import{j as e,R as Te,L as He,_ as Ce,u as ze,c as Me,m as Ve,r as h,d as We,o as _,p as fe,i as xe}from"./main-pxHJVgAj.js";import{r as qe,e as Ke,g as Qe,a as Xe,b as Ye,u as Ze,s as $e}from"./publicRegistrationHelper-C7sSkcqR.js";import{B as Pe}from"./box-DYBuPXzb.js";import{E as et}from"./alert-C-r-ZSpj.js";import"./PencilIcon-BAVMqIEE.js";function tt({isSubmitted:p,availableSteps:f,submittedSteps:n,handleClick:r}){return e.jsx("nav",{"aria-label":"Progress",className:"mb-2 flex w-full",children:e.jsx("ol",{role:"list",className:"divide-y divide-gray-300 rounded-md border border-gray-300 flex md:divide-y-0  w-full flex-wrap",children:f?.map((t,g)=>e.jsxs("li",{className:"relative md:flex md:flex-1 ",children:[t.status==="active"?e.jsx("a",{href:t.href,"aria-current":"step",className:"group max-w-40 flex items-center truncate text-ellipsis overflow-hidden whitespace-nowrap",children:e.jsxs("span",{className:"flex items-center px-2 py-2 text-xs font-medium",children:[e.jsx("span",{className:"flex h-6 w-6 sm:h-8 sm:w-8 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-white text-xs",children:t.id})}),e.jsx("span",{className:"ml-1 mr-3 text-xs font-medium text-indigo-600",children:t.label??t.name})]})}):n?.find(a=>a.name==t.name)||p?e.jsx("a",{href:t.href,className:"group max-w-40 flex items-center truncate text-ellipsis overflow-hidden whitespace-nowrap",onClick:a=>r(g,a),children:e.jsxs("span",{className:"flex items-center px-2 py-2 text-xs font-medium",children:[e.jsx("span",{className:"flex h-6 w-6 sm:h-8 sm:w-8 items-center justify-center rounded-full bg-gray-300 group-hover:bg-gray-400",children:e.jsx("span",{className:"text-gray-500 group-hover:text-gray-900",children:t.id})}),e.jsx("span",{className:"ml-1 mr-3 text-xs font-medium text-gray-400 group-hover:text-gray-900",children:t.label??t.name})]})}):e.jsx("a",{href:t.href,className:"group max-w-40 flex items-center truncate text-ellipsis overflow-hidden whitespace-nowrap",onClick:a=>r(g,a),children:e.jsxs("span",{className:"flex items-center px-2 py-2 text-xs font-medium",children:[e.jsx("span",{className:"flex h-6 w-6 sm:h-8 sm:w-8 items-center justify-center rounded-full border-2 border-gray-300 group-hover:border-gray-400",children:e.jsx("span",{className:"text-gray-500 group-hover:text-gray-900",children:t.id})}),e.jsx("span",{className:"ml-1 mr-3 text-xs font-medium text-gray-500 group-hover:text-gray-900",children:t.label??t.name})]})}),g!==f.length-1?e.jsx(e.Fragment,{children:e.jsx("div",{"aria-hidden":"true",className:"absolute right-0 top-0 hidden h-full w-5 md:block",children:e.jsx("svg",{fill:"none",viewBox:"0 0 22 80",preserveAspectRatio:"none",className:"h-full w-full text-gray-300",children:e.jsx("path",{d:"M0 -2L20 40L0 82",stroke:"currentcolor",vectorEffect:"non-scaling-stroke",strokeLinejoin:"round"})})})}):null]},t.name))})})}const st=Te.lazy(()=>Ce(()=>import("./formSubmission-3KXjCBnz.js"),[])),at=Te.lazy(()=>Ce(()=>import("./modalForm-xyOCzcEX.js"),[]));function rt({steps:p,userRoleJson:f,isCoordinatorView:n,gotoHome:r,participantType:t,isSubmitted:g,selectedUser:a,selectedTeam:N,eventDetails:u,activeStep:B,isLoading:l,updateIndex:i,availableSteps:d,submittedSteps:G,allStepsComponents:L,customComponents:b,data:O,onChange:H,handleClick:E,handleNext:z,components:A,tempUser:v,selectedComponent:j,setSelectedComponent:o,isDirectOpen:$=!1,isProperlyLoaded:K=!0}){if(!d||d?.length==0)return e.jsx("div",{className:"text-center text-2xl text-gray-500",children:a||N?"Steps Loading/No Steps Found":"Unfortunately, no steps are available at this time."});let Q=d.findIndex(c=>c.status==="active")+1===d.length,M=d.findIndex(c=>c.name==="Guardian Registration")>-1;if(a||N||M||$){let c=e.jsxs("span",{className:"text-gray-500",children:[u?.EventName+""," ",e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-200 px-4 py-1 text-[10px] font-medium text-green-700 ring-1 ring-inset ring-green-600/20 ml-2",children:"New Participant Registration"})]});t==="Team"&&(c=e.jsxs("span",{className:"text-gray-500",children:[u?.EventName+""," ",e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-200 px-4 py-1 text-[10px] font-medium text-green-700 ring-1 ring-inset ring-green-600/20 ml-2",children:"New Team Registration"})]})),a&&a.Name&&(c=u?.EventName+" - "+a.Name),f?.FinishedSteps==!0&&(c=u?.EventName+" - "+a.Name+" - Submitted");let w="Registration Form",y="Please fill the form to register for the event";return a&&a.Name&&(w=a.Name+" - Registration Form",y="Please continue remaining steps to complete the registration"),N&&N.TeamName&&(w=N.TeamName+" - Registration Form",y="Please continue remaining steps to complete the registration"),g&&(w="View",y="Please view the details submitted in the registration form"),v&&(c=u?.EventName+" - First User Registration",w="Registration Form",y="Please fill the form to register for the event"),M&&(c=u?.EventName+" - Account Registration",w="Account Registration Form",y="Please fill the form to register an account for adding participants"),e.jsx(at,{title:w,description:y,open:!0,customHeading:b||null,setOpen:()=>{r()},children:e.jsx(Pe,{heading:c,outerClasses:"relative w-full",headingClasses:"px-1 lg:px-4  w-full",children:e.jsx("div",{className:"w-full mt-5 min-h-[800px]",id:"registrationBox",children:B?e.jsxs(e.Fragment,{children:[d?.length>1&&e.jsx(tt,{isSubmitted:g,availableSteps:d,submittedSteps:G,handleClick:E}),K?l?e.jsx(He,{}):e.jsx(e.Fragment,{children:e.jsx(st,{isCoordinatorView:n,participantType:t,isGuardianRegistration:M,handleNext:z,isSubmitted:g,eventDetails:u,isPlayGround:!1,onChange:H,data:O,isLastStep:Q,existingComponents:A,selectedComponent:j,setSelectedComponent:o,components:A},i)}):e.jsx(et,{info:"We couldn't find the selected user or team."})]}):e.jsx("div",{className:"text-center text-2xl text-gray-500",children:"Please select a step to proceed"})})})})}else if(v&&t==="individual")return e.jsx(Pe,{heading:u+" - Event Registration",outerClasses:"relative w-3/4",headingClasses:"px-1 md:px-6  w-full",children:e.jsx("div",{className:"w-full mt-5",children:e.jsx("div",{className:"text-center text-2xl text-gray-500",children:"Please click on add button and proceed"})})})}const nt=p=>{const{getParticipantsLink:f,participantTypeInt:n,candidateId:r,isDirectOpen:t=!1}=p,{eventDetails:g,jsonSettings:a,allStepsComponents:N,participationDetails:u,participationsStatus:B,refreshParticipationDetails:l}=ze(),i={...r&&n==1?{Candidate:r,participantType:"1"}:r&&n==2?{Candidate:r,TeamId:r,participantType:"2"}:t?{participantType:n==1?"1":"2"}:{}},{row:d,update:G,status:L,setFilter:b,filters:O}=Me(f||"/CandidateJson/GetParticipants",{deleteUrl:"/CandidateJson/RemoveUser",mandatoryParams:["participantType","Candidate"],select:"participantList,userList,UserEmail,UserName,UserDobString,UserImage,UserMobile,UserPhone,Email,Group,Candidate,CandidateUser,JsonSettings,Gender,GroupName,Fees,TeamTeamName,Team,TeamStrength,TeamMembersList,TeamMembers,TeamStrength,CandidateIdentityNumber,TeamIdentityNumber,CompetitionOrder,CreatedBy,CreatedByUserName,ParticipationId,UserJsonSettings,TeamJsonSettings,Remarks,LevelSettings,RegistrationId",updateUrl:"/CandidateJson/UpdateParticipant",doCache:!0,noGet:!r||!i.participantType,limit:r?1:0,filter:i}),H=r?d:u,E=r?L:B,z=async j=>{try{return await fe("/CandidateJson/UpdateTeam",j)}catch(o){throw console.error("Update team error:",o),o}},A=async j=>{try{return await fe("/CandidateJson/UpdateUser",j)}catch(o){throw console.error("Update user error:",o),o}},v=async j=>{try{return await fe("/CandidateJson/UpdateUserRoles",j)}catch(o){throw console.error("Update role error:",o),o}};return e.jsx(it,{...p,eventDetails:g,jsonSettings:a,allStepsComponents:N,participationDetails:H,participationsStatus:E,currentFilters:O,updateParticipations:G,setParticipationsFilter:b,updateTeam:z,updateUser:A,updateRole:v,isDataLoading:Ve(E)})},it=({view:p,isCoordinatorView:f,participantTypeInt:n,candidateId:r,closeModel:t,customComponents:g,allowEdit:a,isDirectOpen:N=!1,eventDetails:u,jsonSettings:B,allStepsComponents:l,participationDetails:i,currentFilters:d,updateParticipations:G,setParticipationsFilter:L,updateTeam:b,updateUser:O,updateRole:H,isDataLoading:E})=>{const[z,A]=h.useState(!0),{user:v}=We()||{};if(!v||!v.Email)return e.jsx("div",{children:"Please log in to access this form."});const j=v?.RoleTitle==="Guardian",o=v?.Email?.indexOf("justnshalom")!=-1,[$,K]=h.useState(0),[Q,M]=h.useState(null),[c,w]=h.useState({});let[y,ee]=h.useState(null),[he,pe]=h.useState(!1);const[te,Ne]=h.useState([]),[m,se]=h.useState(r),U=n==1?"Individual":n==2?"Team":"";let[ae,Fe]=h.useState([...qe]),ve={},re={};const ne=s=>M(s);m&&(n==1?i?.UsersList?.length&&i.UsersList[0]:n==2&&i?.UsersList?.length&&i.UsersList[0]),console.log({participationDetails:i}),h.useEffect(()=>{m&&(n==1&&d?.Candidate!=m?L({Candidate:m,participantType:"2"}):n==2&&(d?.Candidate!=m||d?.TeamId!=m)&&L({Candidate:m,participantType:"2",TeamId:m}))},[m,d?.Candidate]);let Le=Ke(i,m,Q?.UId,y?.Team),{userRoles:je,userRole:P,users:ie,userData:T,teams:ye,teamData:C}=Le;console.log({participationDetails:i,selectedUser:Q,selectedTeam:y}),console.log({userRoles:je,userRole:P,users:ie,userData:T,teams:ye,teamData:C});let le=T,oe=C,X=ie?.length?null:_(localStorage.user)?.user;if(j&&!o&&(X=null),U=="Team"){let s=_(localStorage.user)?.user;s&&(X=s?.Email?.indexOf("justnshalom")==-1?null:s)}let Y=X?{UId:X?.UId}:null;Y&&(T={UId:Y?.UId});const be=E||he;let S=_(P?.JsonSettings),de=_(T?.JsonSettings),V=_(C?.TeamJsonSettings);const Ee=B?.AdditionalSettings,Ae=Object.keys(l??{});let Je=_(c?.JsonSettings),ce=Ae?.includes("Agreement")&&l?.Agreement?.filter(s=>s?.validate?.required&&!S[s.name]&&!Je[s.name])?.length==0;ce&&localStorage.setItem("isAgreementStepFilled","true"),localStorage.getItem("isAgreementStepFilled")=="true"&&(ce=!0);let R=Qe(l,ae,ce,U,ie,Y,p,f),x=Xe(R),Se=Ye(l,x),me=x?Ze(x.name,{},K,x,P,S,T,de,U,C,i,l,le,oe,V,!1,c):{};const we=(s,W,J,F,Ie,k,q,ue,Ge)=>{if(W.preventDefault(),!F)return;let Oe=F[s];if(!(ue?.FinishedSteps||Ge?.FinishedSteps||m)&&!J&&!(F.findIndex(ge=>ge.status==="active")>s)&&!te.find(ge=>ge.name==Oe.name)){xe.error("Please complete the current step/click the next button for proceed to the next step.");return}const Z=F?.map((I,D)=>D===s?{...I,status:"active"}:{...I,status:"inactive"});if(F=Z,k=Z.find(I=>I.status==="active"),l[k.name]){let I=l[k.name];I.forEach(D=>{D.name=D.name.charAt(0).toLowerCase()+D.name.slice(1)}),re[k.name]=[...I]}else re[k.name]=[];window.scrollTo({top:0,behavior:"smooth"}),ae=Z,Fe(Z)},ke=async(s,W,J,F)=>{pe(!0),A(!0),ve={...ve,...s};let Ie=R.findIndex(q=>q.status==="active")+1;if(J||Ie>=R.length&&(U=="Individual"?S.FinishedSteps=!0:s.FinishedSteps=!0),await $e(s,c,x,P,je,S,T,de,U,C,i,Se,H,O,b,L,G,le,ne,oe,ee,w,V,ye,Ee,J,se)){Ne([...te,x]),W();let q=R.findIndex(ue=>ue.status==="active")+1;q<R.length&&!J&&!F?we(q,{preventDefault:()=>{}},!0,R,me,x,P,S,V):(ne(null),P={},de={},S={},C={},ee(null),t&&(se(null),t(),z&&refreshParticipationDetails({takeNew:!0})),xe.success("Registration saved successfully!"))}else xe.error("Failed to save data");pe(!1),K($+1)},De=s=>{re[x.name]=s},_e=(s,W)=>{we(s,W,!1,R,me,x,P,S,V)};let Ue=U=="Individual"&&S?.FinishedSteps||U=="Team"&&V?.FinishedSteps;a&&m&&(Ue=!1),l?.User&&l?.User?.length>0,l?.Team&&l?.Team?.length>0;let Be=()=>{ne(null),ee(null),Ne([]),t&&(se(null),t(),refreshParticipationDetails({takeNew:!0}))};var Re=!0;return m>0&&i?.UsersList?.length>0&&(!T&&n==1||!C&&n==2)&&(Re=!1),m>0&&!i&&(he=!0),e.jsx("div",{className:"relative",children:e.jsx(rt,{isDirectOpen:N,isCoordinatorView:f,customComponents:g,isProperlyLoaded:Re,userRoleJson:S,participantType:U,steps:ae,gotoHome:Be,isSubmitted:Ue,selectedTeam:oe,tempUser:Y,selectedUser:le,eventDetails:u,activeStep:x,isLoading:be,onChange:De,availableSteps:R,submittedSteps:te,allStepsComponents:l,data:{...me},handleClick:_e,handleNext:ke,components:Se,setSelectedComponent:()=>{}})})},gt=p=>e.jsx(nt,{...p});export{it as RegistrationFormComponent,gt as RenderRegistrationForm,nt as WithRegistrationFormData,gt as default};
