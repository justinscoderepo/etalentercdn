import{r as L,j as r,t as ve,m as Se,u as je,z as W}from"./main-Dy5yWvzN.js";import{L as Te}from"./layoutOuter-D7oeNeR3.js";import{P as Me}from"./pageHeader-DP0Dkcua.js";import{O as Ne}from"./OldNewTabLayout-CIyV-ZE0.js";import{e as te}from"./navigationUtils-CcqZl_6x.js";import Oe from"./formEditor-ClFyBj4B.js";import{F as re}from"./UserGroupIcon-BRj8vEkm.js";import{F as xe}from"./UserIcon-gBR74wIR.js";import{F as be}from"./XCircleIcon-hWtclMWx.js";import{F as ye}from"./CheckCircleIcon-BrWmx4Wk.js";import{F as Fe}from"./PencilIcon-DN9WKU8z.js";import{F as Ce}from"./TrashIcon-Ba_im28t.js";import{F as ke}from"./PlusIcon-AwvfnZSz.js";import{F as Ie}from"./TableCellsIcon-kMAIlOfN.js";import"./index.esm-D7Mk_BkS.js";import"./renderComponents-lsxJp_7z.js";import"./validationMessage-BZqwpoFm.js";import"./CheckCircleIcon-DTMDZHXi.js";import"./modalForm-C90j6Jbi.js";import"./dialog-Yqad7z-R.js";import"./keyboard-CTrARFuf.js";import"./description-DWNVeqb9.js";import"./use-is-mounted-Dwq9Ps9i.js";import"./XMarkIcon-SFj4wpNZ.js";function Ee({title:t,titleId:A,...C},y){return L.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":A},C),t?L.createElement("title",{id:A},t):null,L.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))}const Re=L.forwardRef(Ee);function Pe({title:t,titleId:A,...C},y){return L.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":A},C),t?L.createElement("title",{id:A},t):null,L.createElement("path",{fillRule:"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z",clipRule:"evenodd"}))}const ae=L.forwardRef(Pe),Ye=(t,A)=>{const C=new Date(t);C.setHours(0,0,0,0);const y=new Date(A);y.setHours(0,0,0,0),y.setDate(y.getDate()+1);let E=y.getFullYear()-C.getFullYear(),T=y.getMonth()-C.getMonth(),f=y.getDate()-C.getDate();if(f<0){T--;const S=new Date(y.getFullYear(),y.getMonth(),0);f+=S.getDate()}return T<0&&(E--,T+=12),{years:E,months:T,days:f}},Ge=(t,A)=>{const C=new Date(t);C.setHours(0,0,0,0);const y=new Date(A);y.setHours(0,0,0,0),y.setDate(y.getDate()+1);const E=Math.abs(y-C);return Math.ceil(E/(1e3*60*60*24))+1},Be=t=>{if(t.years===0&&t.months===0)return`${t.days} ${t.days===1?"day":"days"}`;if(t.years===0)return t.days===0?`${t.months} ${t.months===1?"month":"months"}`:`${t.months} ${t.months===1?"month":"months"}, ${t.days} ${t.days===1?"day":"days"}`;{const A=[];return A.push(`${t.years} ${t.years===1?"year":"years"}`),t.months>0&&A.push(`${t.months} ${t.months===1?"month":"months"}`),t.days>0&&A.push(`${t.days} ${t.days===1?"day":"days"}`),A.join(", ")}},_e=t=>{if(!t)return null;const A=t.split("-");return A.length!==3?null:new Date(parseInt(A[2]),parseInt(A[1])-1,parseInt(A[0]))};function Le({formData:t,getValues:A}){const C=t?.AgeFrom||A?.("AgeFrom"),y=t?.AgeTo||A?.("AgeTo"),E=t?.AgeCalculationDate||A?.("AgeCalculationDate");if(!C||!y||!E)return null;const T=_e(E);if(!T)return null;const f=new Date(T);f.setFullYear(f.getFullYear()-y-1),f.setDate(f.getDate()+1);const S=new Date(T);S.setFullYear(S.getFullYear()-C),new Date().getFullYear();const k=Ye(f,S),P=Ge(f,S),Y=k.years===0;return r.jsxs("div",{className:"p-4 bg-surface border border-primary/20 rounded-md",children:[r.jsxs("h4",{className:"text-sm font-semibold text-onSurface mb-3 flex items-center gap-2",children:[r.jsx(ae,{className:"h-5 w-5 text-cyan-600"}),"Calculated Age Group Preview"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[r.jsxs("div",{className:"bg-surfaceCard p-3 rounded border border-cyan-100",children:[r.jsx("span",{className:"text-xs text-onSurfaceVariant block mb-1",children:"Age From (Youngest)"}),r.jsxs("span",{className:"text-base font-semibold text-onSurface",children:[C," years"]})]}),r.jsxs("div",{className:"bg-surfaceCard p-3 rounded border border-cyan-100",children:[r.jsx("span",{className:"text-xs text-onSurfaceVariant block mb-1",children:"Age To (Oldest)"}),r.jsxs("span",{className:"text-base font-semibold text-onSurface",children:[y," years"]})]}),r.jsxs("div",{className:"bg-surfaceCard p-3 rounded border border-cyan-100",children:[r.jsx("span",{className:"text-xs text-onSurfaceVariant block mb-1",children:"Calculation Date"}),r.jsx("span",{className:"text-base font-semibold text-onSurface",children:E})]})]}),r.jsx("div",{className:"bg-emerald-50 p-3 rounded border border-emerald-200",children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("span",{className:"text-xs text-emerald-700 font-medium block mb-1",children:"Birth Date Range Span"}),r.jsx("span",{className:"text-sm font-semibold text-emerald-900",children:Be(k)})]}),Y&&r.jsxs("div",{className:"text-right",children:[r.jsx("span",{className:"text-xs text-emerald-700 font-medium block mb-1",children:"Total Days"}),r.jsxs("span",{className:"text-sm font-semibold text-emerald-900",children:[P," ",P===1?"day":"days"]})]})]})}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-onSurfaceVariant bg-surfaceCard p-2 rounded",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Birth Date From (Oldest):"})," ",String(f.getDate()).padStart(2,"0"),"-",String(f.getMonth()+1).padStart(2,"0"),"-",f.getFullYear()]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Birth Date To (Youngest):"})," ",String(S.getDate()).padStart(2,"0"),"-",String(S.getMonth()+1).padStart(2,"0"),"-",S.getFullYear()]})]})]})]})}const Ve=[{text:"Any",value:"Any",icon:re},{text:"Individual",value:"Individual",icon:xe},{text:"Team",value:"Team",icon:re}],Ue=[{text:"No",value:"No",icon:be},{text:"Yes (Multiple age groups)",value:"Yes",icon:ye}],de=t=>{const A=String(t.getDate()).padStart(2,"0"),C=String(t.getMonth()+1).padStart(2,"0"),y=t.getFullYear();return`${A}-${C}-${y}`};function ze({editingGroup:t,existingGroups:A=[],onSubmit:C,onCancel:y,open:E}){console.log("AgeGroupForm editingGroup:",t);const T=L.useMemo(()=>{if(A&&A.length>0){const b=A[0];return{day:b.AgeStartDate||1,month:b.AgeStartMonth||1,year:b.AgeStartYear||new Date().getFullYear()}}return{day:1,month:1,year:new Date().getFullYear()}},[A]),f=L.useMemo(()=>{if(!t){const u=new Date(T.year,T.month-1,T.day);return{Status:2,ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No",AgeFrom:"",AgeTo:"",AgeCalculationDate:de(u)}}console.log("Editing group data:",{AgeStartYear:t.AgeStartYear,AgeStartMonth:t.AgeStartMonth,AgeStartDate:t.AgeStartDate});const b=t.AgeStartYear&&t.AgeStartMonth&&t.AgeStartDate?new Date(t.AgeStartYear,t.AgeStartMonth-1,t.AgeStartDate):new Date(T.year,T.month-1,T.day);console.log("Calculated AgeCalculationDate:",b);const D=de(b);return console.log("Formatted AgeCalculationDate string:",D),{EventGroupId:t.EventGroupId,GroupName:t.GroupName,AgeFrom:t.AgeFrom||"",AgeTo:t.AgeTo||"",AgeCalculationDate:D,ParticipantType:t.parsedSettings.ParticipantType,IsCommon:t.parsedSettings.IsCommon,NoAgeIdPrefix:t.parsedSettings.NoAgeIdPrefix,Order:t.Order,Status:t.Status}},[t,T]),S=[{name:"GroupName",label:"Group Name",type:"text",placeholder:"e.g., Juniors, Children, Seniors",validate:{required:!0,minLength:2,maxLength:50}},{name:"ParticipantType",label:"Participant Type",type:"toggle",options:Ve,validate:{required:!0}},{name:"AgeFrom",label:"Age From (Youngest Age)",type:"number",placeholder:"e.g., 5",description:`Ages calculated on ${T.day}/${T.month}/${T.year}`,min:0,max:100,validate:{required:!0,min:0,max:100,lessThanOrEqualTo:"AgeTo"}},{name:"AgeTo",label:"Age To (Oldest Age)",type:"number",placeholder:"e.g., 12",min:0,max:100,validate:{required:!0,min:0,max:100,greaterThanOrEqualTo:"AgeFrom"}},{name:"AgeCalculationDate",label:"Age Calculation Date",type:"normalDate",placeholder:"Select the date for age calculation",description:"Age will be calculated based on this date",validate:{required:!0}},{name:"AgePreview",type:"custom",render:b=>r.jsx(Le,{...b})},{name:"IsCommon",label:"Is Common Group",type:"toggle",options:Ue},{name:"NoAgeIdPrefix",label:"No Age-Based ID Prefix",type:"toggle",options:[{text:"No (Use age prefix)",value:"No",icon:be},{text:"Yes (No prefix)",value:"Yes",icon:ye}],conditions:[{key:"IsCommon",value:"No"}]}],k=async(b,...D)=>{if(b.IsCommon==="Yes"&&(b.NoAgeIdPrefix="Yes"),b.AgeCalculationDate){const u=new Date(b.AgeCalculationDate);b.AgeStartDate=u.getDate(),b.AgeStartMonth=u.getMonth()+1,b.AgeStartYear=u.getFullYear()}return C(b,...D)},P=(b,D,u)=>{},Y=(b,D,u)=>{};return r.jsx(Oe,{title:t?"Edit Age Group":"Add New Age Group",description:t?"Update age group details by modifying age ranges and calculation dates":"Create a new age group by specifying age ranges and calculation dates",row:f,fields:S,onSave:k,onCancel:y,ageFromOnChange:P,ageToOnChange:Y})}function qe({gapInfo:t}){return r.jsxs("div",{className:"relative pb-8",children:[r.jsx("span",{className:"absolute left-6 top-4 -ml-px h-full w-0.5 bg-red-300 border-l-2 border-dashed","aria-hidden":"true"}),r.jsxs("div",{className:"relative flex items-start space-x-3",children:[r.jsx("div",{className:"relative flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-full bg-red-100 border-2 border-red-400 border-dashed",children:r.jsx("span",{className:"text-xs font-bold text-red-600",children:"GAP"})}),r.jsx("div",{className:"min-w-0 flex-1",children:r.jsxs("div",{className:"rounded-lg border-2 border-red-200 border-dashed bg-red-50 shadow-sm p-4",children:[r.jsx("h3",{className:"text-sm font-semibold text-red-700 mb-2",children:"⚠️ Missing Age Range"}),r.jsxs("div",{className:"text-xs text-red-600 space-y-1",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Gap Ages:"})," ",t.missingAges]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Date Range:"})," ",t.dateFrom," to ",t.dateTo]}),r.jsx("p",{className:"italic text-red-500 mt-2",children:"Participants born in this range have no age group assigned!"})]})]})})]})]})}function $e({group:t,onEdit:A,onDelete:C,isLast:y}){const E=t.parsedSettings.ParticipantType==="Individual"?"bg-cyan-500":t.parsedSettings.ParticipantType==="Team"?"bg-emerald-500":"bg-indigo-500",T=t.parsedSettings.ParticipantType==="Individual"?"border-cyan-200":t.parsedSettings.ParticipantType==="Team"?"border-emerald-200":"border-indigo-200",f=t.parsedSettings.ParticipantType==="Individual"?"text-cyan-600":t.parsedSettings.ParticipantType==="Team"?"text-emerald-600":"text-indigo-600",S=b=>{const D=new Date(b),u=String(D.getDate()).padStart(2,"0"),e=String(D.getMonth()+1).padStart(2,"0"),a=D.getFullYear();return`${u}-${e}-${a}`},k=new Date(t.MinAgeDate),P=new Date(t.MaxAgeDate),Y={from:S(t.MinAgeDate),to:S(t.MaxAgeDate),minYear:k.getFullYear(),maxYear:P.getFullYear()};return r.jsxs("div",{className:"relative pb-8",children:[!y&&r.jsx("span",{className:"absolute left-6 top-8 -ml-px h-full w-0.5 bg-border","aria-hidden":"true"}),r.jsxs("div",{className:"relative flex items-start space-x-3",children:[r.jsx("div",{className:`relative flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-full ${E} shadow-sm`,children:r.jsxs("span",{className:"text-base font-bold text-white",children:[t.AgeFrom,"-",t.AgeTo]})}),r.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[r.jsxs("div",{className:`rounded-lg border ${T} bg-surfaceCard shadow-sm p-4`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:`text-base font-semibold ${f}`,children:t.GroupName}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>A(t),className:"text-onSurfaceVariant hover:text-primary transition-colors",title:"Edit",children:r.jsx(Fe,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>C(t.EventGroupId),className:"text-onSurfaceVariant hover:text-red-600 transition-colors",title:"Delete",children:r.jsx(Ce,{className:"h-4 w-4"})})]})]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-onSurfaceVariant",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(ae,{className:"h-4 w-4 text-onSurfaceVariant"}),r.jsxs("span",{children:["Age on: ",t.AgeStartDate,"/",t.AgeStartMonth,"/",t.AgeStartYear]})]}),t.parsedSettings.IsCommon==="Yes"&&r.jsx("span",{className:"rounded-full bg-yellow-100 px-2 py-1 text-xs font-medium text-yellow-800",children:"Common"}),t.Status!==1&&r.jsx("span",{className:"rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800",children:"Inactive"})]}),r.jsxs("div",{className:"mt-2 text-xs text-onSurfaceVariant",children:["Order: ",t.Order]})]}),r.jsx("div",{className:"rounded-md border border-border bg-surfaceCard shadow-sm p-3",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(ae,{className:"h-5 w-5 text-onSurfaceVariant flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-xs font-semibold text-onSurface mb-1",children:"Birth Date Range (Eligible Participants)"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-onSurfaceVariant",children:"From:"}),r.jsx("span",{className:"ml-1 font-medium text-onSurface",children:Y.from}),r.jsxs("span",{className:"ml-1 text-onSurfaceVariant",children:["(",Y.minYear,")"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-onSurfaceVariant",children:"To:"}),r.jsx("span",{className:"ml-1 font-medium text-onSurface",children:Y.to}),r.jsxs("span",{className:"ml-1 text-onSurfaceVariant",children:["(",Y.maxYear,")"]})]})]}),r.jsxs("p",{className:"mt-1 text-xs text-onSurfaceVariant italic",children:["Participants born within this date range will be age ",t.AgeFrom,"-",t.AgeTo," on ",t.AgeStartDate,"/",t.AgeStartMonth,"/",t.AgeStartYear]})]})]})})]})]})]})}function Je({groups:t,onEdit:A,onDelete:C,detectGaps:y}){const E=t.filter(S=>S.parsedSettings.ParticipantType==="Individual"||S.parsedSettings.ParticipantType==="Any").sort((S,k)=>(S.Order||0)-(k.Order||0)),T=t.filter(S=>S.parsedSettings.ParticipantType==="Team"||S.parsedSettings.ParticipantType==="Any").sort((S,k)=>(S.Order||0)-(k.Order||0)),f=(S,k,P,Y,b)=>{const D=[];return S.forEach((u,e)=>{D.push(r.jsx("li",{children:r.jsx($e,{group:u,onEdit:A,onDelete:C,isLast:!1})},u.EventGroupId));const a=k.find(m=>m.afterIndex===e);a&&D.push(r.jsx("li",{children:r.jsx(qe,{gapInfo:a})},`gap-${e}`))}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:`flex items-center gap-2 mb-4 pb-2 border-b-2 ${b.border}`,children:[Y,r.jsx("h2",{className:`text-base font-semibold ${b.text}`,children:P}),r.jsxs("span",{className:`ml-auto rounded-full ${b.bg} px-2 py-1 text-xs font-medium ${b.badge}`,children:[S.length," groups"]})]}),S.length===0?r.jsxs("p",{className:"text-sm text-gray-500",children:["No ",P.toLowerCase()," defined"]}):r.jsx("div",{className:"flow-root",children:r.jsx("ul",{className:"-mb-8",children:D})})]})};return r.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[E.length>0&&f(E,y(E),"Individual Groups",r.jsx(xe,{className:"h-6 w-6 text-cyan-600"}),{border:"border-cyan-300",text:"text-cyan-700",bg:"bg-cyan-100",badge:"text-cyan-800"}),T.length>0&&f(T,y(T),"Team Groups",r.jsx(re,{className:"h-6 w-6 text-emerald-600"}),{border:"border-emerald-300",text:"text-emerald-700",bg:"bg-emerald-100",badge:"text-emerald-800"})]})}var K={},z={},X={},Q={},ue;function ne(){if(ue)return Q;ue=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.Direction=void 0;var t;return(function(A){A.Right="to right",A.Left="to left",A.Down="to bottom",A.Up="to top"})(t||(Q.Direction=t={})),Q}var he;function De(){return he||(he=1,(function(t){var A=X&&X.__spreadArray||function(s,o,d){if(d||arguments.length===2)for(var w=0,M=o.length,j;w<M;w++)(j||!(w in o))&&(j||(j=Array.prototype.slice.call(o,0,w)),j[w]=o[w]);return s.concat(j||Array.prototype.slice.call(o))};Object.defineProperty(t,"__esModule",{value:!0}),t.isIOS=t.useThumbOverlap=t.assertUnreachable=t.voidFn=t.getTrackBackground=t.replaceAt=t.schd=t.translate=t.getClosestThumbIndex=t.translateThumbs=t.getPaddingAndBorder=t.getMargin=t.checkInitialOverlap=t.checkValuesAgainstBoundaries=t.checkBoundaries=t.isVertical=t.relativeValue=t.normalizeValue=t.isStepDivisible=t.isTouchEvent=t.getStepDecimals=void 0;var C=ve(),y=ne(),E=function(s){var o=s.toString().split(".")[1];return o?o.length:0};t.getStepDecimals=E;function T(s){return s.touches&&s.touches.length||s.changedTouches&&s.changedTouches.length}t.isTouchEvent=T;function f(s,o,d){var w=(o-s)/d,M=8,j=Number(w.toFixed(M));return parseInt(j.toString(),10)===j}t.isStepDivisible=f;function S(s,o,d,w,M,j,N){var I=1e11;if(s=Math.round(s*I)/I,!j){var B=N[o-1],R=N[o+1];if(B&&B>s)return B;if(R&&R<s)return R}if(s>w)return w;if(s<d)return d;var $=Math.floor(s*I-d*I)%Math.floor(M*I),V=Math.floor(s*I-Math.abs($)),U=$===0?s:V/I,_=Math.abs($/I)<M/2?U:U+M,G=(0,t.getStepDecimals)(M);return parseFloat(_.toFixed(G))}t.normalizeValue=S;function k(s,o,d){return(s-o)/(d-o)}t.relativeValue=k;function P(s){return s===y.Direction.Up||s===y.Direction.Down}t.isVertical=P;function Y(s,o,d){if(o>=d)throw new RangeError("min (".concat(o,") is equal/bigger than max (").concat(d,")"));if(s<o)throw new RangeError("value (".concat(s,") is smaller than min (").concat(o,")"));if(s>d)throw new RangeError("value (".concat(s,") is bigger than max (").concat(d,")"))}t.checkBoundaries=Y;function b(s,o,d){return s<o?o:s>d?d:s}t.checkValuesAgainstBoundaries=b;function D(s){if(!(s.length<2)&&!s.slice(1).every(function(o,d){return s[d]<=o}))throw new RangeError("values={[".concat(s,"]} needs to be sorted when allowOverlap={false}"))}t.checkInitialOverlap=D;function u(s){var o=window.getComputedStyle(s);return{top:parseInt(o["margin-top"],10),bottom:parseInt(o["margin-bottom"],10),left:parseInt(o["margin-left"],10),right:parseInt(o["margin-right"],10)}}t.getMargin=u;function e(s){var o=window.getComputedStyle(s);return{top:parseInt(o["padding-top"],10)+parseInt(o["border-top-width"],10),bottom:parseInt(o["padding-bottom"],10)+parseInt(o["border-bottom-width"],10),left:parseInt(o["padding-left"],10)+parseInt(o["border-left-width"],10),right:parseInt(o["padding-right"],10)+parseInt(o["border-right-width"],10)}}t.getPaddingAndBorder=e;function a(s,o,d){var w=d?-1:1;s.forEach(function(M,j){return x(M,w*o[j].x,o[j].y)})}t.translateThumbs=a;function m(s,o,d,w){for(var M=0,j=g(s[0],o,d,w),N=1;N<s.length;N++){var I=g(s[N],o,d,w);I<j&&(j=I,M=N)}return M}t.getClosestThumbIndex=m;function x(s,o,d){s.style.transform="translate(".concat(o,"px, ").concat(d,"px)")}t.translate=x;var l=function(s){var o=[],d=null,w=function(){for(var M=[],j=0;j<arguments.length;j++)M[j]=arguments[j];o=M,!d&&(d=requestAnimationFrame(function(){d=null,s.apply(void 0,o)}))};return w};t.schd=l;function p(s,o,d){var w=s.slice(0);return w[o]=d,w}t.replaceAt=p;function F(s){var o=s.values,d=s.colors,w=s.min,M=s.max,j=s.direction,N=j===void 0?y.Direction.Right:j,I=s.rtl,B=I===void 0?!1:I;B&&N===y.Direction.Right?N=y.Direction.Left:B&&y.Direction.Left&&(N=y.Direction.Right);var R=o.slice(0).sort(function(V,U){return V-U}).map(function(V){return(V-w)/(M-w)*100}),$=R.reduce(function(V,U,_){return"".concat(V,", ").concat(d[_]," ").concat(U,"%, ").concat(d[_+1]," ").concat(U,"%")},"");return"linear-gradient(".concat(N,", ").concat(d[0]," 0%").concat($,", ").concat(d[d.length-1]," 100%)")}t.getTrackBackground=F;function n(){}t.voidFn=n;function i(s){throw new Error("Didn't expect to get here")}t.assertUnreachable=i;var v=function(s,o,d,w,M){M===void 0&&(M=function(N){return N});var j=Math.ceil(A([s],Array.from(s.children),!0).reduce(function(N,I){var B=Math.ceil(I.getBoundingClientRect().width);if(I.innerText&&I.innerText.includes(d)&&I.childElementCount===0){var R=I.cloneNode(!0);R.innerHTML=M(o.toFixed(w)),R.style.visibility="hidden",document.body.appendChild(R),B=Math.ceil(R.getBoundingClientRect().width),document.body.removeChild(R)}return B>N?B:N},s.getBoundingClientRect().width));return j},h=function(s,o,d,w,M,j,N){N===void 0&&(N=function(R){return R});var I=[],B=function(R){var $=v(d[R],w[R],M,j,N),V=o[R].x;o.forEach(function(U,_){var G=U.x,q=v(d[_],w[_],M,j,N);R!==_&&(V>=G&&V<=G+q||V+$>=G&&V+$<=G+q)&&(I.includes(_)||(I.push(R),I.push(_),I=A(A([],I,!0),[R,_],!1),B(_)))})};return B(s),Array.from(new Set(I.sort()))},c=function(s,o,d,w,M,j){w===void 0&&(w=.1),M===void 0&&(M=" - "),j===void 0&&(j=function(_){return _});var N=(0,t.getStepDecimals)(w),I=(0,C.useState)({}),B=I[0],R=I[1],$=(0,C.useState)(j(o[d].toFixed(N))),V=$[0],U=$[1];return(0,C.useEffect)(function(){if(s){var _=s.getThumbs();if(_.length<1)return;var G={},q=s.getOffsets(),J=h(d,q,_,o,M,N,j),Z=j(o[d].toFixed(N));if(J.length){var ee=J.reduce(function(H,ie,ce,le){return H.length?A(A([],H,!0),[q[le[ce]].x],!1):[q[le[ce]].x]},[]);if(Math.min.apply(Math,ee)===q[d].x){var se=[];J.forEach(function(H){se.push(o[H].toFixed(N))}),Z=Array.from(new Set(se.sort(function(H,ie){return parseFloat(H)-parseFloat(ie)}))).map(j).join(M);var we=Math.min.apply(Math,ee),oe=Math.max.apply(Math,ee),Ae=_[J[ee.indexOf(oe)]].getBoundingClientRect().width;G.left="".concat(Math.abs(we-(oe+Ae))/2,"px"),G.transform="translate(-50%, 0)"}else G.visibility="hidden"}U(Z),R(G)}},[s,o]),[V,B]};t.useThumbOverlap=c;function g(s,o,d,w){var M=s.getBoundingClientRect(),j=M.left,N=M.top,I=M.width,B=M.height;return P(w)?Math.abs(d-(N+B/2)):Math.abs(o-(j+I/2))}var O=function(){var s,o=((s=navigator.userAgentData)===null||s===void 0?void 0:s.platform)||navigator.platform;return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(o)||navigator.userAgent.includes("Mac")&&"ontouchend"in document};t.isIOS=O})(X)),X}var me;function We(){if(me)return z;me=1;var t=z&&z.__extends||(function(){var b=function(D,u){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var m in a)Object.prototype.hasOwnProperty.call(a,m)&&(e[m]=a[m])},b(D,u)};return function(D,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");b(D,u);function e(){this.constructor=D}D.prototype=u===null?Object.create(u):(e.prototype=u.prototype,new e)}})(),A=z&&z.__createBinding||(Object.create?(function(b,D,u,e){e===void 0&&(e=u);var a=Object.getOwnPropertyDescriptor(D,u);(!a||("get"in a?!D.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return D[u]}}),Object.defineProperty(b,e,a)}):(function(b,D,u,e){e===void 0&&(e=u),b[e]=D[u]})),C=z&&z.__setModuleDefault||(Object.create?(function(b,D){Object.defineProperty(b,"default",{enumerable:!0,value:D})}):function(b,D){b.default=D}),y=z&&z.__importStar||function(b){if(b&&b.__esModule)return b;var D={};if(b!=null)for(var u in b)u!=="default"&&Object.prototype.hasOwnProperty.call(b,u)&&A(D,b,u);return C(D,b),D},E=z&&z.__spreadArray||function(b,D,u){if(u||arguments.length===2)for(var e=0,a=D.length,m;e<a;e++)(m||!(e in D))&&(m||(m=Array.prototype.slice.call(D,0,e)),m[e]=D[e]);return b.concat(m||Array.prototype.slice.call(D))};Object.defineProperty(z,"__esModule",{value:!0});var T=y(ve()),f=De(),S=ne(),k=["ArrowRight","ArrowUp","k","PageUp"],P=["ArrowLeft","ArrowDown","j","PageDown"],Y=(function(b){t(D,b);function D(u){var e=b.call(this,u)||this;if(e.trackRef=T.createRef(),e.thumbRefs=[],e.state={draggedTrackPos:[-1,-1],draggedThumbIndex:-1,thumbZIndexes:new Array(e.props.values.length).fill(0).map(function(a,m){return m}),isChanged:!1,markOffsets:[]},e.getOffsets=function(){var a=e.props,m=a.direction,x=a.values,l=a.min,p=a.max,F=e.trackRef.current;if(!F)return console.warn("No track element found."),[];var n=F.getBoundingClientRect(),i=(0,f.getPaddingAndBorder)(F);return e.getThumbs().map(function(v,h){var c={x:0,y:0},g=v.getBoundingClientRect(),O=(0,f.getMargin)(v);switch(m){case S.Direction.Right:return c.x=(O.left+i.left)*-1,c.y=((g.height-n.height)/2+i.top)*-1,c.x+=n.width*(0,f.relativeValue)(x[h],l,p)-g.width/2,c;case S.Direction.Left:return c.x=(O.right+i.right)*-1,c.y=((g.height-n.height)/2+i.top)*-1,c.x+=n.width-n.width*(0,f.relativeValue)(x[h],l,p)-g.width/2,c;case S.Direction.Up:return c.x=((g.width-n.width)/2+O.left+i.left)*-1,c.y=-i.left,c.y+=n.height-n.height*(0,f.relativeValue)(x[h],l,p)-g.height/2,c;case S.Direction.Down:return c.x=((g.width-n.width)/2+O.left+i.left)*-1,c.y=-i.left,c.y+=n.height*(0,f.relativeValue)(x[h],l,p)-g.height/2,c;default:return(0,f.assertUnreachable)(m)}})},e.getThumbs=function(){return e.trackRef&&e.trackRef.current?Array.from(e.trackRef.current.children).filter(function(a){return a.hasAttribute("aria-valuenow")}):(console.warn("No thumbs found in the track container. Did you forget to pass & spread the `props` param in renderTrack?"),[])},e.getTargetIndex=function(a){return e.getThumbs().findIndex(function(m){return m===a.target||m.contains(a.target)})},e.addTouchEvents=function(a){document.addEventListener("touchmove",e.schdOnTouchMove,{passive:!1}),document.addEventListener("touchend",e.schdOnEnd,{passive:!1}),document.addEventListener("touchcancel",e.schdOnEnd,{passive:!1})},e.addMouseEvents=function(a){document.addEventListener("mousemove",e.schdOnMouseMove),document.addEventListener("mouseup",e.schdOnEnd)},e.onMouseDownTrack=function(a){var m;if(!(a.button!==0||(0,f.isIOS)()))if(a.persist(),a.preventDefault(),e.addMouseEvents(a.nativeEvent),e.props.values.length>1&&e.props.draggableTrack){if(e.thumbRefs.some(function(l){var p;return(p=l.current)===null||p===void 0?void 0:p.contains(a.target)}))return;e.setState({draggedTrackPos:[a.clientX,a.clientY]},function(){return e.onMove(a.clientX,a.clientY)})}else{var x=(0,f.getClosestThumbIndex)(e.thumbRefs.map(function(l){return l.current}),a.clientX,a.clientY,e.props.direction);(m=e.thumbRefs[x].current)===null||m===void 0||m.focus(),e.setState({draggedThumbIndex:x},function(){return e.onMove(a.clientX,a.clientY)})}},e.onResize=function(){(0,f.translateThumbs)(e.getThumbs(),e.getOffsets(),e.props.rtl),e.calculateMarkOffsets()},e.onTouchStartTrack=function(a){var m;if(a.persist(),e.addTouchEvents(a.nativeEvent),e.props.values.length>1&&e.props.draggableTrack){if(e.thumbRefs.some(function(l){var p;return(p=l.current)===null||p===void 0?void 0:p.contains(a.target)}))return;e.setState({draggedTrackPos:[a.touches[0].clientX,a.touches[0].clientY]},function(){return e.onMove(a.touches[0].clientX,a.touches[0].clientY)})}else{var x=(0,f.getClosestThumbIndex)(e.thumbRefs.map(function(l){return l.current}),a.touches[0].clientX,a.touches[0].clientY,e.props.direction);(m=e.thumbRefs[x].current)===null||m===void 0||m.focus(),e.setState({draggedThumbIndex:x},function(){return e.onMove(a.touches[0].clientX,a.touches[0].clientY)})}},e.onMouseOrTouchStart=function(a){if(!e.props.disabled){var m=(0,f.isTouchEvent)(a);if(!(!m&&a.button!==0)){var x=e.getTargetIndex(a);x!==-1&&(m?e.addTouchEvents(a):e.addMouseEvents(a),e.setState({draggedThumbIndex:x,thumbZIndexes:e.state.thumbZIndexes.map(function(l,p){return p===x?Math.max.apply(Math,e.state.thumbZIndexes):l<=e.state.thumbZIndexes[x]?l:l-1})}))}}},e.onMouseMove=function(a){a.preventDefault(),e.onMove(a.clientX,a.clientY)},e.onTouchMove=function(a){a.preventDefault(),e.onMove(a.touches[0].clientX,a.touches[0].clientY)},e.onKeyDown=function(a){var m=e.props,x=m.values,l=m.onChange,p=m.step,F=m.rtl,n=m.direction,i=e.state.isChanged,v=e.getTargetIndex(a.nativeEvent),h=F||n===S.Direction.Left||n===S.Direction.Down?-1:1;v!==-1&&(k.includes(a.key)?(a.preventDefault(),e.setState({draggedThumbIndex:v,isChanged:!0}),l((0,f.replaceAt)(x,v,e.normalizeValue(x[v]+h*(a.key==="PageUp"?p*10:p),v)))):P.includes(a.key)?(a.preventDefault(),e.setState({draggedThumbIndex:v,isChanged:!0}),l((0,f.replaceAt)(x,v,e.normalizeValue(x[v]-h*(a.key==="PageDown"?p*10:p),v)))):a.key==="Tab"?e.setState({draggedThumbIndex:-1},function(){i&&e.fireOnFinalChange()}):i&&e.fireOnFinalChange())},e.onKeyUp=function(a){var m=e.state.isChanged;e.setState({draggedThumbIndex:-1},function(){m&&e.fireOnFinalChange()})},e.onMove=function(a,m){var x=e.state,l=x.draggedThumbIndex,p=x.draggedTrackPos,F=e.props,n=F.direction,i=F.min,v=F.max,h=F.onChange,c=F.values,g=F.step,O=F.rtl;if(l===-1&&p[0]===-1&&p[1]===-1)return null;var s=e.trackRef.current;if(!s)return null;var o=s.getBoundingClientRect(),d=(0,f.isVertical)(n)?o.height:o.width;if(p[0]!==-1&&p[1]!==-1){var w=a-p[0],M=m-p[1],j=0;switch(n){case S.Direction.Right:case S.Direction.Left:j=w/d*(v-i);break;case S.Direction.Down:case S.Direction.Up:j=M/d*(v-i);break;default:(0,f.assertUnreachable)(n)}if(O&&(j*=-1),Math.abs(j)>=g/2){for(var N=0;N<e.thumbRefs.length;N++){if(c[N]===v&&Math.sign(j)===1||c[N]===i&&Math.sign(j)===-1)return;var I=c[N]+j;I>v?j=v-c[N]:I<i&&(j=i-c[N])}for(var B=c.slice(0),N=0;N<e.thumbRefs.length;N++)B=(0,f.replaceAt)(B,N,e.normalizeValue(c[N]+j,N));e.setState({draggedTrackPos:[a,m]}),h(B)}}else{var R=0;switch(n){case S.Direction.Right:R=(a-o.left)/d*(v-i)+i;break;case S.Direction.Left:R=(d-(a-o.left))/d*(v-i)+i;break;case S.Direction.Down:R=(m-o.top)/d*(v-i)+i;break;case S.Direction.Up:R=(d-(m-o.top))/d*(v-i)+i;break;default:(0,f.assertUnreachable)(n)}O&&(R=v+i-R),Math.abs(c[l]-R)>=g/2&&h((0,f.replaceAt)(c,l,e.normalizeValue(R,l)))}},e.normalizeValue=function(a,m){var x=e.props,l=x.min,p=x.max,F=x.step,n=x.allowOverlap,i=x.values;return(0,f.normalizeValue)(a,m,l,p,F,n,i)},e.onEnd=function(a){if(a.preventDefault(),document.removeEventListener("mousemove",e.schdOnMouseMove),document.removeEventListener("touchmove",e.schdOnTouchMove),document.removeEventListener("mouseup",e.schdOnEnd),document.removeEventListener("touchend",e.schdOnEnd),document.removeEventListener("touchcancel",e.schdOnEnd),e.state.draggedThumbIndex===-1&&e.state.draggedTrackPos[0]===-1&&e.state.draggedTrackPos[1]===-1)return null;e.setState({draggedThumbIndex:-1,draggedTrackPos:[-1,-1]},function(){e.fireOnFinalChange()})},e.fireOnFinalChange=function(){e.setState({isChanged:!1});var a=e.props,m=a.onFinalChange,x=a.values;m&&m(x)},e.updateMarkRefs=function(a){if(!a.renderMark){e.numOfMarks=void 0,e.markRefs=void 0;return}e.numOfMarks=(a.max-a.min)/e.props.step,e.markRefs=[];for(var m=0;m<e.numOfMarks+1;m++)e.markRefs[m]=T.createRef()},e.calculateMarkOffsets=function(){if(!(!e.props.renderMark||!e.trackRef||!e.numOfMarks||!e.markRefs||e.trackRef.current===null)){for(var a=window.getComputedStyle(e.trackRef.current),m=parseInt(a.width,10),x=parseInt(a.height,10),l=parseInt(a.paddingLeft,10),p=parseInt(a.paddingTop,10),F=[],n=0;n<e.numOfMarks+1;n++){var i=9999,v=9999;if(e.markRefs[n].current){var h=e.markRefs[n].current.getBoundingClientRect();i=h.height,v=h.width}e.props.direction===S.Direction.Left||e.props.direction===S.Direction.Right?F.push([Math.round(m/e.numOfMarks*n+l-v/2),-Math.round((i-x)/2)]):F.push([Math.round(x/e.numOfMarks*n+p-i/2),-Math.round((v-m)/2)])}e.setState({markOffsets:F})}},u.step===0)throw new Error('"step" property should be a positive number');return e.schdOnMouseMove=(0,f.schd)(e.onMouseMove),e.schdOnTouchMove=(0,f.schd)(e.onTouchMove),e.schdOnEnd=(0,f.schd)(e.onEnd),e.thumbRefs=u.values.map(function(){return T.createRef()}),e.updateMarkRefs(u),e}return D.prototype.componentDidMount=function(){var u=this,e=this.props,a=e.values,m=e.min,x=e.step;this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(this.onResize):{observe:function(){return window.addEventListener("resize",u.onResize)},unobserve:function(){return window.removeEventListener("resize",u.onResize)}},document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart,{passive:!1}),!this.props.allowOverlap&&(0,f.checkInitialOverlap)(this.props.values),this.props.values.forEach(function(l){return(0,f.checkBoundaries)(l,u.props.min,u.props.max)}),this.resizeObserver.observe(this.trackRef.current),(0,f.translateThumbs)(this.getThumbs(),this.getOffsets(),this.props.rtl),this.calculateMarkOffsets(),a.forEach(function(l){(0,f.isStepDivisible)(m,l,x)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")})},D.prototype.componentDidUpdate=function(u,e){var a=this.props,m=a.max,x=a.min,l=a.step,p=a.values,F=a.rtl;(u.max!==m||u.min!==x||u.step!==l)&&this.updateMarkRefs(this.props),(0,f.translateThumbs)(this.getThumbs(),this.getOffsets(),F),(u.max!==m||u.min!==x||u.step!==l||e.markOffsets.length!==this.state.markOffsets.length)&&(this.calculateMarkOffsets(),p.forEach(function(n){(0,f.isStepDivisible)(x,n,l)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")}))},D.prototype.componentWillUnmount=function(){var u={passive:!1};document.removeEventListener("mousedown",this.onMouseOrTouchStart,u),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchend",this.schdOnEnd),this.resizeObserver.unobserve(this.trackRef.current)},D.prototype.render=function(){var u=this,e=this.props,a=e.label,m=e.labelledBy,x=e.renderTrack,l=e.renderThumb,p=e.renderMark,F=p===void 0?function(){return null}:p,n=e.values,i=e.min,v=e.max,h=e.allowOverlap,c=e.disabled,g=this.state,O=g.draggedThumbIndex,s=g.thumbZIndexes,o=g.markOffsets;return x({props:{style:{transform:"scale(1)",cursor:O>-1?"grabbing":this.props.draggableTrack?(0,f.isVertical)(this.props.direction)?"ns-resize":"ew-resize":n.length===1&&!c?"pointer":"inherit"},onMouseDown:c?f.voidFn:this.onMouseDownTrack,onTouchStart:c?f.voidFn:this.onTouchStartTrack,ref:this.trackRef},isDragged:this.state.draggedThumbIndex>-1,disabled:c,children:E(E([],o.map(function(d,w,M){return F({props:{style:u.props.direction===S.Direction.Left||u.props.direction===S.Direction.Right?{position:"absolute",left:"".concat(d[0],"px"),marginTop:"".concat(d[1],"px")}:{position:"absolute",top:"".concat(d[0],"px"),marginLeft:"".concat(d[1],"px")},key:"mark".concat(w),ref:u.markRefs[w]},index:w})}),!0),n.map(function(d,w){var M=u.state.draggedThumbIndex===w;return l({index:w,value:d,isDragged:M,props:{style:{position:"absolute",zIndex:s[w],cursor:c?"inherit":M?"grabbing":"grab",userSelect:"none",touchAction:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},key:w,tabIndex:c?void 0:0,"aria-valuemax":h?v:n[w+1]||v,"aria-valuemin":h?i:n[w-1]||i,"aria-valuenow":d,draggable:!1,ref:u.thumbRefs[w],"aria-label":a,"aria-labelledby":m,role:"slider",onKeyDown:c?f.voidFn:u.onKeyDown,onKeyUp:c?f.voidFn:u.onKeyUp}})}),!0)})},D.defaultProps={label:"Accessibility label",labelledBy:null,step:1,direction:S.Direction.Right,rtl:!1,disabled:!1,allowOverlap:!1,draggableTrack:!1,min:0,max:100},D})(T.Component);return z.default=Y,z}var ge;function He(){return ge||(ge=1,(function(t){var A=K&&K.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkValuesAgainstBoundaries=t.relativeValue=t.useThumbOverlap=t.Direction=t.getTrackBackground=t.Range=void 0;var C=A(We());t.Range=C.default;var y=De();Object.defineProperty(t,"getTrackBackground",{enumerable:!0,get:function(){return y.getTrackBackground}}),Object.defineProperty(t,"useThumbOverlap",{enumerable:!0,get:function(){return y.useThumbOverlap}}),Object.defineProperty(t,"relativeValue",{enumerable:!0,get:function(){return y.relativeValue}}),Object.defineProperty(t,"checkValuesAgainstBoundaries",{enumerable:!0,get:function(){return y.checkValuesAgainstBoundaries}});var E=ne();Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return E.Direction}})})(K)),K}var fe=He();function pe({groups:t,participantType:A,onUpdate:C,colorScheme:y}){const[E,T]=L.useState([]),[f,S]=L.useState([]),[k,P]=L.useState(0),[Y,b]=L.useState(60),D=0,u=99,e=l=>{const p=new Date(l),F=String(p.getDate()).padStart(2,"0"),n=String(p.getMonth()+1).padStart(2,"0"),i=p.getFullYear();return`${F}-${n}-${i}`};L.useEffect(()=>{if(t.length===0)return;const l=[...t].sort((v,h)=>v.AgeFrom-h.AgeFrom),p=[l[0].AgeFrom,...l.map(v=>v.AgeTo)];console.log(`${A} Groups:`,l),console.log(`${A} Thumb Values:`,p),T(p);const F=Math.min(...p),n=Math.max(...p);P(Math.min(D,F)),b(Math.max(60,n));const i=l.map(()=>y.color);i.push("#d1d5db"),S(["#d1d5db",...i])},[t,y]);const a=l=>{T(l)},m=l=>{console.log("Final thumb values:",l);const F=[...t].sort((n,i)=>n.AgeFrom-i.AgeFrom).map((n,i)=>{let v=l[i];i!=0&&(v+=1);const h=l[i+1];return{...n,AgeFrom:v,AgeTo:h}});C(F)};if(t.length===0||E.length===0)return null;const x=[...t].sort((l,p)=>l.AgeFrom-p.AgeFrom);return r.jsxs("div",{className:"mb-6 p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Re,{className:"h-5 w-5 text-gray-600"}),r.jsxs("h3",{className:`text-sm font-semibold ${y.text}`,children:[A," Groups Range"]}),r.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Drag boundaries to adjust)"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs text-gray-600 font-medium",children:"Start:"}),r.jsx("input",{type:"number",min:D,max:Y-1,value:k,onChange:l=>P(Math.max(D,Math.min(Number(l.target.value),Y-1))),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs text-gray-600 font-medium",children:"End:"}),r.jsx("input",{type:"number",min:k+1,max:u,value:Y,onChange:l=>b(Math.max(k+1,Math.min(Number(l.target.value),u))),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),r.jsxs("div",{className:"px-4 relative",children:[r.jsx(fe.Range,{draggableTrack:!0,step:1,min:k,max:Y,values:E,onChange:a,onFinalChange:m,renderTrack:({props:l,children:p})=>r.jsx("div",{onMouseDown:l.onMouseDown,onTouchStart:l.onTouchStart,style:{...l.style,height:"36px",display:"flex",width:"100%"},children:r.jsx("div",{ref:l.ref,style:{height:"6px",width:"100%",borderRadius:"3px",background:fe.getTrackBackground({values:E,colors:f,min:k,max:Y}),alignSelf:"center"},children:p})}),renderThumb:({props:l,index:p,isDragged:F})=>{const n=E[p],i=new Date().getFullYear();let v=i-n-1;p==0&&(v=i-n);let h="",c="";if(p===0){h=`Start of ${x[0]?.GroupName||""}`;const O=new Date(x[0]?.MaxAgeDate);c=`Born: ${e(x[0]?.MaxAgeDate)} (${O.getFullYear()})`}else if(p===x.length){const O=x.length-1;h=`End of ${x[O]?.GroupName||""}`;const s=new Date(x[O]?.MinAgeDate);c=`Born: ${e(x[O]?.MinAgeDate)} (${s.getFullYear()})`}else{const O=p-1,s=p;h=`${x[O]?.GroupName||""} / ${x[s]?.GroupName||""}`;const o=new Date(x[O]?.MinAgeDate);c=`Born: ${e(x[O]?.MinAgeDate)} (${o.getFullYear()})`}let g=n;return p!=0&&(g=n+1),L.createElement("div",{...l,key:l.key,className:"group",style:{...l.style,height:"40px",width:"40px",borderRadius:"8px",backgroundColor:F?"#3b82f6":y.thumbColor,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",cursor:"grab",padding:"2px"}},r.jsx("div",{className:"text-xs font-bold text-white leading-tight",children:g}),r.jsx("div",{className:"text-xxs font-medium text-white leading-tight",children:v}),r.jsxs("div",{className:"absolute -top-16 bg-gray-800 text-white text-xs rounded px-2 py-1 whitespace-nowrap pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[h,r.jsx("br",{}),c]}))}}),r.jsxs("div",{className:"flex justify-between mt-3 text-xs text-gray-500",children:[r.jsx("span",{children:k}),r.jsx("span",{children:Math.round(k+(Y-k)*.25)}),r.jsx("span",{children:Math.round(k+(Y-k)*.5)}),r.jsx("span",{children:Math.round(k+(Y-k)*.75)}),r.jsx("span",{children:Y})]}),r.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:x.map((l,p)=>{let F=E[p];p!=0&&(F+=1);const n=E[p+1],i=new Date(l.MinAgeDate),v=new Date(l.MaxAgeDate),h=i.getFullYear(),c=v.getFullYear();return r.jsxs("div",{className:`rounded-lg px-3 py-2 ${y.bg} ${y.badge} text-xs font-medium`,children:[r.jsx("div",{className:"font-semibold",children:l.GroupName}),r.jsxs("div",{className:"text-xs opacity-80",children:["Age ",F,"-",n," (",h,"-",c,")"]})]},l.EventGroupId)})})]})]})}function yt(){const{eventDetails:t}=Se(),[A,C]=L.useState(null),[y,E]=L.useState(!1),{rows:T,update:f,delete:S,status:k}=je("/AgewiseGroupsJson/Get",{filter:{EventCategory:t?.EventCategory},updateUrl:"/AgewiseGroupsJson/Save",deleteUrl:"/AgewiseGroupsJson/Remove",limit:100,sort:{sortOrder:"ASC",sortColumn:"Order"},select:"EventGroupId,GroupName,AgeFrom,AgeTo,AgeStartDate,AgeStartMonth,AgeStartYear,Status,JsonSettings,Order,MinAgeDate,MaxAgeDate"});console.log("rows",T);const P=L.useMemo(()=>T?T.map(n=>{let i={ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No"};try{n.JsonSettings&&(i=JSON.parse(n.JsonSettings))}catch(v){console.error("Failed to parse JsonSettings:",v)}return{...n,parsedSettings:i}}):[],[T]),Y=L.useMemo(()=>P.filter(n=>n.parsedSettings.ParticipantType==="Individual"||n.parsedSettings.ParticipantType==="Any").sort((n,i)=>(n.Order||0)-(i.Order||0)),[P]),b=L.useMemo(()=>P.filter(n=>n.parsedSettings.ParticipantType==="Team"||n.parsedSettings.ParticipantType==="Any").sort((n,i)=>(n.Order||0)-(i.Order||0)),[P]),D=n=>{const i=h=>{const c=h.parsedSettings.ParticipantType,g=h.parsedSettings.IsCommon==="Yes";return c==="Individual"&&!g?1:c==="Individual"&&g?2:c==="Team"&&!g?3:c==="Team"&&g?4:5};return[...n].sort((h,c)=>{const g=i(h)-i(c);return g!==0?g:(h.AgeFrom||0)-(c.AgeFrom||0)}).map((h,c)=>({...h,correctOrder:c+1}))},u=async(n,i=!1)=>{if(!n||n.length===0)return;const h=D(n).filter(g=>g.Order!==g.correctOrder);if(h.length===0)return;console.log("Auto-fixing incorrect orders for",h.length,"groups:",h.map(g=>({name:g.GroupName,currentOrder:g.Order,newOrder:g.correctOrder})));const c=h.map(g=>f({EventGroupId:g.EventGroupId,Order:g.correctOrder},!0).catch(O=>(console.error(`Failed to auto-update order for group "${g.GroupName}":`,O),null)));try{const O=(await Promise.all(c)).filter(s=>s!==null).length;!i&&O>0&&console.log(`Auto-fixed order for ${O} group(s)`)}catch(g){console.error("Group order auto-fix errors:",g)}},e=async()=>{if(!P||P.length===0){W.error("No groups available to reorder");return}const n=D(P),i=[];if(n.forEach(h=>{h.Order!==h.correctOrder&&i.push({EventGroupId:h.EventGroupId,GroupName:h.GroupName,currentOrder:h.Order,newOrder:h.correctOrder})}),i.length===0){W.success("All groups are already in correct order");return}console.log("Groups needing order update:",i);const v=i.map(h=>f({EventGroupId:h.EventGroupId,Order:h.newOrder}).catch(c=>{throw console.error(`Failed to update order for group "${h.GroupName}":`,c),c}));try{await Promise.all(v),W.success(`Successfully updated order for ${i.length} group(s)`)}catch(h){W.error("Some group orders failed to update. Check console for details."),console.error("Group order update errors:",h)}},a=n=>{const i=[],v=c=>{const g=String(c.getDate()).padStart(2,"0"),O=String(c.getMonth()+1).padStart(2,"0"),s=c.getFullYear();return`${g}-${O}-${s}`},h=n.map(c=>{const g=new Date(c.AgeStartYear,c.AgeStartMonth-1,c.AgeStartDate),O=new Date(g);O.setFullYear(O.getFullYear()-c.AgeTo),O.setDate(O.getDate()+1);const s=new Date(g);return s.setFullYear(s.getFullYear()-c.AgeFrom+1),{...c,minBirthDate:O,maxBirthDate:s,minBirthDateStr:v(O),maxBirthDateStr:v(s)}});for(let c=0;c<h.length-1;c++){const g=h[c],O=h[c+1],s=new Date(O.maxBirthDate);s.setDate(s.getDate()+1);const o=new Date(g.minBirthDate);if(o.setDate(o.getDate()-1),s<=o){const d=new Date(g.AgeStartYear,g.AgeStartMonth-1,g.AgeStartDate),w=Math.floor((d-o)/(365.25*24*60*60*1e3)),M=Math.ceil((d-s)/(365.25*24*60*60*1e3));i.push({afterIndex:c,missingAges:w===M?`Age ${w}`:`Age ${w}-${M}`,dateFrom:v(s),dateTo:v(o)})}}return i},m=async n=>{try{const[i,v,h]=(n.BirthDateTo||"1-1-2020").split("-"),[c,g,O]=(n.BirthDateFrom||"31-12-2024").split("-"),s=new Date().getFullYear(),o=new Date(s,parseInt(g)-1,parseInt(c)),d=s-parseInt(O),w=s-parseInt(h),M=new Date(parseInt(h),parseInt(v)-1,parseInt(i)),j=new Date(parseInt(O),parseInt(g)-1,parseInt(c)),N=P.find(G=>{if(n.EventGroupId&&G.EventGroupId===n.EventGroupId||G.parsedSettings.ParticipantType!==n.ParticipantType||G.parsedSettings.IsCommon!==n.IsCommon)return!1;const q=new Date(G.AgeStartYear-G.AgeTo,G.AgeStartMonth-1,G.AgeStartDate),J=new Date(G.AgeStartYear-G.AgeFrom,G.AgeStartMonth-1,G.AgeStartDate);return M<=J&&j>=q});if(N){W.error(`Date range overlaps with existing group "${N.GroupName}". Please adjust the dates to avoid overlap within the same Participant Type and Common Group status.`);return}const I={EventGroupId:n.EventGroupId||0,EventCategory:t?.EventCategory,GroupName:n.GroupName,AgeFrom:d,AgeTo:w,AgeStartDate:o.getDate(),AgeStartMonth:o.getMonth()+1,AgeStartYear:o.getFullYear(),Status:1,Order:n.Order||(T?.length||0)+1,JsonSettings:JSON.stringify({ParticipantType:n.ParticipantType,IsCommon:n.IsCommon,NoAgeIdPrefix:n.NoAgeIdPrefix}),BirthDateFrom:n.BirthDateFrom,BirthDateTo:n.BirthDateTo},B=await f(I,!1,!0),[R,$,V,U]=B,_=Array.isArray(U)&&U.length>0?U[0]:null;if(_){console.log("Latest data after save:",_);const G=_.map(q=>{let J={ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No"};try{q.JsonSettings&&(J=JSON.parse(q.JsonSettings))}catch(Z){console.error("Failed to parse JsonSettings:",Z)}return{...q,parsedSettings:J}});await u(G,!0)}W.success(A?"Group updated successfully":"Group added successfully"),C(null),E(!1)}catch(i){W.error("Failed to save group"),console.error(i)}},x=async n=>{if(window.confirm("Are you sure you want to delete this age group?"))try{const i=await S({EventGroupId:n}),[v,h,c]=i;setTimeout(async()=>{try{const g=P.filter(O=>O.EventGroupId!==n);g.length>0&&await u(g,!0)}catch(g){console.error("Failed to auto-fix orders after delete:",g)}},1e3),W.success("Group deleted successfully")}catch{W.error("Failed to delete group")}},l=n=>{let i="",v="";if(n.AgeFrom&&n.AgeTo&&n.AgeStartYear&&n.AgeStartMonth&&n.AgeStartDate)try{const c=new Date(n.AgeStartYear,n.AgeStartMonth-1,n.AgeStartDate),g=new Date(c);g.setFullYear(g.getFullYear()-n.AgeTo),g.setDate(g.getDate()+1);const O=o=>{const d=String(o.getDate()).padStart(2,"0"),w=String(o.getMonth()+1).padStart(2,"0"),M=o.getFullYear();return`${d}-${w}-${M}`};v=O(g);const s=new Date(c);s.setFullYear(s.getFullYear()-n.AgeFrom+1),i=O(s)}catch(c){console.error("Error calculating birth dates for editing:",c)}const h={...n,BirthDateFrom:n.BirthDateFrom||i,BirthDateTo:n.BirthDateTo||v};console.log("Setting editingGroup with data:",{AgeStartDate:h.AgeStartDate,AgeStartMonth:h.AgeStartMonth,AgeStartYear:h.AgeStartYear,fullGroup:h}),C(h),E(!0)},p=()=>{C(null),E(!1)},F=[{title:"New Page",path:te("/SetUp/ManageGroups")},{title:"Old Page",path:te("/SetUp/ManageGroupsOld")},{title:"Old Table View",path:te("/AgewiseGroups/Manage")}];return r.jsx(Ne,{tabs:F,children:r.jsx(Te,{children:r.jsxs("div",{className:"flex flex-col grow",children:[r.jsx(Me,{heading:"Age Groups Setup",subHeading:"Manage participant age categories and groups",rightChildren:r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>E(!y),className:"inline-flex items-center gap-x-2 rounded-lg bg-gradient-to-r from-primary to-darkprimary px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200",children:[r.jsx(ke,{className:"h-5 w-5"}),y?"Cancel":"Add New Group"]}),r.jsxs("button",{onClick:e,disabled:k==="loading",className:"inline-flex items-center gap-x-2 rounded-lg bg-emerald-600 px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200 disabled:bg-surfaceVariant disabled:scale-100",children:[r.jsx(Ie,{className:"h-5 w-5"}),"Fix Order"]})]})}),y&&r.jsx(ze,{editingGroup:A,existingGroups:P,onSubmit:m,onCancel:p,open:y}),r.jsx("div",{className:"bg-surface border border-primary/20 rounded-xl p-5 mb-6 shadow-sm",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"bg-blue-100 rounded-lg p-2 flex-shrink-0",children:r.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-onSurface mb-1",children:"Quick Guide"}),r.jsx("p",{className:"text-sm text-onSurfaceVariant leading-relaxed mb-2",children:"Organize participants into age-based groups. Groups are automatically ordered by priority (Individual → Team → Any) and age range."}),r.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-onSurfaceVariant",children:[r.jsx("li",{children:"Cyan badges represent Individual participants, Emerald for Teams, Indigo for Any type"}),r.jsx("li",{children:"Red dashed gaps indicate missing age ranges between groups"}),r.jsx("li",{children:'Use "Fix Order" button to manually reorder groups when needed'})]})]})]})}),k==="loading"&&r.jsx("div",{className:"text-center py-8 text-onSurfaceVariant",children:"Loading groups..."}),k==="error"&&r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-red-500",children:"Error loading age groups. Please try refreshing the page."})}),(k==="success"||k==="finished")&&(!T||T.length===0)&&r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-onSurfaceVariant",children:'No age groups found. Click "Add New Group" to get started.'})}),(k==="success"||k==="finished")&&T&&T.length>0&&r.jsxs(r.Fragment,{children:[Y.length>0&&r.jsx(pe,{groups:Y,participantType:"Individual",onUpdate:n=>n.forEach(i=>f(i)),colorScheme:{border:"border-cyan-300",text:"text-cyan-700",bg:"bg-cyan-100",badge:"text-cyan-800",color:"#06b6d4",thumbColor:"#0891b2"}}),b.length>0&&r.jsx(pe,{groups:b,participantType:"Team",onUpdate:n=>n.forEach(i=>f(i)),colorScheme:{border:"border-emerald-300",text:"text-emerald-700",bg:"bg-emerald-100",badge:"text-emerald-800",color:"#10b981",thumbColor:"#059669"}}),r.jsx(Je,{groups:P,onEdit:l,onDelete:x,detectGaps:a})]}),r.jsx("div",{className:"mt-8 pt-6 border-t border-border",children:r.jsxs("p",{className:"text-xs text-onSurfaceVariant",children:[r.jsx("strong",{className:"text-primary",children:"What's next?"})," ",r.jsx("a",{href:"/SetUp/ManageCompetitionItems",className:"underline hover:text-primary",children:"Add Competition Items"})," ","|"," ",r.jsx("a",{href:"/CompetitionStructure/Tab",className:"underline hover:text-primary",children:"Assign Competitions to Groups"})," ","|"," ",r.jsx("a",{href:"/Coordinator/ManageBulkParticipants",className:"underline hover:text-primary",children:"Add Participants"})]})})]})})})}export{yt as default};
