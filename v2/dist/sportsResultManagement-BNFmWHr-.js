import{j as t,r as f,u as h,L as B,p as C,z as c}from"./main-C93JHIOS.js";import{L as F}from"./layoutOuter-l6BzHFR0.js";import{P as O}from"./pageHeader-BW5xwF8Q.js";import b from"./selectBox-C2VpuCpi.js";import"./validationMessage-DJDqjMiL.js";const G=({icon:i,title:d,rankId:y})=>{const l=()=>{if(!d)return"bg-surfaceContainer text-onSurfaceVariant";const S=d.toLowerCase();return S.includes("first")||i?.includes("ðŸ¥‡")?"bg-green-50 text-green-900 border border-green-300":S.includes("second")||i?.includes("ðŸ¥ˆ")?"bg-slate-50 text-slate-900 border border-slate-200":S.includes("third")||i?.includes("ðŸ¥‰")?"bg-orange-100 text-orange-950 border border-orange-300":"bg-surfaceContainer text-onSurface border border-border"};return t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${l()}`,children:[i&&t.jsx("span",{dangerouslySetInnerHTML:{__html:i}}),d||"-"]})},q=()=>{localStorage.getItem("sportsResultManagement_lastCompetition");const[i,d]=f.useState(null),[y,l]=f.useState(null),[S,I]=f.useState({}),[V,g]=f.useState(!1),{rows:o=[],loading:L,setFilter:J}=h("/CompetitionStructureJson/Get",{filter:{Status:"1"},select:"CompetitionStructureId,Order,GroupGroupName,CompetitionItemTitle,GenderGenderTitle,LanguageLanguageName,ParticipantTypeTitle,Gender,Language,CompetitionStatusCompetitionStatusTitle,CompetitionStatus,CompetitionStatusIcon",limit:1e4,sort:{sortOrder:"asc",sortColumn:"Order"}}),{rows:A=[]}=h("/CompetitionStatusJson/Get",{select:"CompetitionStatusId,CompetitionStatusTitle,Icon",sort:"CompetitionStatusId asc"}),{rows:p=[],setFilter:N,loading:D}=h("/CompetitionParticipantsScoreCardJson/Get",{mandatoryParams:["Competition"],select:"ParticipantId,CandidateIdentityNumber,TeamIdentityNumber,CandidateUserName,TeamTeamName,IdentityNumber,ParticipantIdScorecardId,ParticipantIdScore",sort:"ParticipantId asc"}),{rows:m=[],setFilter:w}=h("/JudgesScoreCardResultReportJson/Get",{mandatoryParams:["ParticipantCompetition"],select:"Participant,ScorecardIdRank,ScorecardIdRankTitle",sort:"Participant asc"}),{rows:k=[]}=h("/RankPositionsJson/Get",{filter:"",select:"RankId,Title,BonusPoints,Icon",sort:"BonusPoints asc"});f.useEffect(()=>{if(!o?.length)return;const e=localStorage.getItem("sportsResultManagement_lastCompetition");if(e&&!i){const a=parseInt(e);d(a),N({Competition:a}),w({ParticipantCompetition:a});const r=o.find(n=>n.CompetitionStructureId===a);r&&l(r.CompetitionStatus)}},[o]),f.useEffect(()=>{if(m?.length>0){const e={};m.forEach(a=>{a.ScorecardIdRank&&(e[a.Participant]=a.ScorecardIdRank)}),I(e)}},[m]);const E=e=>{const a=parseInt(e);if(d(a),I({}),a){N({Competition:a}),w({ParticipantCompetition:a}),localStorage.setItem("sportsResultManagement_lastCompetition",a.toString());const r=o.find(n=>n.CompetitionStructureId===a);r&&l(r.CompetitionStatus)}else N({}),w({}),localStorage.removeItem("sportsResultManagement_lastCompetition"),l(null)},$=async e=>{if(!i||!e)return;const a=parseInt(e),r=o.find(n=>n.CompetitionStructureId===i);if(!(r&&r.CompetitionStatus===a)){g(!0);try{await C("/CompetitionStructureJson/Save",{CompetitionStructureId:i,CompetitionStatus:a}),l(a),c.success("Competition status changed successfully"),J({timestamp:new Date().getTime()})}catch(n){console.error("Error changing status:",n),c.error("Error changing competition status")}finally{g(!1)}}},M=async(e,a)=>{const r=a?parseInt(a,10):null;if(I(n=>({...n,[e]:r})),!i){c.error("Competition not selected");return}g(!0);try{const n=p.find(s=>s.ParticipantId===parseInt(e));if(!n){c.error("Participant not found"),g(!1);return}const R=s=>{const T=k?.find(_=>_.RankId===s);if(!T)return 0;const j=T.Title?.toLowerCase()||"";return j.includes("first")?10:j.includes("second")?9:j.includes("third")?8:0},x=m?.find(s=>s.Participant===parseInt(e));if(r===null)x&&(await C("/JudgeJson/SaveScore",{Scores:[{IsTotalScore:!0,Competition:i,ScoreCardParticipant:parseInt(e),ScoreCardScore:0,Score:0,IsActAsJudge:!0,ScoreCardScorecardId:n.ParticipantIdScorecardId||0}],Absent:2}),c.success("Rank removed")),await C("/CoordinatorJson/SaveResultReport",{ParticipantCompetition:i,Participant:parseInt(e),Rank:null,ResultId:n.ParticipantIdScorecardId||0,Status:1,Remarks:"Sports Result - Rank Removed",AutoGenerated:0});else{const s=R(r);(!x||x.ScorecardIdRank!==r)&&await C("/JudgeJson/SaveScore",{Scores:[{Competition:i,ScoreCardParticipant:parseInt(e),ScoreCardScore:s,Score:s,IsActAsJudge:!0,IsTotalScore:!0,ScoreCardScorecardId:n.ParticipantIdScorecardId||0}],Absent:2}),await C("/CoordinatorJson/SaveResultReport",{ParticipantCompetition:i,Participant:parseInt(e),Rank:r,ResultId:n.ParticipantIdScorecardId||0,Status:1,Remarks:"Sports Result - Direct Rank Assignment",AutoGenerated:0}),c.success("Rank saved")}i&&(N({Competition:i}),w({ParticipantCompetition:i}))}catch(n){console.error("Error saving rank:",n),c.error("Error saving rank"),I(R=>{const x={...R};return delete x[e],x})}finally{g(!1)}},u=L||D,P=o?.find(e=>e.CompetitionStructureId===i),v=m?.sort((e,a)=>{const r=e.ScorecardIdRank,n=a.ScorecardIdRank;return r-n}).filter(e=>e.ScorecardIdRank);return t.jsx(F,{children:t.jsxs("div",{className:"flex flex-col grow max-w-full",children:[t.jsx(O,{heading:"Sports Result Management",subHeading:"Direct rank assignment for sports competitions without judge scoring"}),t.jsxs("div",{className:"px-2 lg:px-6 py-2 max-w-full",children:[u&&t.jsx(B,{info:"Loading competitions..."}),t.jsx("div",{className:"bg-surface rounded-lg p-4 mb-4 shadow-sm",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:space-x-4 space-y-4 md:space-y-0",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(b,{fieldName:"competition",label:"Select Competition",placeholder:"Choose a competition",formData:{competition:i},onChange:e=>E(e.target.value),options:o?.map(e=>{let a=`${e.Order} - ${e.CompetitionItemTitle}`;return e.Gender!==3&&(a+=` ${e.GenderGenderTitle||""}`),e.Language!==4&&(a+=` ${e.LanguageLanguageName||""}`),e.ParticipantTypeTitle&&(a+=` (${e.ParticipantTypeTitle})`),e.CompetitionStatusCompetitionStatusTitle&&(a+=` - ${e.CompetitionStatusCompetitionStatusTitle}`),{CompetitionStructureId:e.CompetitionStructureId,displayText:a.replace(/\s+/g," ").trim(),GroupGroupName:e.GroupGroupName+" - "+e.CompetitionStatusCompetitionStatusTitle,CompetitionStatusIcon:e.CompetitionStatusIcon}})||[],optionKey:"CompetitionStructureId",optionText:"displayText",groupText:"GroupGroupName",groupIcon:"CompetitionStatusIcon",disabled:u,optional:!0})}),i&&t.jsx("div",{className:"flex-1 min-w-0 md:max-w-xs",children:t.jsx(b,{fieldName:"competitionStatus",label:"Change Status",placeholder:"Select Status",formData:{competitionStatus:y},onChange:e=>$(e.target.value),options:A||[],optionKey:"CompetitionStatusId",optionText:"CompetitionStatusTitle",optionIcon:"Icon",disabled:u||V,optional:!0})})]})}),!u&&i&&p?.length>0&&t.jsxs("div",{className:"space-y-4 max-w-full w-full",children:[t.jsx("div",{className:"bg-surface rounded-lg p-4 shadow-sm mb-4",children:t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-onSurface",children:P?.CompetitionItemTitle}),t.jsxs("p",{className:"text-sm text-onSurfaceVariant mt-1",children:[P?.GroupGroupName," â€¢ ",p?.length||0," Participants"]})]})}),v?.length>0&&t.jsxs("div",{className:"bg-surface rounded-lg overflow-hidden shadow-sm mb-4",children:[t.jsx("div",{className:"px-4 py-3 bg-surfaceContainer border-b border-border",children:t.jsx("h4",{className:"text-sm font-semibold text-onSurface",children:"Current Rank Results"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-border",children:[t.jsx("thead",{className:"bg-surfaceContainer",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider",children:"Rank Title"}),t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider",children:"ID No"}),t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider",children:"Name"})]})}),t.jsx("tbody",{className:"bg-surface divide-y divide-border",children:v.map(e=>{const a=p.find(n=>n.ParticipantId===e.Participant),r=k?.find(n=>n.RankId===e.ScorecardIdRank);return t.jsxs("tr",{children:[t.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:t.jsx(G,{icon:r?.Icon,title:e.ScorecardIdRankTitle,rankId:e.ScorecardIdRank})}),t.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-onSurfaceVariant",children:a?.CandidateIdentityNumber||a?.TeamIdentityNumber||"-"}),t.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm font-medium text-onSurface",children:a?.CandidateUserName||a?.TeamTeamName||"-"})]},e.Participant)})})]})})]}),t.jsx("div",{className:"bg-surface rounded-lg shadow-sm overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto max-w-full",children:t.jsxs("table",{className:"w-full divide-y divide-border",style:{minWidth:"600px"},children:[t.jsx("thead",{className:"bg-surfaceContainer",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider whitespace-nowrap",children:"#"}),t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider whitespace-nowrap",children:"ID No"}),t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider whitespace-nowrap",children:"Name"}),t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider whitespace-nowrap",children:"Assign Rank"}),t.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-onSurfaceVariant uppercase tracking-wider whitespace-nowrap",children:"Current Rank"})]})}),t.jsx("tbody",{className:"bg-surface divide-y divide-border",children:p?.map((e,a)=>{const r=m?.find(n=>n.Participant===e.ParticipantId);return console.log(r),t.jsxs("tr",{className:S[e.ParticipantId]?"bg-gray-50":"hover:bg-surfaceHover",children:[t.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-onSurface",children:a+1}),t.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-onSurfaceVariant",children:e.CandidateIdentityNumber||e.TeamIdentityNumber}),t.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm font-medium text-onSurface",children:e.CandidateUserName||e.TeamTeamName}),t.jsx("td",{className:"px-3 py-3",children:t.jsx("div",{className:"-mt-2 min-w-32",children:t.jsx(b,{fieldName:`rank_${e.ParticipantId}`,label:"",noLabel:!0,placeholder:r?.ScorecardIdRankTitle?"No Rank":"Select Rank",formData:{[`rank_${e.ParticipantId}`]:r?.ScorecardIdRank||""},onChange:n=>M(e.ParticipantId,n.target.value),options:k||[],optionKey:"RankId",optionText:"Title",optionIcon:"Icon",optional:!0})})}),t.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:r?.ScorecardIdRankTitle?t.jsx(G,{icon:k?.find(n=>n.RankId===r?.ScorecardIdRank)?.Icon,title:r.ScorecardIdRankTitle,rankId:r.ScorecardIdRank}):t.jsx("span",{className:"text-onSurfaceVariant",children:"-"})})]},e.ParticipantId)})})]})})})]}),!u&&i&&p?.length===0&&t.jsx("div",{className:"bg-surface rounded-lg p-12 shadow-sm text-center",children:t.jsx("p",{className:"text-onSurfaceVariant",children:"No participants found for this competition"})}),!u&&!i&&t.jsx("div",{className:"bg-surface rounded-lg p-12 shadow-sm text-center",children:t.jsxs("div",{className:"max-w-md mx-auto",children:[t.jsx("h3",{className:"text-lg font-medium text-onSurface mb-2",children:"Sports Result Management"}),t.jsx("p",{className:"text-onSurfaceVariant",children:"Select a competition from the dropdown above to assign ranks to participants"})]})})]})]})})};export{q as default};
