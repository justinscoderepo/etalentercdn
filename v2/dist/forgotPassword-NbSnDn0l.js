import{r,D as u,j as t}from"./main-DMKfhHuC.js";import{B as a,Q as $}from"./react-toastify.esm-DmM7HRLZ.js";import{a as L,b as Q}from"./navigationUtils-DXU5tDUq.js";import"./clsx-B-dksMZM.js";const X=()=>{const y=L(),E=Q(y),[o,O]=r.useState(""),[g,w]=r.useState(!0),[C,x]=r.useState(!1),[j,b]=r.useState(!1),[S,m]=r.useState(!1),[i,N]=r.useState(!1),[h,k]=r.useState(""),[P,f]=r.useState(!0),[F,l]=r.useState(!1),[n,I]=r.useState(""),[d,V]=r.useState(""),[c,A]=r.useState(""),D="https://etalenterapi.azurewebsites.net/PublicJson/GetUserCheck",R="https://etalenterapi.azurewebsites.net/PublicJson/UsersActivation",U="https://etalenterapi.azurewebsites.net/PublicJson/GetOTPCheck",z="https://etalenterapi.azurewebsites.net/PublicJson/UsersForgotPassword",p=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),v=e=>e.length===6&&/^\d{6}$/.test(e);r.useEffect(()=>{const e=setTimeout(()=>{k(o)},500);return()=>{clearTimeout(e)}},[o]),r.useEffect(()=>{if(p(h)){const e={Email:h};u.post(D,e,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{s.data===!0?f(!0):(f(!1),a.error("This email ID is not registered with us."))}).catch(s=>{console.error("Error checking user:",s),f(!1),a.error("Error checking user, please try again.")})}else w(!1)},[h]);const J=e=>{const s=e.target.value;O(s),b(!1),w(p(s)),x(!1)},q=()=>{if(p(o)){m(!0),a.success("OTP button will activate in 20 seconds."),setTimeout(()=>{m(!1),a.success("OTP is sent to your email. Please check and fill the fields. Sometimes it may take a few seconds to receive the email, kindly wait. If not found, check the spam folder.")},2e4);const e={Email:o,isForgotPassword:!0};u.post(R,e,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{x(!0),b(!0)}).catch(s=>{console.error("Error sending OTP:",s),a.error("Failed to send OTP, please try again."),m(!1)})}else a.error("Please enter a valid email address.")},T=()=>{v(n)?u.post(U,{Email:o,OTP:n},{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e.data===!0?(l(!0),a.success("OTP is valid.")):(a.error("OTP is not valid."),l(!1))}).catch(e=>{console.error("Error validating OTP:",e),a.error("Invalid OTP. Please try again."),l(!1)}):a.error("Please enter a valid 6-digit OTP.")},B=e=>{const s=e.target.value;I(s),N(v(s)),i&&T()};r.useEffect(()=>{i&&T()},[i]);const G=()=>{if(!o||!n||!d||!c){a.error("All fields are required.");return}if(d!==c){a.error("Passwords do not match.");return}try{const e={"Content-Type":"multipart/form-data"};u.post(z,{Email:o,OTP:n,Password:d,confirmPassword:c},{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{s.data===!0?(a.success("Password Changed."),E("/Account/Login")):(a.error("Password not Changed."),l(!1))}).catch(s=>{console.error("Error Changing Password:",s),a.error("Error Changing Password."),l(!1)})}catch(e){console.error("Unexpected error:",e),a.error("An unexpected error occurred. Please try again."),l(!1)}};return t.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md mx-auto mt-10",children:[t.jsx("h1",{className:"text-2xl font-bold text-center mb-6 text-blue-800",children:"Forgot Password"}),t.jsxs("form",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-onSurface",children:"Email"}),t.jsx("input",{type:"email",id:"email",value:o,onChange:J,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter your email",required:!0}),!g&&o&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Please enter a valid email address."}),!P&&o&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"This email ID is not registered with us."})]}),g&&P&&!C&&t.jsx("button",{onClick:q,type:"button",disabled:S,className:"w-full py-2 px-4 bg-green-600 text-white rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Get OTP via Email"}),j&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-onSurface",children:"Enter OTP"}),t.jsx("input",{type:"text",id:"otp",value:n,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter OTP"})," "]}),i&&F&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-onSurface",children:"New Password"}),t.jsx("input",{type:"password",id:"newPassword",value:d,onChange:e=>V(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter new password"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-onSurface",children:"Confirm Password"}),t.jsx("input",{type:"password",id:"confirmPassword",value:c,onChange:e=>A(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Confirm new password"})]}),t.jsx("button",{type:"button",onClick:G,className:"w-full py-2 px-4 bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700",children:"Change Password"})]})]}),t.jsx($,{})]})};export{X as default};
