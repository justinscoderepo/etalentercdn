import{q as ee,r as E,j as e,z as N,p as re,u as de,i as te}from"./main-DzBv391f.js";import{M as me}from"./index.modern-X6bqbYuk.js";import{u as ce}from"./index.esm-h7sPU12O.js";import{B as pe}from"./box-CpDtOdJu.js";import{RenderComponents as ue}from"./renderComponents-CSN2_fR5.js";import{F as ge}from"./PencilIcon-BHoIEZiM.js";import{F as fe}from"./XMarkIcon-DA669kBC.js";import{F as xe}from"./CheckIcon-DIbNRK37.js";import{F as he}from"./PlusIcon-B0EPORjc.js";import"./validationMessage-BKcGXX-U.js";import"./CheckCircleIcon-CoXhJr6u.js";function Ce({item:T,competitionStructureId:A,eventDetails:G,participantsList:D,formData:k,participantId:V,candidateId:m,disabled:B,selectedItems:ie,onChangeParticipantCompetitionProperties:I,isChecked:z}){const{register:W,control:j,errors:H,handleSubmit:se,setValue:M,getValues:q}=ce({defaultValues:{customCompetitionFields:[]}});let Y=D.find(s=>s.Candidate?.toString()==m?.toString()&&s.Competition?.toString()==A?.toString());const F=ee(T?.JsonSettings),K=F?.AdditionalTextFieldsForPubRegForm||[],x=F?.AdditionalTextFieldsMaxLength||1/0,c=F?.AdditionalTextFieldsMinLength||1;let U=ee(Y?.JsonSettings),v=ee(k?.participantCompetitionProperties||"{}"),$=U?.customCompetitionFields||[],J=!0;Y||(J=!1),console.log("formDataSavedCompetitionsProperties",v),v?.customCompetitionFields&&($=v?.customCompetitionFields.filter(s=>s.CandidateId?.toString()==m?.toString()&&s.Competition?.toString()==A?.toString())||[]);const y=K.map(s=>({key:s.FieldName.replace(/\s+/g,"_").toLowerCase(),label:s.FieldName,name:`customCompetitionFields[0].${s.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:s.FieldType?.toLowerCase()=="dropdown"?"select":s.FieldType?.toLowerCase()||"text",isRequired:s.IsRequired?.toLowerCase()==="yes",conditions:[],options:s.FieldType?.toLowerCase()==="dropdown"&&s.Options?s.Options.split(",").map(u=>u.trim()):[],placeholder:"",defaultValue:""})),[a,C]=E.useState([{id:Date.now(),values:{},fields:[...y],disabled:!1}]);let Q=JSON.stringify($);E.useEffect(()=>{if($.length>0){let s=[],u=$.map((t,i)=>{let n={},l={};return y.forEach(d=>{n[`customCompetitionFields[${i}].${d.key}`]=t?.[d.key],l[d.key]=t?.[d.key]}),s.push(l),{id:Date.now()+i,values:n,fields:y.map(d=>({...d,name:`customCompetitionFields[${i}].${d.key}`})),disabled:!0}});M("customCompetitionFields",s),C(u)}},[Q]);const b=()=>{if(a.length>=x){N.error(`You can add a maximum of ${x} rows.`);return}C(s=>[...s,{id:Date.now(),values:{},fields:y.map(u=>({...u,name:`customCompetitionFields[${s.length}].${u.key}`})),disabled:!1}])},P=async s=>{let u=q(),{candidate:t,customCompetitionFields:i}=u;i.forEach((r,f)=>{i[f]={...r,CandidateId:m,Competition:A}});let n=a.findIndex(r=>r.id===s);const l=i[n];if(y.filter(r=>r.isRequired&&!l[r.key]).length>0){N.error("Please fill all required fields before adding a new row.");return}var p=v?.customCompetitionFields||[];p=p.filter(r=>!(r.CandidateId==m&&r.Competition==A));const o=[...p,...i];I({...v,customCompetitionFields:o});let g=a[n];if(g.disabled=!0,y.forEach(r=>{g.values[`customCompetitionFields[${n}].${r.key}`]=l[r.key]}),C([...a]),J!==!1)try{let r=D.find(h=>h.Candidate?.toString()==m?.toString()&&h.Competition?.toString()==A?.toString())?.ParticipantId;if(!r){N.error("Participant ID not found.");return}let f=await re("/CandidateJson/UpdateParticipantJson",{participantId:r,candidateId:k?.candidate,JsonSettings:JSON.stringify(u)});N.success("Data saved successfully!");let S=a[n];S.disabled=!0,y.forEach(h=>{S.values[`customCompetitionFields[${n}].${h.key}`]=l[h.key]}),C([...a])}catch(r){console.error("Error updating participant JSON:",r),N.error("Failed to save data.")}},X=s=>{C(u=>u.map(t=>t.id===s?{...t,disabled:!1}:t))},Z=s=>{if(a.length<=c){N.error(`You must have at least ${c} rows.`);return}C(d=>d.filter(p=>p.id!==s));let u=q(),{candidate:t,customCompetitionFields:i}=u,n=a.findIndex(d=>d.id===s);if(i.splice(n,1),M("customCompetitionFields",i),J===!1){I({...v,customCompetitionFields:i});return}let l=Y?.ParticipantId;if(!l){N.error("Participant ID not found.");return}re("/CandidateJson/UpdateParticipantJson",{participantId:l,candidateId:k?.candidate,JsonSettings:JSON.stringify(u)}).then(d=>{N.success("Data deleted successfully!")}).catch(d=>{console.error("Error updating participant JSON:",d),N.error("Failed to delete data.")})};let O=y.map(s=>s.label).join(", "),w=O.lastIndexOf(",");w>-1&&(O=O.substring(0,w)+" and"+O.substring(w));const ne=F?.AdditionalTextFieldsHeading||"Additional Inputs",L=F?.AdditionalTextFieldsDescription?F?.AdditionalTextFieldsDescription+(F?.AdditionalTextFieldsDescription.endsWith(".")?"":". ")+(x>1?" Minimum "+c+" and maximum "+x+" rows.":""):"Please fill in the additional inputs, "+(x>1?" add a minimum of "+c+" and a maximum of "+x+" rows.":"");return y.length>0&&e.jsx(pe,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0 mb-4",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:L,headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:ne,children:e.jsxs("div",{className:"flex flex-col flex-grow",children:[a.map(s=>e.jsxs("div",{className:"flex flex-col lg:flex-row  gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[x>1&&e.jsx("div",{className:"flex",children:e.jsxs("span",{className:"text-sm font-bold text-gray-700 mr-2 mt-1 mb-2 ",children:[" #",a.indexOf(s)+1,":"]})}),e.jsx(ue,{singleRow:!1,eventDetails:G,components:s.fields,errors:H,register:W,handleSelect:()=>{},control:j,setValue:M,getValues:q,formData:s.values,isSubmitted:s.disabled,onChangeValue:(u,t)=>{C(i=>i.map(n=>n.id===s.id?{...n,values:{...n.values,[u]:t}}:n))}},s.id),e.jsx("div",{className:"flex items-baseline justify-end gap-x-2 print:hidden",children:s.disabled?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>X(s.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:e.jsx(ge,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+s.id),e.jsx("button",{type:"button",onClick:()=>Z(s.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:e.jsx(fe,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+s.id)]}):e.jsx("button",{type:"button",onClick:()=>P(s.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:e.jsx(xe,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+s.id)})]},s.id)),a.length<x&&e.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:e.jsx("button",{type:"button",onClick:b,disabled:a.length>=x,className:`rounded-full p-1.5 text-white shadow-sm ${a.length>=x?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:e.jsx(he,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const Re=({fieldName:T,label:A,errors:G,isGroupMandatory:D,participantType:k,setValue:V,formData:m,eventDetails:B,competitions:ie,participantsList:I,onChange:z,onChangeParticipantCompetitionProperties:W,disabled:j,register:H,control:se})=>{const{rows:M,status:q}=de("/CandidateJson/GetByAge",{sort:{sortOrder:"DESC",sortColumn:"id"},filter:{ParticipantType:m?.participantType=="Individual"?1:m?.participantType=="Team"?2:0,DobString:m?.userDobString},doCache:!0,select:"AgeFrom,AgeTo,EventGroupId,GroupName,Status"});let Y=G?.[T],[F,K]=E.useState(Y);E.useEffect(()=>{K(G?.[T])},[G?.[T]]);let x=I?.map(t=>t.Competition)??[],[c,U]=E.useState(x);j&&(c=x);let v=x.join(",");E.useEffect(()=>{v&&x.length>0&&U(x)},[v]);let $=function(t){t.forEach(i=>{let n=`competitionCheckBox_${i.Competition}`,l=document.querySelector(`input[name='${n}']`);l&&(l.checked=!0,z&&V(n,!0))})};E.useEffect(()=>{I?.length>0&&$(I)},[I]);var J=M?.filter(t=>{let i=t.JsonSettings;return!!(i&&(i=JSON.parse(i),i?.IsCommon=="Yes"))});let y=J?.map(t=>t.EventGroupId),a=ie??[];if(m?.group||D)a=a.filter(t=>j&&!c.find(i=>i==t.CompetitionStructureId)?!1:!!(t.Group==m?.group||y?.find(i=>i==t.Group)));else{let t=[];a=a.filter(i=>!(t.find(n=>n.Title==i.Title)||(t.push(i),j&&!c.find(n=>n==i.CompetitionStructureId)))),a=t}m?.gender&&(a=a.filter(t=>{if(m?.gender=="Male"){if(t.Gender==1||t.Gender==3)return!0}else if(m?.gender=="Female"){if(t.Gender==2||t.Gender==3)return!0}else return!0;return!1}));const C=[],Q=(t,i)=>{i.target.checked?c=[...c,t]:c=c.filter(l=>l!==t),U(c),z(c)};let b=JSON.parse(B?.JsonSettings??"{}"),P=10;k=="Individual"?P=b?.AdditionalSettings?.MaximumParticipationPerCandidate??10:P=b?.AdditionalSettings?.MaximumParticipationPerGroup??10;let X=b?.AdditionalSettings?.FeesCurrency??"USD",Z=b?.AdditionalSettings?.EnablePublicAndPrivateRegistration=="Yes",O=b?.AdditionalSettings?.UsePublicAndPrivateRegistrationByRegId=="Yes",w=b?.AdditionalSettings?.CustomMaxParticipationPerCandidate??[];if(a.length>0&&Z&&!j)if(O){let t=b?.AdditionalSettings,i=b?.components?.User?.find(p=>p.type=="RegistrationIdBox"),l=t?.EligibleRegistrationNumbers?.find(p=>p.RegistrationNumber==(m?.registrationId??"-")),d=!1;if(i?.conditions){let p=!0;for(let o=0;o<i.conditions.length;o++){let g=i.conditions[o],r=g.key?.charAt(0)?.toLowerCase()+g.key?.slice(1);if(m[r]?.toString()!=g.value?.toString()){p=!1;break}}p?d=!0:d=!1}else d=!0;l&&d||(a=a.filter(p=>{if(p.AllowPublicRegistration!="2")return!0}))}else a=a.filter(t=>{if(t.AllowPublicRegistration!="2")return!0});let L=c.filter(t=>a.find(i=>i.CompetitionStructureId==t))?.length>=P;w.length>0&&k=="Individual"&&console.log("customMaxSettings conflict with maxCompetitions");const s=[...new Set(a.map(t=>t.CompetitionCategoryName))],u=a.reduce((t,i)=>t.find(l=>l.CompetitionName===i.CompetitionName)?t:t.concat([i]),[]);return M?.forEach(t=>{s.forEach(i=>{let n=u.filter(o=>o.CompetitionCategoryName==i&&o.Group==t.EventGroupId),l={};if(l.CategoryName=i,l.CompetitionNames=[],n.forEach(o=>{let g=a.filter(f=>f.CompetitionCategoryName==i&&f.CompetitionName==o.CompetitionName),r={};r.CompetitionName=o.CompetitionName,r.competitions=g,l.CompetitionNames.push(r)}),w.length>0){let o=w.filter(h=>h.CompetitionCategoryId?.startsWith(i)),g=w.find(h=>h.CompetitionCategoryId==i),r=a.filter(h=>o.find(R=>R.CompetitionCategoryId==h.CompetitionCategoryName));var d=c.filter(h=>r.find(R=>R.CompetitionStructureId==h));let f=d.length>=(g?.MaxParticipation??1);if(f&&(l.isExceeded=f,l.MaxParticipation=g?.MaxParticipation??1),i.split("-").length>1){let h=i.split(" - ")[0],R=w.find(_=>_.CompetitionCategoryId==h),ae=a.filter(_=>R.CompetitionCategoryId==_.CompetitionCategoryName);var p=c.filter(_=>ae.find(le=>le.CompetitionStructureId==_));let oe=p.length+d.length>=(R?.MaxParticipation??1);oe&&(l.isExceeded=oe,l.MaxParticipation=R?.MaxParticipation??1)}}if(n.length>0){let o=n[0]?.GroupName;if(C.find(g=>g.GroupName==o))C.find(r=>r.GroupName==o).items.push(l);else{let g={GroupName:o,items:[l]};C.push(g)}}})}),e.jsx("div",{className:"mt-4  print:mt-0",children:e.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[C.length==0&&q=="finished"&&(m?.group?e.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}):e.jsx("div",{className:"text-orange-600 text-sm",children:"Please select a group to see competitions"})),L&&e.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:e.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",P," competition per ",k=="Individual"?"candidate":"team","."]})}),C?.map((t,i)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-3 print:mb-0 rounded-md print:border-0 print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-3  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-2xl px-5 print:text-lg font-semibold leading-6 text-blue-900",children:t.GroupName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500"})]})}),t?.items?.map((n,l)=>e.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-xl  print:text-lg font-semibold leading-6 text-cyan-600",children:n.CategoryName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Competitions"})]})}),e.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:n.CompetitionNames?.map((d,p)=>e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:e.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[e.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:d.CompetitionName}),e.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),e.jsx("div",{className:"mt-2 flex flex-wrap",children:d.competitions?.map((o,g)=>{let r=c.find(S=>S==o.CompetitionStructureId)!=null,f=!!(j||!r&&L);return n.isExceeded&&!r&&(f=!0),J?.find(S=>S.EventGroupId==o.Group),e.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("label",{onClick:S=>{if((L||n.isExceeded)&&f){n.isExceeded?N.error("You can't select more than "+n.MaxParticipation+" competitions from "+n.CategoryName):N.error("You can select maximum "+P+" competitions only");return}},className:te(f?"":"ml-2","block text-sm text-gray-900"),children:[!f&&e.jsx("input",{type:"checkbox",id:`competitionCheckBox_${o.CompetitionStructureId}`,className:te(" h-5 w-5 optiontext-darkprimary ",F?"border-red-300  text-red-600 focus:ring-red-800":f?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:f,fieldName:`competitionCheckBox_${o.CompetitionStructureId}`,checked:r,onChange:S=>{Q(o.CompetitionStructureId,S)}},g),f&&!r&&e.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),e.jsxs("span",{className:"hidden print:flex",children:[B?.AllowDisplayCompetitionOrder==1?o.CompetitionOrder+" - ":""," ",o.Title]}),e.jsx("span",{className:te(j?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(F?"text-danger":"text-gray-900")),children:(B?.AllowDisplayCompetitionOrder==1?o.CompetitionOrder+" - ":"")+(o.Title.replace(d.CompetitionName,"").replace(/ /gi,"").trim()!==""?o.Title.replace(d.CompetitionName,"").trim():d.CompetitionName.trim())})]})}),e.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:o?.Remarks&&e.jsx(me,{children:o.Remarks})}),o.Fees>0&&e.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:e.jsxs("b",{children:[b?.AdditionalSettings?.CustomFeesLabel||"Fees",":",e.jsxs("i",{className:"text-green-700 font-medium",children:[" ",o.Fees,b?.AdditionalSettings?.HideCurrencyInPublicPages!=="Yes"&&X]})]})}),r&&e.jsx(Ce,{eventDetails:B,item:o,competitionStructureId:o.CompetitionStructureId,candidateId:m?.candidate??m?.CandidateId??m?.candidateId,register:H,errors:G,isChecked:r,control:se,participantsList:I,onChangeParticipantCompetitionProperties:W,disabled:j,selectedItems:c,setValue:V,getValues:null,setFormData1:()=>{},formData:m})]},l+"_"+p+"_"+o.CompetitionStructureId)})})]},l+"_"+p))})]},l))]},i)}))]})})};export{Re as default};
