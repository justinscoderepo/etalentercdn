import{r as c,u as A,j as e,z as n}from"./main-CkEDTDV5.js";import{u as L}from"./index.esm-BtZBDDa6.js";import{L as U}from"./layoutOuter-u3lFfmHl.js";import{P as q}from"./pageHeader-CxCtK4jC.js";import{F as D}from"./DocumentTextIcon-DDeNCZvS.js";import{F as H}from"./ArrowUpTrayIcon-Dt18q-8A.js";import{F as O}from"./PlusIcon-CZ2YnAGi.js";import{F as P}from"./PencilIcon-DEGHZ8Zo.js";import{F as $}from"./TrashIcon-j-ilP0PV.js";const Z=()=>{const[m,p]=c.useState(null),[f,j]=c.useState(null),[o,d]=c.useState([]),[G,y]=c.useState(!0),[a,h]=c.useState(null),x=c.useRef(null),{register:N,handleSubmit:S,reset:v,formState:{errors:u}}=L(),{rows:g}=A("/EventJson/Get",{select:"EVId,JsonSettings,EventSecret",noGet:!1});c.useEffect(()=>{if(g&&g.length>0){const s=g[0];if(j(s),s.JsonSettings)try{const i=JSON.parse(s.JsonSettings)?.AdditionalSettings?.EligibleRegistrationNumbers||[];d(i)}catch(t){console.error("Error parsing JsonSettings:",t),d([])}y(!1)}},[g]);const w=(s,t=",")=>{let r=s.split(`
`).map(b=>{const l=b.split(t);try{return{RegistrationNumber:l[0]?.replace(/(\r\n|\n|\r)/gm,"").trim(),IssuedTo:l[1]?.replace(/(\r\n|\n|\r)/gm,"").trim(),ContactNumber:l[2]?.replace(/(\r\n|\n|\r)/gm,"").trim()}}catch(J){return console.error(J),null}});return r=r.filter(b=>b?.RegistrationNumber),r.length>0&&r[0].RegistrationNumber.toLowerCase().includes("registration")&&r.shift(),r},C=s=>{const t=s.target.files[0];if(!t)return;const i=new FileReader;i.onload=r=>{const b=r.target.result,l=w(b);if(l.length===0){n.error("No valid data found in CSV file");return}h(l),n.success(`${l.length} records loaded from CSV`)},i.onerror=()=>{n.error("Error reading CSV file")},i.readAsText(t)},R=()=>{if(!a||a.length===0){n.error("No CSV data to save");return}const s={};a.forEach(i=>{s[i.RegistrationNumber]=i});const t=Object.values(s);d(t),h(null),x.current&&(x.current.value=""),n.success(`${t.length} unique registration numbers added`)},E=()=>{h(null),x.current&&(x.current.value=""),n.info("CSV upload cancelled")},k=s=>{if(m!==null){const t=o.map((i,r)=>r===m?{RegistrationNumber:s.RegistrationNumber,IssuedTo:s.IssuedTo,ContactNumber:s.ContactNumber}:i);d(t),n.success("Registration number updated successfully"),p(null)}else{if(o.find(r=>r.RegistrationNumber===s.RegistrationNumber)){n.error("Registration number already exists");return}const i={RegistrationNumber:s.RegistrationNumber,IssuedTo:s.IssuedTo,ContactNumber:s.ContactNumber};d([...o,i]),n.success("Registration number added successfully")}v()},I=s=>{const t=o[s];p(s),v({RegistrationNumber:t.RegistrationNumber,IssuedTo:t.IssuedTo,ContactNumber:t.ContactNumber})},T=s=>{const t=o.filter((i,r)=>r!==s);d(t),n.success("Registration number deleted successfully")},V=async()=>{if(!f){n.error("Event details not loaded");return}try{let s={};f.JsonSettings&&(s=JSON.parse(f.JsonSettings)),s.AdditionalSettings||(s.AdditionalSettings={}),s.AdditionalSettings.EligibleRegistrationNumbers=o,(await fetch("/EventJson/Save",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({Select:"EVId,JsonSettings",EVId:f.EVId,JsonSettings:JSON.stringify(s)})})).ok?n.success("All eligible registration numbers saved successfully"):n.error("Failed to save registration numbers")}catch(s){console.error("Error saving registration numbers:",s),n.error("Error saving registration numbers")}},F=()=>{const s=`RegistrationNumber,IssuedTo,ContactNumber
REG001,John Doe,1234567890
REG002,Jane Smith,9876543210`,t=new Blob([s],{type:"text/csv"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download="registration_numbers_template.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)};return e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx(q,{heading:"Eligible Registration Numbers",subHeading:"Manage whitelisted registration numbers for event access",icon:D,rightChildren:o.length>0&&e.jsx("button",{onClick:V,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:"Save All Changes"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-onSurface mb-4",children:"CSV Upload"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center mb-4",children:[e.jsxs("label",{htmlFor:"csvUpload",className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:[e.jsx(H,{className:"-mr-0.5 h-5 w-5"}),"Upload CSV File"]}),e.jsx("input",{ref:x,type:"file",id:"csvUpload",accept:".csv",onChange:C,className:"hidden"}),e.jsx("button",{onClick:F,className:"inline-flex items-center gap-x-2 rounded-md bg-gray-200 px-6 py-2.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:"Download Template"}),e.jsx("div",{className:"text-sm text-onSurfaceVariant",children:"Format: RegistrationNumber,IssuedTo,ContactNumber"})]}),a&&a.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-onSurface",children:["Preview (",a.length," records)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:E,className:"inline-flex items-center gap-x-2 rounded-md bg-surface px-4 py-2 text-sm font-semibold text-onSurface shadow-sm hover:bg-surfaceHover",children:"Cancel"}),e.jsx("button",{onClick:R,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover",children:"Add to List"})]})]}),e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-surface sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Registration Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Issued To"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Contact Number"})]})}),e.jsx("tbody",{className:"bg-surfaceCard divide-y divide-border",children:a.map((s,t)=>e.jsxs("tr",{className:"hover:bg-surface",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:s.RegistrationNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:s.IssuedTo}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:s.ContactNumber})]},t))})]})})})]})]}),e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-onSurface mb-4",children:m!==null?"Edit Registration Number":"Add Registration Number Manually"}),e.jsxs("form",{onSubmit:S(k),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-1",children:"Registration Number *"}),e.jsx("input",{type:"text",...N("RegistrationNumber",{required:"Registration number is required"}),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border",placeholder:"Enter registration number"}),u.RegistrationNumber&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.RegistrationNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-1",children:"Issued To *"}),e.jsx("input",{type:"text",...N("IssuedTo",{required:"Issued to name is required"}),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border",placeholder:"Enter name"}),u.IssuedTo&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.IssuedTo.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-1",children:"Contact Number *"}),e.jsx("input",{type:"text",...N("ContactNumber",{required:"Contact number is required"}),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border",placeholder:"Enter contact number"}),u.ContactNumber&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.ContactNumber.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[m!==null&&e.jsx("button",{type:"button",onClick:()=>{p(null),v()},className:"inline-flex items-center gap-x-2 rounded-md bg-surface px-6 py-2.5 text-sm font-semibold text-onSurface shadow-sm hover:bg-surfaceHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:[e.jsx(O,{className:"-mr-0.5 h-5 w-5"}),m!==null?"Update":"Add"]})]})]})]}),o.length>0?e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-surface",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Registration Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Issued To"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Contact Number"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-surfaceCard divide-y divide-border",children:o.map((s,t)=>e.jsxs("tr",{className:"hover:bg-surface",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:s.RegistrationNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:s.IssuedTo}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:s.ContactNumber}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:[e.jsx("button",{onClick:()=>I(t),className:"text-primary hover:text-primaryHover mr-3",title:"Edit",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>T(t),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx($,{className:"h-5 w-5"})})]})]},t))})]})})}):e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm border border-border p-12 text-center",children:[e.jsx(ShieldExclamationIcon,{className:"mx-auto h-12 w-12 text-onSurfaceVariant mb-3"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-1",children:"No registration numbers configured"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Add registration numbers manually or upload a CSV file"})]})]})]})})};export{Z as default};
