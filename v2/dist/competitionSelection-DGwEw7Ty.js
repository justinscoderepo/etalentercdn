import{q as ee,r as A,j as t,z as b,p as oe,u as le,i as te}from"./main-CEPZRmg1.js";import{M as de}from"./index.modern-B8KnPWb4.js";import{u as me}from"./index.esm-C50ZSFQh.js";import{B as ce}from"./box-DIpGP7xw.js";import{RenderComponents as pe}from"./renderComponents-Yu98HXl6.js";import{F as ue}from"./PencilIcon-Da4B0Phe.js";import{F as ge}from"./XMarkIcon-BpS2j1JB.js";import{F as fe}from"./CheckIcon-LMgNgar7.js";import{F as xe}from"./PlusIcon-rp6G9vRG.js";import"./validationMessage-CmJBVnbp.js";import"./CheckCircleIcon-D8KYM7br.js";function he({item:O,competitionStructureId:G,eventDetails:M,participantsList:_,formData:I,participantId:V,candidateId:p,disabled:T,selectedItems:ie,onChangeParticipantCompetitionProperties:v,isChecked:z}){const{register:W,control:F,errors:H,handleSubmit:se,setValue:$,getValues:B}=me({defaultValues:{customCompetitionFields:[]}});let J=_.find(i=>i.Candidate?.toString()==p?.toString()&&i.Competition?.toString()==G?.toString());const S=ee(O?.JsonSettings),k=S?.AdditionalTextFieldsForPubRegForm||[],m=S?.AdditionalTextFieldsMaxLength||1/0,P=S?.AdditionalTextFieldsMinLength||1;let D=ee(J?.JsonSettings),w=ee(I?.participantCompetitionProperties||"{}"),R=D?.customCompetitionFields||[],q=!0;J||(q=!1),console.log("formDataSavedCompetitionsProperties",w),w?.customCompetitionFields&&(R=w?.customCompetitionFields.filter(i=>i.CandidateId?.toString()==p?.toString()&&i.Competition?.toString()==G?.toString())||[]);const d=k.map(i=>({key:i.FieldName.replace(/\s+/g,"_").toLowerCase(),label:i.FieldName,name:`customCompetitionFields[0].${i.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:i.FieldType?.toLowerCase()=="dropdown"?"select":i.FieldType?.toLowerCase()||"text",isRequired:i.IsRequired?.toLowerCase()==="yes",conditions:[],options:i.FieldType?.toLowerCase()==="dropdown"&&i.Options?i.Options.split(",").map(e=>e.trim()):[],placeholder:"",defaultValue:""})),[u,j]=A.useState([{id:Date.now(),values:{},fields:[...d],disabled:!1}]);let h=JSON.stringify(R);A.useEffect(()=>{if(R.length>0){let i=[],e=R.map((s,r)=>{let o={},c={};return d.forEach(l=>{o[`customCompetitionFields[${r}].${l.key}`]=s?.[l.key],c[l.key]=s?.[l.key]}),i.push(c),{id:Date.now()+r,values:o,fields:d.map(l=>({...l,name:`customCompetitionFields[${r}].${l.key}`})),disabled:!0}});$("customCompetitionFields",i),j(e)}},[h]);const E=()=>{if(u.length>=m){b.error(`You can add a maximum of ${m} rows.`);return}j(i=>[...i,{id:Date.now(),values:{},fields:d.map(e=>({...e,name:`customCompetitionFields[${i.length}].${e.key}`})),disabled:!1}])},K=async i=>{let e=B(),{candidate:s,customCompetitionFields:r}=e;r.forEach((a,N)=>{r[N]={...a,CandidateId:p,Competition:G}});let o=u.findIndex(a=>a.id===i);const c=r[o];if(d.filter(a=>a.isRequired&&!c[a.key]).length>0){b.error("Please fill all required fields before adding a new row.");return}var n=w?.customCompetitionFields||[];n=n.filter(a=>!(a.CandidateId==p&&a.Competition==G));const f=[...n,...r];v({...w,customCompetitionFields:f});let g=u[o];if(g.disabled=!0,d.forEach(a=>{g.values[`customCompetitionFields[${o}].${a.key}`]=c[a.key]}),j([...u]),q!==!1)try{let a=_.find(x=>x.Candidate?.toString()==p?.toString()&&x.Competition?.toString()==G?.toString())?.ParticipantId;if(!a){b.error("Participant ID not found.");return}let N=await oe("/CandidateJson/UpdateParticipantJson",{participantId:a,candidateId:I?.candidate,JsonSettings:JSON.stringify(e)});b.success("Data saved successfully!");let C=u[o];C.disabled=!0,d.forEach(x=>{C.values[`customCompetitionFields[${o}].${x.key}`]=c[x.key]}),j([...u])}catch(a){console.error("Error updating participant JSON:",a),b.error("Failed to save data.")}},Q=i=>{j(e=>e.map(s=>s.id===i?{...s,disabled:!1}:s))},X=i=>{if(u.length<=P){b.error(`You must have at least ${P} rows.`);return}j(l=>l.filter(n=>n.id!==i));let e=B(),{candidate:s,customCompetitionFields:r}=e,o=u.findIndex(l=>l.id===i);if(r.splice(o,1),$("customCompetitionFields",r),q===!1){v({...w,customCompetitionFields:r});return}let c=J?.ParticipantId;if(!c){b.error("Participant ID not found.");return}oe("/CandidateJson/UpdateParticipantJson",{participantId:c,candidateId:I?.candidate,JsonSettings:JSON.stringify(e)}).then(l=>{b.success("Data deleted successfully!")}).catch(l=>{console.error("Error updating participant JSON:",l),b.error("Failed to delete data.")})};let y=d.map(i=>i.label).join(", "),U=y.lastIndexOf(",");U>-1&&(y=y.substring(0,U)+" and"+y.substring(U));const Y=S?.AdditionalTextFieldsHeading||"Additional Inputs",Z=S?.AdditionalTextFieldsDescription?S?.AdditionalTextFieldsDescription+(S?.AdditionalTextFieldsDescription.endsWith(".")?"":". ")+(m>1?" Minimum "+P+" and maximum "+m+" rows.":""):"Please fill in the additional inputs, "+(m>1?" add a minimum of "+P+" and a maximum of "+m+" rows.":"");return d.length>0&&t.jsx(ce,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0 mb-4",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:Z,headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:Y,children:t.jsxs("div",{className:"flex flex-col flex-grow",children:[u.map(i=>t.jsxs("div",{className:"flex flex-col lg:flex-row  gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[m>1&&t.jsx("div",{className:"flex",children:t.jsxs("span",{className:"text-sm font-bold text-gray-700 mr-2 mt-1 mb-2 ",children:[" #",u.indexOf(i)+1,":"]})}),t.jsx(pe,{singleRow:!1,eventDetails:M,components:i.fields,errors:H,register:W,handleSelect:()=>{},control:F,setValue:$,getValues:B,formData:i.values,isSubmitted:i.disabled,onChangeValue:(e,s)=>{j(r=>r.map(o=>o.id===i.id?{...o,values:{...o.values,[e]:s}}:o))}},i.id),t.jsx("div",{className:"flex items-baseline justify-end gap-x-2 print:hidden",children:i.disabled?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>Q(i.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:t.jsx(ue,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+i.id),t.jsx("button",{type:"button",onClick:()=>X(i.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:t.jsx(ge,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+i.id)]}):t.jsx("button",{type:"button",onClick:()=>K(i.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:t.jsx(fe,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+i.id)})]},i.id)),u.length<m&&t.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:t.jsx("button",{type:"button",onClick:E,disabled:u.length>=m,className:`rounded-full p-1.5 text-white shadow-sm ${u.length>=m?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:t.jsx(xe,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const Pe=({fieldName:O,label:G,errors:M,isGroupMandatory:_,participantType:I,setValue:V,formData:p,eventDetails:T,competitions:ie,participantsList:v,onChange:z,onChangeParticipantCompetitionProperties:W,disabled:F,register:H,control:se})=>{const{rows:$}=le("/CandidateJson/GetByAge",{sort:{sortOrder:"DESC",sortColumn:"id"},filter:{ParticipantType:p?.participantType=="Individual"?1:p?.participantType=="Team"?2:0,DobString:p?.userDobString},doCache:!0,select:"AgeFrom,AgeTo,EventGroupId,GroupName,Status"});let B=M?.[O],[J,S]=A.useState(B);A.useEffect(()=>{S(M?.[O])},[M?.[O]]);let k=v?.map(e=>e.Competition)??[],[m,P]=A.useState(k);F&&(m=k);let D=k.join(",");A.useEffect(()=>{D&&k.length>0&&P(k)},[D]);let w=function(e){e.forEach(s=>{let r=`competitionCheckBox_${s.Competition}`,o=document.querySelector(`input[name='${r}']`);o&&(o.checked=!0,z&&V(r,!0))})};A.useEffect(()=>{v?.length>0&&w(v)},[v]);var R=$?.filter(e=>{let s=e.JsonSettings;return!!(s&&(s=JSON.parse(s),s?.IsCommon=="Yes"))});let q=R?.map(e=>e.EventGroupId),d=ie??[];if(p?.group||_)d=d.filter(e=>F&&!m.find(s=>s==e.CompetitionStructureId)?!1:!!(e.Group==p?.group||q?.find(s=>s==e.Group)));else{let e=[];d=d.filter(s=>!(e.find(r=>r.Title==s.Title)||(e.push(s),F&&!m.find(r=>r==s.CompetitionStructureId)))),d=e}p?.gender&&(d=d.filter(e=>{if(p?.gender=="Male"){if(e.Gender==1||e.Gender==3)return!0}else if(p?.gender=="Female"){if(e.Gender==2||e.Gender==3)return!0}else return!0;return!1}));const u=[],j=(e,s)=>{s.target.checked?m=[...m,e]:m=m.filter(o=>o!==e),P(m),z(m)};let h=JSON.parse(T?.JsonSettings??"{}"),E=10;I=="Individual"?E=h?.AdditionalSettings?.MaximumParticipationPerCandidate??10:E=h?.AdditionalSettings?.MaximumParticipationPerGroup??10;let K=h?.AdditionalSettings?.FeesCurrency??"USD",Q=h?.AdditionalSettings?.EnablePublicAndPrivateRegistration=="Yes",X=h?.AdditionalSettings?.UsePublicAndPrivateRegistrationByRegId=="Yes",y=h?.AdditionalSettings?.CustomMaxParticipationPerCandidate??[];if(d.length>0&&Q&&!F)if(X){let e=h?.AdditionalSettings,s=h?.components?.User?.find(l=>l.type=="RegistrationIdBox"),o=e?.EligibleRegistrationNumbers?.find(l=>l.RegistrationNumber==(p?.registrationId??"-")),c=!1;if(s?.conditions){let l=!0;for(let n=0;n<s.conditions.length;n++){let f=s.conditions[n],g=f.key?.charAt(0)?.toLowerCase()+f.key?.slice(1);if(p[g]?.toString()!=f.value?.toString()){l=!1;break}}l?c=!0:c=!1}else c=!0;o&&c||(d=d.filter(l=>{if(l.AllowPublicRegistration!="2")return!0}))}else d=d.filter(e=>{if(e.AllowPublicRegistration!="2")return!0});let Y=m.filter(e=>d.find(s=>s.CompetitionStructureId==e))?.length>=E;y.length>0&&I=="Individual"&&console.log("customMaxSettings conflict with maxCompetitions");const Z=[...new Set(d.map(e=>e.CompetitionCategoryName))],i=d.reduce((e,s)=>e.find(o=>o.CompetitionName===s.CompetitionName)?e:e.concat([s]),[]);return $?.forEach(e=>{Z.forEach(s=>{let r=i.filter(n=>n.CompetitionCategoryName==s&&n.Group==e.EventGroupId),o={};if(o.CategoryName=s,o.CompetitionNames=[],r.forEach(n=>{let f=d.filter(a=>a.CompetitionCategoryName==s&&a.CompetitionName==n.CompetitionName),g={};g.CompetitionName=n.CompetitionName,g.competitions=f,o.CompetitionNames.push(g)}),y.length>0){let n=y.filter(C=>C.CompetitionCategoryId?.startsWith(s)),f=y.find(C=>C.CompetitionCategoryId==s),g=d.filter(C=>n.find(x=>x.CompetitionCategoryId==C.CompetitionCategoryName));var c=m.filter(C=>g.find(x=>x.CompetitionStructureId==C));let a=c.length>=(f?.MaxParticipation??1);if(a&&(o.isExceeded=a,o.MaxParticipation=f?.MaxParticipation??1),s.split("-").length>1){let C=s.split(" - ")[0],x=y.find(L=>L.CompetitionCategoryId==C),re=d.filter(L=>x.CompetitionCategoryId==L.CompetitionCategoryName);var l=m.filter(L=>re.find(ae=>ae.CompetitionStructureId==L));let ne=l.length+c.length>=(x?.MaxParticipation??1);ne&&(o.isExceeded=ne,o.MaxParticipation=x?.MaxParticipation??1)}}if(r.length>0){let n=r[0]?.GroupName;if(u.find(f=>f.GroupName==n))u.find(g=>g.GroupName==n).items.push(o);else{let f={GroupName:n,items:[o]};u.push(f)}}})}),t.jsx("div",{className:"mt-4  print:mt-0",children:t.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[u.length==0&&(p?.group?t.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}):t.jsx("div",{className:"text-orange-600 text-sm",children:"Please select a group to see competitions"})),Y&&t.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:t.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",E," competition per ",I=="Individual"?"candidate":"team","."]})}),u?.map((e,s)=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"mb-3 print:mb-0 rounded-md print:border-0 print:px-0   print:py-0 py-2",children:[t.jsx("div",{className:"border-b border-gray-300 pb-3  print:pb-0 print:hidden",children:t.jsxs("div",{className:"flex flex-wrap items-baseline",children:[t.jsx("h3",{className:"mt-1 text-2xl px-5 print:text-lg font-semibold leading-6 text-blue-900",children:e.GroupName}),t.jsx("p",{className:"ml-1 truncate text-base text-gray-500"})]})}),e?.items?.map((r,o)=>t.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[t.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:t.jsxs("div",{className:"flex flex-wrap items-baseline",children:[t.jsx("h3",{className:"mt-1 text-xl  print:text-lg font-semibold leading-6 text-cyan-600",children:r.CategoryName}),t.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Competitions"})]})}),t.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:r.CompetitionNames?.map((c,l)=>t.jsxs("div",{children:[t.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:t.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[t.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:c.CompetitionName}),t.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),t.jsx("div",{className:"mt-2 flex flex-wrap",children:c.competitions?.map((n,f)=>{let g=m.find(N=>N==n.CompetitionStructureId)!=null,a=!!(F||!g&&Y);return r.isExceeded&&!g&&(a=!0),R?.find(N=>N.EventGroupId==n.Group),t.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[t.jsx("div",{className:"flex gap-3",children:t.jsxs("label",{onClick:N=>{if((Y||r.isExceeded)&&a){r.isExceeded?b.error("You can't select more than "+r.MaxParticipation+" competitions from "+r.CategoryName):b.error("You can select maximum "+E+" competitions only");return}},className:te(a?"":"ml-2","block text-sm text-gray-900"),children:[!a&&t.jsx("input",{type:"checkbox",id:`competitionCheckBox_${n.CompetitionStructureId}`,className:te(" h-5 w-5 optiontext-darkprimary ",J?"border-red-300  text-red-600 focus:ring-red-800":a?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:a,fieldName:`competitionCheckBox_${n.CompetitionStructureId}`,checked:g,onChange:N=>{j(n.CompetitionStructureId,N)}},f),a&&!g&&t.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),t.jsxs("span",{className:"hidden print:flex",children:[T?.AllowDisplayCompetitionOrder==1?n.CompetitionOrder+" - ":""," ",n.Title]}),t.jsx("span",{className:te(F?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(J?"text-danger":"text-gray-900")),children:(T?.AllowDisplayCompetitionOrder==1?n.CompetitionOrder+" - ":"")+(n.Title.replace(c.CompetitionName,"").replace(/ /gi,"").trim()!==""?n.Title.replace(c.CompetitionName,"").trim():c.CompetitionName.trim())})]})}),t.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:n?.Remarks&&t.jsx(de,{children:n.Remarks})}),n.Fees>0&&t.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:t.jsxs("b",{children:[h?.AdditionalSettings?.CustomFeesLabel||"Fees",":",t.jsxs("i",{className:"text-green-700 font-medium",children:[" ",n.Fees,h?.AdditionalSettings?.HideCurrencyInPublicPages!=="Yes"&&K]})]})}),g&&t.jsx(he,{eventDetails:T,item:n,competitionStructureId:n.CompetitionStructureId,candidateId:p?.candidate??p?.CandidateId??p?.candidateId,register:H,errors:M,isChecked:g,control:se,participantsList:v,onChangeParticipantCompetitionProperties:W,disabled:F,selectedItems:m,setValue:V,getValues:null,setFormData1:()=>{},formData:p})]},o+"_"+l+"_"+n.CompetitionStructureId)})})]},o+"_"+l))})]},o))]},s)}))]})})};export{Pe as default};
