import{r as S,j as i,i as ee,p as he,u as E,n as Xe,L as we}from"./main-DMKfhHuC.js";import{L as Ze}from"./layoutOuter-CNlfANEd.js";import{P as et}from"./pageHeader-R5eL0mcb.js";import{C as tt}from"./index.esm-UnYTSlTD.js";import{V as it}from"./validationMessage-Cqly-3I2.js";import{u as W,w as Ne}from"./xlsx-BojT3SgY.js";const ye=function({control:O,fieldName:G,label:q,placeholder:$,errors:L,register:k,formData:z,optional:te,maxLength:ge,onChange:ie,options:A,optionKey:v="id",values:N,optionText:_="name",type:de,maxHeight:j="max-h-96",value:D,name:F,className:Y=""}){let b=L?.[G],[K,V]=S.useState(b),[Q,U]=S.useState(new Set);const B=!!O;S.useEffect(()=>{V(L?.[G])},[L?.[G]]),S.useEffect(()=>{U(new Set)},[D,N]);const X=()=>B&&N&&N.length>0?A?.filter(g=>N.some(f=>f.id==g[v]&&f.isDelete==!1)).map(g=>g[v])||[]:!B&&D!==void 0?Array.isArray(D)?D:[]:[],oe=(g,f)=>{U(y=>{const J=new Set(y);return J.has(g)?J.delete(g):J.add(g),J});let C=[...X()];const H=String(g);C.some(y=>String(y)===H)?C=C.filter(y=>String(y)!==H):C.push(g),setTimeout(()=>{ie&&ie(C),f&&f(C),V("")},1e3)},se=g=>typeof _=="function"?_(g):g[_];console.log({pendingToggles:Q,value:D});const P=g=>i.jsx("div",{className:ee("w-full bg-white overflow-y-auto",j),children:A&&A.length>0?A.map((f,ne)=>{const H=X().some(J=>J==f[v]),y=Q.has(f[v])?!H:H;return i.jsxs("label",{className:ee("flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors",y?"bg-green-50/10":"",Y),children:[i.jsxs("div",{className:"relative flex items-center justify-center",children:[i.jsx("input",{type:"checkbox",checked:y,onChange:()=>oe(f[v],g?.onChange),className:"sr-only"}),i.jsx("div",{className:ee("w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200",y?"bg-green-600 border-green-600 shadow-sm":"bg-white border-gray-300 hover:border-green-400"),children:y&&i.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3.5",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{d:"M5 13l4 4L19 7"})})})]}),i.jsx("span",{className:ee("ml-3 text-sm transition-colors",y?"text-green-700 font-medium":"text-gray-700"),children:se(f)})]},ne)}):i.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"No options available"})});return i.jsxs("div",{className:"multiSelectCheckBox",children:[q&&i.jsx("label",{htmlFor:G||F,className:ee("block text-sm font-medium mb-2 px-3",K?"text-danger":"text-gray-700"),children:q}),B?i.jsx(tt,{control:O,...k(G,{required:!te}),render:({field:g})=>P(g)}):P(),K&&i.jsx(it,{message:"This field is required"})]})},ot=async(w,O)=>{var G={};if(w.JsonSettings!=null&&w.JsonSettings!=""){var q=JSON.parse(w.JsonSettings);G=q}G.scheduleSettings=O;var $=JSON.stringify(G,null,2);await he("/EventJson/Save",{Select:"EVId,JsonSettings",EVId:w.EVId,JsonSettings:$})};let ce={};sessionStorage.getItem("allpreferences")&&(ce=JSON.parse(sessionStorage.getItem("allpreferences")));const mt=()=>{const[w,O]=S.useState([]),[G,q]=S.useState(!1),[$,L]=S.useState(!1),[k,z]=S.useState(!1),te=S.useRef(!1);let[ge,ie]=S.useState({}),A=localStorage.getItem("preferenceCompetitionStructures"),v=localStorage.getItem("preferenceCompetitions"),N=localStorage.getItem("startTime"),_=localStorage.getItem("startDate"),de=localStorage.getItem("timeGap")||10,[j,D]=S.useState(A?JSON.parse(A):{}),[F,Y]=S.useState(v?JSON.parse(v):{});const[b,K]=S.useState(()=>{let t=new Date;if(_&&(t=new Date(_)),t.setHours(9,0,0,0),N){let o=N.split(":");t.setHours(o[0],o[1].split(" ")[0],0,0)}return t}),{row:V}=E("/EventJson/Get",{select:"EVId,JsonSettings",doCache:!0});let Q=V?.JsonSettings,U=Q?JSON.parse(Q):{},B=U.scheduleSettings?.scheduleListPreferences,X=U.scheduleSettings?.scheduleListPreferenceCompetitions,oe=U.scheduleSettings?.scheduleStartTime,se=U.scheduleSettings?.scheduleStartDate;S.useEffect(()=>{V&&!te.current&&(oe&&(N=oe),se&&(_=se),B&&D(B),X&&Y(X),te.current=!0)},[V]);const{rows:P,status:g}=E("/EventStagesJson/Get",{select:"ESGId,Title,Venue",limit:1e3,offset:0,filter:{status:1},doCache:!0}),{rows:f,status:ne}=E("/CompetitionStructureJson/GetReadyToStart",{filter:{ParticipantType:1,status:1},sort:{sortOrder:"ASC",sortColumn:"GroupOrder"},select:"CompetitionStructureId,CompetitionItem,CompetitionItemTitle,GroupGroupName,ParticipantType,ParticipantTypeTitle,MaximumMinutes,MaximumSeconds,Gender,Language,GenderGenderTitle,LanguageLanguageName,CompetitionStructureId,CompetitionItem,ParticipantType,MaximumMinutes,MaximumSeconds",doCache:!0,limit:1e3,offset:0}),{rows:C,status:H}=E("/CompetitionParticipantsJson/Get",{select:"ParticipantId,IdentityNumber,Competition,Candidate,Team",filter:{ParticipantType:1,status:1},doCache:!0,limit:1e4,offset:0}),{rows:me,status:y}=E("/UsersRolesPlusUsersJson/Get",{select:"UserId,UserName,UserRoleId,UserRoleId,UserJsonSettings,UserDobString,UserImage,UserMobile,UserPhone,Email,Group,IdentityNumber,CandidateUser,UserJsonSettings",filter:{status:1},doCache:!0,limit:1e4,offset:0}),{rows:J}=E("/CompetitionParticipantsTeamsJson/Get",{select:"TeamId,TeamName,TeamStrength,TeamMembersList,TeamMembers,TeamStrength,IdentityNumber",filter:{status:1},doCache:!0,limit:1e4,offset:0});let{rows:Se,status:Pe}=E("/competitionItemsJson/Get",{select:"CompetitionId,Title,Category,CategoryCategoryName,JsonSettings",filter:{status:1},limit:1e3,doCache:!0});E("/CompetitionParticipantsTeamMembersJson/Get",{select:"*",limit:1e3,filter:{status:1},doCache:!0});let{rows:I,status:Ie,setFilter:je}=E("/CompetitionScheduleJson/Get",{filter:{CompetitionParticipantType:1,status:1},select:"ScheduledStartTime,Stage,Competition,CompetitionParticipantType,ExpectedTotalTimeInMinutes,Ischeduled,ScheduledEndTime,CompetitionCompetitionItem,CompetitionCompetitionItemTItle,CompetitionCompetitionStructureId,CompetitionMaximumMinutes,CompetitionMaximumSeconds,CompetitionMinimumMinutes,CompetitionMinimumSeconds,CompetitionWarningMinute,CompetitionWarningSecond,Phase,PhaseTitle,StageTitle,Status,Event,EventEventName,Order,CreatedBy,CreatedDate,ModifiedDate,ScheduleId,JsonSettings,EventGlobal,Participants,CompetitionPreviosGapInMinutes,AvoidChangeStage",limit:1e3,doCache:!0,offset:0}),xe=[];I?.length&&f?.length&&(I=I.filter(t=>f.some(o=>o.CompetitionStructureId==t.Competition)));let re=Xe(g,ne,H,y,Pe,Ie),Z=10,ae=70,Ge=b,Ce=72*60/Z;const ue=S.useMemo(()=>Array.from(Array(Ce),(t,o)=>{const e=o*Z;return new Date(Ge.getTime()+e*60*1e3).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}),[b,Ce,Z]);S.useEffect(()=>{re||f&&C&&P&&I&&(L(!1),pe())},[re]),S.useEffect(()=>{const t=o=>{if(k)return o.preventDefault(),o.returnValue="You have unsaved changes. Are you sure you want to leave?",o.returnValue};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[k]);const pe=async()=>{if(!$){L(!0);let t=JSON.stringify(j);ce[b+"_"+t];let o={};C.forEach(n=>{n.Team==0?o[n.Candidate]=me.find(a=>a.UserRoleId===n.Candidate)?.IdentityNumber??"":o[n.Team]=J.find(a=>a.TeamId===n.Team)?.IdentityNumber??"",o[n.Candidate]||delete o[n.Candidate]});const e=De(),s=be();let d=Te(s);d.sort((n,a)=>{const l=I.find(M=>M.Competition==n.Competition),r=I.find(M=>M.Competition==a.Competition),m=l?.JsonSettings?JSON.parse(l.JsonSettings):{},T=r?.JsonSettings?JSON.parse(r.JsonSettings):{};return m.forceOrder&&T.forceOrder?(l?.Order||0)-(r?.Order||0):m.forceOrder?-1:T.forceOrder?1:0});for(let n of d){const a=Le(n,o),l=I.find(m=>m.Competition==n.Competition);l?.JsonSettings&&JSON.parse(l.JsonSettings);let r;r||(r=Oe(a,e)),r&&Je(r,a,e)}ce[b+"_"+t]=e,sessionStorage.setItem("allpreferences",JSON.stringify(ce)),O(e),L(!1)}},De=()=>{const t={};return P.forEach(o=>{t[o.ESGId]=[]}),O(t),t},be=()=>f.filter(t=>!xe.some(o=>o.Competition==t.CompetitionStructureId)),Ee=(t,o)=>{let e=t.target.value;localStorage.setItem(o,e),ie({...ge,[o]:e}),setTimeout(()=>{L(!1),pe()},1e3)},Te=t=>{let o=[...xe];return t.length>0&&o.push(...t.map(e=>({CompetitionStructureId:e.CompetitionStructureId,Competition:e.CompetitionStructureId,CompetitionCompetitionItemTitle:e.CompetitionItemTitle,GroupGroupName:e.GroupGroupName,CompetitionParticipantTypeTitle:e.ParticipantTypeTitle,CompetitionMaximumMinutes:e.MaximumMinutes,CompetitionMaximumSeconds:e.MaximumSeconds,CompetitionGenderGenderTitle:e.GenderGenderTitle,CompetitionLanguageLanguageName:e.LanguageLanguageName}))),o},Le=(t,o)=>{const e=f.find(m=>m.CompetitionStructureId==t.Competition),s=Se.find(m=>m.CompetitionId==e.CompetitionItem);e?.MaximumMinutes||console.error("Competition Maximum Minutes not found for competition: ",e);const d=parseFloat(e?.MaximumMinutes||20),n=C.filter(m=>m.Competition==t.Competition).length;let l=[8,1,105,107].includes(s.Category);const r=ve(d,e,n,l,s);return{CompetitionStructureId:e.CompetitionStructureId,Title:`${e.ParticipantType==1?"ðŸ•º":"ðŸ‘«"} ${e.GroupGroupName} ${e.CompetitionItemTitle}${e.Gender!=3?" "+e.GenderGenderTitle:""} ${e.Language!=4?" "+e.LanguageLanguageName:""}`,Duration:r,ParticipantsCount:n,MaximumMinutes:d,perTimeLimit:e.MaximumMinutes,isOffStage:l,Logs:[],allParticipants:C.filter(m=>m.Competition==e.CompetitionStructureId).map(m=>m.Candidate>0?m.Candidate:m.Team),Participants:C.filter(m=>m.Competition==e.CompetitionStructureId&&o[m.Candidate>0?m.Candidate:m.Team]).map(m=>o[m.Candidate>0?m.Candidate:m.Team])}},ve=(t,o,e,s,d)=>{const n=parseFloat(de)||10,a=d.JsonSettings?JSON.parse(d.JsonSettings):{};a?.TimeCalculation&&(a.TimeCalculation=="PerHead"?s=!1:a.TimeCalculation=="TotalTime"&&(s=!0));let l=s?t:t*e+n;return l%10===0?l:l+(10-l%10)},Je=async(t,o,e)=>{const s=o.Duration/Z*ae;e[t.ESGId]||(e[t.ESGId]=[]),s>0&&e[t.ESGId].push({...o,...t,Height:s})};let Me=(t,o)=>{let e=f.find(r=>r.CompetitionStructureId==t.CompetitionStructureId);if(!e)return!1;o==288&&t.Title.includes("Essay Writing");for(let r in j)if(r!=o){let m=j[r];if(m&&m.some(T=>T==t.CompetitionStructureId))return!1}let s=F[o];if(!s||!s.some(r=>r==e.CompetitionItem))return!1;let d=j[o];if(!d||d.length===0||d.some(r=>r==e.CompetitionStructureId))return!0;let a=f.filter(r=>r.CompetitionItem==e.CompetitionItem).map(r=>r.CompetitionStructureId);var l=d.filter(r=>a.includes(r));return l.length==0};const Oe=(t,o)=>{for(let e=0;e<ue.length;e++){const s=e*ae,d=t.Duration/Z,n=s+ae*d,a=Ae(ue[e]),l=new Date(a);l.setMinutes(l.getMinutes()+t.Duration);for(let r of P){const m=o[r.ESGId]||[];if(!Me(t,r.ESGId))continue;let T={StartTime:a,EndTime:l,topPosition:s,bottomPosition:n,stage:r,ESGId:r.ESGId};if(ke(T,m)&&!$e(t,o,T))return{...T}}}return null},$e=(t,o,e)=>{for(let d of P)if(e?.stage?.Title!=d.Title){t.CompetitionStructureId==5622;const n=o[d.ESGId]||[];for(var s of n){let a=!1;if(e.topPosition<s.bottomPosition&&e.bottomPosition>s.topPosition&&(a=!0),e.topPosition>s.bottomPosition&&e.bottomPosition<s.topPosition&&(a=!0),e.topPosition>s.topPosition&&e.topPosition<s.topPosition&&(a=!0),e.bottomPosition>s.topPosition&&e.bottomPosition<s.topPosition&&(a=!0),a){let l=[];for(let r of s.Participants)for(let m of t.Participants)r===m&&l.push(r);if(l.length>0)return t.Logs.push(l.join(", ")+` - ${s.StartTime.toLocaleTimeString()} - ${s.EndTime.toLocaleTimeString()} @ ${s.stage.Title} - ${s.Title}`),!0}}}return!1},ke=(t,o,e)=>{let s=!0;for(let d of o){if(d.topPosition<t.bottomPosition&&d.bottomPosition>t.topPosition||d.topPosition>t.bottomPosition&&d.bottomPosition<t.topPosition||d.topPosition>t.topPosition&&d.topPosition<t.topPosition||d.bottomPosition>t.topPosition&&d.bottomPosition<t.topPosition)return s=!1,s;if(!s)return s}return s},Ae=t=>{const o=t.split(":"),e=new Date(b);return e.setHours(o[0],o[1].split(" ")[0],0,0),e},_e=()=>{window.print()},Fe=(t,o)=>{const e={...j,[o]:t};D(e),localStorage.setItem("preferenceCompetitionStructures",JSON.stringify(e)),z(!0)},Ve=(t,o)=>{const e={...F,[o]:t};Y(e),localStorage.setItem("preferenceCompetitions",JSON.stringify(e)),z(!0)},fe=async()=>{await ot(V,{scheduleListPreferences:j,scheduleListPreferenceCompetitions:F,scheduleStartTime:b,scheduleStartDate:b})},Ue=()=>{D({}),Y({}),localStorage.removeItem("preferenceCompetitionStructures"),localStorage.removeItem("preferenceCompetitions"),z(!0)},He=t=>{let o=t.target.value,e=o.split(":");const s=new Date(b);s.setHours(e[0],e[1].split(" ")[0],0,0),K(s),localStorage.setItem("startTime",o),N=o,fe()},Re=t=>{const o=new Date(t.target.value);if(o.setHours(9,0,0,0),N){let e=N.split(":");o.setHours(e[0],e[1].split(" ")[0],0,0)}K(o),N=o,localStorage.setItem("startDate",o),fe()},Be=S.useMemo(()=>b.toISOString().split("T")[0],[b]),We=()=>{let t=1;for(let o in w)for(let e of w[o]){let s=e.StartTime,d=e.EndTime,n=e.ESGId,a={ScheduledStartTimeString:s,ScheduledEndTimeString:d,Stage:n,Competition:e.CompetitionStructureId,order:t};t++;let l=I.find(r=>r.Competition==e.CompetitionStructureId);l&&(a.scheduleId=l.ScheduleId),he("/CompetitionScheduleJson/Save",a)}},qe=async(t,o)=>{let e=I.find(a=>a.Competition==t.CompetitionStructureId),s={};if(e?.JsonSettings)try{s=JSON.parse(e.JsonSettings)}catch(a){console.error("Error parsing existing JsonSettings:",a)}const d={...s,forceOrder:!0};let n={Competition:t.CompetitionStructureId,Order:parseInt(o),JsonSettings:JSON.stringify(d)};e&&(n.scheduleId=e.ScheduleId,n.Stage=e.Stage);try{await he("/CompetitionScheduleJson/Save",n),await je({date:new Date().getTime()})}catch(a){console.error("Error saving order change:",a)}},ze=()=>{const t=W.book_new(),o=be(),e=Te(o);Object.entries(w).forEach(([n,a])=>{const l=P.find(c=>c.ESGId==parseInt(n))?.Title||`Stage ${n}`,r=[[l],[],["Order","Competition","Start Time","End Time","Duration (min)","Participants Count","Time Limit (min)","Type","Participants","Status"]],m=[...a].sort((c,u)=>new Date(c.StartTime).getTime()-new Date(u.StartTime).getTime());m.forEach((c,u)=>{const h=I.find(R=>R.Competition==c.CompetitionStructureId)?.Order||u+1;r.push([h,c.Title,new Date(c.StartTime).toLocaleTimeString(),new Date(c.EndTime).toLocaleTimeString(),c.Duration,c.ParticipantsCount,c.perTimeLimit??"N/A",c.isOffStage?"Off-Stage":"On-Stage",c.Participants?.join(", ")||"","Scheduled"])});const T=j[n]||[],M=new Set(m.map(c=>c.CompetitionStructureId)),le=I.filter(c=>c.Stage==parseInt(n)&&!M.has(c.Competition));if(le.length>0&&(r.push([]),r.push(["MANUALLY SCHEDULED (Not in automated schedule)"]),le.forEach(c=>{const u=f.find(p=>p.CompetitionStructureId==c.Competition);if(u){const p=C.filter(R=>R.Competition==c.Competition).length,h=`${u.ParticipantType==1?"ðŸ•º":"ðŸ‘«"} ${u.GroupGroupName} ${u.CompetitionItemTitle}${u.Gender!=3?" "+u.GenderGenderTitle:""} ${u.Language!=4?" "+u.LanguageLanguageName:""}`;r.push([c.Order||"",h,c.ScheduledStartTime?new Date(c.ScheduledStartTime).toLocaleTimeString():"N/A",c.ScheduledEndTime?new Date(c.ScheduledEndTime).toLocaleTimeString():"N/A",u.MaximumMinutes||"N/A",p,u.MaximumMinutes||"N/A","","","Manual Schedule"]),M.add(c.Competition)}})),T.length>0){const c=e.filter(u=>{const p=T.includes(u.Competition),h=!M.has(u.Competition);return p&&h});c.length>0&&(r.push([]),r.push(["UNSCHEDULED COMPETITIONS"]),c.forEach((u,p)=>{const h=f.find(R=>R.CompetitionStructureId==u.Competition);if(h){const R=C.filter(Qe=>Qe.Competition==u.Competition).length,Ke=`${h.ParticipantType==1?"ðŸ•º":"ðŸ‘«"} ${h.GroupGroupName} ${h.CompetitionItemTitle}${h.Gender!=3?" "+h.GenderGenderTitle:""} ${h.Language!=4?" "+h.LanguageLanguageName:""}`;r.push(["",Ke,"Not Scheduled","Not Scheduled",h.MaximumMinutes||"N/A",R,h.MaximumMinutes||"N/A","","","Not Scheduled"])}}))}const x=W.aoa_to_sheet(r);x["!cols"]=[{wch:8},{wch:40},{wch:15},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:50},{wch:15}],W.book_append_sheet(t,x,l.substring(0,31))});const d=`Schedule_Sheetwise_${b.toLocaleDateString().replace(/\//g,"-")}.xlsx`;Ne(t,d)},Ye=()=>{const t=W.book_new(),o=Object.keys(w).map(x=>({id:x,name:P.find(c=>c.ESGId==parseInt(x))?.Title||`Stage ${x}`})),e=["Time"],s=[""],d=6;o.forEach(x=>{e.push(x.name);for(let c=1;c<d;c++)e.push("");s.push("Competition","Start Time","End Time","Duration","Participants","Count")});const n=[e,s],a=new Map;Object.entries(w).forEach(([x,c])=>{c.forEach(u=>{const p=new Date(u.StartTime).toLocaleTimeString();a.has(p)||a.set(p,{time:p,startDate:u.StartTime,stages:{}}),a.get(p).stages[x]=u})}),Array.from(a.values()).sort((x,c)=>new Date(x.startDate)-new Date(c.startDate)).forEach(x=>{const c=[x.time];o.forEach(u=>{const p=x.stages[u.id];if(p)c.push(p.Title,new Date(p.StartTime).toLocaleTimeString(),new Date(p.EndTime).toLocaleTimeString(),`${p.Duration}m`,p.Participants?.slice(0,3).join(", ")||"",p.ParticipantsCount);else for(let h=0;h<d;h++)c.push("")}),n.push(c)});const r=W.aoa_to_sheet(n),m=[{wch:12}];o.forEach(()=>{m.push({wch:40},{wch:12},{wch:12},{wch:10},{wch:30},{wch:8})}),r["!cols"]=m;const T=[];o.forEach((x,c)=>{const u=1+c*d,p=u+d-1;T.push({s:{r:0,c:u},e:{r:0,c:p}})}),r["!merges"]=T,W.book_append_sheet(t,r,"All Stages");const le=`Schedule_AllStages_${b.toLocaleDateString().replace(/\//g,"-")}.xlsx`;Ne(t,le)};return i.jsx(Ze,{children:i.jsxs("div",{className:"flex flex-col grow",children:[i.jsx(et,{heading:"Automated Schedule",subHeading:"Generate and manage automated competition schedules",rightChildren:!re&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-700  hidden-print",onClick:Ue,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"clear_all"}),"Clear Preferences"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700  hidden-print",onClick:We,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Save To Schedule"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700  hidden-print",onClick:Ye,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"}),"Export to Excel"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-teal-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-700  hidden-print",onClick:ze,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"table_view"}),"Sheetwise Excel"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover  hidden-print",onClick:_e,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"print"}),"Print"]})]})}),re?i.jsx(we,{}):i.jsxs("div",{className:"flex justify-between flex-col w-full print-hidden relative",children:[i.jsxs("div",{className:"flex justify-between  w-full print:hidden",children:[i.jsxs("div",{className:"flex timeline flex-col w-32 bg-surface",children:[i.jsx("label",{htmlFor:"preferredStartDate",className:"block text-sm font-medium text-onSurfaceVariant p-2",children:"Preferred Start Date"}),i.jsx("input",{type:"date",value:Be,className:"p-2 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"preferredStartDate",name:"preferredStartDate",onChange:t=>Re(t)}),i.jsx("input",{type:"time",value:N,className:"p-2 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"preferredStartDate",name:"preferredStartDate",onChange:t=>He(t)}),i.jsx("input",{type:"number",value:de,className:"p-2 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"timeGap",name:"timeGap",onChange:t=>Ee(t,"timeGap")})]}),i.jsxs("div",{className:"flex flex-1 h-full w-full flex-col",children:[i.jsx("div",{className:"flex w-full",children:Object.entries(w).map(([t,o])=>i.jsxs("div",{className:"bg-white p-2 border-b-2 shadow-md relative flex-1 h-full",children:[i.jsx(ye,{label:`${P.find(e=>e.ESGId==parseInt(t))?.Title} Preferences`,placeholder:"Select competitions...",options:Se,optionKey:"CompetitionId",optionText:"Title",value:F[t]||[],onChange:e=>Ve(e,t),maxHeight:"max-h-[400px]"}),i.jsx("h3",{className:"text-sm font-medium text-onSurfaceVariant mt-4 mb-2",children:"Selected Competitions"}),i.jsx("div",{className:"max-h-96 ",children:i.jsx(ye,{options:f.filter(e=>F[t]?.some(s=>s==e.CompetitionItem)),optionKey:"CompetitionStructureId",optionText:e=>{const s=Object.entries(j).filter(([n,a])=>n!==t&&a?.some(l=>l==e.CompetitionStructureId)).map(([n])=>P.find(l=>l.ESGId==parseInt(n))?.Title||`Stage ${n}`);return`${s.length>0?`(${s.join(", ")}) `:""}${e.GroupGroupName} - ${e.CompetitionItemTitle}${e.Gender!=3?` ${e.GenderGenderTitle}`:""}${e.Language!=4?` ${e.LanguageLanguageName}`:""}`},value:j[t]||[],onChange:e=>Fe(e,t),maxHeight:"max-h-96",className:"border-b border-border text-xs"})})]},"stage_"+t))}),i.jsxs("div",{className:"flex justify-end gap-3 w-full mt-3 px-2",children:[i.jsxs("button",{className:"inline-flex items-center justify-center gap-x-2 rounded-md bg-green-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{await fe(),z(!1)},disabled:$||!k,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Save Preferences"]}),i.jsxs("button",{className:"inline-flex items-center justify-center gap-x-2 rounded-md bg-indigo-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{pe()},disabled:$||k,title:k?"Please save preferences before generating schedule":"Generate schedule based on saved preferences",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"schedule"}),"Generate Schedule"]})]})]})]}),$?i.jsx(we,{from:"Schedule Generation",message:"Generating schedule..."}):i.jsxs("div",{className:"flex justify-between  w-full mt-10",children:[i.jsx("div",{className:"flex timeline flex-col min-w-32 bg-surface",children:ue.map((t,o)=>i.jsx("div",{className:"flex items-center border-b-2 text-center bg-white p-2",style:{height:`${ae}px`},children:i.jsx("div",{className:"w-20",children:t})},o))}),i.jsx("div",{className:"flex flex-1 h-full w-full",children:Object.entries(w).map(([t,o])=>i.jsx("div",{className:"bg-surface border-b-2 shadow-md relative flex-1 h-full",children:i.jsx("div",{className:"flex flex-col ",children:o.map((e,s)=>{const d=I.find(l=>l.Competition==e.CompetitionStructureId),n=d?.JsonSettings?JSON.parse(d.JsonSettings):{},a=n.ForcedStage||n.forceOrder;return i.jsx("div",{className:"min-h-6 max-w-full flex-1 flex min-w-72",children:i.jsxs("div",{className:"bg-white absolute border-x-2 border-darkprimary/40 p-2 shadow-sm border-b-2 flex overflow-y-auto justify-between w-full",style:{height:`${e.Height}px`,top:`${e.topPosition}px`},children:[a&&i.jsxs("div",{className:`absolute top-1 right-1 text-xs font-bold px-2 py-1 rounded shadow-sm ${n.ForcedStage&&n.forceOrder?"bg-purple-100 text-purple-700 border border-purple-300":n.ForcedStage?"bg-blue-100 text-blue-700 border border-blue-300":"bg-green-100 text-green-700 border border-green-300"}`,title:`${n.ForcedStage?"Forced Stage":""} ${n.forceOrder?"Forced Order":""}`,children:[n.ForcedStage&&P.find(l=>l.ESGId===d?.Stage)?.Title,n.ForcedStage&&n.forceOrder&&" | ",n.forceOrder&&`#${d?.Order||s+1}`]}),i.jsxs("div",{className:"max-w-[80%] overflow-auto pr-2",children:[i.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[i.jsx("h3",{className:"text-green-800 font-medium text-xs pb-1 border-b-2 whitespace-nowrap text-ellipsis overflow-hidden",children:e.Title}),i.jsxs("div",{className:"flex items-center gap-2 hidden-print",children:[i.jsx("label",{className:"text-xs font-medium text-gray-600 min-w-12",children:"Order:"}),i.jsx("input",{type:"number",className:"flex-1 p-1 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-xs",defaultValue:s+1,onBlur:l=>qe(e,l.target.value),min:"1"})]})]}),i.jsxs("h2",{className:"text-blue-900 font-medium text-sm py-1 border-b-2 whitespace-nowrap ",children:[new Date(e.StartTime).toLocaleTimeString()," - ",new Date(e.EndTime).toLocaleTimeString()]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("div",{className:"bg-white shadow p-2",children:e.isOffStage?i.jsx("span",{className:"material-symbols-outlined text-2xl text-amber-700",children:"airline_seat_recline_normal"}):i.jsx("span",{className:"material-symbols-outlined text-2xl text-green-600",children:"podium"})}),i.jsxs("div",{className:"bg-white shadow p-2 justify-center text-center text-xs font-bold text-yellow-700",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl text-yellow-700",children:"settings_accessibility"}),e.ParticipantsCount]}),i.jsxs("div",{className:"bg-white shadow p-2 justify-center text-center text-xs font-bold text-pink-700",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl text-pink-700",children:"hourglass_top"}),e.perTimeLimit??"?"]}),i.jsxs("div",{className:"bg-white shadow p-2 justify-center text-center text-xs font-bold text-purple-700",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl text-purple-700",children:"timer"}),e.Duration,"m"]})]}),i.jsx("div",{children:e.Logs?.map((l,r)=>i.jsx("div",{className:"text-red-600 text-xs",children:l},r))})]}),i.jsx("div",{className:"flex flex-col overflow-y-auto bg-white max-h-full pr-4 text-xs",children:e.Participants?.map((l,r)=>i.jsx("div",{className:"flex items-center p-2 bg-white text-onSurfaceVariant font-medium border-b-2 ",children:i.jsx("div",{children:l})},r))})]},s)},t+"_"+s)})})},t))})]})]})]})})};export{mt as default};
