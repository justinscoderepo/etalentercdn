import{r as C,j as e,l as K,d as X,k as I}from"./main-CNwsE70q.js";import{O as ee}from"./OldNewTabLayout-C66hebmo.js";import{b as k}from"./index-C2b8_KXo.js";import te from"./formEditor-BMtRR2ml.js";import{F as P}from"./UserGroupIcon-cK4pkkW5.js";import{F as H}from"./UserIcon-C7jgRwb1.js";import{F as z}from"./XCircleIcon-B8ohFP-7.js";import{F as Z}from"./CheckCircleIcon-DUuk71z7.js";import{F as re}from"./PencilIcon-CIdZDNDg.js";import{F as ae}from"./TrashIcon-35Nqj25C.js";import{F as se}from"./PlusIcon-CDgLbrzv.js";import{F as ne}from"./TableCellsIcon-CK4kj0g4.js";import"./index.esm-BL8OPNFa.js";import"./renderComponents-CO97qroD.js";import"./validationMessage-D_gLv93j.js";import"./CheckCircleIcon-hYT7tTd9.js";import"./modalForm-Ct03LL-Z.js";import"./dialog-CgbJ1UKe.js";import"./keyboard-9WK94Kur.js";import"./description-pQlnE8nZ.js";import"./open-closed-cCj8iGKy.js";import"./XMarkIcon-CxEZFlk-.js";function oe({title:t,titleId:i,...g},o){return C.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":i},g),t?C.createElement("title",{id:i},t):null,C.createElement("path",{fillRule:"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z",clipRule:"evenodd"}))}const J=C.forwardRef(oe),ie=(t,i)=>{const g=new Date(t);g.setHours(0,0,0,0);const o=new Date(i);o.setHours(0,0,0,0),o.setDate(o.getDate()+1);let y=o.getFullYear()-g.getFullYear(),l=o.getMonth()-g.getMonth(),h=o.getDate()-g.getDate();if(h<0){l--;const w=new Date(o.getFullYear(),o.getMonth(),0);h+=w.getDate()}return l<0&&(y--,l+=12),{years:y,months:l,days:h}},le=(t,i)=>{const g=new Date(t);g.setHours(0,0,0,0);const o=new Date(i);o.setHours(0,0,0,0),o.setDate(o.getDate()+1);const y=Math.abs(o-g);return Math.ceil(y/(1e3*60*60*24))+1},de=t=>{if(t.years===0&&t.months===0)return`${t.days} ${t.days===1?"day":"days"}`;if(t.years===0)return t.days===0?`${t.months} ${t.months===1?"month":"months"}`:`${t.months} ${t.months===1?"month":"months"}, ${t.days} ${t.days===1?"day":"days"}`;{const i=[];return i.push(`${t.years} ${t.years===1?"year":"years"}`),t.months>0&&i.push(`${t.months} ${t.months===1?"month":"months"}`),t.days>0&&i.push(`${t.days} ${t.days===1?"day":"days"}`),i.join(", ")}},W=t=>{if(!t)return null;const i=t.split("-");return i.length!==3?null:new Date(parseInt(i[2]),parseInt(i[1])-1,parseInt(i[0]))};function ce({formData:t,getValues:i}){const g=t?.BirthDateTo||i?.("BirthDateTo"),o=t?.BirthDateFrom||i?.("BirthDateFrom");if(!g||!o)return null;const y=W(g),l=W(o);if(!y||!l)return null;const h=new Date().getFullYear(),w=new Date(h,l.getMonth(),l.getDate()),d=h-l.getFullYear(),u=h-y.getFullYear(),b=ie(y,l),A=le(y,l),c=b.years===0;return e.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-md",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-cyan-600"}),"Calculated Age Group Preview"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-cyan-100",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"Age From (Youngest)"}),e.jsxs("span",{className:"text-base font-semibold text-gray-900",children:[d," years"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-cyan-100",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"Age To (Oldest)"}),e.jsxs("span",{className:"text-base font-semibold text-gray-900",children:[u," years"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-cyan-100",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"Calculation Date"}),e.jsxs("span",{className:"text-base font-semibold text-gray-900",children:[String(w.getDate()).padStart(2,"0"),"-",String(w.getMonth()+1).padStart(2,"0"),"-",h]})]})]}),e.jsx("div",{className:"bg-emerald-50 p-3 rounded border border-emerald-200",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-emerald-700 font-medium block mb-1",children:"Birth Date Range Span"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-900",children:de(b)})]}),c&&e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-emerald-700 font-medium block mb-1",children:"Total Days"}),e.jsxs("span",{className:"text-sm font-semibold text-emerald-900",children:[A," ",A===1?"day":"days"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 bg-gray-50 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"From (Oldest):"})," ",g]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"To (Youngest):"})," ",o]})]})]})]})}const me=[{text:"Any",value:"Any",icon:P},{text:"Individual",value:"Individual",icon:H},{text:"Team",value:"Team",icon:P}],ge=[{text:"No",value:"No",icon:z},{text:"Yes (Multiple age groups)",value:"Yes",icon:Z}],q=t=>{const i=String(t.getDate()).padStart(2,"0"),g=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return`${i}-${g}-${o}`};function he({editingGroup:t,existingGroups:i=[],onSubmit:g,onCancel:o,open:y}){const l=C.useMemo(()=>{if(i&&i.length>0){const c=i[0];return{day:c.AgeStartDate||1,month:c.AgeStartMonth||1,year:c.AgeStartYear||new Date().getFullYear()}}return{day:1,month:1,year:new Date().getFullYear()}},[i]),h=(c,f,D)=>{if(!c||!f||!D)return{birthDateFrom:"",birthDateTo:""};try{const j=new Date(D.year,D.month-1,D.day),N=new Date(j);N.setFullYear(N.getFullYear()-f),N.setDate(N.getDate()+1);const T=new Date(j);return T.setFullYear(T.getFullYear()-c+1),{birthDateFrom:q(T),birthDateTo:q(N)}}catch(j){return console.error("Error calculating birth dates from ages:",j),{birthDateFrom:"",birthDateTo:""}}},w=C.useMemo(()=>t?{EventGroupId:t.EventGroupId,GroupName:t.GroupName,BirthDateFrom:t.BirthDateFrom||"",BirthDateTo:t.BirthDateTo||"",AgeFrom:t.AgeFrom||"",AgeTo:t.AgeTo||"",ParticipantType:t.parsedSettings.ParticipantType,IsCommon:t.parsedSettings.IsCommon,NoAgeIdPrefix:t.parsedSettings.NoAgeIdPrefix,Order:t.Order,Status:t.Status}:{Status:2,ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No",AgeFrom:"",AgeTo:""},[t]),d=[{name:"GroupName",label:"Group Name",type:"text",placeholder:"e.g., Juniors, Children, Seniors",validate:{required:!0,minLength:2,maxLength:50}},{name:"ParticipantType",label:"Participant Type",type:"toggle",options:me,validate:{required:!0}},{name:"BirthDateTo",label:"Birth Date From (Oldest Eligible)",type:"normalDate",maxDate:new Date,placeholder:"Select the birth date of the oldest eligible participant (earliest date)",validate:{required:!0,toField:"BirthDateFrom"}},{name:"BirthDateFrom",label:"Birth Date To (Youngest Eligible)",type:"normalDate",maxDate:new Date,placeholder:"Select the birth date of the youngest eligible participant (most recent)",validate:{required:!0,fromField:"BirthDateTo"}},{name:"AgeFrom",label:"Age From (Youngest Age)",type:"number",placeholder:"e.g., 5",description:`Ages calculated on ${l.day}/${l.month}/${l.year}`,min:0,max:100,validate:{required:!0,min:0,max:100,lessThanOrEqualTo:"AgeTo"}},{name:"AgeTo",label:"Age To (Oldest Age)",type:"number",placeholder:"e.g., 12",min:0,max:100,validate:{required:!0,min:0,max:100,greaterThanOrEqualTo:"AgeFrom"}},{name:"AgePreview",type:"custom",render:c=>e.jsx(ce,{...c})},{name:"IsCommon",label:"Is Common Group",type:"toggle",options:ge},{name:"NoAgeIdPrefix",label:"No Age-Based ID Prefix",type:"toggle",options:[{text:"No (Use age prefix)",value:"No",icon:z},{text:"Yes (No prefix)",value:"Yes",icon:Z}],conditions:[{key:"IsCommon",value:"No"}]}],u=async(c,...f)=>(c.IsCommon==="Yes"&&(c.NoAgeIdPrefix="Yes"),g(c,...f)),b=(c,f,D)=>{const j=parseInt(c)||0,N=parseInt(f.AgeTo)||0,{birthDateFrom:T,birthDateTo:B}=h(j+1,N,l);D("BirthDateFrom",T),D("BirthDateTo",B)},A=(c,f,D)=>{const j=parseInt(c)||0,N=parseInt(f.AgeFrom)||0,{birthDateFrom:T,birthDateTo:B}=h(N,j,l);D("BirthDateFrom",T),D("BirthDateTo",B)};return e.jsx(te,{title:t?"Edit Age Group":"Add New Age Group",description:t?"Update age group details by modifying age ranges and calculation dates":"Create a new age group by specifying age ranges and calculation dates",row:w,fields:d,onSave:u,onCancel:o,ageFromOnChange:b,ageToOnChange:A})}function pe({gapInfo:t}){return e.jsxs("div",{className:"relative pb-8",children:[e.jsx("span",{className:"absolute left-6 top-4 -ml-px h-full w-0.5 bg-red-300 border-l-2 border-dashed","aria-hidden":"true"}),e.jsxs("div",{className:"relative flex items-start space-x-3",children:[e.jsx("div",{className:"relative flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-full bg-red-100 border-2 border-red-400 border-dashed",children:e.jsx("span",{className:"text-xs font-bold text-red-600",children:"GAP"})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"rounded-lg border-2 border-red-200 border-dashed bg-red-50 shadow-sm p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-700 mb-2",children:"⚠️ Missing Age Range"}),e.jsxs("div",{className:"text-xs text-red-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Gap Ages:"})," ",t.missingAges]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Range:"})," ",t.dateFrom," to ",t.dateTo]}),e.jsx("p",{className:"italic text-red-500 mt-2",children:"Participants born in this range have no age group assigned!"})]})]})})]})]})}function ue({group:t,onEdit:i,onDelete:g,isLast:o}){const y=t.parsedSettings.ParticipantType==="Individual"?"bg-cyan-500":t.parsedSettings.ParticipantType==="Team"?"bg-emerald-500":"bg-indigo-500",l=t.parsedSettings.ParticipantType==="Individual"?"border-cyan-200":t.parsedSettings.ParticipantType==="Team"?"border-emerald-200":"border-indigo-200",h=t.parsedSettings.ParticipantType==="Individual"?"text-cyan-600":t.parsedSettings.ParticipantType==="Team"?"text-emerald-600":"text-indigo-600",d=(()=>{const u=new Date(t.AgeStartYear,t.AgeStartMonth-1,t.AgeStartDate),b=new Date(u);b.setFullYear(b.getFullYear()-t.AgeTo),b.setDate(b.getDate()+1);const A=new Date(u);A.setFullYear(A.getFullYear()-t.AgeFrom+1);const c=f=>{const D=String(f.getDate()).padStart(2,"0"),j=String(f.getMonth()+1).padStart(2,"0"),N=f.getFullYear();return`${D}-${j}-${N}`};return{from:c(b),to:c(A),minYear:b.getFullYear(),maxYear:A.getFullYear()}})();return e.jsxs("div",{className:"relative pb-8",children:[!o&&e.jsx("span",{className:"absolute left-6 top-8 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"}),e.jsxs("div",{className:"relative flex items-start space-x-3",children:[e.jsx("div",{className:`relative flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-full ${y} shadow-sm`,children:e.jsxs("span",{className:"text-base font-bold text-white",children:[t.AgeFrom,"-",t.AgeTo]})}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[e.jsxs("div",{className:`rounded-lg border ${l} bg-white shadow-sm p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:`text-base font-semibold ${h}`,children:t.GroupName}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(t),className:"text-gray-400 hover:text-primary transition-colors",title:"Edit",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>g(t.EventGroupId),className:"text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:e.jsx(ae,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["Age on: ",t.AgeStartDate,"/",t.AgeStartMonth,"/",t.AgeStartYear]})]}),t.parsedSettings.IsCommon==="Yes"&&e.jsx("span",{className:"rounded-full bg-yellow-100 px-2 py-1 text-xs font-medium text-yellow-800",children:"Common"}),t.Status!==1&&e.jsx("span",{className:"rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800",children:"Inactive"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Order: ",t.Order]})]}),e.jsx("div",{className:"rounded-md border border-gray-200 bg-gray-50 shadow-sm p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Birth Date Range (Eligible Participants)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"From:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:d.from}),e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",d.minYear,")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"To:"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:d.to}),e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",d.maxYear,")"]})]})]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 italic",children:["Participants born within this date range will be age ",t.AgeFrom,"-",t.AgeTo," on ",t.AgeStartDate,"/",t.AgeStartMonth,"/",t.AgeStartYear]})]})]})})]})]})]})}function xe({groups:t,onEdit:i,onDelete:g,detectGaps:o}){const y=t.filter(d=>d.parsedSettings.ParticipantType==="Individual").sort((d,u)=>(d.Order||0)-(u.Order||0)),l=t.filter(d=>d.parsedSettings.ParticipantType==="Team").sort((d,u)=>(d.Order||0)-(u.Order||0)),h=t.filter(d=>d.parsedSettings.ParticipantType==="Any").sort((d,u)=>(d.Order||0)-(u.Order||0)),w=(d,u,b,A,c)=>{const f=[];return d.forEach((D,j)=>{f.push(e.jsx("li",{children:e.jsx(ue,{group:D,onEdit:i,onDelete:g,isLast:!1})},D.EventGroupId));const N=u.find(T=>T.afterIndex===j);N&&f.push(e.jsx("li",{children:e.jsx(pe,{gapInfo:N})},`gap-${j}`))}),e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 mb-4 pb-2 border-b-2 ${c.border}`,children:[A,e.jsx("h2",{className:`text-base font-semibold ${c.text}`,children:b}),e.jsxs("span",{className:`ml-auto rounded-full ${c.bg} px-2 py-1 text-xs font-medium ${c.badge}`,children:[d.length," groups"]})]}),d.length===0?e.jsxs("p",{className:"text-sm text-gray-500",children:["No ",b.toLowerCase()," defined"]}):e.jsx("div",{className:"flow-root",children:e.jsx("ul",{className:"-mb-8",children:f})})]})};return e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[(y.length>0||h.length===0)&&w(y,o(y),"Individual Groups",e.jsx(H,{className:"h-6 w-6 text-cyan-600"}),{border:"border-cyan-300",text:"text-cyan-700",bg:"bg-cyan-100",badge:"text-cyan-800"}),(l.length>0||h.length===0)&&w(l,o(l),"Team Groups",e.jsx(P,{className:"h-6 w-6 text-emerald-600"}),{border:"border-emerald-300",text:"text-emerald-700",bg:"bg-emerald-100",badge:"text-emerald-800"}),h.length>0&&e.jsx(e.Fragment,{children:w(h,o(h),"Individual+Team Groups",e.jsx(P,{className:"h-6 w-6 text-indigo-600"}),{border:"border-indigo-300",text:"text-indigo-700",bg:"bg-indigo-100",badge:"text-indigo-800"})})]})}function Ue(){const{eventDetails:t}=K(),[i,g]=C.useState(null),[o,y]=C.useState(!1),{rows:l,update:h,delete:w,status:d}=X("/AgewiseGroupsJson/Get",{filter:{EventCategory:t?.EventCategory},updateUrl:"/AgewiseGroupsJson/Save",deleteUrl:"/AgewiseGroupsJson/Remove",limit:100,sort:{sortOrder:"ASC",sortColumn:"Order"},select:"EventGroupId,GroupName,AgeFrom,AgeTo,AgeStartDate,AgeStartMonth,AgeStartYear,Status,JsonSettings,Order"});console.log("rows",l);const u=C.useMemo(()=>l?l.map(r=>{let m={ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No"};try{r.JsonSettings&&(m=JSON.parse(r.JsonSettings))}catch(v){console.error("Failed to parse JsonSettings:",v)}return{...r,parsedSettings:m}}):[],[l]),b=r=>{const m=n=>{const s=n.parsedSettings.ParticipantType,a=n.parsedSettings.IsCommon==="Yes";return s==="Individual"&&!a?1:s==="Individual"&&a?2:s==="Team"&&!a?3:s==="Team"&&a?4:5};return[...r].sort((n,s)=>{const a=m(n)-m(s);return a!==0?a:(n.AgeFrom||0)-(s.AgeFrom||0)}).map((n,s)=>({...n,correctOrder:s+1}))},A=async(r,m=!1)=>{if(!r||r.length===0)return;const n=b(r).filter(a=>a.Order!==a.correctOrder);if(n.length===0)return;console.log("Auto-fixing incorrect orders for",n.length,"groups:",n.map(a=>({name:a.GroupName,currentOrder:a.Order,newOrder:a.correctOrder})));const s=n.map(a=>h({EventGroupId:a.EventGroupId,Order:a.correctOrder},!0).catch(p=>(console.error(`Failed to auto-update order for group "${a.GroupName}":`,p),null)));try{const p=(await Promise.all(s)).filter(x=>x!==null).length;!m&&p>0&&console.log(`Auto-fixed order for ${p} group(s)`)}catch(a){console.error("Group order auto-fix errors:",a)}},c=async()=>{if(!u||u.length===0){I.error("No groups available to reorder");return}const r=b(u),m=[];if(r.forEach(n=>{n.Order!==n.correctOrder&&m.push({EventGroupId:n.EventGroupId,GroupName:n.GroupName,currentOrder:n.Order,newOrder:n.correctOrder})}),m.length===0){I.success("All groups are already in correct order");return}console.log("Groups needing order update:",m);const v=m.map(n=>h({EventGroupId:n.EventGroupId,Order:n.newOrder}).catch(s=>{throw console.error(`Failed to update order for group "${n.GroupName}":`,s),s}));try{await Promise.all(v),I.success(`Successfully updated order for ${m.length} group(s)`)}catch(n){I.error("Some group orders failed to update. Check console for details."),console.error("Group order update errors:",n)}},f=r=>{const m=[],v=s=>{const a=String(s.getDate()).padStart(2,"0"),p=String(s.getMonth()+1).padStart(2,"0"),x=s.getFullYear();return`${a}-${p}-${x}`},n=r.map(s=>{const a=new Date(s.AgeStartYear,s.AgeStartMonth-1,s.AgeStartDate),p=new Date(a);p.setFullYear(p.getFullYear()-s.AgeTo),p.setDate(p.getDate()+1);const x=new Date(a);return x.setFullYear(x.getFullYear()-s.AgeFrom+1),{...s,minBirthDate:p,maxBirthDate:x,minBirthDateStr:v(p),maxBirthDateStr:v(x)}});for(let s=0;s<n.length-1;s++){const a=n[s],p=n[s+1],x=new Date(p.maxBirthDate);x.setDate(x.getDate()+1);const F=new Date(a.minBirthDate);if(F.setDate(F.getDate()-1),x<=F){const G=new Date(a.AgeStartYear,a.AgeStartMonth-1,a.AgeStartDate),Y=Math.floor((G-F)/(365.25*24*60*60*1e3)),O=Math.ceil((G-x)/(365.25*24*60*60*1e3));m.push({afterIndex:s,missingAges:Y===O?`Age ${Y}`:`Age ${Y}-${O}`,dateFrom:v(x),dateTo:v(F)})}}return m},D=async r=>{try{const[m,v,n]=(r.BirthDateTo||"1-1-2020").split("-"),[s,a,p]=(r.BirthDateFrom||"31-12-2024").split("-"),x=new Date().getFullYear(),F=new Date(x,parseInt(a)-1,parseInt(s)),G=x-parseInt(p),Y=x-parseInt(n),O=new Date(parseInt(n),parseInt(v)-1,parseInt(m)),Q=new Date(parseInt(p),parseInt(a)-1,parseInt(s)),U=u.find(S=>{if(r.EventGroupId&&S.EventGroupId===r.EventGroupId||S.parsedSettings.ParticipantType!==r.ParticipantType||S.parsedSettings.IsCommon!==r.IsCommon)return!1;const $=new Date(S.AgeStartYear-S.AgeTo,S.AgeStartMonth-1,S.AgeStartDate),E=new Date(S.AgeStartYear-S.AgeFrom,S.AgeStartMonth-1,S.AgeStartDate);return O<=E&&Q>=$});if(U){I.error(`Date range overlaps with existing group "${U.GroupName}". Please adjust the dates to avoid overlap within the same Participant Type and Common Group status.`);return}const V={EventGroupId:r.EventGroupId||0,EventCategory:t?.EventCategory,GroupName:r.GroupName,AgeFrom:G,AgeTo:Y,AgeStartDate:F.getDate(),AgeStartMonth:F.getMonth()+1,AgeStartYear:F.getFullYear(),Status:1,Order:r.Order||(l?.length||0)+1,JsonSettings:JSON.stringify({ParticipantType:r.ParticipantType,IsCommon:r.IsCommon,NoAgeIdPrefix:r.NoAgeIdPrefix}),BirthDateFrom:r.BirthDateFrom,BirthDateTo:r.BirthDateTo},_=await h(V,!1,!0),[ye,fe,be,M]=_,R=Array.isArray(M)&&M.length>0?M[0]:null;if(R){console.log("Latest data after save:",R);const S=R.map($=>{let E={ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No"};try{$.JsonSettings&&(E=JSON.parse($.JsonSettings))}catch(L){console.error("Failed to parse JsonSettings:",L)}return{...$,parsedSettings:E}});await A(S,!0)}I.success(i?"Group updated successfully":"Group added successfully"),g(null),y(!1)}catch(m){I.error("Failed to save group"),console.error(m)}},j=async r=>{if(window.confirm("Are you sure you want to delete this age group?"))try{const m=await w({EventGroupId:r}),[v,n,s]=m;setTimeout(async()=>{try{const a=u.filter(p=>p.EventGroupId!==r);a.length>0&&await A(a,!0)}catch(a){console.error("Failed to auto-fix orders after delete:",a)}},1e3),I.success("Group deleted successfully")}catch{I.error("Failed to delete group")}},N=r=>{let m="",v="";if(r.AgeFrom&&r.AgeTo&&r.AgeStartYear&&r.AgeStartMonth&&r.AgeStartDate)try{const s=new Date(r.AgeStartYear,r.AgeStartMonth-1,r.AgeStartDate),a=new Date(s);a.setFullYear(a.getFullYear()-r.AgeTo),a.setDate(a.getDate()+1);const p=F=>{const G=String(F.getDate()).padStart(2,"0"),Y=String(F.getMonth()+1).padStart(2,"0"),O=F.getFullYear();return`${G}-${Y}-${O}`};v=p(a);const x=new Date(s);x.setFullYear(x.getFullYear()-r.AgeFrom+1),m=p(x)}catch(s){console.error("Error calculating birth dates for editing:",s)}const n={...r,BirthDateFrom:r.BirthDateFrom||m,BirthDateTo:r.BirthDateTo||v};g(n),y(!0)},T=()=>{g(null),y(!1)},B=[{title:"New Page",path:k("/SetUp/ManageGroups")},{title:"Old Page",path:k("/SetUp/ManageGroupsOld")},{title:"Old Table View",path:k("/AgewiseGroups/Manage")}];return e.jsx(ee,{tabs:B,children:e.jsxs("div",{className:"p-6 bg-gradient-to-br from-gray-50 to-white min-h-screen",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-primary to-darkprimary rounded-xl p-3 shadow-md",children:e.jsx(P,{className:"h-7 w-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Age Groups Setup"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Manage participant age categories and groups"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!o),className:"inline-flex items-center gap-x-2 rounded-lg bg-gradient-to-r from-primary to-darkprimary px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200",children:[e.jsx(se,{className:"h-5 w-5"}),o?"Cancel":"Add New Group"]}),e.jsxs("button",{onClick:c,disabled:d==="loading",className:"inline-flex items-center gap-x-2 rounded-lg bg-emerald-600 px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200 disabled:bg-gray-400 disabled:scale-100",children:[e.jsx(ne,{className:"h-5 w-5"}),"Fix Order"]})]})]})}),o&&e.jsx(he,{editingGroup:i,existingGroups:u,onSubmit:D,onCancel:T,open:o}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-5 mb-6 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-lg p-2 flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Quick Guide"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed mb-2",children:"Organize participants into age-based groups. Groups are automatically ordered by priority (Individual → Team → Any) and age range."}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-gray-600",children:[e.jsx("li",{children:"Cyan badges represent Individual participants, Emerald for Teams, Indigo for Any type"}),e.jsx("li",{children:"Red dashed gaps indicate missing age ranges between groups"}),e.jsx("li",{children:'Use "Fix Order" button to manually reorder groups when needed'})]})]})]})}),d==="loading"&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading groups..."}),d==="error"&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:"Error loading age groups. Please try refreshing the page."})}),(d==="success"||d==="finished")&&(!l||l.length===0)&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:'No age groups found. Click "Add New Group" to get started.'})}),(d==="success"||d==="finished")&&l&&l.length>0&&e.jsx(xe,{groups:u,onEdit:N,onDelete:j,detectGaps:f}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{className:"text-primary",children:"What's next?"})," ",e.jsx("a",{href:"/SetUp/ManageCompetitionItems",className:"underline hover:text-primary",children:"Add Competition Items"})," ","|"," ",e.jsx("a",{href:"/CompetitionStructure/Tab",className:"underline hover:text-primary",children:"Assign Competitions to Groups"})," ","|"," ",e.jsx("a",{href:"/Coordinator/ManageBulkParticipants",className:"underline hover:text-primary",children:"Add Participants"})]})})]})})}export{Ue as default};
