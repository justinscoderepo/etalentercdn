import{r as N,j as e,f as A}from"./main-YrYtAxAS.js";import{c as G}from"./computeTotalAmount-D5_wn-tc.js";import{p as M}from"./httpService-BnCZZ1ib.js";import{c as T}from"./utilities-CN4lTu6a.js";import{V}from"./validationMessage-C8UQV-p_.js";import{F as C}from"./CheckCircleIcon-eDHedEn2.js";import{F as $}from"./CreditCardIcon-BBQ0gQPB.js";import{F as _}from"./ExclamationTriangleIcon-CaIv2k3v.js";import"./index-t--hEgTQ.js";const k=[{name:"PayPal",imageOnly:!1,icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8 text-blue-600",children:e.jsx("path",{d:"M7.5 4.5c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h3.375l-.375 1.5H7.5c-.621 0-1.125.504-1.125 1.125S6.879 21 7.5 21h2.25l1.5-6h2.625c3.75 0 6-1.875 6-5.625 0-2.25-1.125-4.5-4.5-4.5H7.5zm0 1.5h7.125c2.25 0 3 .75 3 2.625 0 2.25-1.125 3-3.75 3H10.5l-.75 3H9l1.125-4.5H7.5c-.621 0-1.125-.504-1.125-1.125V5.625c0-.621.504-1.125 1.125-1.125z"})})},{name:"Stripe",imageOnly:!1,icon:e.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded text-white flex items-center justify-center font-bold text-sm",children:"S"})},{name:"Razorpay",imageOnly:!1,icon:e.jsx("div",{className:"w-8 h-8 bg-blue-800 rounded text-white flex items-center justify-center font-bold text-sm",children:"R"})},{name:"Paytm",imageOnly:!1,icon:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded text-white flex items-center justify-center font-bold text-sm",children:"P"})},{name:"RoyalXpay",imageOnly:!0,imageUrl:"https://royalxpay.com/assets_frontend/images/RoyalXpay-whitewithtransparent.png",icon:e.jsx("div",{className:"bg-gray-800 px-4 pb-2 rounded",children:e.jsx("img",{src:"https://royalxpay.com/assets_frontend/images/RoyalXpay-whitewithtransparent.png",alt:"RoyalXpay",className:"w-full  h-10 object-contain"})})}],q=({gateway:c})=>{const a=k.find(y=>y.name===c);return a?a.icon:e.jsx($,{className:"w-8 h-8 text-primary"})},de=({label:c,errors:a,register:y,formData:i,isPlayGround:g,onChangeValue:v,disabled:u,readOnly:p,optional:h,component:d,eventDetails:f,competitions:s,participantsList:w,selectedCompetitions:n})=>{console.log("PayNowButton props:",{label:c,errors:a,formData:i,isPlayGround:g,disabled:u,readOnly:p,optional:h,component:d}),console.log("PayNowButton competitions data:",{competitions:s,selectedCompetitions:n,competitionsLength:s?.length,selectedLength:n?.length});const o="paymentCompleted",[P,I]=N.useState(!1),l=d?.paymentGateway||"PayPal";d?.secretKey,d?.webhookUrl;let H=a?.[o],[R,x]=N.useState(H);N.useEffect(()=>{x(a?.[o])},[a?.[o]]);const B=()=>{try{let t=s?.filter(j=>n?.includes(j.CompetitionStructureId))||[],r={};try{r=JSON.parse(f?.JsonSettings||"{}")}catch(j){console.warn("Failed to parse event JSON settings:",j)}let b={...i},{products:L,subTotal:D,discountPrice:Q,extraPayments:W,total:X,feesCurrency:z,discounts:Y,orders:Z}=G(r,t,b);return{gateway:l,userRoleId:i?.userRoleId||w?.[0]?.UserRoleId||null,teamId:i?.teamId||w?.[0]?.TeamId||null,displayedAmount:X||0,currency:z||"USD",eventId:f?.EVId||null,registrationId:w?.[0]?.RegistrationId||null,description:`${f?.EventName||"Event"} Registration`,returnUrl:`${window.location.origin}/payment/return`,cancelUrl:`${window.location.origin}/payment/cancel`,timeoutUrl:`${window.location.origin}/payment/timeout`}}catch(t){throw console.error("Error creating order data:",t),new Error("Failed to prepare order data")}},J=async()=>{if(!(u||p)){I(!0);try{const t=B();if(console.log("Creating order with payload:",t),!t.displayedAmount||t.displayedAmount<=0)throw new Error("Invalid payment amount");if(!t.userRoleId)throw new Error("User role ID is required for secure payment processing");const r=await M("/PaymentJson/CreateOrder",t);if(r.success)if(v&&v(o,!0),x(""),A.success("Order created successfully! Redirecting to payment..."),r.paymentUrl)window.location.href=r.paymentUrl;else if(r.orderId){const b=`/Payment/ProcessOrder?orderId=${r.orderId}&gateway=${l}`;window.location.href=b}else throw new Error("Invalid payment response - missing payment URL or order ID");else throw new Error(r.message||"Failed to create order")}catch(t){console.error("Payment failed:",t),I(!1);const r=t.message||"Payment failed. Please try again.";x(r),A.error(r)}}},m=i?.[o]===!0,F=s&&Array.isArray(s)&&s.length>0,E=n&&Array.isArray(n)&&n.length>0,O=F&&E,S=u||p||P||!O&&!g,U=k.find(t=>t.name===l)?.imageOnly||!1;return e.jsxs("div",{className:"sm:col-span-4 mb-4",children:[e.jsxs("div",{className:"block text-sm font-semibold leading-6 text-gray-900 mb-2",children:[c||"Payment Gateway",!h&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"checkbox",...y(o,{required:!h}),checked:m,onChange:()=>{},className:"hidden"}),e.jsx("div",{className:"mb-4 p-4 border border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("div",{className:`flex items-center mb-2 ${U?"justify-center":""}`,children:[e.jsx(q,{gateway:l}),!U&&e.jsx("span",{className:"ml-2 font-medium text-gray-900",children:l})]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:J,disabled:S,className:T("inline-flex items-center justify-center gap-x-2 rounded-md px-6 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",m?"bg-green-600 text-white hover:bg-green-700 focus-visible:outline-green-600":S?"bg-gray-200 text-gray-700 cursor-not-allowed":"bg-primary text-white hover:bg-primaryHover focus-visible:outline-primary"),children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating Order..."]}):m?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-5 w-5"}),"Payment Initiated"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5"}),"Pay Now"]})}),m&&e.jsxs("div",{className:"text-sm text-green-600 bg-green-50 p-2 rounded border border-green-200",children:[e.jsx(C,{className:"h-4 w-4 inline mr-1"}),"Order has been created and payment initiated."]}),!O&&!g&&e.jsxs("div",{className:"text-sm text-amber-600 bg-amber-50 p-2 rounded border border-amber-200",children:[e.jsx(_,{className:"h-4 w-4 inline mr-1"}),F?E?"No valid competitions for payment.":"No competitions selected for payment. Please select competitions first.":"No competitions available."]})]}),R&&e.jsx(V,{message:R})]})};export{de as default};
