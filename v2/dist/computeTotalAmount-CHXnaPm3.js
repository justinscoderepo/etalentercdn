import{q as M}from"./main-DBQ-0816.js";function q(x,m,t){if(t?.JsonSettings){let e=M(t?.UserJsonSettings),s=M(t?.JsonSettings);t={...t,...e,...s}}let v={};Object.keys(t).forEach(e=>{let s=e[0]?.toLowerCase()+e.slice(1);v[s]||(v[s]=t[e])}),t={...t,...v},t?.RegistrationId&&!t?.registrationId&&(t.registrationId=t.RegistrationId);const E=t?Object.keys(t).filter(e=>e.includes("extra_payment_")):[],f=x?.AdditionalSettings,u=x?.components?.User?.find(e=>e.type==="RegistrationIdBox"),L=f?.EligibleRegistrationNumbers;let h=[];if(t?.teamMembers?.length>0&&x?.AdditionalSettings?.AllowTeamDiscountIfCaptainIsEligible==="Yes"){const e=t?.teamMembers?.find(o=>o.Designation===4),s=M(e?.UserJsonSettings),i=M(e?.JsonSettings);t={...t,...s,...i,...e},t.registrationId=e?.RegistrationId}const l=L?.find(e=>e.RegistrationNumber===(t?.registrationId??"-"));let A=u?.conditions?u.conditions.every(e=>{const s=t[`${e.key.charAt(0).toLowerCase()}${e.key.slice(1)}`],i=t[e.key];return s?.toString()===e.value?.toString()||i?.toString()===e.value?.toString()}):!0;if(l&&A&&u?.discountPercentage){const e=parseFloat(u.discountPercentage);h.push({Title:u.discountTitle,DiscountPercent:e})}const R=m.reduce((e,s)=>e+parseFloat(s.Fees||0),0),c=e=>parseFloat(e||0).toFixed(3),J=l&&A&&u?.discountPercentage?parseFloat(u.discountPercentage):0,g=m.map(e=>{const s=parseFloat(e.Fees||0);let i=0,o=s;const n=e.JsonSettings?M(e.JsonSettings):{},a=n?.AdditionalSettings?.CustomMemberFees||n?.CustomMemberFees;return l&&A&&a!=null&&a>0?(o=parseFloat(a),i=s-o):J>0&&(i=s*J/100,o=s-i),{name:`${e.Title} - ${e.CompetitionCategoryName||""}`,total:e.Fees,finalPrice:o,CustomMemberFees:a,Fees:c(e.Fees),discountAmount:c(i),discountPercent:a!=null&&a>0?null:J}}),I=E.flatMap(e=>{const s=M(t[e]);return Object.entries(s).filter(([i,o])=>o.checked).map(([i,o])=>({name:i,total:o.fees}))}),P=I.reduce((e,s)=>e+parseFloat(s.total),0),O=g.reduce((e,s)=>e+parseFloat(s.discountAmount),0);let b=c(O),p=0;const B=parseFloat(f?.MaxIndividualTotalFees),d=parseFloat(f?.MaxIndividualMemberTotalFees),_=t?.participantType==="Individual",$=g.some(e=>e.CustomMemberFees!=null&&e.CustomMemberFees>0),T=f?.CustomMaxFees;let N=null,S=null,k=null,w=null;if(T&&Array.isArray(T)&&m.length>0){const e=m.map(n=>n.CompetitionCategoryName).filter(Boolean),s=T.filter(n=>e.includes(n.CompetitionCategoryId)),i=s.map(n=>({fee:parseFloat(n.MaxFees),category:n.CompetitionCategoryId})).filter(n=>!isNaN(n.fee)&&n.fee>0),o=s.map(n=>({fee:parseFloat(n.MaxMemberFees),category:n.CompetitionCategoryId})).filter(n=>!isNaN(n.fee)&&n.fee>0);if(i.length>0){const n=i.reduce((a,F)=>F.fee>a.fee?F:a);N=n.fee,k=n.category}if(o.length>0){const n=o.reduce((a,F)=>F.fee>a.fee?F:a);S=n.fee,w=n.category}}const r=l&&$&&S?S:N||(l&&$&&d&&!isNaN(d)&&d>0?d:B);if(r&&!isNaN(r)&&r>0&&_){const e=R+P-b;e>r&&(p=e-r)}const U=R+P,K=U-b-p,y=x?.AdditionalSettings?.FeesCurrency??"USD",C=[];if(g.length>0&&C.push({heading:"Competitions Fees",total:g.reduce((e,s)=>e+parseFloat(s.total),0),products:g}),I.length>0&&C.push({heading:"Extra Fees",total:P,products:I}),h.length>0&&C.push({heading:"Discount",total:`-${b}`,products:h.map(e=>({name:e.Title,total:`-${b}`}))}),p>0){let e;l&&$&&S?e=`Maximum Member Fees Cap by Category - ${w} (${r}${y})`:N?e=`Maximum Fees Cap by Category - ${k} (${r}${y})`:l&&$&&d>0?e=`Maximum Individual Member Fees Cap (${d}${y})`:e=`Maximum Individual Fees Cap (${B}${y})`,C.push({heading:"Maximum Fees Discount",total:`-${p}`,products:[{name:e,total:`-${p}`}]})}return{products:g,subTotal:c(U),discountPrice:c(b),maxIndividualFeesDiscount:c(p),extraPayments:I,taxPrice:c(0),total:c(K),feesCurrency:y,discounts:h,orders:C,bksMemberDtls:l||null}}export{q as c};
