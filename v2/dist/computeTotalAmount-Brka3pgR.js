import{q as g}from"./main-BxwnD9jH.js";function B(I,P,s){if(s?.JsonSettings){let e=g(s?.UserJsonSettings),t=g(s?.JsonSettings);s={...s,...e,...t}}let F={};Object.keys(s).forEach(e=>{let t=e[0]?.toLowerCase()+e.slice(1);F[t]||(F[t]=s[e])}),s={...s,...F},s?.RegistrationId&&!s?.registrationId&&(s.registrationId=s.RegistrationId);const R=s?Object.keys(s).filter(e=>e.includes("extra_payment_")):[],h=I?.AdditionalSettings,l=I?.components?.User?.find(e=>e.type==="RegistrationIdBox"),f=h?.EligibleRegistrationNumbers;let M=[];if(s?.teamMembers?.length>0&&I?.AdditionalSettings?.AllowTeamDiscountIfCaptainIsEligible==="Yes"){const e=s?.teamMembers?.find(i=>i.Designation===4),t=g(e?.UserJsonSettings),n=g(e?.JsonSettings);s={...s,...t,...n,...e},s.registrationId=e?.RegistrationId}const c=f?.find(e=>e.RegistrationNumber===(s?.registrationId??"-"));let S=l?.conditions?l.conditions.every(e=>{const t=s[`${e.key.charAt(0).toLowerCase()}${e.key.slice(1)}`],n=s[e.key];return t?.toString()===e.value?.toString()||n?.toString()===e.value?.toString()}):!0;if(c&&S&&l?.discountPercentage){const e=parseFloat(l.discountPercentage);M.push({Title:l.discountTitle,DiscountPercent:e})}const T=P.reduce((e,t)=>e+parseFloat(t.Fees||0),0),o=e=>parseFloat(e||0).toFixed(3),v=c&&S&&l?.discountPercentage?parseFloat(l.discountPercentage):0,u=P.map(e=>{const t=parseFloat(e.Fees||0);let n=0,i=t;const N=e.JsonSettings?g(e.JsonSettings):{},d=N?.AdditionalSettings?.CustomMemberFees||N?.CustomMemberFees;return c&&S&&d!=null&&d>0?(i=parseFloat(d),n=t-i):v>0&&(n=t*v/100,i=t-n),{name:`${e.Title} - ${e.CompetitionCategoryName||""}`,total:e.Fees,finalPrice:i,CustomMemberFees:d,Fees:o(e.Fees),discountAmount:o(n),discountPercent:d!=null&&d>0?null:v}}),C=R.flatMap(e=>{const t=g(s[e]);return Object.entries(t).filter(([n,i])=>i.checked).map(([n,i])=>({name:n,total:i.fees}))}),y=C.reduce((e,t)=>e+parseFloat(t.total),0),k=u.reduce((e,t)=>e+parseFloat(t.discountAmount),0);let r=o(k),a=0;const $=parseFloat(h?.MaxIndividualTotalFees),p=parseFloat(h?.MaxIndividualMemberTotalFees),w=s?.participantType==="Individual",m=u.some(e=>e.CustomMemberFees!=null&&e.CustomMemberFees>0),b=c&&m&&p&&!isNaN(p)&&p>0?p:$;if(b&&!isNaN(b)&&b>0&&w){const e=T+y-r;e>b&&(a=e-b)}const A=T+y,U=A-r-a,J=I?.AdditionalSettings?.FeesCurrency??"USD",x=[];if(u.length>0&&x.push({heading:"Competitions Fees",total:u.reduce((e,t)=>e+parseFloat(t.total),0),products:u}),C.length>0&&x.push({heading:"Extra Fees",total:y,products:C}),M.length>0&&x.push({heading:"Discount",total:`-${r}`,products:M.map(e=>({name:e.Title,total:`-${r}`}))}),a>0){const e=c&&m&&p>0?`Maximum Individual Member Fees Cap (${p}${J})`:`Maximum Individual Fees Cap (${$}${J})`;x.push({heading:"Maximum Fees Discount",total:`-${a}`,products:[{name:e,total:`-${a}`}]})}return{products:u,subTotal:o(A),discountPrice:o(r),maxIndividualFeesDiscount:o(a),extraPayments:C,taxPrice:o(0),total:o(U),feesCurrency:J,discounts:M,orders:x,bksMemberDtls:c||null}}export{B as c};
