import{r as g,j as e,h as z,k as q,e as Se,d as se}from"./main-CNwsE70q.js";import{F as le}from"./ClipboardDocumentListIcon-GQMeRs9_.js";import{F as ye}from"./CheckCircleIcon-DUuk71z7.js";import{F as he}from"./CheckCircleIcon-Cyyx_gWv.js";import{F as Ne}from"./StarIcon-QN3g6u3m.js";import{F as je}from"./TrashIcon-3Aiu4OUV.js";import{F as ue}from"./TrophyIcon-BVNiF5cj.js";function ve({title:d,titleId:m,...i},n){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},i),d?g.createElement("title",{id:m},d):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const we=g.forwardRef(ve);function Ce({title:d,titleId:m,...i},n){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},i),d?g.createElement("title",{id:m},d):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const de=g.forwardRef(Ce);function Ie({title:d,titleId:m,...i},n){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},i),d?g.createElement("title",{id:m},d):null,g.createElement("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z",clipRule:"evenodd"}))}const Je=g.forwardRef(Ie),$e=({competitions:d,processedCompetitions:m,competitionsStatus:i,selectedCompetition:n,onCompetitionSelect:j,getCompetitionStatusPriority:l,selectedGroupFilter:w,setSelectedGroupFilter:k})=>{const[$,A]=g.useState([]);g.useEffect(()=>{let t=m;w!=="all"&&(t=t.filter(u=>u.competitionGroupName===w)),A(t)},[m,w]);const x=t=>{const u=t.competitionOrder+" -"||"",h=t.competitionGroupName||"",o=t.competitionItemTitle||"",E=t.competitionGenderTitle||"",_=t.competitionLanguageName||"",F=t.statusTitle||"",J=t.competitionGender===3,O=t.competitionLanguage===4;let v=[];return u&&v.push(u),h&&v.push(h),o&&v.push(o),!J&&!O?(E&&v.push(E),_&&v.push(_)):J&&!O?_&&v.push(_):!J&&O&&E&&v.push(E),F&&v.push(`- ${F}`),v.join(" ").trim()||`Competition ${t.competitionId}`},N=t=>{switch(t){case"Filling in Progress":return 1;case"Allowed to Fill":return 2;case"Filled":return 3;case"Published":return 4;case"No Judges Assigned":return 5;default:return 6}},T=t=>{const u=t.competitionGroupName||"";let h="";if(t.judges&&t.judges.length>0){const o=t.judges.filter(J=>J.scoreStatus===1||J.scoreStatus==="1").length,E=t.judges.filter(J=>J.scoreStatus===2||J.scoreStatus==="2").length,_=t.judges.filter(J=>!J.scoreStatus||J.scoreStatus===0||J.scoreStatus==="0"||J.scoreStatus===3||J.scoreStatus==="3").length,F=t.judges.length;_>0&&_!==F?h="Filling in Progress":_===F?h="Allowed to Fill":o+E===F?h="Filled":E===F&&(h="Published")}return t._groupPriority=N(h),u&&h?`${u} - ${h}`:u||h||"General"},p=t=>t.inProgressJudges>0?"bg-blue-50 border-blue-200 text-blue-700":t.finishedJudges===t.totalJudges&&t.competitionStatus!==4?"bg-green-50 border-green-200 text-green-700":t.competitionStatus===4?"bg-purple-50 border-purple-200 text-purple-700":"bg-gray-50 border-gray-200 text-gray-700";return i==="loading"?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading competitions..."})]})}):m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No Competitions Available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No competitions have been assigned yet."})]}):$.length===0?e.jsxs("div",{children:[e.jsx("h2",{className:"border-b-2 border-b-[#485257] text-[#206689] items-center mb-4 font-medium pb-1 px-1 w-full uppercase text-lg",children:"Competition & Judge Selection"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No Competitions Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No competitions match the selected group filter. Try adjusting your filter settings."})]})]}):e.jsxs("div",{className:"",children:[e.jsx("div",{className:"block lg:hidden ",children:e.jsx("div",{className:"mb-2",children:e.jsxs("select",{value:n,onChange:t=>j(t.target.value),className:"block w-full rounded-md border-0 py-2 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-primary focus:border-primary sm:text-sm sm:leading-6",children:[e.jsx("option",{value:"",children:w==="all"?"Choose Competition...":`Choose Competition from ${w}...`}),(()=>{const t=$.reduce((u,h)=>{const o=T(h);return u[o]||(u[o]=[]),u[o].push(h),u},{});return Object.entries(t).sort(([,u],[,h])=>{const o=u[0]?._groupPriority||999,E=h[0]?._groupPriority||999;return o-E}).map(([u,h])=>e.jsx("optgroup",{label:u,children:h.map(o=>e.jsxs("option",{value:o.competitionId,"data-competition-status":o.competitionStatus,"data-allotment-id":o.allotementId,children:[x(o)," (",o.totalJudges," judges)"]},o.competitionId))},u))})()]})})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"max-h-[calc(100vh-120px)] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:e.jsx("div",{className:"w-full pr-2",children:(()=>{const t=$.reduce((u,h)=>{const o=T(h);return u[o]||(u[o]=[]),u[o].push(h),u},{});return Object.entries(t).sort(([,u],[,h])=>{const o=u[0]?._groupPriority||999,E=h[0]?._groupPriority||999;return o-E}).map(([u,h])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-bold bg-white text-gray-600 uppercase tracking-wide mb-2 px-2 sticky top-0  py-1 z-10",children:u}),e.jsx("div",{className:"space-y-2",children:h.map(o=>e.jsx("button",{onClick:()=>j(o.competitionId),className:`w-full text-left py-3 px-3 rounded-lg border transition-colors ${n===o.competitionId?"bg-gray-200 text-primary border-primary":p(o)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:`font-medium mr-1 text-xs break-words ${n===o.competitionId?"text-primary":"text-gray-900"}`,title:x(o),children:x(o)})}),o.competitionCode&&e.jsx("div",{className:`mb-3 ${n===o.competitionId,"text-gray-800"}`,children:e.jsxs("p",{className:"text-xs break-words",title:`Code: ${o.competitionCode}`,children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",o.competitionCode]})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs space-y-1",children:[o.finishedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-green-800"}`,children:[e.jsx(ye,{className:"h-5 w-5"}),e.jsx("span",{children:o.finishedJudges})]}),o.inProgressJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-blue-800"}`,children:[e.jsx(Je,{className:"h-5 w-5"}),e.jsx("span",{children:o.inProgressJudges})]}),o.notStartedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-gray-500"}`,children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:o.notStartedJudges})]})]})})]})},o.competitionId))})]},u))})()})})})]})},Te=({processedCompetitions:d,selectedCompetition:m,selectedJudges:i,onJudgeSelect:n})=>{const[j,l]=g.useState(!1),[w,k]=g.useState([]);g.useEffect(()=>{const t=()=>{l(window.innerWidth>1200)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),g.useEffect(()=>{i&&i.length>0&&k(i)},[i]);const $=t=>t.scoreStatus===1||t.scoreStatus==="1"?"bg-green-50 border-green-200 text-green-700":t.scoreStatus===2||t.scoreStatus==="2"?"bg-blue-50 border-blue-200 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700",A=t=>t.scoreStatus===1||t.scoreStatus==="1"?"Filled":t.scoreStatus===2||t.scoreStatus==="2"?"Published":"Allowed To Fill",x=t=>{if(j){const u=w.includes(t)?w.filter(h=>h!==t):[...w,t];k(u),n(u)}else{const u=[t];k(u),n(u)}},N=t=>w.includes(t.toString());if(!m)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Select a Competition"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a competition to see available judges."})]});const p=d.find(t=>t.competitionId==m)?.judges||[];return p.length===0&&m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No Judges Available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No judges found for this competition."})]}):e.jsx("div",{children:m&&e.jsx("div",{children:e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-row gap-2 flex-wrap",children:p.map(t=>e.jsxs("label",{className:`group relative flex rounded-lg border p-2 sm:p-3 min-w-24 sm:min-w-28 flex-1 sm:flex-none cursor-pointer transition-colors ${N(t.judgeId)?"border-primary bg-primary text-white shadow-sm":`${$(t)} hover:border-primary hover:shadow-sm bg-white`}`,children:[e.jsx("input",{type:j?"checkbox":"radio",name:j?`judge-${t.judgeId}`:"judge",value:t.judgeId,checked:N(t.judgeId),onChange:()=>x(t.judgeId.toString()),className:"absolute inset-0 appearance-none focus:outline-none focus:ring-0 border-transparent outline-0 invisible"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:`block text-xs sm:text-sm font-semibold ${N(t.judgeId)?"text-white":"text-gray-900"}`,children:t.judgeName}),e.jsx("span",{className:`block text-[10px] mt-0.5 sm:mt-1 ${N(t.judgeId)?"text-blue-100":"text-gray-500"}`,children:A(t)})]})}),e.jsx("div",{className:"absolute bottom-1 right-1 sm:bottom-2 sm:right-2",children:(t.scoreStatus===1||t.scoreStatus==="1"||t.scoreStatus===2||t.scoreStatus==="2")&&e.jsx(he,{className:`h-3 w-3 sm:h-4 sm:w-4 ${N(t.judgeId)?"text-green-200":"text-green-500"}`})})]},t.judgeId))})})})})},Pe=({participants:d,participantsStatus:m,activeParticipantId:i,currentParticipantIndex:n,participantScores:j,onParticipantSelect:l,onNavigateParticipant:w,judgeId:k,showJudgeSpecificScores:$=!1})=>{const A=x=>{if($&&k){const N=`judge_${k}_${x}`;return j[N]||j[x]||"-"}return j[x]||"-"};return m==="loading"?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsx("div",{className:"text-center text-gray-500 py-4",children:"Loading participants..."})}):!d||d.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"No participants found"})]})}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"space-y-1",children:d.map((x,N)=>e.jsx("button",{onClick:()=>l(x.ParticipantId,N),className:z("w-full text-left p-3 rounded-md transition-colors",x.ParticipantId===i?"bg-primary text-white":"hover:bg-gray-50 bg-white border border-gray-200"),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:z("text-sm font-medium",x.ParticipantId===i?"text-white":"text-gray-900"),children:x.IdentityNumber?x.IdentityNumber:x.CandidateIdentityNumber||x.ParticipantNumber}),e.jsx("div",{className:z("text-sm font-medium",x.ParticipantId===i?"text-green-200":"text-primary"),children:A(x.ParticipantId)})]})},x.ParticipantId))})})})})},me=({value:d,onChange:m,maxStars:i=10,criteriaId:n,participantId:j,disabled:l=!1})=>{const[w,k]=g.useState(0),$=x=>{l||m(x,n,j)},A=x=>{l||k(x)};return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex items-center justify-center gap-1 mb-2 w-full",children:[...Array(i)].map((x,N)=>{const T=N+1,p=T<=(w||d||0);return e.jsx("button",{type:"button",disabled:l,className:z("flex-1 flex items-center justify-center p-1 transition-colors duration-150 max-w-8 max-h-8 aspect-square",l?"cursor-not-allowed opacity-50":"cursor-pointer",p?"text-yellow-400":"text-gray-300 hover:text-yellow-200"),onMouseEnter:()=>A(T),onMouseLeave:()=>k(0),onClick:()=>$(T),children:p?e.jsx(Ne,{className:"w-full h-full min-w-4 min-h-4"}):e.jsx(we,{className:"w-full h-full min-w-4 min-h-4"})},N)})})})},ge=({value:d,onChange:m,maxMarks:i=100,minMarks:n=0,criteriaId:j,participantId:l,disabled:w=!1,placeholder:k="Enter marks"})=>{const $=x=>{const N=x.target.value,T=parseFloat(N);!isNaN(T)&&T>=n&&T<=i?m(T,j,l):N===""&&m(0,j,l)},A=()=>{const x=parseFloat(d);isNaN(x)||x<n?m(n,j,l):x>i&&m(i,j,l)};return e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",min:n,max:i,step:"0.1",value:d||"",onChange:$,onBlur:A,disabled:w,placeholder:k,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-gray-900 focus:border-darkprimary placeholder:text-gray-400 ring-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed"})})})},xe=({value:d,onChange:m,maxCount:i=10,minCount:n=0,criteriaId:j,participantId:l,disabled:w=!1,label:k="Count"})=>{const $=()=>{if(w||(d||0)>=i)return;const N=(d||0)+1;m(N,j,l)},A=()=>{if(w||(d||0)<=n)return;const N=Math.max(n,(d||0)-1);m(N,j,l)},x=N=>{const T=parseInt(N.target.value);!isNaN(T)&&T>=n&&T<=i&&m(T,j,l)};return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:A,disabled:w||(d||0)<=n,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-gray-600",children:e.jsx("span",{className:"text-lg font-medium",children:"−"})}),e.jsx("div",{className:"flex-1 max-w-20",children:e.jsx("input",{type:"number",step:"0.1",min:n,max:i,value:d||0,onChange:x,disabled:w,className:"text-center pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-gray-900 focus:border-darkprimary placeholder:text-gray-400 ring-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed"})}),e.jsx("button",{type:"button",onClick:$,disabled:w||(d||0)>=i,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-gray-600",children:e.jsx("span",{className:"text-lg font-medium",children:"+"})})]})},ke=({activeParticipantId:d,participants:m,competitionDetails:i,criteriaScores:n,participantScores:j,participantNotes:l,onScoreChange:w,onNotesChange:k,onSaveScore:$,onDeleteScore:A,selectedCompetition:x,processedCompetitions:N,selectedJudges:T,currentJudgeId:p})=>{const[t,u]=g.useState(!1),[h,o]=g.useState({}),[E,_]=g.useState(""),[F,J]=g.useState(0),O=m?.find(a=>a.ParticipantId===d),v=N?.find(a=>a.competitionId==x),X=()=>{if(!p||!v||!v.judges)return"";const a=v.judges.find(y=>y.judgeId.toString()===p.toString());return a?a.judgeName:`Judge ${p}`},Q=(a,y=p)=>T.length>1?`${a}_judge_${y}`:a,W=()=>!i||i.length===0||i.every(y=>y.Value&&y.Value!=0&&y.Value==v.competitionMaximumScore)?!1:i.every(y=>y.Value&&y.Value!=0),M=(a=h)=>{if(!i||i.length===0)return F;let y=0;const C=W();return i.forEach(I=>{const G=I.DetailId||I.CompetitionDetailsId,L=a[G]||0;y+=L}),C?y:y/i.length},re=a=>{if(J(a),!i||i.length===0)return;const y={...h};if(W()){const I=i.reduce((G,L)=>G+(L.Value||0),0);i.forEach(G=>{const L=G.DetailId||G.CompetitionDetailsId,U=G.Value||0,K=I>0?a*U/I:0,te=G.Value||10;y[L]=Math.min(K,te)})}else i.forEach(I=>{const G=I.DetailId||I.CompetitionDetailsId,L=I.Value||10;y[G]=Math.min(a,L)});o(y)};if(g.useEffect(()=>{if(d&&p){const a={},y=Q(d),C=j[y]||0;if(J(C),i&&i.length>0&&(i.forEach(L=>{const U=L.DetailId||L.CompetitionDetailsId,K=Q(`${U}_${d}`);a[U]=n[K]||0}),!Object.values(a).some(L=>L>0)&&C>0&&M(a)!==C)){re(C);return}o(a);const I=Q(d);_(l[I]||"")}},[d,j,n,l,i,p]),!O)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 text-center",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Select a participant to begin scoring"})});const ae=async()=>{u(!0);try{const a={...O,judgeId:p,totalScore:F,criteriaScores:h,notes:E};if(await $(d,null,F,p),i&&i.length>0)for(const y of i){const C=y.DetailId||y.CompetitionDetailsId,I=h[C]||0;w(I,C,d,p),await $(d,C,I,p)}k(d,E,p),q.success(`Score saved successfully for ${X()}!`)}catch(a){console.error("Error saving scores:",a),q.error("Failed to save score. Please try again.")}finally{u(!1)}},Z=async()=>{if(window.confirm(`Are you sure you want to delete the score for this participant from ${X()}?`)){u(!0);try{if(await A(d,null,p),i&&i.length>0)for(const a of i){const y=a.DetailId||a.CompetitionDetailsId;await A(d,y,p)}J(0),o({}),_(""),q.success(`Score deleted successfully for ${X()}!`)}catch(a){console.error("Error deleting scores:",a),q.error("Failed to delete score. Please try again.")}finally{u(!1)}}},ne=()=>v?.competitionMaximumScore||10,H=()=>{switch(v?.scoreLabel){case 1:return"marks";case 2:return"count";case 3:case 4:return"star";default:return"marks"}},Y=()=>H(),ee=()=>{const a=ne(),y=Y(),C={value:F,onChange:I=>re(I),disabled:t,criteriaId:"total",participantId:d};return y==="count"?e.jsx(xe,{...C,maxCount:a,label:"Total Count"}):y==="marks"?e.jsx(ge,{...C,maxMarks:a,placeholder:"Enter total score"}):e.jsx(me,{...C,maxStars:Math.min(a,10),maxScore:a})},ie=(a,y)=>{const C=a.DetailId||a.CompetitionDetailsId,I=h[C]||0,G=a.Value||10,L=Y(),U=(K,te,s)=>{const c={...h,[te]:K};o(c);const f=M(c);J(f)};return L==="count"?e.jsx(xe,{value:I,onChange:U,maxCount:G,criteriaId:C,participantId:d,disabled:t}):L==="star"?e.jsx(me,{value:I,onChange:U,maxStars:10,maxScore:G,criteriaId:C,participantId:d,disabled:t}):e.jsx(ge,{value:I,onChange:U,maxMarks:G,criteriaId:C,participantId:d,disabled:t})},oe=i&&i.length>0;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900",children:O.CandidateName}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ID: #",O.CandidateIdentityNumber||O.TeamIdentityNumber]})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Enter Score"}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:"Total Score"}),e.jsx("p",{className:"text-xs text-gray-500",children:oe?"Enter total score (will auto-distribute to criteria below)":"Enter the participant's total score"})]})}),e.jsx("div",{className:"mt-3",children:ee()}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[F.toFixed(1)," / ",ne()]})})]})]}),oe&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Detailed Criteria Scoring (Optional)"}),e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsx("div",{className:"space-y-4",children:i.map((a,y)=>{`${a.DetailId||a.CompetitionDetailsId}${d}`;const C=a.DetailId||a.CompetitionDetailsId,I=h[C]||0,L=Y()==="star";return e.jsx("div",{className:y>0?"border-t border-gray-200 pt-4":"",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:a.CriteriaName||a.CompetitionDetailsTitle}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",a.Value||10," points"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:ie(a)}),L&&e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"text-sm font-semibold text-primary",children:[I.toFixed(1)," / ",a.Value||10]})})]})]})},a.DetailId||a.CompetitionDetailsId)})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-gray-900 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:E,onChange:a=>_(a.target.value),disabled:t,placeholder:"Add any additional comments or notes about this participant's performance...",rows:3,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-gray-900 focus:border-darkprimary placeholder:text-gray-400 ring-gray-300 disabled:bg-gray-100"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("button",{onClick:Z,disabled:t,className:"inline-flex items-center gap-x-2 rounded-md bg-gray-200 px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:[e.jsx(je,{className:"-mr-0.5 h-5 w-5"}),"Delete Score"]}),e.jsx("button",{onClick:ae,disabled:t||F===0,className:z("inline-flex items-center gap-x-2 rounded-md px-6 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",t||F===0?"bg-gray-200 text-gray-700 cursor-not-allowed":"bg-primary text-white hover:bg-primaryHover"),children:t?"Saving...":"Save Score"})]})]})]})},De=({user:d})=>{const{user:m,token:i}=Se()||{},[n,j]=g.useState([]),[l,w]=g.useState(""),[k,$]=g.useState(null),[A,x]=g.useState(0),[N,T]=g.useState(!1),[p,t]=g.useState([]),[u,h]=g.useState("all"),[o,E]=g.useState({}),[_,F]=g.useState({}),[J,O]=g.useState({}),{rows:v,status:X,update:Q}=se("/JudgesAllotmentWithScoreLabelJson/Get",{select:"AllotementId,Competition,CompetitionParticipantType,CompetitionParticipantTypeTitle,CompetitionGroup,CompetitionGroupGroupName,CompetitionCompetitionItem,CompetitionItemTitle,CompetitionItemScoreLabel,ScoreLabelLabel,CompetitionLanguage,CompetitionLanguageLanguageName,CompetitionGender,CompetitionGenderGenderTitle,CompetitionCompetitionStatus,CompetitionCompetitionStatusCompetitionStatusTitle,CompetitionEventEventName,CompetitionOrder,CompetitionMaximumScore,CompetitionFees,CompetitionMaximumMinutes,CompetitionMaximumSeconds,CompetitionMinimumMinutes,CompetitionMinimumSeconds,CompetitionWarningMinute,CompetitionWarningSecond,ScoreStatus,ScoreStatusScoreResultStatus,Phase,PhaseTitle,Stage,StageTitle,Judge,Visibility,Status,EventEventName,Order,ModifiedDateString,CompetitionStatusTitle",filter:{NoGrouping:!0,CreatedBy:m?.UId,Status:"1",Event:m?.Event},sort:{sortColumn:"CompetitionOrder"},updateUrl:"/JudgesAllotmentJson/SaveJudgeStatus"}),{rows:W}=se("/UsersRolesJson/Get",{select:"UId,UserRoleId,UserName,Name,Role,Status",filter:{Role:"6",Status:"1"}}),{rows:M,status:re,setFilter:ae}=se("/CompetitionParticipantsScoreCardJson/Get",{select:"ParticipantId,CandidateIdentityNumber,CompetitionCompetitionItem,CompetitionGender,CompetitionGroup,CompetitionLanguage,CompetitionMaximumScore,CompetitionParticipantType,IdentityNumber,Notes,ParticipantIdScore,ParticipantIdScorecardId,ParticipantType,Status,TeamIdentityNumber,CandidateName,ParticipantNumber,ScorecardId",filter:{Status:"1"},noGet:!0,updateUrl:"/JudgeJson/SaveScore",deleteUrl:"/JudgeJson/DeleteScore"}),{rows:Z,setFilter:ne}=se("/JudgesDetailedScoreCardJson/Get",{select:"JudgesDetailedScoreCardId,ParticipantId,CompetitionDetailsId,Score,Judge,Competition,ScoreCard",filter:{},noGet:!0,updateUrl:"/JudgesDetailedScoreCardJson/Save",deleteUrl:"/JudgesDetailedScoreCardJson/Remove"}),{rows:H,setFilter:Y}=se("/CompetitionDetailsJson/Get",{select:"CriteriaName,DetailId,Order,SecondValue,Status,Value,Competition,CompetitionDetailsTitle,MaxScore,MinScore,CompetitionItem,ParticipantType,Gender,Group,Language,CompetitionDetailsId",filter:{},noGet:!0,updateUrl:"/CompetitionDetailsJson/Save"}),ee=s=>s.inProgressJudges>0?1:s.finishedJudges===s.totalJudges&&s.competitionStatus!==4?2:s.notStartedJudges===s.totalJudges?4:s.competitionStatus===4?5:3;g.useEffect(()=>{if(m&&m.Role===6&&p.length>0){const c=p.flatMap(f=>f.judges).find(f=>f.judgeName===m.UserName||f.judgeUserName===m.UserName||f.judgeId===m.UId||f.judgeId===m.UserRoleId);c&&j([c.judgeId.toString()])}},[m,p]),g.useEffect(()=>{if(v&&v.length>0&&W&&W.length>0){const s=v.reduce((f,r)=>{const b=r.Competition;if(f[b]||(f[b]={competitionId:b,allotementId:r.AllotementId,competitionName:r.CompetitionEventEventName||`Competition ${b}`,competitionCode:r.CompetitionCode||"",statusTitle:r.CompetitionStatusTitle||r.CompetitionCompetitionStatusCompetitionStatusTitle||"Unknown Status",competitionStatus:r.CompetitionCompetitionStatus,competitionItemTitle:r.CompetitionItemTitle,competitionGender:r.CompetitionGender,competitionGenderTitle:r.CompetitionGenderGenderTitle,competitionGroupName:r.CompetitionGroupGroupName,competitionItemScoreLabel:r.CompetitionItemScoreLabel,competitionLanguage:r.CompetitionLanguage,competitionLanguageName:r.CompetitionLanguageLanguageName,competitionOrder:r.CompetitionOrder||r.Order,competitionParticipantTypeTitle:r.CompetitionParticipantTypeTitle,scoreLabel:r.CompetitionItemScoreLabel,scoreLabelLabel:r.ScoreLabelLabel,scoreStatus:r.ScoreStatus,scoreStatusTitle:r.ScoreStatusScoreResultStatus,competitionMaximumScore:r.CompetitionMaximumScore>0?r.CompetitionMaximumScore:10,competitionFees:r.CompetitionFees,phaseTitle:r.PhaseTitle,stageTitle:r.StageTitle,judges:[],totalJudges:0,finishedJudges:0,inProgressJudges:0,notStartedJudges:0}),!f[b].judges.find(S=>S.judgeId===r.Judge&&S.allotmentId===r.AllotementId)){const S=W.find(D=>D.UserRoleId===r.Judge),B=S?S.Name||S.UserName:`Judge ${r.Judge}`;f[b].judges.push({judgeId:r.Judge,judgeName:B,judgeUserName:S?.UserName||"",scoreStatus:r.ScoreStatus,allotmentId:r.AllotementId}),f[b].totalJudges++,r.ScoreStatus===1||r.ScoreStatus==="1"?f[b].finishedJudges++:r.ScoreStatus===2||r.ScoreStatus==="2"?f[b].inProgressJudges++:f[b].notStartedJudges++}return f},{}),c=Object.values(s).sort((f,r)=>{const b=ee(f)-ee(r);if(b!==0)return b;const P=f.competitionOrder||0,S=r.competitionOrder||0;return P-S});t(c)}},[v,W]);const ie=g.useMemo(()=>{const s=[...new Set(p.map(c=>c.competitionGroupName).filter(Boolean))];return[{value:"all",label:"All Groups",count:p.length},...s.map(c=>({value:c,label:c,count:p.filter(f=>f.competitionGroupName===c).length}))]},[p]);g.useEffect(()=>{n.length>0&&l&&ae({Judge:n[0],Competition:l,Status:"1"})},[n,l]),g.useEffect(()=>{n.length>0&&l&&ne({Judge:n[0],Competition:l})},[n,l]),g.useEffect(()=>{l&&Y({Competition:l})},[l]),g.useEffect(()=>{if(Z&&Z.length>0){const s={},c={},f={};Z.forEach(r=>{r.CriteriaId&&(s[`${r.CriteriaId}_${r.ParticipantId}`]=r.Score),r.TotalScore&&(c[r.ParticipantId]=r.TotalScore),r.Notes&&(f[r.ParticipantId]=r.Notes)}),E(s),F(c),O(f)}},[Z]),g.useEffect(()=>{M&&M.length>0&&!k&&($(M[0].ParticipantId),x(0))},[M,k]);const oe=s=>{w(s),$(null),x(0)},a=s=>{j(s),$(null),x(0)},y=(s,c)=>{$(s),x(c)},C=s=>{if(!M||M.length===0)return;let c;s==="next"?(c=A+1,c>=M.length&&(c=0)):(c=A-1,c<0&&(c=M.length-1)),x(c),$(M[c]?.ParticipantId)},I=(s,c,f,r=null)=>{const b=r||n[0],P=n.length>1?`judge_${b}_`:"";if(c===null)F(S=>({...S,[`${P}${f}`]:s}));else{const S=`${P}${c}_${f}`;E(B=>({...B,[S]:s})),L(f,b)}},G=(s,c,f=null)=>{const r=f||n[0],b=n.length>1?`judge_${r}_`:"";O(P=>({...P,[`${b}${s}`]:c}))},L=(s,c=null)=>{const f=c||n[0],r=n.length>1?`judge_${f}_`:"",P=Object.keys(o).filter(S=>S.endsWith(`_${s}`)&&(n.length===1||S.startsWith(`judge_${f}_`))).reduce((S,B)=>S+(o[B]||0),0);F(S=>({...S,[`${r}${s}`]:P}))},U=async(s,c=null,f=null,r=null)=>{const b=r||n[0],P=n.length>1?`judge_${b}_`:"";try{const S={};if(S.Scores=[],c){const V={Judge:b,Competition:l,ParticipantId:s,CriteriaId:c,Score:f||o[`${P}${c}_${s}`]||0,AllotementId:v?.find(R=>R.Competition===l)?.AllotementId};S.Scores.push(V)}else if(H&&H.length>0){H.forEach(R=>{const fe=`${P}${R.DetailId||R.CompetitionDetailsId}_${s}`,ce=o[fe]||0;if(ce>0){const pe={Judge:b,Competition:l,ParticipantId:s,CriteriaId:R.DetailId||R.CompetitionDetailsId,Score:ce,AllotementId:v?.find(be=>be.Competition===l)?.AllotementId};S.Scores.push(pe)}});const V={Judge:b,Competition:l,ParticipantId:s,ScoreCardScore:_[`${P}${s}`]||0,IsTotalScore:!0,AllotementId:v?.find(R=>R.Competition===l)?.AllotementId};S.Scores.push(V)}else{const V={Judge:b,Competition:l,ParticipantId:s,ScoreCardScore:_[`${P}${s}`]||0,AllotementId:v?.find(R=>R.Competition===l)?.AllotementId};S.Scores.push(V)}S.notes=J[`${P}${s}`]||"",S.JudgeId=b;const D=await(await fetch("/JudgeJson/SaveScore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)})).json();if(D.Results>0&&D.Results!=="0")return D.Results;throw new Error(typeof D.Results=="string"?D.Results:"Failed to save score")}catch(S){throw console.error("Error saving score:",S),S}},K=async(s,c=null,f=null)=>{const r=f||n[0],b=n.length>1?`judge_${r}_`:"";try{const P={Judge:r,Competition:l,ParticipantId:s};return c?(P.CriteriaId=c,(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json()).success!==!1&&E(D=>{const V={...D};return delete V[`${b}${c}_${s}`],V})):(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json()).success!==!1&&(F(D=>{const V={...D};return delete V[`${b}${s}`],V}),E(D=>{const V={...D};return Object.keys(V).forEach(R=>{R.endsWith(`_${s}`)&&(n.length===1||R.startsWith(`judge_${r}_`))&&delete V[R]}),V}),O(D=>{const V={...D};return delete V[`${b}${s}`],V})),!0}catch(P){throw console.error("Error deleting score:",P),P}},te=async()=>{if(!(n.length===0||!l)){T(!0);try{const s={Competition:l,ScoreStatus:1,AllotementId:v?.find(c=>c.Competition===l)?.AllotementId};await Q(s),q.success("Competition marked as finished!")}catch(s){console.error("Error marking as finished:",s),q.error("Failed to mark competition as finished.")}finally{T(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-6 w-6 text-primary mr-3"}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Scoring Panel - Warning - Not finished"})})]}),n.length>0&&l&&e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:te,disabled:N,className:z("inline-flex items-center gap-x-2 rounded-md px-4 py-2 text-sm font-semibold shadow-sm",N?"bg-gray-200 text-gray-700 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"),children:[e.jsx(he,{className:"h-4 w-4"}),N?"Finishing...":"Mark as Finished"]})})]})})}),e.jsxs("div",{className:"px-2 lg:px-6 py-2",children:[p.length>0&&e.jsx("div",{className:"lg:mb-6",children:e.jsxs("div",{className:"bg-white rounded-t-lg lg:rounded-lg py-2 px-2 lg:px-6 ",children:[e.jsx("div",{className:"lg:hidden lg:mb-4 mt-1",children:e.jsx("select",{value:u,onChange:s=>h(s.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-darkprimary focus:ring-primary text-sm",children:ie.map(s=>e.jsxs("option",{value:s.value,children:[s.label," (",s.count,")"]},s.value))})}),e.jsx("nav",{className:"hidden lg:flex -mb-px space-x-4 overflow-x-auto",children:ie.map(s=>e.jsxs("button",{onClick:()=>h(s.value),className:`whitespace-nowrap py-2 px-6 border-b-2 font-medium text-sm transition-all duration-200 ${u===s.value?"border-primary text-primary bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.label," (",s.count,")"]},s.value))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-2",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsx("div",{className:"bg-white lg:border-t-2 lg:border-primary rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx($e,{competitions:v,processedCompetitions:p,competitionsStatus:X,selectedCompetition:l,onCompetitionSelect:oe,getCompetitionStatusPriority:ee,selectedGroupFilter:u,setSelectedGroupFilter:h})})})}),e.jsxs("div",{className:"lg:col-span-3 space-y-2",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx(Te,{processedCompetitions:p,selectedCompetition:l,selectedJudges:n,onJudgeSelect:a})})}),n.length>0&&l&&e.jsx("div",{className:"space-x-1 flex flex-row overflow-x-auto",children:n.map((s,c)=>{const r=p.find(b=>b.competitionId==l)?.judges?.find(b=>b.judgeId.toString()===s.toString());return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-primary",children:["Judge: ",r?.judgeName||`Judge ${s}`]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Status: ",r?.scoreStatus===1||r?.scoreStatus==="1"?"Filled":r?.scoreStatus===2||r?.scoreStatus==="2"?"Published":"Allowed To Fill"]})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("div",{className:"w-28 flex-shrink-0",children:e.jsx(Pe,{participants:M,participantsStatus:re,activeParticipantId:k,currentParticipantIndex:A,participantScores:_,onParticipantSelect:y,onNavigateParticipant:C,judgeId:s,showJudgeSpecificScores:n.length>1})}),e.jsx("div",{className:"flex-1",children:e.jsx(ke,{activeParticipantId:k,participants:M,competitionDetails:H,criteriaScores:o,participantScores:_,participantNotes:J,onScoreChange:I,onNotesChange:G,onSaveScore:U,onDeleteScore:K,selectedCompetition:l,processedCompetitions:p,selectedJudges:[s],currentJudgeId:s})})]})]},s)})})]})]}),(n.length===0||!l)&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Welcome to Judge Scoring Panel v2"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Please select a judge and competition to begin scoring participants."}),e.jsx("div",{className:"text-sm text-gray-400",children:"Enhanced with modern UX patterns and interactive scoring features"})]})]})]})};export{De as default};
