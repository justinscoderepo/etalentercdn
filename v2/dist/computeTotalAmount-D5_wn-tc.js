import{p as g}from"./main-YrYtAxAS.js";function N(d,x,e){if(e?.JsonSettings){let s=g(e?.UserJsonSettings),n=g(e?.JsonSettings);e={...e,...s,...n}}let r={};Object.keys(e).forEach(s=>{let n=s[0]?.toLowerCase()+s.slice(1);r[n]||(r[n]=e[s])}),e={...e,...r},e?.RegistrationId&&!e?.registrationId&&(e.registrationId=e.RegistrationId);const T=e?Object.keys(e).filter(s=>s.includes("extra_payment_")):[],S=d?.AdditionalSettings,u=d?.components?.User?.find(s=>s.type==="RegistrationIdBox"),J=S?.EligibleRegistrationNumbers;let i=[];if(e?.teamMembers?.length>0&&d?.AdditionalSettings?.AllowTeamDiscountIfCaptainIsEligible==="Yes"){const s=e?.teamMembers?.find(p=>p.Designation===4),n=g(s?.UserJsonSettings),o=g(s?.JsonSettings);e={...e,...n,...o,...s},e.registrationId=s?.RegistrationId}const $=J?.find(s=>s.RegistrationNumber===(e?.registrationId??"-"));let P=u?.conditions?u.conditions.every(s=>{const n=e[`${s.key.charAt(0).toLowerCase()}${s.key.slice(1)}`],o=e[s.key];return n?.toString()===s.value?.toString()||o?.toString()===s.value?.toString()}):!0;if($&&P&&u?.discountPercentage){const s=parseFloat(u.discountPercentage);i.push({Title:u.discountTitle,DiscountPercent:s})}const y=x.reduce((s,n)=>s+parseFloat(n.Fees),0),h=x.map(s=>({name:`${s.Title} - ${s.CompetitionCategoryName}`,total:s.Fees})),I=T.flatMap(s=>{const n=g(e[s]);return Object.entries(n).filter(([o,p])=>p.checked).map(([o,p])=>({name:o,total:p.fees}))}),b=I.reduce((s,n)=>s+parseFloat(n.total),0);let t=0;if(i.length>0){const s=i[0],n=parseFloat(s.DiscountPercent);t=y*n/100}let c=0;const l=parseFloat(S?.MaxIndividualTotalFees),A=e?.participantType==="Individual";if(l&&!isNaN(l)&&l>0&&A){const s=y+b-t;s>l&&(c=s-l)}const v=y+b,M=v-t-c,C=d?.AdditionalSettings?.FeesCurrency??"USD",a=[];return h.length>0&&a.push({heading:"Competitions Fees",total:h.reduce((s,n)=>s+parseFloat(n.total),0),products:h}),I.length>0&&a.push({heading:"Extra Fees",total:b,products:I}),i.length>0&&a.push({heading:"Discount",total:`-${t}`,products:i.map(s=>({name:s.Title,total:`-${t}`}))}),c>0&&a.push({heading:"Maximum Fees Discount",total:`-${c}`,products:[{name:`Maximum Individual Fees Cap (${l}${C})`,total:`-${c}`}]}),{products:h,subTotal:v,discountPrice:t,maxIndividualFeesDiscount:c,extraPayments:I,total:M,feesCurrency:C,discounts:i,orders:a}}export{N as c};
