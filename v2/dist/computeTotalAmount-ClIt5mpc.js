import{q as d}from"./main-D5_pO8CD.js";function k(r,v,e){if(e?.JsonSettings){let s=d(e?.UserJsonSettings),n=d(e?.JsonSettings);e={...e,...s,...n}}let x={};Object.keys(e).forEach(s=>{let n=s[0]?.toLowerCase()+s.slice(1);x[n]||(x[n]=e[s])}),e={...e,...x},e?.RegistrationId&&!e?.registrationId&&(e.registrationId=e.RegistrationId);const P=e?Object.keys(e).filter(s=>s.includes("extra_payment_")):[],S=r?.AdditionalSettings,a=r?.components?.User?.find(s=>s.type==="RegistrationIdBox"),$=S?.EligibleRegistrationNumbers;let t=[];if(e?.teamMembers?.length>0&&r?.AdditionalSettings?.AllowTeamDiscountIfCaptainIsEligible==="Yes"){const s=e?.teamMembers?.find(g=>g.Designation===4),n=d(s?.UserJsonSettings),u=d(s?.JsonSettings);e={...e,...n,...u,...s},e.registrationId=s?.RegistrationId}const T=$?.find(s=>s.RegistrationNumber===(e?.registrationId??"-"));let A=a?.conditions?a.conditions.every(s=>{const n=e[`${s.key.charAt(0).toLowerCase()}${s.key.slice(1)}`],u=e[s.key];return n?.toString()===s.value?.toString()||u?.toString()===s.value?.toString()}):!0;if(T&&A&&a?.discountPercentage){const s=parseFloat(a.discountPercentage);t.push({Title:a.discountTitle,DiscountPercent:s})}const I=v.reduce((s,n)=>s+parseFloat(n.Fees||0),0),i=s=>parseFloat(s||0).toFixed(3),b=v.map(s=>({name:`${s.Title} - ${s.CompetitionCategoryName||""}`,total:s.Fees,Fees:i(s.Fees)})),h=P.flatMap(s=>{const n=d(e[s]);return Object.entries(n).filter(([u,g])=>g.checked).map(([u,g])=>({name:u,total:g.fees}))}),y=h.reduce((s,n)=>s+parseFloat(n.total),0);let c=0;if(t.length>0){const s=t[0],n=parseFloat(s.DiscountPercent);c=I*n/100}let l=0;const o=parseFloat(S?.MaxIndividualTotalFees),M=e?.participantType==="Individual";if(o&&!isNaN(o)&&o>0&&M){const s=I+y-c;s>o&&(l=s-o)}const C=I+y,N=C-c-l,J=r?.AdditionalSettings?.FeesCurrency??"USD",p=[];return b.length>0&&p.push({heading:"Competitions Fees",total:b.reduce((s,n)=>s+parseFloat(n.total),0),products:b}),h.length>0&&p.push({heading:"Extra Fees",total:y,products:h}),t.length>0&&p.push({heading:"Discount",total:`-${c}`,products:t.map(s=>({name:s.Title,total:`-${c}`}))}),l>0&&p.push({heading:"Maximum Fees Discount",total:`-${l}`,products:[{name:`Maximum Individual Fees Cap (${o}${J})`,total:`-${l}`}]}),{products:b,subTotal:i(C),discountPrice:i(c),maxIndividualFeesDiscount:i(l),extraPayments:h,taxPrice:i(0),total:i(N),feesCurrency:J,discounts:t,orders:p,bksMemberDtls:T||null}}export{k as c};
