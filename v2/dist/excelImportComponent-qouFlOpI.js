import{r as u,l as Ve,m as et,j as e,k as v,p as tt,d as st,L as rt}from"./main-BWzMsQNc.js";import{u as nt}from"./useConfirmation-BeegOQpj.js";import{F as at}from"./ChevronDownIcon-BwmFTsvg.js";import{F as ye}from"./XMarkIcon-D1m40oZE.js";import{F as ze}from"./ArrowPathIcon-C4QUQS6u.js";import{F as ne}from"./CheckIcon-DBW4iFov.js";import{y as He,D as Fe,j as We,Y as Je}from"./dialog-BhrJpZ10.js";import{F as it}from"./ExclamationTriangleIcon-BcgmRnXm.js";import"./TrashIcon-Mlie7npg.js";import"./keyboard-BqrsB3bq.js";import"./description-CrFBjouQ.js";import"./open-closed-B59MYedN.js";import"./index-T2M3h99b.js";function ot({title:b,titleId:w,...E},k){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:k,"aria-labelledby":w},E),b?u.createElement("title",{id:w},b):null,u.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const lt=u.forwardRef(ot);function dt({title:b,titleId:w,...E},k){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:k,"aria-labelledby":w},E),b?u.createElement("title",{id:w},b):null,u.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"}))}const mt=u.forwardRef(dt);function ct({title:b,titleId:w,...E},k){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:k,"aria-labelledby":w},E),b?u.createElement("title",{id:w},b):null,u.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const ue=u.forwardRef(ct),ut=({competitions:b,selectedGroupFilter:w,selectedParticipantType:E,currentUser:k,updateParticipantLocal:D,usersList:A,participantsList:B,setParticipantFilter:xe})=>{console.log({competitions:b});const[J,q]=u.useState(!1),[Y,Z]=u.useState([]),[X,I]=u.useState([]),[ae,z]=u.useState(new Set),[qe,fe]=u.useState([]),[K,he]=u.useState(1),[Ze,pe]=u.useState(!1),ie=u.useRef(!1),{eventLevels:je}=Ve();et();const[S,Q]=u.useState(null),we=({title:t,description:s,confirmButtonLabel:i,cancelButtonLabel:r,showConfirmAllButton:n})=>new Promise(a=>{Q({title:t,description:s,confirmButtonLabel:i,cancelButtonLabel:r,showConfirmAllButton:n,onConfirm:()=>{Q(null),a(!0)},onConfirmAll:()=>{Q(null),a("confirmAll")},onCancel:()=>{Q(null),a(!1)}})}),x={USER_NAME:"UserName",IDENTITY_NUMBER:"IdentityNumber",REGISTRATION_ID:"RegistrationId",GROUP_NAME:"GroupName",USER_DOB:"UserDob",USER_GENDER:"UserGender",USER_PHONE:"UserPhone",USER_MOBILE:"UserMobile",USER_EMAIL:"UserEmail",USER_PROFILE_PICTURE:"UserProfilePicture"},R=(je||[]).slice(1).map(t=>`${t.LevelName}Name`),U=[x.USER_NAME,x.IDENTITY_NUMBER,x.REGISTRATION_ID,...w?[]:[x.GROUP_NAME],x.USER_DOB,x.USER_GENDER,...R,x.USER_PHONE,x.USER_MOBILE,x.USER_EMAIL,x.USER_PROFILE_PICTURE,...b.map(t=>t.Title)],V=R.length>0?R.join(", "):null;(()=>{const t={};return[].forEach(i=>{const r=i.CompetitionName?.toLowerCase().replace(/[^a-z0-9]/g,"");r&&(t[r]||(t[r]=[]),t[r].push({CompetitionStructureId:i.CompetitionStructureId,CompetitionName:i.CompetitionName,GroupName:i.GroupName,GenderName:i.GenderName,LanguageName:i.LanguageName,EventGroupId:i.EventGroupId}))}),t})();const H=t=>!A||A.length===0?null:A.find(i=>(E==2?i.TeamTeamName:i.UserName)?.toLowerCase().trim()===t.name?.toLowerCase().trim()?R.every(o=>{const d=i.LevelSettings?.[o]||i[o],m=t[o];return d?.toLowerCase().trim()===m?.toLowerCase().trim()}):!1),te=(t,s)=>{if(!B||B.length===0)return!1;const i=H(t);if(!i)return!1;const r=E==2?i.Team||i.TeamId:i.Candidate||i.UserRoleId;return r?B.some(a=>a.Competition===s.toString()&&a.Candidate===r.toString()):!1},oe=t=>H(t)?!t.participations||Object.keys(t.participations).length===0?!0:Object.keys(t.participations).every(r=>{const n=t.participations[r];return!n||!n.CompetitionStructureId?!0:te(t,n.CompetitionStructureId)}):!1,F=t=>t?.toLowerCase().replace(/[^a-z0-9]/g,"")||"",le=(t,s)=>{const i=F(s);return t.findIndex(r=>F(r)===i)},se=(t,s)=>{const i=U.map(a=>le(t,a)),r=U.map((a,o)=>{const d=i[o];return d>=0?t[d]:a}),n=s.map(a=>U.map((o,d)=>{const m=i[d];return m>=0&&a[m]!==void 0&&a[m]||""}));return{headers:r,data:n,mapping:i}},_=t=>{(t.target.innerText||t.target.textContent||"").trim()||(I([]),Z([]),z(new Set),fe([]))},W=t=>{const s=t.clipboardData.getData("text");if(!s.trim()){I([]),Z([]);return}const r=s.split(`
`).filter(C=>C.trim()).map(C=>C.split("	").map(h=>h.trim()));if(r.length===0){v.error("No data found in pasted content");return}let n=[],a=[];const o=r[0],d=o.length>=3&&(F(o[0]).includes("username")||F(o[0]).includes("name"));d?(n=o,a=r.slice(1)):(n=U,a=r);const{headers:m,data:g,mapping:f}=se(n,a);if(m.length!==U.length){v.error(`Header mismatch: Expected ${U.length} columns, got ${m.length}`);return}const N=[m,...g];if(N.length===0||N[0].length!==U.length){v.error(`Invalid data structure: First row must have ${U.length} columns`);return}if(Z(N),d){const C=f.filter(L=>L<0),h=f.filter(L=>L>=0);if(C.length===0&&h.length>0)v.success(`Columns automatically reordered to match expected format (${h.join(", ")} columns matched)`);else if(C.length>0&&h.length>0)v.success(`${h.length} column(s) matched, ${C.join(", ")} column(s) will use empty values`);else if(h.length===0&&C.length>0){v.error("No columns matched. Please check your column headers.");return}}else{v.error("No headers detected. We are assuming data must contain all expected columns.");return}setTimeout(()=>{l(m,g)},0)},Ee=async t=>{const s=t.target.files?.[0];if(!s)return;const i=s.name.split(".").pop()?.toLowerCase();if(i==="csv"){const a=(await s.text()).split(`
`).filter(h=>h.trim()).map(h=>{const L=h.includes("	")?"	":h.includes(";")?";":",";return h.split(L).map(ce=>ce.trim().replace(/^"|"$/g,""))});if(a.length===0){v.error("No data found in CSV file");return}const o=a[0],d=a.slice(1),{headers:m,data:g,mapping:f}=se(o,d);if(m.length!==U.length){v.error(`Header mismatch: Expected ${U.length} columns, got ${m.length}`);return}const N=[m,...g];Z(N);const C=f.filter(h=>h>=0).length;v.success(`CSV uploaded successfully (${C} columns matched)`),setTimeout(()=>{l(m,g)},0)}else i==="xlsx"||i==="xls"?v.info("Excel file upload coming soon. For now, please use CSV or copy-paste from Excel."):v.error("Unsupported file format. Please upload CSV or Excel (.xlsx, .xls) files.");t.target.value=""},Ce=t=>!t||t.trim()===""?{valid:!0,error:null}:(t.match(/[a-zA-Z]/g)||[]).length<3?{valid:!1,error:"Name must have at least 3 letters"}:{valid:!0,error:null},ge=t=>!t||t.trim()===""?{valid:!0,error:null}:(t.match(/\d/g)||[]).length<5?{valid:!1,error:"Phone must have at least 5 digits"}:{valid:!0,error:null},de=t=>!t||t.trim()===""?{valid:!1,error:"This field is required and cannot be empty"}:t.trim().length<3?{valid:!1,error:"Must have at least 3 characters"}:{valid:!0,error:null},me=(t,s,i)=>{const r=String(t).padStart(2,"0"),n=String(s).padStart(2,"0"),a=String(i);return`${r}-${n}-${a}`},$=t=>{if(!t||t.trim()==="")return{valid:!0,error:null,formattedDate:null};const s=t.trim();if(s.includes("-")){const i=s.split("-");if(i.length!==3)return{valid:!1,error:"Date with - must have format: YYYY-MM-DD or DD-MM-YYYY"};const[r,n,a]=i.map(f=>parseInt(f,10));if(isNaN(r)||isNaN(n)||isNaN(a))return{valid:!1,error:"Date parts must be valid numbers"};let o,d,m;if(r>31?(o=r,d=n,m=a):(m=r,d=n,o=a),o<1900||o>2100)return{valid:!1,error:"Year must be between 1900 and 2100"};if(d<1||d>12)return{valid:!1,error:"Month must be between 1 and 12"};if(m<1||m>31)return{valid:!1,error:"Day must be between 1 and 31"};const g=new Date(o,d-1,m);return g.getMonth()!==d-1||g.getDate()!==m?{valid:!1,error:"Invalid day for the given month"}:{valid:!0,error:null,formattedDate:me(m,d,o)}}else if(s.includes("/")){const i=s.split("/");if(i.length!==3)return{valid:!1,error:"Date with / must have format: DD/MM/YYYY or MM/DD/YYYY"};const[r,n,a]=i.map(f=>parseInt(f,10));if(isNaN(r)||isNaN(n)||isNaN(a))return{valid:!1,error:"Date parts must be valid numbers"};let o,d,m;if(r>12?(o=r,d=n,m=a):n>12?(d=r,o=n,m=a):(o=r,d=n,m=a),m<1900||m>2100)return{valid:!1,error:"Year must be between 1900 and 2100"};if(d<1||d>12)return{valid:!1,error:"Month must be between 1 and 12"};if(o<1||o>31)return{valid:!1,error:"Day must be between 1 and 31"};const g=new Date(m,d-1,o);return g.getMonth()!==d-1||g.getDate()!==o?{valid:!1,error:"Invalid day for the given month"}:{valid:!0,error:null,formattedDate:me(o,d,m)}}else return{valid:!1,error:"Date must contain / or - separator"}},Ie=t=>!t||t.trim()===""?{valid:!0,error:null}:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim())?{valid:!0,error:null}:{valid:!1,error:"Invalid email format"},Se=t=>{if(!t||t.trim()==="")return{valid:!0,error:null};const s=t.trim().toLowerCase();return s!=="male"&&s!=="female"?{valid:!1,error:"Gender must be 'Male' or 'Female'"}:{valid:!0,error:null}},l=(t,s)=>{if(!s||s.length===0)return;const i=[],r=[],n=T=>U.indexOf(T),a=n(x.USER_NAME),o=n(x.IDENTITY_NUMBER),d=n(x.REGISTRATION_ID),m=n(x.GROUP_NAME),g=n(x.USER_DOB),f=n(x.USER_GENDER),N=n(x.USER_PHONE),C=n(x.USER_MOBILE),h=n(x.USER_EMAIL),L=n(x.USER_PROFILE_PICTURE),ce=R.map(T=>n(T));b.length>0?n(b[0]?.Title):U.length;for(let T=0;T<s.length;T++){const y=s[T];if(y.length<3)continue;const j=[],P=T+2,Re=a>=0?y[a]||"":y[0]||"",Ne=o>=0&&y[o]||"",be=d>=0&&y[d]||"",Ue=m>=0&&y[m]||"",Me=N>=0&&y[N]||"",De=C>=0&&y[C]||"",Pe=h>=0&&y[h]||"",$e=g>=0&&y[g]||"",Le=f>=0&&y[f]||"",ve=L>=0&&y[L]||"",Te=Ce(Re);if(Te.valid||j.push(`Row ${P} (Name): ${Te.error}`),Ne&&Ne.trim()===""&&j.push(`Row ${P} (IdentityNumber): Cannot be empty whitespace`),be&&be.trim()===""&&j.push(`Row ${P} (RegistrationId): Cannot be empty whitespace`),!w){const M=de(Ue);M.valid||j.push(`Row ${P} (GroupName): ${M.error}`)}const ke=ge(Me);ke.valid||j.push(`Row ${P} (Phone): ${ke.error}`);const Ae=ge(De);Ae.valid||j.push(`Row ${P} (Mobile): ${Ae.error}`);const _e=Ie(Pe);_e.valid||j.push(`Row ${P} (Email): ${_e.error}`);const re=$($e);re.valid||j.push(`Row ${P} (DOB): ${re.error}`);const Xe=re.valid&&re.formattedDate?re.formattedDate:$e,Oe=Se(Le);Oe.valid||j.push(`Row ${P} (Gender): ${Oe.error}`),ve&&ve.trim()===""&&j.push(`Row ${P} (ProfilePicture): Cannot be empty whitespace`),ce.forEach((M,G)=>{if(M>=0){const Qe=y[M]||"",Ye=de(Qe);Ye.valid||j.push(`Row ${P} (${R[G]}): ${Ye.error}`)}}),j.length>0&&r.push(...j);const Ge={};ce.forEach((M,G)=>{M>=0&&(Ge[R[G]]=y[M]||"")});const Be={};b.forEach(M=>{const G=n(M.Title);G>=0&&y[G]&&(Be[M.Title]={value:y[G],CompetitionStructureId:M.CompetitionStructureId,Title:M.Title})});const Ke={name:Re,identityNumber:Ne,registrationId:be,groupName:Ue,dob:Xe,gender:Le,phone:Me,mobile:De,email:Pe,profilePicture:ve,...Ge,rowIndex:T,status:j.length>0?"error":"pending",error:j.length>0?j.join("; "):null,participations:Be};i.push(Ke)}if(r.length>0){const y=r.slice(0,10).join(`
`),j=r.length>10?`
...and ${r.length-10} more issues`:"";v.error(`Data validation issues found:
${y}${j}`,{duration:8e3})}I(i)},c=t=>{const s=[];s.push(`Name: ${t.name||"-"}`),t.identityNumber&&s.push(`Identity Number: ${t.identityNumber}`),t.registrationId&&s.push(`Registration ID: ${t.registrationId}`),t.groupName&&s.push(`Group: ${t.groupName}`),t.dob&&s.push(`Date of Birth: ${t.dob}`),t.gender&&s.push(`Gender: ${t.gender}`),R.forEach(r=>{t[r]&&s.push(`${r}: ${t[r]}`)}),t.phone&&s.push(`Phone: ${t.phone}`),t.mobile&&s.push(`Mobile: ${t.mobile}`),t.email&&s.push(`Email: ${t.email}`);const i=b.filter(r=>t.participations?.[r.Title]).map(r=>{const n=t.participations[r.Title];return`${r.Title} (ID: ${r.CompetitionStructureId}) - Value: ${n.value}`});return i.length>0&&(s.push(`
Competitions:`),i.forEach(r=>{s.push(`  • ${r}`)})),s.join(`
`)},p=async(t,s,i=!1)=>{if(!ie.current&&!i){const r=await we({title:`Import Participant ${s+1} of ${X.length}`,description:c(t),confirmButtonLabel:"Import",cancelButtonLabel:"Skip",showConfirmAllButton:!0});if(r==="confirmAll")ie.current=!0,pe(!0);else if(!r){I(n=>n.map((a,o)=>o===s?{...a,status:"skipped"}:a));return}}z(r=>new Set(r).add(s)),I(r=>r.map((n,a)=>a===s?{...n,status:"importing"}:n));try{const r={};R.forEach(f=>{if(t[f])r[f]=t[f];else{v.error(`Missing value for mandatory organization level: ${f}`);return}});const n=[];t.participations&&Object.keys(t.participations).forEach(f=>{const N=t.participations[f];N&&N.CompetitionStructureId&&n.push(N.CompetitionStructureId)});const a={};R.forEach(f=>{t[f]&&(a[f]=t[f])});const o=H(t),d=o?E==2?o.Team||o.TeamId:o.Candidate||o.UserRoleId:null,m={isImport:!0,EventCategory:k?.EventCategory,Event:k?.Event,ParticipantType:E,Group:w,CompetitionParticipantsModel:{CompetitionList:n},...E==1?{"UsersModel[UserName]":t.name,"UsersModel[UserDobString]":t.dob,"UsersModel[UserGender]":t.gender,"UsersModel[UserPhone]":t.phone,"UsersModel[UserMobile]":t.mobile,"UsersModel[UserEmail]":t.email,"UsersModel[UserImage]":t.profilePicture||"","UsersModel[CandidateIdentityNumber]":t.identityNumber,"UsersModel[RegistrationId]":t.registrationId,...d?{"UsersModel[Candidate]":d}:{}}:{"UsersModel[TeamTeamName]":t.name,"UsersModel[TeamIdentityNumber]":t.identityNumber,"UsersModel[RegistrationId]":t.registrationId,...d?{"UsersModel[Candidate]":d,"UsersModel[TeamId]":d,"UsersModel[Team]":d}:{}},...E==1?Object.keys(a).reduce((f,N)=>(f[`UsersRolesModel[LevelSettings][${N}]`]=a[N],f),{}):Object.keys(a).reduce((f,N)=>(f[`TeamModel[LevelSettings][${N}]`]=a[N],f),{})},{data:g}=await tt("/CoordinatorJson/SaveParticipants",m);if(g){const f=g.split(","),N=parseInt(f[0]);if(N)I(C=>C.map((h,L)=>L===s?(console.log("Preserving participations:",h.participations),{...h,status:"success",savedParticipantId:N,participations:h.participations}):h)),v.success(`Participant ${s+1} imported successfully`);else throw new Error("Invalid response from server")}else throw new Error("No response from server");xe({refreshToggle:new Date().getTime()})}catch(r){console.error("Error importing participant:",r),I(n=>n.map((a,o)=>o===s?{...a,status:"error",error:r.message||"Import failed"}:a)),v.error(`Failed to import participant ${s+1}: ${r.message}`)}finally{z(r=>{const n=new Set(r);return n.delete(s),n})}},O=async()=>{let t=0,s=0,i=0,r=0;I(n=>((async()=>{for(let o=0;o<n.length;o++){const d=n[o];if(oe(d)){r++;continue}(d.status==="pending"||d.status==="error")&&(await p(d,o),I(m=>{const g=m[o];return g.status==="success"?t++:g.status==="skipped"?s++:g.status==="error"&&i++,m}),o<n.length-1&&await new Promise(m=>setTimeout(m,500)))}const a=[];t>0&&a.push(`${t} imported`),r>0&&a.push(`${r} already exist`),s>0&&a.push(`${s} skipped`),i>0&&a.push(`${i} failed`),t>0?v.success(`Import completed: ${a.join(", ")}`):v.info(`Import completed: ${a.join(", ")}`),ie.current=!1,pe(!1)})(),n))};return e.jsxs(e.Fragment,{children:[S&&e.jsxs(He,{open:!0,onClose:S.onCancel,className:"relative z-50",children:[e.jsx(Fe,{className:"fixed inset-0 bg-gray-500/75 transition-opacity"}),e.jsx("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-end justify-center p-3 text-center sm:items-center sm:p-0",children:e.jsxs(We,{className:"relative transform overflow-hidden rounded-lg bg-white px-3 pb-3 pt-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-4",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex size-10 shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:size-9",children:e.jsx(ue,{"aria-hidden":"true",className:"size-5 text-blue-600"})}),e.jsxs("div",{className:"mt-2 text-center sm:ml-3 sm:mt-0 sm:text-left flex-1",children:[e.jsx(Je,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900 mb-2",children:S.title}),e.jsx("div",{className:"mt-2 overflow-y-auto",children:e.jsx("div",{className:"text-xs leading-relaxed text-gray-700 space-y-1",children:S.description.split(`
`).map((t,s)=>{if(t.trim()==="")return e.jsx("div",{className:"h-2"},s);if(t.trim().startsWith("•"))return e.jsxs("div",{className:"flex gap-2 pl-2",children:[e.jsx("span",{className:"text-primary font-medium",children:"•"}),e.jsx("span",{className:"flex-1",children:t.trim().substring(1).trim()})]},s);if(t.includes(":")){const[i,...r]=t.split(":"),n=r.join(":").trim();return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-900 min-w-fit",children:[i.trim(),":"]}),e.jsx("span",{className:"text-gray-700",children:n})]},s)}return e.jsx("div",{className:"font-medium text-gray-900",children:t},s)})})})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-5 sm:flex sm:flex-row-reverse gap-2",children:[e.jsx("button",{type:"button",onClick:S.onConfirm,className:"inline-flex w-full justify-center rounded-md bg-primary px-4 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary sm:w-auto",children:S.confirmButtonLabel||"Confirm"}),S.showConfirmAllButton&&e.jsx("button",{type:"button",onClick:S.onConfirmAll,className:"inline-flex w-full justify-center rounded-md bg-green-600 px-4 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600 sm:w-auto",children:"Confirm All"}),e.jsx("button",{type:"button",onClick:S.onCancel,className:"mt-2 inline-flex w-full justify-center rounded-md bg-gray-200 px-4 py-1.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary sm:mt-0 sm:w-auto",children:S.cancelButtonLabel||"Cancel"})]})]})})})]}),e.jsxs("button",{onClick:()=>q(!J),className:"inline-flex items-center gap-x-1.5 rounded-md bg-primary px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover",children:[e.jsx(ue,{className:"h-4 w-4"}),"Excel Import",J?e.jsx(mt,{className:"h-4 w-4 ml-2"}):e.jsx(at,{className:"h-4 w-4 ml-2"})]}),J&&e.jsxs("div",{className:"mt-2 p-3 bg-white rounded-lg w-full shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base font-medium leading-5 text-gray-900",children:"Excel Import - Paste from Google Sheets"}),e.jsx("button",{onClick:()=>q(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1 text-sm",children:"Instructions:"}),e.jsxs("ol",{className:"text-xs text-blue-800 space-y-0.5",children:[e.jsxs("li",{children:["1. ",e.jsx("strong",{children:"Option A:"})," Upload CSV or Excel file using the file input below"]}),e.jsxs("li",{children:["2. ",e.jsx("strong",{children:"Option B:"})," Copy the entire table from Google Sheets (including headers) and paste in the text area"]}),e.jsxs("li",{children:["3. Columns will be ",e.jsx("strong",{children:"automatically reordered"})," to match required format"]}),e.jsx("li",{children:"4. Review the parsed data in the table below"}),e.jsx("li",{children:'5. Click "Import to List" to save participants and their participations'})]}),e.jsxs("div",{className:"mt-2 p-2 bg-white rounded border border-blue-200",children:[e.jsx("div",{className:"text-xs font-medium text-blue-900 mb-1",children:"Required Columns (any order in Excel):"}),e.jsxs("div",{className:"text-xs text-gray-700 space-y-0.5",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Base Fields:"})," ",[x.USER_NAME,x.IDENTITY_NUMBER,x.REGISTRATION_ID,...w?[]:[x.GROUP_NAME],x.USER_DOB,x.USER_GENDER].join(", ")]}),V&&e.jsxs("div",{children:[e.jsx("strong",{children:"Organization Levels:"})," ",V]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",[x.USER_PHONE,x.USER_MOBILE,x.USER_EMAIL,x.USER_PROFILE_PICTURE].join(", ")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Competitions: "}),b.length>0?b.map(t=>t.Title).join(", "):"None"]})]})]}),e.jsxs("div",{className:"mt-1 text-xs text-blue-600 flex items-start gap-1",children:[e.jsx(lt,{className:"h-3 w-3 flex-shrink-0 mt-0.5 text-green-600"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-medium text-green-700",children:"✓ Columns can be in any order - system will automatically reorder them!"}),!w&&e.jsx("div",{children:"No group filter selected: Include GroupName column to specify group per participant."}),e.jsx("div",{children:"Group auto-detection: System will detect group from DOB (age range) if not specified."})]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Min Similarity"}),e.jsxs("select",{value:K,onChange:t=>he(parseInt(t.target.value)),className:"form-control text-sm py-1",children:[e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Upload CSV/Excel File (Recommended for large data)"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:Ee,className:"block w-full text-xs text-gray-900 border border-gray-300 rounded-md cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent file:mr-2 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-primary file:text-white hover:file:bg-primaryHover"})}),e.jsx("p",{className:"mt-0.5 text-xs text-gray-500",children:"Supported formats: CSV, Excel (.xlsx, .xls). Much faster than paste for large datasets."})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-xs",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"OR"})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Paste Excel Data Here (Alternative)"}),e.jsx("div",{contentEditable:!0,onPaste:W,onInput:_,className:"w-full h-24 border border-gray-300 rounded-md p-2 overflow-x-auto overflow-y-auto text-xs bg-gray-50 focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Paste your Excel data here...",style:{minHeight:"6rem",maxHeight:"20rem"}}),e.jsx("p",{className:"mt-0.5 text-xs text-gray-500",children:"Scrollable area - supports horizontal scrolling for wide data. Clear this area to reset."})]}),X.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:["Parsed Participants (",X.length,")"]}),e.jsxs("button",{onClick:O,disabled:ae.size>0,className:"inline-flex items-center gap-x-1.5 rounded-md bg-primary px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-primaryHover disabled:opacity-50",children:[ae.size>0?e.jsx(ze,{className:"h-3 w-3 animate-spin"}):e.jsx(ue,{className:"h-3 w-3"}),"Import to List"]})]}),e.jsx("div",{className:"overflow-x-auto overflow-y-auto border border-gray-200 rounded-lg shadow-sm ",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 table-auto text-xs",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Actions"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Status"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Name"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Identity No"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Reg ID"}),!w&&e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Group"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"DoB"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Gender"}),R.map((t,s)=>e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:t},s)),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Phone"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Mobile"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Email"}),e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Profile Pic"}),b.map((t,s)=>e.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:[t.CompetitionOrder," - ",t.Title]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["ID: ",t.CompetitionStructureId]})]})},s))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.map((t,s)=>{const i=oe(t),r=H(t);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-1 py-1 ",children:[(t.status==="pending"||t.status==="error")&&!i&&e.jsxs("button",{onClick:()=>p(t,s),disabled:ae.has(s),className:"inline-flex items-center gap-x-1 rounded-md bg-primary px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-primaryHover disabled:opacity-50 disabled:cursor-not-allowed",title:r?"Import additional competitions":"Import this participant",children:[e.jsx(ue,{className:"h-3 w-3"}),r?"Import Comps":"Import"]}),i&&t.status==="pending"&&e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Fully Imported"}),t.status==="success"&&e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Imported"}),t.status==="importing"&&e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Importing..."}),t.status==="skipped"&&e.jsx("span",{className:"text-xs text-yellow-600 font-medium",children:"Skipped"})]}),e.jsxs("td",{className:"px-1 py-1 ",children:[t.status==="success"&&e.jsx(ne,{className:"h-5 w-5 text-white bg-green-500 rounded-full p-0.5",title:"Imported successfully"}),t.status==="error"&&e.jsx(ye,{className:"h-5 w-5 text-red-500",title:t.error||"Import failed"}),t.status==="importing"&&e.jsx(ze,{className:"h-5 w-5 text-blue-500 animate-spin",title:"Importing..."}),t.status==="skipped"&&e.jsx(ye,{className:"h-5 w-5 text-yellow-500",title:"Skipped by user"}),t.status==="pending"&&e.jsx(e.Fragment,{children:i?e.jsx(ne,{className:"h-5 w-5 text-white bg-green-500 rounded-full p-0.5",title:"Participant and all competitions already imported"}):r?e.jsx(ne,{className:"h-5 w-5 text-white bg-yellow-500 rounded-full p-0.5",title:"Participant exists, but some competitions not assigned"}):e.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-gray-300",title:"Pending import"})})]}),e.jsx("td",{className:"px-1 py-1 text-xs font-medium text-gray-900  max-w-24 overflow-hidden text-ellipsis",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.name||"-"}),r&&e.jsx(ne,{className:"h-4 w-4 text-white bg-green-500 rounded-full p-0.5 flex-shrink-0",title:"Participant already exists in server"})]})}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.identityNumber||"-"}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.registrationId||"-"}),!w&&e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.groupName||"-"}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 whitespace-nowrap",children:t.dob||"-"}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.gender||"-"}),R.map((n,a)=>e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 max-w-24 overflow-hidden text-ellipsis",children:t[n]||"-"},a)),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.phone||"-"}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.mobile||"-"}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.email||"-"}),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.profilePicture?e.jsx("a",{href:t.profilePicture,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:"View"}):"-"}),b.map((n,a)=>{const o=t.participations?.[n.Title],d=te(t,n.CompetitionStructureId);return a===0&&(console.log(`Row ${s} - Participations:`,t.participations),console.log(`Row ${s} - Competition ${n.Title}:`,o)),e.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:o?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-xs text-gray-700 whitespace-nowrap",children:["ID: ",n.CompetitionStructureId]}),d&&e.jsx(ne,{className:"h-4 w-4 text-white bg-green-500 rounded-full p-0.5 flex-shrink-0",title:"Competition already assigned in server"})]}):e.jsx("span",{children:"-"})},a)})]},s)})})]})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Table is scrollable both horizontally and vertically - showing all imported columns"})]})]})]})},It=({onEdit:b,onView:w,onDelete:E,onTeamManage:k,selectedGroupFilter:D,selectedParticipantType:A,selectedOrganization:B,pageSize:xe,currentPage:J,filterCriterias:q,currentUser:Y,onAssignmentChange:Z,onPageChange:X,selectedOrganizations:I,onClearFilters:ae})=>{const{groups:z}=Ve(),[qe,fe]=u.useState(384),[K,he]=u.useState(!1),[Ze,pe]=u.useState(null),[ie,je]=u.useState({competitionId:null,candidateId:null}),[S,Q]=u.useState(null),[we,x]=u.useState(new Set),[R,U]=u.useState(null);u.useRef(null);const V=u.useRef(null),{row:ee,status:H,setFilter:te,updateLocal:oe,delete:F}=st("/CoordinatorJson/GetParticipants",{select:"participantList,userList,UserEmail,UserName,UserDobString,UserImage,UserMobile,UserPhone,Email,Group,Candidate,CandidateUser,JsonSettings,Gender,GroupName,GenderName,LanguageName,Fees,TeamTeamName,Team,TeamStrength,TeamMembersList,TeamMembers,TeamStrength,CandidateIdentityNumber,TeamIdentityNumber,CompetitionOrder,CreatedBy,CreatedByUserName,ParticipantId,UserJsonSettings,TeamJsonSettings,Remarks,LevelSettings,RegistrationId,UniqueCandidateId,UniqueTeamId,CreatedDate,ModifiedDate,CreatedByEmail,CreatedByMobile,Order",filter:{EventCategory:Y?.EventCategory,Event:Y?.Event},limit:1e5,offset:(J-1)*xe,updateUrl:"/CoordinatorJson/SaveParticipants",deleteUrl:"/CompetitionParticipantsJson/Remove",noGet:!0});let le=ee?.ParticipantsList||[];const se=ee?.UsersList||[],_=ee?.Competitions||[],W=ee?.OrganizationLevels||[];(()=>{const l={};return _.forEach(c=>{const p=c.CompetitionName?.toLowerCase().replace(/[^a-z0-9]/g,"");p&&(l[p]||(l[p]=[]),l[p].push({CompetitionStructureId:c.CompetitionStructureId,CompetitionName:c.CompetitionName,GroupName:c.GroupName,GenderName:c.GenderName,LanguageName:c.LanguageName,EventGroupId:c.EventGroupId}))}),l})(),(()=>{const l=[];l.push("UserName"),l.push("IdentityNumber"),l.push("RegistrationId"),D||l.push("GroupName"),l.push("UserDob"),l.push("UserGender"),(W||[]).forEach((t,s)=>{s!==0&&l.push(`Level_${t.LevelName}Name`)}),l.push("UserPhone"),l.push("UserMobile"),l.push("UserEmail"),l.push("UserProfilePicture");let p=[];D?p=_.filter(t=>t.EventGroupId===D||t.Group===D).map(t=>t.CompetitionName):p=_.map(t=>t.CompetitionName);const O=[...new Set(p)].filter(Boolean);return l.push(...O),l})(),(()=>{const l=W||[],c=[];if(l.forEach((O,t)=>{t!==0&&c.push(`${O.LevelName}Name`)}),c.length===0)return"";if(c.length===1)return c[0];const p=c.pop();return c.join(", ")+" and "+p})(),se.map(l=>{const c=le.filter(p=>l.Team>0?p.Team===l.Team.toString()||p.Candidate===l.Team.toString():l.Candidate>0?p.Candidate===l.Candidate.toString():!1);return{...l,participations:c}});let de=JSON.stringify(q);u.useEffect(()=>{if(A&&D){let l={};I&&I.length>0&&I.forEach(c=>{l={...l,...c}}),te({EventCategory:Y?.EventCategory,Event:Y?.Event,ParticipantType:A,Group:D,OrganizationId:B||void 0,AgeFrom:z?.find(c=>c.EventGroupId===D)?.AgeFrom,AgeTo:z?.find(c=>c.EventGroupId===D)?.AgeTo,...q||{},...l},!0)}},[A,D,B,de]),u.useEffect(()=>{const l=p=>{if(!K||!V.current)return;const O=V.current.getBoundingClientRect(),t=O.right-p.clientX,s=280,i=Array.isArray(W)?W.length:0,r=i>0?Math.max(s,i*120):O.width*.6;t>=s&&t<=r&&fe(t)},c=()=>{he(!1)};return K&&(document.addEventListener("mousemove",l),document.addEventListener("mouseup",c)),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c)}},[K]),u.useCallback((l,c)=>l.participations?l.participations.some(p=>p.Competition===c):!1,[]);const[me]=nt(),[$,Ie]=u.useState(null);return H!=="finished"?e.jsx(rt,{info:"Loading participants...",className:"h-64"}):!D||!A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-sm text-gray-600",children:"Please select a group and participant type."})})}):e.jsxs("div",{ref:V,className:"flex-1 flex overflow-hidden",children:[e.jsx(me,{title:"Delete Participant",description:"Are you sure you want to delete this participant?",confirmButtonLabel:"Delete",confirmButtonClick:async l=>{try{await F(l),v.success("Participant Deleted Successfully"),typeof E=="function"&&E(l)}catch{v.error("Failed to delete participant")}},className:"w-96 print:hidden"}),$&&e.jsxs(He,{open:!0,onClose:$.onCancel,className:"relative z-50",children:[e.jsx(Fe,{className:"fixed inset-0 bg-gray-500/75 transition-opacity"}),e.jsx("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsxs(We,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10",children:e.jsx(it,{"aria-hidden":"true",className:"size-6 text-red-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx(Je,{as:"h3",className:"text-base font-semibold text-gray-900",children:$.title}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:$.message})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:$.onConfirm,className:"inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto",children:$.confirmText}),e.jsx("button",{type:"button",onClick:$.onCancel,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:$.cancelText})]})]})})})]}),e.jsx("style",{children:`
        table:has(th.competition-header:hover) tbody tr td:nth-child(n+5) {
          background-color: transparent;
        }
        ${_?.map((l,c)=>`
          table:has(th.competition-header:nth-child(${c+5}):hover) tbody tr td:nth-child(${c+5}) {
            background-color: rgb(219 234 254) !important;
          }
        `).join("")}

        ${S?_?.map((l,c)=>l.CompetitionStructureId===S?`tbody tr td:nth-child(${c+5}) {
                    background-color: rgb(191 219 254) !important;
                  }`:"").join(""):""}
      `}),e.jsx("div",{className:"flex-1 overflow-hidden bg-white",children:e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"px-2 py-2 border-b border-gray-200",children:e.jsx("div",{className:"flex flex-col items-center justify-between",children:e.jsx(ut,{usersList:se,setParticipantFilter:te,participantsList:le,competitions:_,selectedGroupFilter:D,selectedParticipantType:A,currentUser:Y,updateParticipantLocal:oe})})})})})]})};export{It as default};
