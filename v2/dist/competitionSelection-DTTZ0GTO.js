import{o as se,r as J,j as e,R as oe,_ as le,i as I,p as ne,c as de,f as ee}from"./main-pxHJVgAj.js";import{M as ce}from"./index.modern-C5RzyvPV.js";import{u as me}from"./index.esm-9pHF3yrR.js";import{B as pe}from"./box-DYBuPXzb.js";import{F as ue}from"./PencilIcon-BAVMqIEE.js";import{F as ge}from"./XMarkIcon-Ef4lkw0A.js";import{F as fe}from"./CheckIcon-BFFlxrJT.js";import{F as xe}from"./PlusIcon-D4nqOvsW.js";const he=oe.lazy(()=>le(()=>import("./renderComponents-EghwnrFz.js"),[]));function Ce({item:q,competitionStructureId:W,eventDetails:$,participantsList:U,formData:_,participantId:H,candidateId:p}){const{register:O,control:K,errors:P,handleSubmit:Q,setValue:S,getValues:Y}=me({defaultValues:{customCompetitionFields:[]}});let D=U.find(i=>i.CandidateId==p&&i.Competition==W);const T=se(q?.JsonSettings),X=T?.AdditionalTextFieldsForPubRegForm||[],F=T?.AdditionalTextFieldsMaxLength||1/0,L=T?.AdditionalTextFieldsMinLength||1;let c=se(D?.JsonSettings)?.customCompetitionFields||[];const j=X.map(i=>({key:i.FieldName.replace(/\s+/g,"_").toLowerCase(),label:i.FieldName,name:`customCompetitionFields[0].${i.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:i.FieldType?.toLowerCase()||"text",isRequired:i.IsRequired?.toLowerCase()==="yes",conditions:[],options:[],placeholder:"",defaultValue:""})),[h,R]=J.useState([{id:Date.now(),values:{},fields:[...j],disabled:!1}]);J.useEffect(()=>{if(c.length>0){let i=[],m=c.map((N,v)=>{let d={},w={};return j.forEach(l=>{d[`customCompetitionFields[${v}].${l.key}`]=N?.[l.key],w[l.key]=N?.[l.key]}),i.push(w),{id:Date.now()+v,values:d,fields:j.map(l=>({...l,name:`customCompetitionFields[${v}].${l.key}`})),disabled:!0}});S("customCompetitionFields",i),R(m)}},[]);const z=()=>{if(h.length>=F){I.error(`You can add a maximum of ${F} rows.`);return}R(i=>[...i,{id:Date.now(),values:{},fields:j.map(m=>({...m,name:`customCompetitionFields[${i.length}].${m.key}`})),disabled:!1}])},Z=async i=>{let m=Y(),{candidate:N,customCompetitionFields:v}=m,d=h.findIndex(C=>C.id===i);const w=v[d];if(j.filter(C=>C.isRequired&&!w.values[C.name]).length>0){I.error("Please fill all required fields before adding a new row.");return}try{let C=U.find(s=>s.CandidateId==p&&s.Competition==W)?.ParticipantId;if(!C){I.error("Participant ID not found.");return}let te=await ne("/CandidateJson/UpdateParticipantJson",{participantId:C,candidateId:_?.candidate,JsonSettings:JSON.stringify(m)});I.success("Data saved successfully!");let t=h[d];t.disabled=!0,j.forEach(s=>{t.values[`customCompetitionFields[${d}].${s.key}`]=w[s.key]}),R([...h])}catch(C){console.error("Error updating participant JSON:",C),I.error("Failed to save data.")}},o=i=>{R(m=>m.map(N=>N.id===i?{...N,disabled:!1}:N))},E=i=>{if(h.length<=L){I.error(`You must have at least ${L} rows.`);return}R(l=>l.filter(C=>C.id!==i));let m=Y(),{candidate:N,customCompetitionFields:v}=m,d=h.findIndex(l=>l.id===i);v.splice(d,1),S("customCompetitionFields",v);let w=D?.ParticipantId;if(!w){I.error("Participant ID not found.");return}ne("/CandidateJson/UpdateParticipantJson",{participantId:w,candidateId:_?.candidate,JsonSettings:JSON.stringify(m)}).then(l=>{I.success("Data deleted successfully!")}).catch(l=>{console.error("Error updating participant JSON:",l),I.error("Failed to delete data.")})};let A=j.map(i=>i.label).join(", "),g=A.lastIndexOf(",");return g>-1&&(A=A.substring(0,g)+" and"+A.substring(g)),j.length>0&&D&&e.jsx(pe,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:"Please fill some additional inputs here, fields are "+A+" and minimum "+L+" and maximum "+F+" rows if items are required.",headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:"Additional Inputs",children:e.jsxs("div",{className:"flex flex-col flex-grow",children:[h.map(i=>e.jsxs("div",{className:"flex flex-row gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[e.jsx(he,{singleRow:!0,eventDetails:$,components:i.fields,errors:P,register:O,handleSelect:()=>{},control:K,setValue:S,getValues:Y,formData:i.values,isSubmitted:i.disabled,onChangeValue:(m,N)=>{R(v=>v.map(d=>d.id===i.id?{...d,values:{...d.values,[m]:N}}:d))}},i.id),e.jsx("div",{className:"flex items-baseline gap-x-2 print:hidden",children:i.disabled?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>o(i.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:e.jsx(ue,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+i.id),e.jsx("button",{type:"button",onClick:()=>E(i.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:e.jsx(ge,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+i.id)]}):e.jsx("button",{type:"button",onClick:()=>Z(i.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:e.jsx(fe,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+i.id)})]},i.id)),h.length<F&&e.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:e.jsx("button",{type:"button",onClick:z,disabled:h.length>=F,className:`rounded-full p-1.5 text-white shadow-sm ${h.length>=F?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:e.jsx(xe,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const we=({fieldName:q,label:W,errors:$,isGroupMandatory:U,participantType:_,setValue:H,formData:p,eventDetails:O,competitions:K,participantsList:P,onChange:Q,disabled:S,register:Y,control:D})=>{const{rows:T}=de("/CandidateJson/GetByAge",{sort:{sortOrder:"DESC",sortColumn:"id"},filter:{ParticipantType:p?.participantType=="Individual"?1:p?.participantType=="Team"?2:0,DobString:p?.userDobString},doCache:!0,select:"AgeFrom,AgeTo,EventGroupId,GroupName,Status"});let X=$?.[q],[F,L]=J.useState(X);J.useEffect(()=>{L($?.[q])},[$?.[q]]);let B=P?.map(t=>t.Competition)??[],[c,j]=J.useState(B);S&&(c=B);let h=B.join(",");J.useEffect(()=>{h&&B.length>0&&j(B)},[h]);let R=function(t){t.forEach(s=>{let a=`competitionCheckBox_${s.Competition}`,r=document.querySelector(`input[name='${a}']`);r&&(r.checked=!0,Q&&H(a,!0))})};J.useEffect(()=>{P?.length>0&&R(P)},[P]);var z=T?.filter(t=>{let s=t.JsonSettings;return!!(s&&(s=JSON.parse(s),s?.IsCommon=="Yes"))});let Z=z?.map(t=>t.EventGroupId),o=K??[];if(p?.group||U)o=o.filter(t=>S&&!c.find(s=>s==t.CompetitionStructureId)?!1:!!(t.Group==p?.group||Z?.find(s=>s==t.Group)));else{let t=[];o=o.filter(s=>!(t.find(a=>a.Title==s.Title)||(t.push(s),S&&!c.find(a=>a==s.CompetitionStructureId)))),o=t}p?.gender&&(o=o.filter(t=>{if(p?.gender=="Male"){if(t.Gender==1||t.Gender==3)return!0}else if(p?.gender=="Female"){if(t.Gender==2||t.Gender==3)return!0}else return!0;return!1}));const E=[],A=(t,s)=>{s.target.checked?c=[...c,t]:c=c.filter(r=>r!==t),j(c),Q(c)};let g=JSON.parse(O?.JsonSettings??"{}"),i=10;_=="Individual"?i=g?.AdditionalSettings?.MaximumParticipationPerCandidate??10:i=g?.AdditionalSettings?.MaximumParticipationPerGroup??10;let m=g?.AdditionalSettings?.FeesCurrency??"USD",N=g?.AdditionalSettings?.EnablePublicAndPrivateRegistration=="Yes",v=g?.AdditionalSettings?.UsePublicAndPrivateRegistrationByRegId=="Yes",d=g?.AdditionalSettings?.CustomMaxParticipationPerCandidate??[];if(o.length>0&&N&&!S)if(v){let t=g?.AdditionalSettings,s=g?.components?.User?.find(y=>y.type=="RegistrationIdBox"),r=t?.EligibleRegistrationNumbers?.find(y=>y.RegistrationNumber==(p?.registrationId??"-")),b=!1;if(s?.conditions){let y=!0;for(let n=0;n<s.conditions.length;n++){let u=s.conditions[n],f=u.key?.charAt(0)?.toLowerCase()+u.key?.slice(1);if(p[f]?.toString()!=u.value?.toString()){y=!1;break}}y?b=!0:b=!1}else b=!0;r&&b||(o=o.filter(y=>{if(y.AllowPublicRegistration!="2")return!0}))}else o=o.filter(t=>{if(t.AllowPublicRegistration!="2")return!0});let l=c.filter(t=>o.find(s=>s.CompetitionStructureId==t))?.length>=i;d.length>0&&_=="Individual"&&(l=!1);const C=[...new Set(o.map(t=>t.CompetitionCategoryName))],te=o.reduce((t,s)=>t.find(r=>r.CompetitionName===s.CompetitionName)?t:t.concat([s]),[]);return T?.forEach(t=>{C.forEach(s=>{let a=te.filter(n=>n.CompetitionCategoryName==s&&n.Group==t.EventGroupId),r={};if(r.CategoryName=s,r.CompetitionNames=[],a.forEach(n=>{let u=o.filter(x=>x.CompetitionCategoryName==s&&x.CompetitionName==n.CompetitionName),f={};f.CompetitionName=n.CompetitionName,f.competitions=u,r.CompetitionNames.push(f)}),d.length>0){let n=d.filter(k=>k.CompetitionCategoryId?.startsWith(s)),u=d.find(k=>k.CompetitionCategoryId==s),f=o.filter(k=>n.find(M=>M.CompetitionCategoryId==k.CompetitionCategoryName));var b=c.filter(k=>f.find(M=>M.CompetitionStructureId==k));let x=b.length>=(u?.MaxParticipation??1);if(x&&(r.isExceeded=x,r.MaxParticipation=u?.MaxParticipation??1),s.split("-").length>1){let k=s.split(" - ")[0],M=d.find(V=>V.CompetitionCategoryId==k),re=o.filter(V=>M.CompetitionCategoryId==V.CompetitionCategoryName);var y=c.filter(V=>re.find(ae=>ae.CompetitionStructureId==V));let ie=y.length+b.length>=(M?.MaxParticipation??1);ie&&(r.isExceeded=ie,r.MaxParticipation=M?.MaxParticipation??1)}}if(a.length>0){let n=a[0]?.GroupName;if(E.find(u=>u.GroupName==n))E.find(f=>f.GroupName==n).items.push(r);else{let u={GroupName:n,items:[r]};E.push(u)}}})}),e.jsx("div",{className:"mt-4  print:mt-0",children:e.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[E.length==0&&(p?.group?e.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}):e.jsx("div",{className:"text-orange-600 text-sm",children:"Please select a group to see competitions"})),l&&e.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:e.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",i," competition per ",_=="Individual"?"candidate":"team","."]})}),E?.map((t,s)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-3 print:mb-0 rounded-md print:border-0 print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-3  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-2xl px-5 print:text-lg font-semibold leading-6 text-blue-900",children:t.GroupName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500"})]})}),t?.items?.map((a,r)=>e.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-xl  print:text-lg font-semibold leading-6 text-cyan-600",children:a.CategoryName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Competitions"})]})}),e.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:a.CompetitionNames?.map((b,y)=>e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:e.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[e.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:b.CompetitionName}),e.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),e.jsx("div",{className:"mt-2 flex flex-wrap",children:b.competitions?.map((n,u)=>{let f=c.find(G=>G==n.CompetitionStructureId)!=null,x=!!(S||!f&&l);return a.isExceeded&&!f&&(x=!0),z?.find(G=>G.EventGroupId==n.Group),e.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("label",{onClick:G=>{if((l||a.isExceeded)&&x){a.isExceeded?I.error("You can't select more than "+a.MaxParticipation+" competitions from "+a.CategoryName):I.error("You can select maximum "+i+" competitions only");return}},className:ee(x?"":"ml-2","block text-sm text-gray-900"),children:[!x&&e.jsx("input",{type:"checkbox",id:`competitionCheckBox_${n.CompetitionStructureId}`,className:ee(" h-5 w-5 optiontext-darkprimary ",F?"border-red-300  text-red-600 focus:ring-red-800":x?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:x,fieldName:`competitionCheckBox_${n.CompetitionStructureId}`,checked:f,onChange:G=>{A(n.CompetitionStructureId,G)}},u),x&&!f&&e.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),e.jsxs("span",{className:"hidden print:flex",children:[O?.AllowDisplayCompetitionOrder==1?n.CompetitionOrder+" - ":""," ",n.Title]}),e.jsx("span",{className:ee(S?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(F?"text-danger":"text-gray-900")),children:(O?.AllowDisplayCompetitionOrder==1?n.CompetitionOrder+" - ":"")+(n.Title.replace(b.CompetitionName,"").replace(/ /gi,"").trim()!==""?n.Title.replace(b.CompetitionName,"").trim():b.CompetitionName.trim())})]})}),e.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:n?.Remarks&&e.jsx(ce,{children:n.Remarks})}),n.Fees>0&&e.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:e.jsxs("b",{children:[g?.AdditionalSettings?.CustomFeesLabel||"Fees",":",e.jsxs("i",{className:"text-green-700 font-medium",children:[" ",n.Fees,g?.AdditionalSettings?.HideCurrencyInPublicPages!=="Yes"&&m]})]})}),e.jsx(Ce,{eventDetails:O,item:n,competitionStructureId:n.CompetitionStructureId,candidateId:n.CandidateId,register:Y,errors:$,control:D,participantsList:P,setValue:H,getValues:null,setFormData1:()=>{},formData:p})]},r+"_"+y+"_"+n.CompetitionStructureId)})})]},r+"_"+y))})]},r))]},s)}))]})})};export{we as default};
