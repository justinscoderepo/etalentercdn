import{r as l,p as x,j as e,L as G,z as u}from"./main-DzBv391f.js";import{A as H}from"./AdminLayout-DtdmbH0P.js";import{h as q,a as J,i as Y,L as C}from"./navigationUtils-DKALZK-h.js";import"./XMarkIcon-CsrWjw8n.js";const te=()=>{const{tableName:d}=q(),P=J(),[b,V]=Y(),[y,k]=l.useState([]),[r,R]=l.useState(null),[$,L]=l.useState(!0),[T,A]=l.useState(null),[o,f]=l.useState(null),[n,h]=l.useState({pageNumber:1,pageSize:20,totalCount:0,totalPages:0}),[K,p]=l.useState(!1),[m,S]=l.useState(null),[g,N]=l.useState({});l.useEffect(()=>{R(null),k([]),h(a=>({...a,pageNumber:1})),document.title=`${d} - Database Admin - eTalenter`,D();const t=b.get("filterColumn"),s=b.get("filterValue");f(t&&s?{column:t,value:s}:null)},[d,b]),l.useEffect(()=>{r&&j()},[n.pageNumber,r,o]);const D=async()=>{try{const t=await x("/Admin/GetTableSchema",{Table:d});t.data?.Results&&R(t.data.Results)}catch(t){console.error("Error loading schema:",t)}},j=async()=>{try{L(!0);const t={Table:d,PageNumber:n.pageNumber,PageSize:n.pageSize,OrderBy:r?.primaryKey?`${r.primaryKey} DESC`:null};o&&(t.FilterColumn=o.column,t.FilterValue=o.value);const s=await x("/Admin/GetAll",t);s?.data?.Results&&(k(s.data.Results.data),h(s.data.Results.pagination))}catch(t){console.error("Error loading data:",t),A(t.message||"Failed to load data")}finally{L(!1)}},F=()=>{S(null),N({}),p(!0)},z=t=>{S(t),N(t),p(!0)},I=async t=>{if(window.confirm("Are you sure you want to delete this record?"))try{const s=r?.primaryKey,a=t[s];await x("/Admin/Delete",{Table:d,Id:a}),u.success("Record deleted successfully"),j()}catch(s){console.error("Error deleting record:",s),u.error(s.message||"Failed to delete record")}},B=async()=>{try{if(m){const t=r?.primaryKey,s=m[t];await x("/Admin/Update",{Table:d,Id:s,Data:g}),u.success("Record updated successfully")}else await x("/Admin/Create",{Table:d,Data:g}),u.success("Record created successfully");p(!1),j()}catch(t){console.error("Error saving record:",t),u.error(t.message||"Failed to save record")}},M=t=>r?.foreignKeys?.find(s=>s.ColumnName===t),W=(t,s,a)=>{if(t==null)return e.jsx("span",{className:"text-gray-400 italic",children:"null"});if(typeof t=="boolean")return t?"âœ“":"âœ—";if(typeof t=="object")return JSON.stringify(t);const i=String(t),c=M(s);if(c){const O=`fk_${c.ReferencedTable}_${s}`,v=[];Object.keys(a).forEach(w=>{w.startsWith(O+"_")&&a[w]&&v.push(a[w])});const U=v.length>0?`${i} (${v.join(" - ")})`:i;return e.jsxs(C,{to:`/admin/table/${c.ReferencedTable}?filterColumn=${c.ReferencedColumn}&filterValue=${encodeURIComponent(i)}`,className:"text-blue-600 hover:text-blue-800 underline flex items-center gap-1",title:`View ${c.ReferencedTable} where ${c.ReferencedColumn} = ${i}`,children:[e.jsx("span",{className:"truncate max-w-md",children:U}),e.jsx("svg",{className:"w-3 h-3 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})}return i.length>100?e.jsxs("span",{title:i,children:[i.substring(0,100),"..."]}):i};if($&&!y.length)return e.jsx(G,{from:"TableManager"});const _=r?.columns||[],E=r?.columns?.map(t=>t.ColumnName)||[];return e.jsx(H,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("p",{className:"text-gray-600",children:[n.totalCount," records total"]}),o&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 border border-green-300 text-green-800 rounded-lg text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),e.jsxs("span",{children:["Filter: ",o.column," = ",o.value]}),e.jsx("button",{onClick:()=>{f(null),V({})},className:"ml-1 text-green-600 hover:text-green-900",title:"Clear filter",children:"âœ•"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>P(`/admin/designer/${d}`),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",title:"Modify table schema",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Modify Schema"]}),e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create New"]})]})]}),r?.childRelationships&&r.childRelationships.length>0&&e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Related Tables (",r.childRelationships.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.childRelationships.map((t,s)=>e.jsxs(C,{to:`/admin/table/${t.ChildTable}`,className:"inline-flex items-center gap-1 px-3 py-1 bg-white border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-100 text-sm",children:[t.ChildTable,e.jsxs("span",{className:"text-blue-500 text-xs",children:["(",t.ChildColumn,")"]})]},s))})]})]}),T&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-700",children:T})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[" ",r?.childRelationships&&r.childRelationships.length>0&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("span",{className:"flex items-center gap-1",children:["Related Tables",e.jsx("span",{className:"text-purple-600",title:"Child relationships",children:"ðŸ”—"})]})}),E.map(t=>{const s=M(t);return e.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:[t,t===r?.primaryKey&&e.jsx("span",{className:"ml-1 text-blue-600",title:"Primary Key",children:"ðŸ”‘"}),s&&e.jsx("span",{className:"ml-1 text-green-600",title:`Foreign Key â†’ ${s.ReferencedTable}.${s.ReferencedColumn}`,children:"ðŸ”—"})]},t)}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[r?.childRelationships&&r.childRelationships.length>0&&e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t._childRelationships&&t._childRelationships.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:t._childRelationships.map((a,i)=>e.jsx(C,{to:`/admin/table/${a.childTable}?filterColumn=${a.childColumn}&filterValue=${encodeURIComponent(a.filterValue)}`,className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs hover:bg-purple-200",title:`View ${a.childTable} where ${a.childColumn} = ${a.filterValue}`,children:a.childTable},i))}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"None"})}),E.map(a=>e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:W(t[a],a,t)},a)),e.jsxs("td",{className:"px-4 py-3 text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>z(t),className:"text-blue-600 hover:text-blue-900 mr-3",children:"Edit"}),e.jsx("button",{onClick:()=>I(t),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},s))})]})}),n.totalPages>1&&e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",n.pageNumber," of ",n.totalPages]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(t=>({...t,pageNumber:t.pageNumber-1})),disabled:n.pageNumber===1,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Previous"}),e.jsx("button",{onClick:()=>h(t=>({...t,pageNumber:t.pageNumber+1})),disabled:n.pageNumber===n.totalPages,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Next"})]})]})})]}),y.length===0&&!$&&e.jsx("div",{className:"text-center py-12 bg-white rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No records found"})})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:m?"Edit Record":"Create New Record"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:_.map(t=>{const s=m&&t.ColumnName===r?.primaryKey;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t.ColumnName,t.ColumnName===r?.primaryKey&&e.jsx("span",{className:"ml-1 text-blue-600",title:"Primary Key",children:"ðŸ”‘"}),t.IsNullable==="NO"&&e.jsx("span",{className:"text-red-600 ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:g[t.ColumnName]||"",onChange:a=>N({...g,[t.ColumnName]:a.target.value}),disabled:s,placeholder:`${t.DataType}${t.MaxLength?`(${t.MaxLength})`:""}`,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Type: ",t.DataType,t.MaxLength&&` (max: ${t.MaxLength})`,t.IsNullable==="YES"&&" â€¢ Nullable"]})]},t.ColumnName)})})}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:m?"Update":"Create"})]})]})})]})})};export{te as default};
