import{r as u,j as i,i as X,p as fe,u as G,n as ze,L as xe}from"./main-DBQ-0816.js";import{L as Ye}from"./layoutOuter-BrdXIu4-.js";import{P as Ke}from"./pageHeader-gArgWnpd.js";import{C as Qe}from"./index.esm-C7QzPlR5.js";import{V as Xe}from"./validationMessage-T29xaJJZ.js";import{u as B,w as be}from"./xlsx-BojT3SgY.js";const Ce=function({control:O,fieldName:j,label:W,placeholder:M,errors:D,register:k,formData:q,optional:Z,maxLength:he,onChange:ee,options:$,optionKey:J="id",values:S,optionText:_="name",type:ae,maxHeight:P="max-h-96",value:N,name:A,className:z=""}){let p=D?.[j],[F,Y]=u.useState(p),[V,K]=u.useState(new Set);const H=!!O;u.useEffect(()=>{Y(D?.[j])},[D?.[j]]),u.useEffect(()=>{K(new Set)},[N,S]);const Q=()=>H&&S&&S.length>0?$?.filter(m=>S.some(C=>C.id==m[J]&&C.isDelete==!1)).map(m=>m[J])||[]:!H&&N!==void 0?Array.isArray(N)?N:[]:[],te=(m,C)=>{K(x=>{const v=new Set(x);return v.has(m)?v.delete(m):v.add(m),v});let I=[...Q()];const U=String(m);I.some(x=>String(x)===U)?I=I.filter(x=>String(x)!==U):I.push(m),setTimeout(()=>{ee&&ee(I),C&&C(I),Y("")},1e3)},T=m=>typeof _=="function"?_(m):m[_];console.log({pendingToggles:V,value:N});const ie=m=>i.jsx("div",{className:X("w-full bg-white overflow-y-auto",P),children:$&&$.length>0?$.map((C,E)=>{const U=Q().some(v=>v==C[J]),x=V.has(C[J])?!U:U;return i.jsxs("label",{className:X("flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors",x?"bg-green-50/10":"",z),children:[i.jsxs("div",{className:"relative flex items-center justify-center",children:[i.jsx("input",{type:"checkbox",checked:x,onChange:()=>te(C[J],m?.onChange),className:"sr-only"}),i.jsx("div",{className:X("w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200",x?"bg-green-600 border-green-600 shadow-sm":"bg-white border-gray-300 hover:border-green-400"),children:x&&i.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3.5",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{d:"M5 13l4 4L19 7"})})})]}),i.jsx("span",{className:X("ml-3 text-sm transition-colors",x?"text-green-700 font-medium":"text-gray-700"),children:T(C)})]},E)}):i.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"No options available"})});return i.jsxs("div",{className:"multiSelectCheckBox",children:[W&&i.jsx("label",{htmlFor:j||A,className:X("block text-sm font-medium mb-2 px-3",F?"text-danger":"text-gray-700"),children:W}),H?i.jsx(Qe,{control:O,...k(j,{required:!Z}),render:({field:m})=>ie(m)}):ie(),F&&i.jsx(Xe,{message:"This field is required"})]})},Ze=async(g,O)=>{var j={};if(g.JsonSettings!=null&&g.JsonSettings!=""){var W=JSON.parse(g.JsonSettings);j=W}j.scheduleSettings=O;var M=JSON.stringify(j,null,2);await fe("/EventJson/Save",{Select:"EVId,JsonSettings",EVId:g.EVId,JsonSettings:M})};let ne={};sessionStorage.getItem("allpreferences")&&(ne=JSON.parse(sessionStorage.getItem("allpreferences")));const at=()=>{const[g,O]=u.useState([]),[j,W]=u.useState(!1),[M,D]=u.useState(!1),[k,q]=u.useState(!1),Z=u.useRef(!1);let[he,ee]=u.useState({}),$=localStorage.getItem("preferenceCompetitionStructures"),J=localStorage.getItem("preferenceCompetitions"),S=localStorage.getItem("startTime"),_=localStorage.getItem("startDate"),ae=localStorage.getItem("timeGap")||10,[P,N]=u.useState($?JSON.parse($):{}),[A,z]=u.useState(J?JSON.parse(J):{}),p=new Date;if(_&&(p=new Date(_)),p.setHours(9,0,0,0),S){let t=S.split(":");p.setHours(t[0],t[1].split(" ")[0],0,0)}const{row:F}=G("/EventJson/Get",{select:"EVId,JsonSettings",doCache:!0});let Y=F?.JsonSettings,V=Y?JSON.parse(Y):{},K=V.scheduleSettings?.scheduleListPreferences,H=V.scheduleSettings?.scheduleListPreferenceCompetitions,Q=V.scheduleSettings?.scheduleStartTime,te=V.scheduleSettings?.scheduleStartDate;u.useEffect(()=>{F&&!Z.current&&(Q&&(S=Q),te&&(_=te),K&&N(K),H&&z(H),Z.current=!0)},[F]);const{rows:T,status:ie}=G("/EventStagesJson/Get",{select:"ESGId,Title,Venue",limit:1e3,offset:0,filter:{status:1},doCache:!0}),{rows:m,status:C}=G("/CompetitionStructureJson/GetReadyToStart",{filter:{ParticipantType:1,status:1},sort:{sortOrder:"ASC",sortColumn:"GroupOrder"},select:"CompetitionStructureId,CompetitionItem,CompetitionItemTitle,GroupGroupName,ParticipantType,ParticipantTypeTitle,MaximumMinutes,MaximumSeconds,Gender,Language,GenderGenderTitle,LanguageLanguageName,CompetitionStructureId,CompetitionItem,ParticipantType,MaximumMinutes,MaximumSeconds",doCache:!0,limit:1e3,offset:0}),{rows:E,status:I}=G("/CompetitionParticipantsJson/Get",{select:"ParticipantId,IdentityNumber,Competition,Candidate,Team",filter:{ParticipantType:1,status:1},doCache:!0,limit:1e4,offset:0}),{rows:U,status:le}=G("/UsersRolesPlusUsersJson/Get",{select:"UserId,UserName,UserRoleId,UserRoleId,UserJsonSettings,UserDobString,UserImage,UserMobile,UserPhone,Email,Group,IdentityNumber,CandidateUser,UserJsonSettings",filter:{status:1},doCache:!0,limit:1e4,offset:0}),{rows:x}=G("/CompetitionParticipantsTeamsJson/Get",{select:"TeamId,TeamName,TeamStrength,TeamMembersList,TeamMembers,TeamStrength,IdentityNumber",filter:{status:1},doCache:!0,limit:1e4,offset:0});let{rows:v,status:we}=G("/competitionItemsJson/Get",{select:"CompetitionId,Title,Category,CategoryCategoryName,JsonSettings",filter:{status:1},limit:1e3,doCache:!0});G("/CompetitionParticipantsTeamMembersJson/Get",{select:"*",limit:1e3,filter:{status:1},doCache:!0});let{rows:y,status:Te,setFilter:ye}=G("/CompetitionScheduleJson/Get",{filter:{CompetitionParticipantType:1,status:1},select:"ScheduledStartTime,Stage,Competition,CompetitionParticipantType,ExpectedTotalTimeInMinutes,Ischeduled,ScheduledEndTime,CompetitionCompetitionItem,CompetitionCompetitionItemTItle,CompetitionCompetitionStructureId,CompetitionMaximumMinutes,CompetitionMaximumSeconds,CompetitionMinimumMinutes,CompetitionMinimumSeconds,CompetitionWarningMinute,CompetitionWarningSecond,Phase,PhaseTitle,StageTitle,Status,Event,EventEventName,Order,CreatedBy,CreatedDate,ModifiedDate,ScheduleId,JsonSettings,EventGlobal,Participants,CompetitionPreviosGapInMinutes,AvoidChangeStage",limit:1e3,doCache:!0,offset:0}),ge=[];y?.length&&m?.length&&(y=y.filter(t=>m.some(s=>s.CompetitionStructureId==t.Competition)));let se=ze(ie,C,I,le,we,Te),oe=10,re=70,ce=p,je=72*60/oe,de=Array.from(Array(je),(t,s)=>{const e=s*oe;return new Date(ce.getTime()+e*60*1e3).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})});u.useEffect(()=>{se||m&&E&&T&&y&&(D(!1),me())},[se]),u.useEffect(()=>{const t=s=>{if(k)return s.preventDefault(),s.returnValue="You have unsaved changes. Are you sure you want to leave?",s.returnValue};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[k]);const me=async()=>{if(!M){D(!0);let t=JSON.stringify(P);ne[p+"_"+t];let s={};E.forEach(n=>{n.Team==0?s[n.Candidate]=U.find(a=>a.UserRoleId===n.Candidate)?.IdentityNumber??"":s[n.Team]=x.find(a=>a.TeamId===n.Team)?.IdentityNumber??"",s[n.Candidate]||delete s[n.Candidate]});const e=Pe(),o=Ne();let c=ve(o);c.sort((n,a)=>{const l=y.find(R=>R.Competition==n.Competition),r=y.find(R=>R.Competition==a.Competition),d=l?.JsonSettings?JSON.parse(l.JsonSettings):{},w=r?.JsonSettings?JSON.parse(r.JsonSettings):{};return d.forceOrder&&w.forceOrder?(l?.Order||0)-(r?.Order||0):d.forceOrder?-1:w.forceOrder?1:0});for(let n of c){const a=Ge(n,s),l=y.find(d=>d.Competition==n.Competition);l?.JsonSettings&&JSON.parse(l.JsonSettings);let r;r||(r=Le(a,e)),r&&Je(r,a,e)}ne[p+"_"+t]=e,sessionStorage.setItem("allpreferences",JSON.stringify(ne)),O(e),D(!1)}},Pe=()=>{const t={};return T.forEach(s=>{t[s.ESGId]=[]}),O(t),t},Ne=()=>m.filter(t=>!ge.some(s=>s.Competition==t.CompetitionStructureId)),Ie=(t,s)=>{let e=t.target.value;localStorage.setItem(s,e),ee({...he,[s]:e}),setTimeout(()=>{D(!1),me()},1e3)},ve=t=>{let s=[...ge];return t.length>0&&s.push(...t.map(e=>({CompetitionStructureId:e.CompetitionStructureId,Competition:e.CompetitionStructureId,CompetitionCompetitionItemTitle:e.CompetitionItemTitle,GroupGroupName:e.GroupGroupName,CompetitionParticipantTypeTitle:e.ParticipantTypeTitle,CompetitionMaximumMinutes:e.MaximumMinutes,CompetitionMaximumSeconds:e.MaximumSeconds,CompetitionGenderGenderTitle:e.GenderGenderTitle,CompetitionLanguageLanguageName:e.LanguageLanguageName}))),s},Ge=(t,s)=>{const e=m.find(d=>d.CompetitionStructureId==t.Competition),o=v.find(d=>d.CompetitionId==e.CompetitionItem);e?.MaximumMinutes||console.error("Competition Maximum Minutes not found for competition: ",e);const c=parseFloat(e?.MaximumMinutes||20),n=E.filter(d=>d.Competition==t.Competition).length;let l=[8,1,105,107].includes(o.Category);const r=De(c,e,n,l,o);return{CompetitionStructureId:e.CompetitionStructureId,Title:`${e.ParticipantType==1?"ðŸ•º":"ðŸ‘«"} ${e.GroupGroupName} ${e.CompetitionItemTitle}${e.Gender!=3?" "+e.GenderGenderTitle:""} ${e.Language!=4?" "+e.LanguageLanguageName:""}`,Duration:r,ParticipantsCount:n,MaximumMinutes:c,perTimeLimit:e.MaximumMinutes,isOffStage:l,Logs:[],allParticipants:E.filter(d=>d.Competition==e.CompetitionStructureId).map(d=>d.Candidate>0?d.Candidate:d.Team),Participants:E.filter(d=>d.Competition==e.CompetitionStructureId&&s[d.Candidate>0?d.Candidate:d.Team]).map(d=>s[d.Candidate>0?d.Candidate:d.Team])}},De=(t,s,e,o,c)=>{const n=parseFloat(ae)||10,a=c.JsonSettings?JSON.parse(c.JsonSettings):{};a?.TimeCalculation&&(a.TimeCalculation=="PerHead"?o=!1:a.TimeCalculation=="TotalTime"&&(o=!0));let l=o?t:t*e+n;return l%10===0?l:l+(10-l%10)},Je=async(t,s,e)=>{const o=s.Duration/oe*re;e[t.ESGId]||(e[t.ESGId]=[]),o>0&&e[t.ESGId].push({...s,...t,Height:o})};let Ee=(t,s)=>{let e=m.find(r=>r.CompetitionStructureId==t.CompetitionStructureId);if(!e)return!1;s==288&&t.Title.includes("Essay Writing");for(let r in P)if(r!=s){let d=P[r];if(d&&d.some(w=>w==t.CompetitionStructureId))return!1}let o=A[s];if(!o||!o.some(r=>r==e.CompetitionItem))return!1;let c=P[s];if(!c||c.length===0||c.some(r=>r==e.CompetitionStructureId))return!0;let a=m.filter(r=>r.CompetitionItem==e.CompetitionItem).map(r=>r.CompetitionStructureId);var l=c.filter(r=>a.includes(r));return l.length==0};const Le=(t,s)=>{for(let e=0;e<de.length;e++){const o=e*re,c=t.Duration/oe,n=o+re*c,a=ke(de[e]),l=new Date(a);l.setMinutes(l.getMinutes()+t.Duration);for(let r of T){const d=s[r.ESGId]||[];if(!Ee(t,r.ESGId))continue;let w={StartTime:a,EndTime:l,topPosition:o,bottomPosition:n,stage:r,ESGId:r.ESGId};if(Me(w,d)&&!Oe(t,s,w))return{...w}}}return null},Oe=(t,s,e)=>{for(let c of T)if(e?.stage?.Title!=c.Title){t.CompetitionStructureId==5622;const n=s[c.ESGId]||[];for(var o of n){let a=!1;if(e.topPosition<o.bottomPosition&&e.bottomPosition>o.topPosition&&(a=!0),e.topPosition>o.bottomPosition&&e.bottomPosition<o.topPosition&&(a=!0),e.topPosition>o.topPosition&&e.topPosition<o.topPosition&&(a=!0),e.bottomPosition>o.topPosition&&e.bottomPosition<o.topPosition&&(a=!0),a){let l=[];for(let r of o.Participants)for(let d of t.Participants)r===d&&l.push(r);if(l.length>0)return t.Logs.push(l.join(", ")+` - ${o.StartTime.toLocaleTimeString()} - ${o.EndTime.toLocaleTimeString()} @ ${o.stage.Title} - ${o.Title}`),!0}}}return!1},Me=(t,s,e)=>{let o=!0;for(let c of s){if(c.topPosition<t.bottomPosition&&c.bottomPosition>t.topPosition||c.topPosition>t.bottomPosition&&c.bottomPosition<t.topPosition||c.topPosition>t.topPosition&&c.topPosition<t.topPosition||c.bottomPosition>t.topPosition&&c.bottomPosition<t.topPosition)return o=!1,o;if(!o)return o}return o},ke=t=>{const s=t.split(":"),e=new Date(p);return e.setHours(s[0],s[1].split(" ")[0],0,0),e},$e=()=>{window.print()},_e=(t,s)=>{const e={...P,[s]:t};N(e),localStorage.setItem("preferenceCompetitionStructures",JSON.stringify(e)),q(!0)},Ae=(t,s)=>{const e={...A,[s]:t};z(e),localStorage.setItem("preferenceCompetitions",JSON.stringify(e)),q(!0)},ue=async()=>{await Ze(F,{scheduleListPreferences:P,scheduleListPreferenceCompetitions:A,scheduleStartTime:p,scheduleStartDate:p})},Fe=()=>{N({}),z({}),localStorage.removeItem("preferenceCompetitionStructures"),localStorage.removeItem("preferenceCompetitions"),q(!0)},Ve=t=>{let s=t.target.value,e=s.split(":");ce.setHours(e[0],e[1].split(" ")[0],0,0),localStorage.setItem("startTime",s),S=s,ue()},Ue=t=>{const s=new Date(t.target.value);if(s.setHours(9,0,0,0),S){let e=S.split(":");s.setHours(e[0],e[1].split(" ")[0],0,0)}ce=s,S=s,localStorage.setItem("startDate",s),ue()};let He=p.toISOString().split("T")[0];const Re=()=>{let t=1;for(let s in g)for(let e of g[s]){let o=e.StartTime,c=e.EndTime,n=e.ESGId,a={ScheduledStartTimeString:o,ScheduledEndTimeString:c,Stage:n,Competition:e.CompetitionStructureId,order:t};t++;let l=y.find(r=>r.Competition==e.CompetitionStructureId);l&&(a.scheduleId=l.ScheduleId),fe("/CompetitionScheduleJson/Save",a)}},Be=async(t,s)=>{let e=y.find(a=>a.Competition==t.CompetitionStructureId),o={};if(e?.JsonSettings)try{o=JSON.parse(e.JsonSettings)}catch(a){console.error("Error parsing existing JsonSettings:",a)}const c={...o,forceOrder:!0};let n={Competition:t.CompetitionStructureId,Order:parseInt(s),JsonSettings:JSON.stringify(c)};e&&(n.scheduleId=e.ScheduleId,n.Stage=e.Stage);try{await fe("/CompetitionScheduleJson/Save",n),await ye({date:new Date().getTime()})}catch(a){console.error("Error saving order change:",a)}},We=()=>{const t=B.book_new();Object.entries(g).forEach(([o,c])=>{const n=T.find(r=>r.ESGId==parseInt(o))?.Title||`Stage ${o}`,a=[[n],[],["Order","Competition","Start Time","End Time","Duration (min)","Participants Count","Time Limit (min)","Type","Participants"]];c.forEach((r,d)=>{const R=y.find(pe=>pe.Competition==r.CompetitionStructureId)?.Order||d+1;a.push([R,r.Title,new Date(r.StartTime).toLocaleTimeString(),new Date(r.EndTime).toLocaleTimeString(),r.Duration,r.ParticipantsCount,r.perTimeLimit??"N/A",r.isOffStage?"Off-Stage":"On-Stage",r.Participants?.join(", ")||""])});const l=B.aoa_to_sheet(a);l["!cols"]=[{wch:8},{wch:40},{wch:15},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:50}],B.book_append_sheet(t,l,n.substring(0,31))});const e=`Schedule_Sheetwise_${p.toLocaleDateString().replace(/\//g,"-")}.xlsx`;be(t,e)},qe=()=>{const t=B.book_new(),s=Object.keys(g).map(b=>({id:b,name:T.find(f=>f.ESGId==parseInt(b))?.Title||`Stage ${b}`})),e=["Time"],o=[""],c=6;s.forEach(b=>{e.push(b.name);for(let f=1;f<c;f++)e.push("");o.push("Competition","Start Time","End Time","Duration","Participants","Count")});const n=[e,o],a=new Map;Object.entries(g).forEach(([b,f])=>{f.forEach(L=>{const h=new Date(L.StartTime).toLocaleTimeString();a.has(h)||a.set(h,{time:h,startDate:L.StartTime,stages:{}}),a.get(h).stages[b]=L})}),Array.from(a.values()).sort((b,f)=>new Date(b.startDate)-new Date(f.startDate)).forEach(b=>{const f=[b.time];s.forEach(L=>{const h=b.stages[L.id];if(h)f.push(h.Title,new Date(h.StartTime).toLocaleTimeString(),new Date(h.EndTime).toLocaleTimeString(),`${h.Duration}m`,h.Participants?.slice(0,3).join(", ")||"",h.ParticipantsCount);else for(let Se=0;Se<c;Se++)f.push("")}),n.push(f)});const r=B.aoa_to_sheet(n),d=[{wch:12}];s.forEach(()=>{d.push({wch:40},{wch:12},{wch:12},{wch:10},{wch:30},{wch:8})}),r["!cols"]=d;const w=[];s.forEach((b,f)=>{const L=1+f*c,h=L+c-1;w.push({s:{r:0,c:L},e:{r:0,c:h}})}),r["!merges"]=w,B.book_append_sheet(t,r,"All Stages");const pe=`Schedule_AllStages_${p.toLocaleDateString().replace(/\//g,"-")}.xlsx`;be(t,pe)};return i.jsx(Ye,{children:i.jsxs("div",{className:"flex flex-col grow",children:[i.jsx(Ke,{heading:"Automated Schedule",subHeading:"Generate and manage automated competition schedules",rightChildren:!se&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-700  hidden-print",onClick:Fe,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"clear_all"}),"Clear Preferences"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700  hidden-print",onClick:Re,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Save To Schedule"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700  hidden-print",onClick:qe,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"}),"Export to Excel"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-teal-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-700  hidden-print",onClick:We,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"table_view"}),"Sheetwise Excel"]}),i.jsxs("button",{className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover  hidden-print",onClick:$e,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"print"}),"Print"]})]})}),se?i.jsx(xe,{}):i.jsxs("div",{className:"flex justify-between flex-col w-full print-hidden relative",children:[i.jsxs("div",{className:"flex justify-between  w-full print:hidden",children:[i.jsxs("div",{className:"flex timeline flex-col w-32 bg-surface",children:[i.jsx("label",{htmlFor:"preferredStartDate",className:"block text-sm font-medium text-onSurfaceVariant p-2",children:"Preferred Start Date"}),i.jsx("input",{type:"date",value:He,className:"p-2 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"preferredStartDate",name:"preferredStartDate",onChange:t=>Ue(t)}),i.jsx("input",{type:"time",value:S,className:"p-2 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"preferredStartDate",name:"preferredStartDate",onChange:t=>Ve(t)}),i.jsx("input",{type:"number",value:ae,className:"p-2 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"timeGap",name:"timeGap",onChange:t=>Ie(t,"timeGap")})]}),i.jsxs("div",{className:"flex flex-1 h-full w-full flex-col",children:[i.jsx("div",{className:"flex w-full",children:Object.entries(g).map(([t,s])=>i.jsxs("div",{className:"bg-white p-2 border-b-2 shadow-md relative flex-1 h-full",children:[i.jsx(Ce,{label:`${T.find(e=>e.ESGId==parseInt(t))?.Title} Preferences`,placeholder:"Select competitions...",options:v,optionKey:"CompetitionId",optionText:"Title",value:A[t]||[],onChange:e=>Ae(e,t),maxHeight:"max-h-[400px]"}),i.jsx("h3",{className:"text-sm font-medium text-onSurfaceVariant mt-4 mb-2",children:"Selected Competitions"}),i.jsx("div",{className:"max-h-96 ",children:i.jsx(Ce,{options:m.filter(e=>A[t]?.some(o=>o==e.CompetitionItem)),optionKey:"CompetitionStructureId",optionText:e=>{const o=Object.entries(P).filter(([n,a])=>n!==t&&a?.some(l=>l==e.CompetitionStructureId)).map(([n])=>T.find(l=>l.ESGId==parseInt(n))?.Title||`Stage ${n}`);return`${o.length>0?`(${o.join(", ")}) `:""}${e.GroupGroupName} - ${e.CompetitionItemTitle}${e.Gender!=3?` ${e.GenderGenderTitle}`:""}${e.Language!=4?` ${e.LanguageLanguageName}`:""}`},value:P[t]||[],onChange:e=>_e(e,t),maxHeight:"max-h-96",className:"border-b border-border text-xs"})})]},"stage_"+t))}),i.jsxs("div",{className:"flex justify-end gap-3 w-full mt-3 px-2",children:[i.jsxs("button",{className:"inline-flex items-center justify-center gap-x-2 rounded-md bg-green-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{await ue(),q(!1)},disabled:M||!k,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Save Preferences"]}),i.jsxs("button",{className:"inline-flex items-center justify-center gap-x-2 rounded-md bg-indigo-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{me()},disabled:M||k,title:k?"Please save preferences before generating schedule":"Generate schedule based on saved preferences",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"schedule"}),"Generate Schedule"]})]})]})]}),M?i.jsx(xe,{from:"Schedule Generation",message:"Generating schedule..."}):i.jsxs("div",{className:"flex justify-between  w-full mt-10",children:[i.jsx("div",{className:"flex timeline flex-col min-w-32 bg-surface",children:de.map((t,s)=>i.jsx("div",{className:"flex items-center border-b-2 text-center bg-white p-2",style:{height:`${re}px`},children:i.jsx("div",{className:"w-20",children:t})},s))}),i.jsx("div",{className:"flex flex-1 h-full w-full",children:Object.entries(g).map(([t,s])=>i.jsx("div",{className:"bg-surface border-b-2 shadow-md relative flex-1 h-full",children:i.jsx("div",{className:"flex flex-col ",children:s.map((e,o)=>{const c=y.find(l=>l.Competition==e.CompetitionStructureId),n=c?.JsonSettings?JSON.parse(c.JsonSettings):{},a=n.ForcedStage||n.forceOrder;return i.jsx("div",{className:"min-h-6 max-w-full flex-1 flex min-w-72",children:i.jsxs("div",{className:"bg-white absolute border-x-2 border-darkprimary/40 p-2 shadow-sm border-b-2 flex overflow-y-auto justify-between w-full",style:{height:`${e.Height}px`,top:`${e.topPosition}px`},children:[a&&i.jsxs("div",{className:`absolute top-1 right-1 text-xs font-bold px-2 py-1 rounded shadow-sm ${n.ForcedStage&&n.forceOrder?"bg-purple-100 text-purple-700 border border-purple-300":n.ForcedStage?"bg-blue-100 text-blue-700 border border-blue-300":"bg-green-100 text-green-700 border border-green-300"}`,title:`${n.ForcedStage?"Forced Stage":""} ${n.forceOrder?"Forced Order":""}`,children:[n.ForcedStage&&T.find(l=>l.ESGId===c?.Stage)?.Title,n.ForcedStage&&n.forceOrder&&" | ",n.forceOrder&&`#${c?.Order||o+1}`]}),i.jsxs("div",{className:"max-w-[80%] overflow-auto pr-2",children:[i.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[i.jsx("h3",{className:"text-green-800 font-medium text-xs pb-1 border-b-2 whitespace-nowrap text-ellipsis overflow-hidden",children:e.Title}),i.jsxs("div",{className:"flex items-center gap-2 hidden-print",children:[i.jsx("label",{className:"text-xs font-medium text-gray-600 min-w-12",children:"Order:"}),i.jsx("input",{type:"number",className:"flex-1 p-1 border-b-2 border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-xs",defaultValue:o+1,onBlur:l=>Be(e,l.target.value),min:"1"})]})]}),i.jsxs("h2",{className:"text-blue-900 font-medium text-sm py-1 border-b-2 whitespace-nowrap ",children:[new Date(e.StartTime).toLocaleTimeString()," - ",new Date(e.EndTime).toLocaleTimeString()]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("div",{className:"bg-white shadow p-2",children:e.isOffStage?i.jsx("span",{className:"material-symbols-outlined text-2xl text-amber-700",children:"airline_seat_recline_normal"}):i.jsx("span",{className:"material-symbols-outlined text-2xl text-green-600",children:"podium"})}),i.jsxs("div",{className:"bg-white shadow p-2 justify-center text-center text-xs font-bold text-yellow-700",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl text-yellow-700",children:"settings_accessibility"}),e.ParticipantsCount]}),i.jsxs("div",{className:"bg-white shadow p-2 justify-center text-center text-xs font-bold text-pink-700",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl text-pink-700",children:"hourglass_top"}),e.perTimeLimit??"?"]}),i.jsxs("div",{className:"bg-white shadow p-2 justify-center text-center text-xs font-bold text-purple-700",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl text-purple-700",children:"timer"}),e.Duration,"m"]})]}),i.jsx("div",{children:e.Logs?.map((l,r)=>i.jsx("div",{className:"text-red-600 text-xs",children:l},r))})]}),i.jsx("div",{className:"flex flex-col overflow-y-auto bg-white max-h-full pr-4 text-xs",children:e.Participants?.map((l,r)=>i.jsx("div",{className:"flex items-center p-2 bg-white text-onSurfaceVariant font-medium border-b-2 ",children:i.jsx("div",{children:l})},r))})]},o)},t+"_"+o)})})},t))})]})]})]})})};export{at as default};
