import{r as o,z as C,j as r,u as Z,i as E}from"./main-De2Kf-QZ.js";import{u as v}from"./index.esm-BXLi45Vk.js";import{B}from"./box-v0bNNd2i.js";import I from"./textBox-BcvzzSHG.js";import U from"./modalForm-B283j0Ej.js";import{F as T}from"./PlusIcon-Dastn_GC.js";import"./validationMessage-Dqw5AjM-.js";import"./EyeSlashIcon-CoUmi9TA.js";import"./EyeIcon-bdbwMUUq.js";import"./ChatBubbleBottomCenterTextIcon-DDJWRLzU.js";import"./dialog-CvL_LDN8.js";import"./keyboard-DVQj7xPs.js";import"./description-DGNx-eZt.js";import"./use-is-mounted-BZBcgmZb.js";import"./navigationUtils-DA0COmfr.js";import"./XMarkIcon-oCOjLxQD.js";function V({title:n,titleId:i,...t},u){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},t),n?o.createElement("title",{id:i},n):null,o.createElement("path",{fillRule:"evenodd",d:"M4.5 2.25a.75.75 0 0 0 0 1.5v16.5h-.75a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 0-1.5h-.75V3.75a.75.75 0 0 0 0-1.5h-15ZM9 6a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H9Zm-.75 3.75A.75.75 0 0 1 9 9h1.5a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM9 12a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H9Zm3.75-5.25A.75.75 0 0 1 13.5 6H15a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM13.5 9a.75.75 0 0 0 0 1.5H15A.75.75 0 0 0 15 9h-1.5Zm-.75 3.75a.75.75 0 0 1 .75-.75H15a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM9 19.5v-2.25a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-.75.75h-4.5A.75.75 0 0 1 9 19.5Z",clipRule:"evenodd"}))}const k=o.forwardRef(V),q=({isOpen:n,onClose:i,level:t,parentOrganizationId:u,user:p,onOrganizationAdded:x})=>{const{register:j,control:z,handleSubmit:w,getValues:A,reset:O,formState:{errors:L,isSubmitting:g}}=v({defaultValues:{organizationName:"",shortName:""}}),c=A(),y=o.useCallback(async N=>{if(!N.organizationName?.trim()){C.error("Organization name is required");return}try{const b={Name:N.organizationName,ShortName:N.shortName||N.organizationName.substring(0,10).toUpperCase(),CompetitionLevel:t?.EventLevelId,ParentOrganization:u,OrganizationType:2,Status:1,CreatedBy:p?.UId,AllowOrganizationId:1};await x(b),C.success(`${t?.LevelName} "${N.organizationName}" added successfully`),O(),i()}catch(b){console.error("Failed to add organization:",b),C.error(`Failed to add ${t?.LevelName}. Please try again.`)}},[t,u,p,x,O,i]);return r.jsx(U,{open:n,setOpen:i,title:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(k,{className:"h-5 w-5 text-primary"}),r.jsxs("span",{children:["Add New ",t?.LevelName]})]}),center:!0,children:r.jsx(B,{heading:`${t?.LevelName} Details`,description:`Enter the details for the new ${t?.LevelName}`,children:r.jsxs("form",{onSubmit:w(y),className:"space-y-4 w-full",children:[r.jsx("div",{children:r.jsx(I,{fieldName:"organizationName",label:`${t?.LevelName} Name`,placeholder:`Enter ${t?.LevelName} name...`,control:z,register:j,formData:c,errors:L,optional:!1,disabled:g})}),r.jsx("div",{children:r.jsx(I,{fieldName:"shortName",label:"Short Name (Optional)",placeholder:"Enter short name...",control:z,register:j,formData:c,errors:L,optional:!0,disabled:g,maxLength:10})}),r.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[r.jsx("button",{type:"button",onClick:i,disabled:g,className:"inline-flex items-center gap-x-2 rounded-md bg-gray-200 px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:g,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-primaryHover focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:g?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Adding..."]}):r.jsxs(r.Fragment,{children:[r.jsx(T,{className:"h-4 w-4"}),"Add ",t?.LevelName]})})]})]})})})},oe=({user:n,eventLevels:i,topLevels:t,selectedOrganizations:u,onOrganizationChange:p,onFormDataChange:x,className:j=""})=>{const[z,w]=o.useState(!1),[A,O]=o.useState(null),[L,g]=o.useState(null),c=o.useCallback(e=>{if(!Array.isArray(u))return"";const a=u.find(l=>l[e]!==void 0);return a?a[e]:""},[u]),{rows:y,update:N}=Z("/OrganizationJson/Get",{select:"Id,Name,OrganizationId,ShortName,CompetitionLevel,CompetitionLevelLevelName,Order,ParentOrganization,ParentOrganizationName",filter:{Status:1,OrganizationType:2},limit:1e3,offset:0,sort:{sortColumn:"Order",sortOrder:"asc"},updateUrl:"/OrganizationJson/Save"}),[b,S]=o.useState(!1);o.useEffect(()=>{if(b||!i||!n)return;if(i[0]&&c(i[0]?.LevelName)){S(!0);return}const e=[];i[0]&&e.push({[i[0].LevelName]:n.Organization}),n.Role===3&&t&&i.forEach(a=>{t[a.LevelName]&&e.push({[a.LevelName]:t[a.LevelName]})}),e.length>0&&(S(!0),setTimeout(()=>{p(e)},0))},[i,n,t,c,b]);const h=o.useMemo(()=>!i||i.length<=1?[]:i.slice(1),[i]),F=o.useCallback((e,a)=>{if(!y)return[];const l=a+1;let s=null;if(l===1)s=n?.Organization;else if(l>1){const d=i[l-1];s=c(d?.LevelName)}return y.filter(d=>!(d.CompetitionLevel!==e.EventLevelId||s&&d.ParentOrganization!=s))},[y,c,n,i]),P=o.useCallback((e,a,l)=>{let s=[...Array.isArray(u)?u:[]];s=s.filter(m=>!m[e]),a&&s.push({[e]:a});const d=l+1;for(let m=d+1;m<i.length;m++){const f=i[m];f&&(s=s.filter(H=>!H[f.LevelName]))}p(s)},[u,i,p]),$=o.useCallback((e,a)=>{const l=a+1;let s=n?.Organization;if(l>1){const d=i[l-1];s=c(d?.LevelName)}O(e),g(s),w(!0)},[c,i,n]),M=o.useCallback(e=>n?.Role===3&&t&&t[level.LevelName],[n,t]),R=o.useMemo(()=>{const e={AllowToLoadSubOrg:"",OrderFrom:n?.OrganizationLevelOrder+1||1,OrganizationType:"2",ParentOrganization:n?.Organization,levels:{},Group:"",ParticipantType:"",AgeFrom:"",AgeTo:"",UsersRolesModel:{},TeamModel:{},teamrequiredelements:{},userrequiredelements:{}};return i?.[0]&&(e.levels[i[0].LevelName]=n?.Organization),h.forEach((a,l)=>{const s=l+1,d=M(a.LevelName),m=c(a.LevelName)||"";d?e.levels[a.LevelName]=t[a.LevelName]:e.levels[a.LevelName]=m,e.UsersRolesModel[a.LevelName]=d?t[a.LevelName]:m,e.TeamModel[a.LevelName]=d?t[a.LevelName]:m,s>0&&(e.teamrequiredelements[a.LevelName]=d?t[a.LevelName]:m,e.userrequiredelements[a.LevelName]=d?t[a.LevelName]:m)}),i?.forEach((a,l)=>{l===0?(e.UsersRolesModel[a.LevelName]=n?.Organization,e.TeamModel[a.LevelName]=n?.Organization):n?.Role===3&&t&&t[a.LevelName]&&(e.UsersRolesModel[a.LevelName]=t[a.LevelName],e.TeamModel[a.LevelName]=t[a.LevelName])}),e},[n,i,h,t,c,M]);return o.useEffect(()=>{x&&x(R)},[R,x]),!i||i.length<=1?null:r.jsxs("div",{className:E("w-full",j),children:[h.length>0&&r.jsx("div",{className:E("grid gap-3",h.length===1&&"grid-cols-1",h.length===2&&"grid-cols-1 md:grid-cols-2",h.length===3&&"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",h.length>=4&&"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"),children:h.map((e,a)=>{const l=a+1,s=M(e.LevelName),d=F(e,a),m=c(e.LevelName)||"";return s?null:r.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsxs("h4",{className:"text-xs font-medium text-primary flex items-center mr-2",children:[r.jsx(k,{className:"h-3 w-3 mr-1"}),e.LevelName]}),r.jsxs("button",{type:"button",onClick:()=>$(e,a),className:"inline-flex items-center gap-x-1 rounded-md bg-primary px-2 py-0.5 text-xs font-medium text-white shadow-sm hover:bg-primaryHover",children:[r.jsx(T,{className:"h-3 w-3"}),"Add"]})]}),r.jsx("div",{children:r.jsxs("select",{id:`levelid_${l}`,name:"ParentOrganization",className:"pl-2 block w-full rounded-md border-0 py-1 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm text-xs text-gray-900 focus:border-darkprimary ring-gray-300",value:m,onChange:f=>P(e.LevelName,f.target.value,a),children:[l===i.length-1?r.jsxs("option",{value:"all",children:["All ",e.LevelName?.toLowerCase()," Candidates"]}):r.jsxs(r.Fragment,{children:[r.jsxs("option",{value:"",children:["Please add ",e.LevelName?.toLowerCase()," name"]}),r.jsxs("option",{value:"all",children:["All ",e.LevelName?.toLowerCase()," Candidates"]})]}),d.map(f=>r.jsxs("option",{value:f.Id,children:[f.Order&&f.Order!==0?`${f.Order} - `:"",f.Name]},f.Id))]})})]},e.LevelName)})}),r.jsx(q,{isOpen:z,onClose:()=>{w(!1),O(null),g(null)},level:A,parentOrganizationId:L,user:n,onOrganizationAdded:async e=>{await N(e)}})]})};export{oe as default};
