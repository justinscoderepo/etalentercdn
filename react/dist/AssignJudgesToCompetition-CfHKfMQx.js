import{r as a,j as e,E as T}from"./main-C46Odvrx.js";import{J as fe}from"./judgesAllotmentContainer-BCl5lnoi.js";import{F as xe}from"./XMarkIcon-CkMFG6CF.js";const Se=a.createContext();function Ce({isModalOpen:F,setIsModalOpen:E,handleSubmit:b,formData:i,handleEditCompetition:v,handleDeleteCompetition:B,handleInputChange:c,modalTitle:N,buttonText:I,modalType:O,competitionStructure:G,eventStages:y,userRoles:D}){if(!F)return null;const U=O==="filter"?["Competition order number","competition","scoreStatus","stage","judge"]:Object.keys(i),w=o=>{const l=Array.from(o.target.selectedOptions,u=>u.value);c({target:{name:"competition",value:l}})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-container",children:[e.jsx("span",{className:"close-btn",onClick:()=>E(!1),children:"×"}),e.jsx("h3",{className:"modal-title",children:N}),e.jsxs("form",{className:"modal-form",onSubmit:o=>{o.preventDefault(),b()},children:[U.map(o=>{if(o==="competition"){const l=G.reduce((u,P)=>{const x=P.GroupGroupName||"Others";return u[x]||(u[x]=[]),u[x].push(P),u},{});return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,className:"form-label",children:"Competition:"}),e.jsx("div",{className:"styled-select-wrapper",children:e.jsxs("select",{id:o,name:o,value:i[o],onChange:w,className:"styled-select",required:!0,multiple:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),Object.keys(l).sort().map((u,P)=>e.jsx("optgroup",{label:u,children:l[u].sort((x,g)=>x.CompetitionItemTitle.localeCompare(g.CompetitionItemTitle)).map(x=>e.jsx("option",{value:x.CompetitionStructureId,children:x.CompetitionItemTitle},x.CompetitionStructureId))},P))]})}),e.jsxs("p",{className:"selection-count",children:[i[o].length," ",i[o].length===1?"Competition Selected":"Competitions Selected"]})]},o)}return o==="scoreStatus"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,children:"Score Status:"}),e.jsxs("select",{id:o,name:o,value:i[o],onChange:c,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),e.jsx("option",{value:"3",children:"Allowed to Fill"}),e.jsx("option",{value:"2",children:"Filled"}),e.jsx("option",{value:"1",children:"Published"})]})]},o):o==="stage"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,children:"Stage:"}),e.jsxs("select",{id:o,name:o,value:i[o],onChange:c,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),y.map((l,u)=>e.jsx("option",{value:l.Title,children:l.Title},u))]})]},o):o==="judge"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,children:"Judge:"}),e.jsxs("select",{id:o,name:o,value:i[o],onChange:c,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),D.map((l,u)=>e.jsx("option",{value:l.UserRoleId,children:l.UserName},u))]})]},o):e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:o,children:[o.charAt(0).toUpperCase()+o.slice(1),":"]}),e.jsx("input",{type:o==="order"?"number":"text",id:o,name:o,value:i[o],onChange:c,className:"form-input",required:o!=="order"})]},o)}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"submit",className:"submit-btn",children:I}),e.jsx("button",{type:"button",onClick:()=>E(!1),className:"cancel-btn",children:"Cancel"})]})]})]})})}const be=({competitionStructure:F,handleSubmit:E,handleFilterInputChange:b,currentFilters:i,setIsDropdownOpen:v,onCategorySelect:B})=>{const[c,N]=a.useState(!1),[I,O]=a.useState(""),[G,y]=a.useState(""),[D,J]=a.useState(""),[U,w]=a.useState(""),o=a.useRef(null),[l,u]=a.useState([]),[P,x]=a.useState(null),g=[{value:"all",label:"All"},{value:"category",label:"Category"},{value:"competition",label:"Competition"},{value:"stage",label:"Stage"}],M=()=>{u([])},Q=r=>{const m=r.target.value;u(d=>d.includes(m)?d.filter(h=>h!==m):[...d,m])},z=F.reduce((r,m)=>{const d=m.GroupGroupName||"Others";return r[d]||(r[d]=[]),r[d].push(m),r},{}),$=r=>{const{name:m,value:d}=r.target;b(m,d)},X=r=>{const m=r.target.value;b("category",m),B(m)},L=()=>{N(!c),v(!c)};return a.useEffect(()=>{const r=m=>{o.current&&!o.current.contains(m.target)&&(N(!1),v(!0))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),e.jsxs("div",{className:"relative inline-block w-48",ref:o,children:[e.jsx("button",{type:"button",onClick:L,className:"w-full px-2 py-1 bg-white border border-gray-300 text-gray-700 text-sm rounded-md shadow-sm hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:l.length>0?`Selected (${l.length})`:"Select filters..."}),l.length>0&&e.jsx("button",{onClick:M,className:"absolute top-0 right-0 p-1 text-gray-500 hover:text-gray-700",children:e.jsx(xe,{className:"h-4 w-4"})}),c&&e.jsx("div",{className:"absolute left-0 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:g.map(r=>e.jsxs("label",{className:"block px-2 py-1 text-gray-700 hover:bg-gray-100 cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",value:r.value,checked:l.includes(r.value),onChange:Q,className:"mr-2"}),r.label]},r.value))}),l.includes("category")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-xs font-medium text-gray-700",children:"Select Category:"}),e.jsxs("select",{id:"category",name:"category",value:i.category||"",onChange:X,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a category"}),Object.keys(z).sort().map(r=>e.jsx("option",{value:r,children:r},r))]})]}),l.includes("competition")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"competition",className:"block text-xs font-medium text-gray-700",children:"Select Competition:"}),e.jsxs("select",{id:"competition",name:"competition",value:i.competition||"",onChange:$,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a competition"}),Object.keys(z).sort().map((r,m)=>e.jsx("optgroup",{label:r,children:z[r].sort((d,h)=>d.CompetitionItemTitle.localeCompare(h.CompetitionItemTitle)).map(d=>e.jsx("option",{value:d.CompetitionStructureId,children:d.CompetitionItemTitle},d.CompetitionStructureId))},m))]})]}),l.includes("stage")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"stage",className:"block text-xs font-medium text-gray-700",children:"Stage"}),e.jsx("input",{type:"text",id:"stage",name:"stages",value:i.stages||"",onChange:$,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:E,className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-xs",children:"Apply Filters"})})]})};function Te({user:F}){const E=()=>a.useContext(Se),{accessToken:b}=E(),[i,v]=a.useState([]),[B,c]=a.useState(!0),[N,I]=a.useState([]),[O,G]=a.useState(!1),[y,D]=a.useState(i),[J,U]=a.useState([]),[w,o]=a.useState([]),[l,u]=a.useState([]),[P,x]=a.useState(!1),[g,M]=a.useState(1),[Q,z]=a.useState([]),[$,X]=a.useState(null),[L,r]=a.useState(null),[m,d]=a.useState(!1),[h,te]=a.useState(""),[A,Y]=a.useState({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""}),[q,Z]=a.useState({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""}),[j,k]=a.useState({order:"",competition:"",scoreStatus:"",stages:"",judgeUserName:""}),se=()=>{const{order:t,competition:s,scoreStatus:n,stages:p,judgeUserName:S}=j;R(g,t,s,n,p)};a.useEffect(()=>{},[j,y]);const oe=()=>{if(h==="edit"){const t=i.map(s=>s.AllotementId===q.AllotementId?q:s);W(),v(t)}else if(h==="new")v([...i,A]),W(),Y({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""});else if(h==="filter"){const{order:t,competition:s,scoreStatus:n,judgeUserName:p}=A;k({order:t,competition:s,scoreStatus:n,judgeUserName:p}),R(g,t,s,n,p)}d(!1)},[je,ve]=a.useState("all"),ae=t=>{const{name:s,value:n}=t.target;(h==="edit"?Z:Y)(S=>({...S,[s]:n}))},ne=(t,s)=>{k(n=>({...n,[t]:s}))};a.useEffect(()=>{O&&H()},[O]);const R=async(t=1,s="",n="",p="",S="")=>{c(!0);try{const f=["AllotementId","Competition","CompetitionCompetitionItemTitle","CompetitionGender","CompetitionGenderGenderTitle","CompetitionGroupGroupName","CompetitionLanguage","CompetitionLanguageLanguageName","CompetitionOrder","CompetitionParticipantTypeTitle","Judge","JudgeUserName","Order","Phase","PhaseTitle","Remarks","ScoreStatus","ScoreStatusScoreResultStatus","Stage","StageTitle","Status"],C=new FormData;C.append("CompetitionOrder",s??""),C.append("PageSize","10"),C.append("Competition",n??""),C.append("ScoreStatus",p??""),C.append("JudgeUserName",S??""),C.append("SortOrder","desc"),C.append("SortColumn","ModifiedDate"),C.append("select",f),C.append("PageNumber",t.toString());const K=await T.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentPlusUsersRolesJson/Get",C,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b}`}});K.data&&K.data.Results&&v(K.data.Results)}catch(f){console.error("Error fetching JudgesAllotment:",f)}finally{c(!1)}};a.useEffect(()=>{R(g)},[g]);const V=async()=>{x(!0);try{const t=new FormData,s=["*","CreatedDateString","Description","ESGId","Event","EventCategory","EventEventName","Message","ModifiedDateString","Order","RowFrom","RowTo","Status","Title","TitleEquals","TotalRowCount","Venue"];t.append("status","1"),t.append("PageSize","1000"),t.append("SortColumn","ModifiedDate"),t.append("SortOrder","desc"),t.append("PageNumber","1"),t.append("select",s);const n=new FormData,p=["*","CreatedDateString","Event","EventCategory","EventEventName","Group","GroupGroupName","IdentityNumber","JsonSettings","Message","ModifiedDateString","Order","Organization","OrganizationAllowOrganizationId","OrganizationName","OrganizationShortName","ParticipantType","RegistrationId","Role","RowFrom","RowTo","Status","TeamId","TotalRowCount","User","UserComments","UserDobString","UserEmail","UserJsonSettings","UserName","UserNameTitle","UserPhone","UserProfilePicture","UserRoleId"];n.append("status","1"),n.append("Role",F.Role),n.append("CreatedBy","12007"),n.append("select",p);const[S,f]=await T.all([T.post("https://etalenterapi.azurewebsites.net/EventStagesJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b}`}}),T.post("https://etalenterapi.azurewebsites.net/UsersRolesJson/Get",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b}`}})]);S.data&&o(S.data.Results||[]),f.data&&u(f.data.Results||[])}catch(t){console.error("Error fetching new data:",t)}finally{x(!1)}};a.useEffect(()=>{},[i,w,l]);const W=async t=>{c(!0);try{const s=new FormData;t!=null?(s.append("AllowNumberUpdate","true"),s.append("Competition",t.competition),s.append("ScoreStatus[]",t.scoreStatus),s.append("Phase","0"),s.append("Stage",t.stage),s.append("Judge",t.judge),s.append("Remarks",t.remarks),s.append("Status","1"),s.append("Order",t.order),s.append("AllotementId",t.AllotementId)):(s.append("CompetitionList[]",A.competition),s.append("undefined",""),s.append("PageSize","1000"),s.append("ScoreStatusList[]",A.scoreStatus),s.append("StageList[]",A.stage),s.append("JudgeList[]",A.judge),s.append("Remarks","desc"),s.append("Order","ModifiedDate"),s.append("AllotementId",""),s.append("IsMultiple","true"));const n=await T.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/Save",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b}`}});n.data&&n.data.Results&&R(g)}catch(s){console.error("Error Saving JudgesAllotment:",s)}finally{c(!1)}},_=async t=>{c(!0);try{const s=await T.delete("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/Remove",{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b}`},params:{AllotementId:t}});s.data&&s.data.Results&&R(g)}catch(s){console.error("Error Deleting JudgesAllotment:",s)}finally{c(!1)}},H=async()=>{c(!0);try{const t=new FormData;t.append("status","1");const s=["*","AllowPublicRegistration","AllowPublicRegistrationTitle","CompetitionItem","CompetitionItemTitle","CompetitionStatus","CompetitionStatusCompetitionStatusTitle","CompetitionStructureId","CreatedDateString","Event","EventCategory","EventEventName","Fees","Gender","GenderGenderTitle","GenerateRanks","Group","GroupGroupName","JsonSettings","Language","LanguageLanguageName","MaximumCandidates","MaximumContestantsPerUnit","MaximumMinutes","MaximumScore","MaximumSeconds","Message","MinimumMinutes","MinimumSeconds","ModifiedDateString","Order","ParticipantType","ParticipantTypeTitle","Remarks","RowFrom","RowTo","Status","TotalRowCount","Visibility","WarningMinute","WarningSecond"];t.append("select",s);const n=await T.post("https://etalenterapi.azurewebsites.net/CompetitionStructureJson/GetForAllotment",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b}`}});n.data&&n.data.Results&&U(n.data.Results||[])}catch(t){console.error("Error Fetching Competition Structures:",t)}finally{c(!1)}};a.useEffect(()=>{},[J]);const re=t=>{H(),V(),te(t),d(!0)},le=()=>{d(!1)},ie=()=>{d(!1)},de=t=>{H(),V(),I(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},[ce,ee]=a.useState([]),ue=(t,s,n)=>{v(p=>p.map(S=>S.AllotementId===t?{...S,[s]:n}:S)),ee(p=>{if(p.find(f=>f.AllotementId===t))return p.map(f=>f.AllotementId===t?{...f,[s]:n}:f);{const f=i.find(C=>C.AllotementId===t);return[...p,{...f,[s]:n}]}})},me=t=>{ce.find(n=>n.AllotementId===t)&&ee(n=>n.filter(p=>p.AllotementId!==t))},pe=t=>{I(s=>s.filter(n=>n!==t))},ge=async()=>{c(!0);try{for(const s of N)await _(s);const t=i.filter(s=>!N.includes(s.AllotementId));v(t),I([])}catch(t){console.error("Error deleting selected items:",t)}finally{c(!1)}},[Ne,ye]=a.useState({order:"",competition:"",scoreStatus:"",judgeUserName:""}),he=t=>{if(k(s=>({...s,category:t})),t){const s=i.filter(n=>n.CompetitionGroupGroupName===t);D(s),r(t)}else D(i)};return a.useEffect(()=>{},[y,L]),e.jsxs("div",{className:"AssignJudgesToCompetition",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Judges Allotment"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4 mx-auto",children:[e.jsx(be,{handleSubmit:se,handleFilterInputChange:ne,competitionStructure:J,JudgesAllotment:i,eventStages:w,userRoles:l,currentFilters:j,setIsDropdownOpen:G,onCategorySelect:he}),e.jsx("button",{onClick:()=>{V(),re("new")},className:"bg-green-500 text-white font-medium rounded-md px-12 py-1 text-sm hover:bg-green-600 transition",children:e.jsx("i",{className:"fas fa-plus mr-2"})}),N.length>0&&e.jsxs("button",{className:"bg-red-500 text-white font-medium rounded-md px-3 py-1 text-sm hover:bg-red-600 transition",onClick:ge,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete Selected"]})]}),e.jsx(Ce,{isModalOpen:m,setIsModalOpen:d,handleEditCompetition:le,handleDeleteCompetition:ie,handleSubmit:oe,formData:h==="edit"?q:A,handleInputChange:ae,modalTitle:h==="new"?"Create Competition":h==="edit"?"Edit":"Filter Competition",buttonText:h==="new"?"Create":h==="edit"?"Save changes":"Apply Filters",modalType:h,competitionStructure:J,eventStages:w,userRoles:l}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(fe,{JudgesAllotment:y?.length>0||y?.length===0&&L!==null?y:i,competitionStructure:J,selectedItems:N,handleCheckboxChange:de,handleCardDataChange:ue,saveChanges:me,cancelEdit:pe,JudgeAllotmentRemove:_,JudgeAllotmentSave:W,eventStages:w,userRoles:l,setEditCompetitionData:Z})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4",children:[e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition",disabled:g===1,onClick:()=>{const t=g-1;M(t),R(t,j.order,j.competition,j.scoreStatus,j.judgeUserName)},children:"←"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:["Page ",g]}),e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition",onClick:()=>{const t=g+1;M(t),R(t,j.order,j.competition,j.scoreStatus,j.judgeUserName)},children:"→"})]})]})}export{Te as default};
