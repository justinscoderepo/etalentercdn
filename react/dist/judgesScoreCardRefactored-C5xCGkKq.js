import{r as f,j as e,i as q,z as Z,b as Se,u as se}from"./main-C0u1OoiM.js";import{L as be}from"./layoutOuter-D0r5PUsY.js";import{P as je}from"./pageHeader-CRTP0JLy.js";import{F as le}from"./ClipboardDocumentListIcon-CX720kyk.js";import{F as Ne}from"./CheckCircleIcon-DqXAVdCk.js";import{F as xe}from"./CheckCircleIcon-BbsbA9LS.js";import{F as Ce}from"./StarIcon-3b1drVQn.js";import{F as ve}from"./TrashIcon-Dg0YcXiD.js";import{F as we}from"./TrophyIcon-y64oir3x.js";function ye({title:c,titleId:m,...o},n){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},o),c?f.createElement("title",{id:m},c):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const Ie=f.forwardRef(ye);function Je({title:c,titleId:m,...o},n){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},o),c?f.createElement("title",{id:m},c):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const ce=f.forwardRef(Je);function $e({title:c,titleId:m,...o},n){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},o),c?f.createElement("title",{id:m},c):null,f.createElement("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z",clipRule:"evenodd"}))}const Pe=f.forwardRef($e),Te=({competitions:c,processedCompetitions:m,competitionsStatus:o,selectedCompetition:n,onCompetitionSelect:C,getCompetitionStatusPriority:l,selectedGroupFilter:w,setSelectedGroupFilter:V})=>{const[$,L]=f.useState([]);f.useEffect(()=>{let t=m;w!=="all"&&(t=t.filter(u=>u.competitionGroupName===w)),L(t)},[m,w]);const x=t=>{const u=t.competitionOrder+" -"||"",g=t.competitionGroupName||"",a=t.competitionItemTitle||"",k=t.competitionGenderTitle||"",D=t.competitionLanguageName||"",E=t.statusTitle||"",J=t.competitionGender===3,O=t.competitionLanguage===4;let v=[];return u&&v.push(u),g&&v.push(g),a&&v.push(a),!J&&!O?(k&&v.push(k),D&&v.push(D)):J&&!O?D&&v.push(D):!J&&O&&k&&v.push(k),E&&v.push(`- ${E}`),v.join(" ").trim()||`Competition ${t.competitionId}`},N=t=>{switch(t){case"Filling in Progress":return 1;case"Allowed to Fill":return 2;case"Filled":return 3;case"Published":return 4;case"No Judges Assigned":return 5;default:return 6}},P=t=>{const u=t.competitionGroupName||"";let g="";if(t.judges&&t.judges.length>0){const a=t.judges.filter(J=>J.scoreStatus===1||J.scoreStatus==="1").length,k=t.judges.filter(J=>J.scoreStatus===2||J.scoreStatus==="2").length,D=t.judges.filter(J=>!J.scoreStatus||J.scoreStatus===0||J.scoreStatus==="0"||J.scoreStatus===3||J.scoreStatus==="3").length,E=t.judges.length;D>0&&D!==E?g="Filling in Progress":D===E?g="Allowed to Fill":a+k===E?g="Filled":k===E&&(g="Published")}return t._groupPriority=N(g),u&&g?`${u} - ${g}`:u||g||"General"},p=t=>t.inProgressJudges>0?"bg-blue-50 border-blue-200 text-blue-700":t.finishedJudges===t.totalJudges&&t.competitionStatus!==4?"bg-green-50 border-green-200 text-green-700":t.competitionStatus===4?"bg-purple-50 border-purple-200 text-purple-700":"bg-surface border-border text-onSurfaceVariant";return o==="loading"?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Loading competitions..."})]})}):m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"No Competitions Available"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"No competitions have been assigned yet."})]}):$.length===0?e.jsxs("div",{children:[e.jsx("h2",{className:"border-b-2 border-b-[#485257] text-[#206689] items-center mb-4 font-medium pb-1 px-1 w-full uppercase text-lg",children:"Competition & Judge Selection"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"No Competitions Found"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"No competitions match the selected group filter. Try adjusting your filter settings."})]})]}):e.jsxs("div",{className:"",children:[e.jsx("div",{className:"block lg:hidden ",children:e.jsx("div",{className:"mb-2",children:e.jsxs("select",{value:n,onChange:t=>C(t.target.value),className:"block w-full rounded-md border-0 py-2 pl-3 pr-10 text-onSurface ring-1 ring-inset ring-border focus:ring-2 focus:ring-primary focus:border-primary sm:text-sm sm:leading-6",children:[e.jsx("option",{value:"",children:w==="all"?"Choose Competition...":`Choose Competition from ${w}...`}),(()=>{const t=$.reduce((u,g)=>{const a=P(g);return u[a]||(u[a]=[]),u[a].push(g),u},{});return Object.entries(t).sort(([,u],[,g])=>{const a=u[0]?._groupPriority||999,k=g[0]?._groupPriority||999;return a-k}).map(([u,g])=>e.jsx("optgroup",{label:u,children:g.map(a=>e.jsxs("option",{value:a.competitionId,"data-competition-status":a.competitionStatus,"data-allotment-id":a.allotementId,children:[x(a)," (",a.totalJudges," judges)"]},a.competitionId))},u))})()]})})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"max-h-[calc(100vh-120px)] overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-surface hover:scrollbar-thumb-onSurfaceVariant",children:e.jsx("div",{className:"w-full pr-2",children:(()=>{const t=$.reduce((u,g)=>{const a=P(g);return u[a]||(u[a]=[]),u[a].push(g),u},{});return Object.entries(t).sort(([,u],[,g])=>{const a=u[0]?._groupPriority||999,k=g[0]?._groupPriority||999;return a-k}).map(([u,g])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-bold bg-surfaceCard text-onSurfaceVariant uppercase tracking-wide mb-2 px-2 sticky top-0  py-1 z-10",children:u}),e.jsx("div",{className:"space-y-2",children:g.map(a=>e.jsx("button",{onClick:()=>C(a.competitionId),className:`w-full text-left py-3 px-3 rounded-lg border transition-colors ${n===a.competitionId?"bg-surface text-primary border-primary":p(a)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:`font-medium mr-1 text-xs break-words ${n===a.competitionId?"text-primary":"text-onSurface"}`,title:x(a),children:x(a)})}),a.competitionCode&&e.jsx("div",{className:`mb-3 ${n===a.competitionId,"text-onSurface"}`,children:e.jsxs("p",{className:"text-xs break-words",title:`Code: ${a.competitionCode}`,children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",a.competitionCode]})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs space-y-1",children:[a.finishedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===a.competitionId,"text-green-800"}`,children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{children:a.finishedJudges})]}),a.inProgressJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===a.competitionId,"text-blue-800"}`,children:[e.jsx(Pe,{className:"h-5 w-5"}),e.jsx("span",{children:a.inProgressJudges})]}),a.notStartedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===a.competitionId,"text-onSurfaceVariant"}`,children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:a.notStartedJudges})]})]})})]})},a.competitionId))})]},u))})()})})})]})},Ve=({processedCompetitions:c,selectedCompetition:m,selectedJudges:o,onJudgeSelect:n})=>{const[C,l]=f.useState(!1),[w,V]=f.useState([]);f.useEffect(()=>{const t=()=>{l(window.innerWidth>1200)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),f.useEffect(()=>{o&&o.length>0&&V(o)},[o]);const $=t=>t.scoreStatus===1||t.scoreStatus==="1"?"bg-green-50 border-green-200 text-green-700":t.scoreStatus===2||t.scoreStatus==="2"?"bg-blue-50 border-blue-200 text-blue-700":"bg-surface border-border text-onSurfaceVariant",L=t=>t.scoreStatus===1||t.scoreStatus==="1"?"Filled":t.scoreStatus===2||t.scoreStatus==="2"?"Published":"Allowed To Fill",x=t=>{if(C){const u=w.includes(t)?w.filter(g=>g!==t):[...w,t];V(u),n(u)}else{const u=[t];V(u),n(u)}},N=t=>w.includes(t.toString());if(!m)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"Select a Competition"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Choose a competition to see available judges."})]});const p=c.find(t=>t.competitionId==m)?.judges||[];return p.length===0&&m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"No Judges Available"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"No judges found for this competition."})]}):e.jsx("div",{children:m&&e.jsx("div",{children:e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-row gap-2 flex-wrap",children:p.map(t=>e.jsxs("label",{className:`group relative flex rounded-lg border p-2 sm:p-3 min-w-24 sm:min-w-28 flex-1 sm:flex-none cursor-pointer transition-colors ${N(t.judgeId)?"border-primary bg-primary text-white shadow-sm":`${$(t)} hover:border-primary hover:shadow-sm bg-surfaceCard`}`,children:[e.jsx("input",{type:C?"checkbox":"radio",name:C?`judge-${t.judgeId}`:"judge",value:t.judgeId,checked:N(t.judgeId),onChange:()=>x(t.judgeId.toString()),className:"absolute inset-0 appearance-none focus:outline-none border-transparent outline-0 invisible"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:`block text-xs sm:text-sm font-semibold ${N(t.judgeId)?"text-white":"text-onSurface"}`,children:t.judgeName}),e.jsx("span",{className:`block text-[10px] mt-0.5 sm:mt-1 ${N(t.judgeId)?"text-blue-100":"text-onSurfaceVariant"}`,children:L(t)})]})}),e.jsx("div",{className:"absolute bottom-1 right-1 sm:bottom-2 sm:right-2",children:(t.scoreStatus===1||t.scoreStatus==="1"||t.scoreStatus===2||t.scoreStatus==="2")&&e.jsx(xe,{className:`h-3 w-3 sm:h-4 sm:w-4 ${N(t.judgeId)?"text-green-200":"text-green-500"}`})})]},t.judgeId))})})})})},ke=({participants:c,participantsStatus:m,activeParticipantId:o,currentParticipantIndex:n,participantScores:C,onParticipantSelect:l,onNavigateParticipant:w,judgeId:V,showJudgeSpecificScores:$=!1})=>{const L=x=>{if($&&V){const N=`judge_${V}_${x}`;return C[N]||C[x]||"-"}return C[x]||"-"};return m==="loading"?e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-6",children:e.jsx("div",{className:"text-center text-onSurfaceVariant py-4",children:"Loading participants..."})}):!c||c.length===0?e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"text-center text-onSurfaceVariant py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("p",{children:"No participants found"})]})}):e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm",children:e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"space-y-1",children:c.map((x,N)=>e.jsx("button",{onClick:()=>l(x.ParticipantId,N),className:q("w-full text-left p-3 rounded-md transition-colors",x.ParticipantId===o?"bg-primary text-white":"hover:bg-surface bg-surfaceCard border border-border"),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:q("text-sm font-medium",x.ParticipantId===o?"text-white":"text-onSurface"),children:x.IdentityNumber?x.IdentityNumber:x.CandidateIdentityNumber||x.ParticipantNumber}),e.jsx("div",{className:q("text-sm font-medium",x.ParticipantId===o?"text-green-200":"text-primary"),children:L(x.ParticipantId)})]})},x.ParticipantId))})})})})},ue=({value:c,onChange:m,maxStars:o=10,criteriaId:n,participantId:C,disabled:l=!1})=>{const[w,V]=f.useState(0),$=x=>{l||m(x,n,C)},L=x=>{l||V(x)};return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex items-center justify-center gap-1 mb-2 w-full",children:[...Array(o)].map((x,N)=>{const P=N+1,p=P<=(w||c||0);return e.jsx("button",{type:"button",disabled:l,className:q("flex-1 flex items-center justify-center p-1 transition-colors duration-150 max-w-8 max-h-8 aspect-square",l?"cursor-not-allowed opacity-50":"cursor-pointer",p?"text-yellow-400":"text-onSurfaceVariant hover:text-yellow-200"),onMouseEnter:()=>L(P),onMouseLeave:()=>V(0),onClick:()=>$(P),children:p?e.jsx(Ce,{className:"w-full h-full min-w-4 min-h-4"}):e.jsx(Ie,{className:"w-full h-full min-w-4 min-h-4"})},N)})})})},me=({value:c,onChange:m,maxMarks:o=100,minMarks:n=0,criteriaId:C,participantId:l,disabled:w=!1,placeholder:V="Enter marks"})=>{const $=x=>{const N=x.target.value,P=parseFloat(N);!isNaN(P)&&P>=n&&P<=o?m(P,C,l):N===""&&m(0,C,l)},L=()=>{const x=parseFloat(c);isNaN(x)||x<n?m(n,C,l):x>o&&m(o,C,l)};return e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",min:n,max:o,step:"0.1",value:c||"",onChange:$,onBlur:L,disabled:w,placeholder:V,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border disabled:bg-surface disabled:cursor-not-allowed"})})})},fe=({value:c,onChange:m,maxCount:o=10,minCount:n=0,criteriaId:C,participantId:l,disabled:w=!1,label:V="Count"})=>{const $=()=>{if(w||(c||0)>=o)return;const N=(c||0)+1;m(N,C,l)},L=()=>{if(w||(c||0)<=n)return;const N=Math.max(n,(c||0)-1);m(N,C,l)},x=N=>{const P=parseInt(N.target.value);!isNaN(P)&&P>=n&&P<=o&&m(P,C,l)};return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:L,disabled:w||(c||0)<=n,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-surface hover:bg-border disabled:opacity-50 disabled:cursor-not-allowed text-onSurfaceVariant",children:e.jsx("span",{className:"text-lg font-medium",children:"âˆ’"})}),e.jsx("div",{className:"flex-1 max-w-20",children:e.jsx("input",{type:"number",step:"0.1",min:n,max:o,value:c||0,onChange:x,disabled:w,className:"text-center pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border disabled:bg-surface disabled:cursor-not-allowed"})}),e.jsx("button",{type:"button",onClick:$,disabled:w||(c||0)>=o,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-surface hover:bg-border disabled:opacity-50 disabled:cursor-not-allowed text-onSurfaceVariant",children:e.jsx("span",{className:"text-lg font-medium",children:"+"})})]})},Ee=({activeParticipantId:c,participants:m,competitionDetails:o,criteriaScores:n,participantScores:C,participantNotes:l,onScoreChange:w,onNotesChange:V,onSaveScore:$,onDeleteScore:L,selectedCompetition:x,processedCompetitions:N,selectedJudges:P,currentJudgeId:p})=>{const[t,u]=f.useState(!1),[g,a]=f.useState({}),[k,D]=f.useState(""),[E,J]=f.useState(0),O=m?.find(i=>i.ParticipantId===c),v=N?.find(i=>i.competitionId==x),X=()=>{if(!p||!v||!v.judges)return"";const i=v.judges.find(j=>j.judgeId.toString()===p.toString());return i?i.judgeName:`Judge ${p}`},Q=(i,j=p)=>P.length>1?`${i}_judge_${j}`:i,W=()=>!o||o.length===0||o.every(j=>j.Value&&j.Value!=0&&j.Value==v.competitionMaximumScore)?!1:o.every(j=>j.Value&&j.Value!=0),R=(i=g)=>{if(!o||o.length===0)return E;let j=0;const y=W();return o.forEach(I=>{const A=I.DetailId||I.CompetitionDetailsId,F=i[A]||0;j+=F}),y?j:j/o.length},re=i=>{if(J(i),!o||o.length===0)return;const j={...g};if(W()){const I=o.reduce((A,F)=>A+(F.Value||0),0);o.forEach(A=>{const F=A.DetailId||A.CompetitionDetailsId,U=A.Value||0,K=I>0?i*U/I:0,te=A.Value||10;j[F]=Math.min(K,te)})}else o.forEach(I=>{const A=I.DetailId||I.CompetitionDetailsId,F=I.Value||10;j[A]=Math.min(i,F)});a(j)};if(f.useEffect(()=>{if(c&&p){const i={},j=Q(c),y=C[j]||0;if(J(y),o&&o.length>0&&(o.forEach(F=>{const U=F.DetailId||F.CompetitionDetailsId,K=Q(`${U}_${c}`);i[U]=n[K]||0}),!Object.values(i).some(F=>F>0)&&y>0&&R(i)!==y)){re(y);return}a(i);const I=Q(c);D(l[I]||"")}},[c,C,n,l,o,p]),!O)return e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-4 text-center",children:e.jsx("p",{className:"text-onSurfaceVariant text-sm",children:"Select a participant to begin scoring"})});const ie=async()=>{u(!0);try{const i={...O,judgeId:p,totalScore:E,criteriaScores:g,notes:k};if(await $(c,null,E,p),o&&o.length>0)for(const j of o){const y=j.DetailId||j.CompetitionDetailsId,I=g[y]||0;w(I,y,c,p),await $(c,y,I,p)}V(c,k,p),Z.success(`Score saved successfully for ${X()}!`)}catch(i){console.error("Error saving scores:",i),Z.error("Failed to save score. Please try again.")}finally{u(!1)}},H=async()=>{if(window.confirm(`Are you sure you want to delete the score for this participant from ${X()}?`)){u(!0);try{if(await L(c,null,p),o&&o.length>0)for(const i of o){const j=i.DetailId||i.CompetitionDetailsId;await L(c,j,p)}J(0),a({}),D(""),Z.success(`Score deleted successfully for ${X()}!`)}catch(i){console.error("Error deleting scores:",i),Z.error("Failed to delete score. Please try again.")}finally{u(!1)}}},ne=()=>v?.competitionMaximumScore||10,z=()=>{switch(v?.scoreLabel){case 1:return"marks";case 2:return"count";case 3:case 4:return"star";default:return"marks"}},Y=()=>z(),ee=()=>{const i=ne(),j=Y(),y={value:E,onChange:I=>re(I),disabled:t,criteriaId:"total",participantId:c};return j==="count"?e.jsx(fe,{...y,maxCount:i,label:"Total Count"}):j==="marks"?e.jsx(me,{...y,maxMarks:i,placeholder:"Enter total score"}):e.jsx(ue,{...y,maxStars:Math.min(i,10),maxScore:i})},oe=(i,j)=>{const y=i.DetailId||i.CompetitionDetailsId,I=g[y]||0,A=i.Value||10,F=Y(),U=(K,te,s)=>{const d={...g,[te]:K};a(d);const h=R(d);J(h)};return F==="count"?e.jsx(fe,{value:I,onChange:U,maxCount:A,criteriaId:y,participantId:c,disabled:t}):F==="star"?e.jsx(ue,{value:I,onChange:U,maxStars:10,maxScore:A,criteriaId:y,participantId:c,disabled:t}):e.jsx(me,{value:I,onChange:U,maxMarks:A,criteriaId:y,participantId:c,disabled:t})},ae=o&&o.length>0;return e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-md font-medium text-onSurface",children:O.CandidateName}),e.jsxs("p",{className:"text-sm text-onSurfaceVariant mt-1",children:["ID: #",O.CandidateIdentityNumber||O.TeamIdentityNumber]})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Enter Score"}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-onSurface text-sm mb-1",children:"Total Score"}),e.jsx("p",{className:"text-xs text-onSurfaceVariant",children:ae?"Enter total score (will auto-distribute to criteria below)":"Enter the participant's total score"})]})}),e.jsx("div",{className:"mt-3",children:ee()}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[E.toFixed(1)," / ",ne()]})})]})]}),ae&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Detailed Criteria Scoring (Optional)"}),e.jsx("div",{className:"border rounded-lg p-4 bg-surface",children:e.jsx("div",{className:"space-y-4",children:o.map((i,j)=>{`${i.DetailId||i.CompetitionDetailsId}${c}`;const y=i.DetailId||i.CompetitionDetailsId,I=g[y]||0,F=Y()==="star";return e.jsx("div",{className:j>0?"border-t border-border pt-4":"",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-onSurface text-sm",children:i.CriteriaName||i.CompetitionDetailsTitle}),e.jsxs("p",{className:"text-xs text-onSurfaceVariant mt-1",children:["Max: ",i.Value||10," points"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:oe(i)}),F&&e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"text-sm font-semibold text-primary",children:[I.toFixed(1)," / ",i.Value||10]})})]})]})},i.DetailId||i.CompetitionDetailsId)})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:k,onChange:i=>D(i.target.value),disabled:t,placeholder:"Add any additional comments or notes about this participant's performance...",rows:3,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border disabled:bg-surface"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("button",{onClick:H,disabled:t,className:"inline-flex items-center gap-x-2 rounded-md bg-surface px-4 py-2 text-sm font-semibold text-onSurfaceVariant shadow-sm hover:bg-border focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:[e.jsx(ve,{className:"-mr-0.5 h-5 w-5"}),"Delete Score"]}),e.jsx("button",{onClick:ie,disabled:t||E===0,className:q("inline-flex items-center gap-x-2 rounded-md px-6 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",t||E===0?"bg-surface text-onSurfaceVariant cursor-not-allowed":"bg-primary text-white hover:bg-primaryHover"),children:t?"Saving...":"Save Score"})]})]})]})},Ue=({user:c})=>{const{user:m,token:o}=Se()||{},[n,C]=f.useState([]),[l,w]=f.useState(""),[V,$]=f.useState(null),[L,x]=f.useState(0),[N,P]=f.useState(!1),[p,t]=f.useState([]),[u,g]=f.useState("all"),[a,k]=f.useState({}),[D,E]=f.useState({}),[J,O]=f.useState({}),{rows:v,status:X,update:Q}=se("/JudgesAllotmentWithScoreLabelJson/Get",{select:"AllotementId,Competition,CompetitionParticipantType,CompetitionParticipantTypeTitle,CompetitionGroup,CompetitionGroupGroupName,CompetitionCompetitionItem,CompetitionItemTitle,CompetitionItemScoreLabel,ScoreLabelLabel,CompetitionLanguage,CompetitionLanguageLanguageName,CompetitionGender,CompetitionGenderGenderTitle,CompetitionCompetitionStatus,CompetitionCompetitionStatusCompetitionStatusTitle,CompetitionEventEventName,CompetitionOrder,CompetitionMaximumScore,CompetitionFees,CompetitionMaximumMinutes,CompetitionMaximumSeconds,CompetitionMinimumMinutes,CompetitionMinimumSeconds,CompetitionWarningMinute,CompetitionWarningSecond,ScoreStatus,ScoreStatusScoreResultStatus,Phase,PhaseTitle,Stage,StageTitle,Judge,Visibility,Status,EventEventName,Order,ModifiedDateString,CompetitionStatusTitle",filter:{NoGrouping:!0,CreatedBy:m?.UId,Status:"1",Event:m?.Event},sort:{sortColumn:"CompetitionOrder"},updateUrl:"/JudgesAllotmentJson/SaveJudgeStatus"}),{rows:W}=se("/UsersRolesJson/Get",{select:"UId,UserRoleId,UserName,Name,Role,Status",filter:{Role:"6",Status:"1"}}),{rows:R,status:re,setFilter:ie}=se("/CompetitionParticipantsScoreCardJson/Get",{select:"ParticipantId,CandidateIdentityNumber,CompetitionCompetitionItem,CompetitionGender,CompetitionGroup,CompetitionLanguage,CompetitionMaximumScore,CompetitionParticipantType,IdentityNumber,Notes,ParticipantIdScore,ParticipantIdScorecardId,ParticipantType,Status,TeamIdentityNumber,CandidateName,ParticipantNumber,ScorecardId",filter:{Status:"1"},noGet:!0,updateUrl:"/JudgeJson/SaveScore",deleteUrl:"/JudgeJson/DeleteScore"}),{rows:H,setFilter:ne}=se("/JudgesDetailedScoreCardJson/Get",{select:"JudgesDetailedScoreCardId,ParticipantId,CompetitionDetailsId,Score,Judge,Competition,ScoreCard",filter:{},noGet:!0,updateUrl:"/JudgesDetailedScoreCardJson/Save",deleteUrl:"/JudgesDetailedScoreCardJson/Remove"}),{rows:z,setFilter:Y}=se("/CompetitionDetailsJson/Get",{select:"CriteriaName,DetailId,Order,SecondValue,Status,Value,Competition,CompetitionDetailsTitle,MaxScore,MinScore,CompetitionItem,ParticipantType,Gender,Group,Language,CompetitionDetailsId",filter:{},noGet:!0,updateUrl:"/CompetitionDetailsJson/Save"}),ee=s=>s.inProgressJudges>0?1:s.finishedJudges===s.totalJudges&&s.competitionStatus!==4?2:s.notStartedJudges===s.totalJudges?4:s.competitionStatus===4?5:3;f.useEffect(()=>{if(m&&m.Role===6&&p.length>0){const d=p.flatMap(h=>h.judges).find(h=>h.judgeName===m.UserName||h.judgeUserName===m.UserName||h.judgeId===m.UId||h.judgeId===m.UserRoleId);d&&C([d.judgeId.toString()])}},[m,p]),f.useEffect(()=>{if(v&&v.length>0&&W&&W.length>0){const s=v.reduce((h,r)=>{const S=r.Competition;if(h[S]||(h[S]={competitionId:S,allotementId:r.AllotementId,competitionName:r.CompetitionEventEventName||`Competition ${S}`,competitionCode:r.CompetitionCode||"",statusTitle:r.CompetitionStatusTitle||r.CompetitionCompetitionStatusCompetitionStatusTitle||"Unknown Status",competitionStatus:r.CompetitionCompetitionStatus,competitionItemTitle:r.CompetitionItemTitle,competitionGender:r.CompetitionGender,competitionGenderTitle:r.CompetitionGenderGenderTitle,competitionGroupName:r.CompetitionGroupGroupName,competitionItemScoreLabel:r.CompetitionItemScoreLabel,competitionLanguage:r.CompetitionLanguage,competitionLanguageName:r.CompetitionLanguageLanguageName,competitionOrder:r.CompetitionOrder||r.Order,competitionParticipantTypeTitle:r.CompetitionParticipantTypeTitle,scoreLabel:r.CompetitionItemScoreLabel,scoreLabelLabel:r.ScoreLabelLabel,scoreStatus:r.ScoreStatus,scoreStatusTitle:r.ScoreStatusScoreResultStatus,competitionMaximumScore:r.CompetitionMaximumScore>0?r.CompetitionMaximumScore:10,competitionFees:r.CompetitionFees,phaseTitle:r.PhaseTitle,stageTitle:r.StageTitle,judges:[],totalJudges:0,finishedJudges:0,inProgressJudges:0,notStartedJudges:0}),!h[S].judges.find(b=>b.judgeId===r.Judge&&b.allotmentId===r.AllotementId)){const b=W.find(M=>M.UserRoleId===r.Judge),B=b?b.Name||b.UserName:`Judge ${r.Judge}`;h[S].judges.push({judgeId:r.Judge,judgeName:B,judgeUserName:b?.UserName||"",scoreStatus:r.ScoreStatus,allotmentId:r.AllotementId}),h[S].totalJudges++,r.ScoreStatus===1||r.ScoreStatus==="1"?h[S].finishedJudges++:r.ScoreStatus===2||r.ScoreStatus==="2"?h[S].inProgressJudges++:h[S].notStartedJudges++}return h},{}),d=Object.values(s).sort((h,r)=>{const S=ee(h)-ee(r);if(S!==0)return S;const T=h.competitionOrder||0,b=r.competitionOrder||0;return T-b});t(d)}},[v,W]);const oe=f.useMemo(()=>{const s=[...new Set(p.map(d=>d.competitionGroupName).filter(Boolean))];return[{value:"all",label:"All Groups",count:p.length},...s.map(d=>({value:d,label:d,count:p.filter(h=>h.competitionGroupName===d).length}))]},[p]);f.useEffect(()=>{n.length>0&&l&&ie({Judge:n[0],Competition:l,Status:"1"})},[n,l]),f.useEffect(()=>{n.length>0&&l&&ne({Judge:n[0],Competition:l})},[n,l]),f.useEffect(()=>{l&&Y({Competition:l})},[l]),f.useEffect(()=>{if(H&&H.length>0){const s={},d={},h={};H.forEach(r=>{r.CriteriaId&&(s[`${r.CriteriaId}_${r.ParticipantId}`]=r.Score),r.TotalScore&&(d[r.ParticipantId]=r.TotalScore),r.Notes&&(h[r.ParticipantId]=r.Notes)}),k(s),E(d),O(h)}},[H]),f.useEffect(()=>{R&&R.length>0&&!V&&($(R[0].ParticipantId),x(0))},[R,V]);const ae=s=>{w(s),$(null),x(0)},i=s=>{C(s),$(null),x(0)},j=(s,d)=>{$(s),x(d)},y=s=>{if(!R||R.length===0)return;let d;s==="next"?(d=L+1,d>=R.length&&(d=0)):(d=L-1,d<0&&(d=R.length-1)),x(d),$(R[d]?.ParticipantId)},I=(s,d,h,r=null)=>{const S=r||n[0],T=n.length>1?`judge_${S}_`:"";if(d===null)E(b=>({...b,[`${T}${h}`]:s}));else{const b=`${T}${d}_${h}`;k(B=>({...B,[b]:s})),F(h,S)}},A=(s,d,h=null)=>{const r=h||n[0],S=n.length>1?`judge_${r}_`:"";O(T=>({...T,[`${S}${s}`]:d}))},F=(s,d=null)=>{const h=d||n[0],r=n.length>1?`judge_${h}_`:"",T=Object.keys(a).filter(b=>b.endsWith(`_${s}`)&&(n.length===1||b.startsWith(`judge_${h}_`))).reduce((b,B)=>b+(a[B]||0),0);E(b=>({...b,[`${r}${s}`]:T}))},U=async(s,d=null,h=null,r=null)=>{const S=r||n[0],T=n.length>1?`judge_${S}_`:"";try{const b={};if(b.Scores=[],d){const G={Judge:S,Competition:l,ParticipantId:s,CriteriaId:d,Score:h||a[`${T}${d}_${s}`]||0,AllotementId:v?.find(_=>_.Competition===l)?.AllotementId};b.Scores.push(G)}else if(z&&z.length>0){z.forEach(_=>{const ge=`${T}${_.DetailId||_.CompetitionDetailsId}_${s}`,de=a[ge]||0;if(de>0){const he={Judge:S,Competition:l,ParticipantId:s,CriteriaId:_.DetailId||_.CompetitionDetailsId,Score:de,AllotementId:v?.find(pe=>pe.Competition===l)?.AllotementId};b.Scores.push(he)}});const G={Judge:S,Competition:l,ParticipantId:s,ScoreCardScore:D[`${T}${s}`]||0,IsTotalScore:!0,AllotementId:v?.find(_=>_.Competition===l)?.AllotementId};b.Scores.push(G)}else{const G={Judge:S,Competition:l,ParticipantId:s,ScoreCardScore:D[`${T}${s}`]||0,AllotementId:v?.find(_=>_.Competition===l)?.AllotementId};b.Scores.push(G)}b.notes=J[`${T}${s}`]||"",b.JudgeId=S;const M=await(await fetch("/JudgeJson/SaveScore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).json();if(M.Results>0&&M.Results!=="0")return M.Results;throw new Error(typeof M.Results=="string"?M.Results:"Failed to save score")}catch(b){throw console.error("Error saving score:",b),b}},K=async(s,d=null,h=null)=>{const r=h||n[0],S=n.length>1?`judge_${r}_`:"";try{const T={Judge:r,Competition:l,ParticipantId:s};return d?(T.CriteriaId=d,(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json()).success!==!1&&k(M=>{const G={...M};return delete G[`${S}${d}_${s}`],G})):(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json()).success!==!1&&(E(M=>{const G={...M};return delete G[`${S}${s}`],G}),k(M=>{const G={...M};return Object.keys(G).forEach(_=>{_.endsWith(`_${s}`)&&(n.length===1||_.startsWith(`judge_${r}_`))&&delete G[_]}),G}),O(M=>{const G={...M};return delete G[`${S}${s}`],G})),!0}catch(T){throw console.error("Error deleting score:",T),T}},te=async()=>{if(!(n.length===0||!l)){P(!0);try{const s={Competition:l,ScoreStatus:1,AllotementId:v?.find(d=>d.Competition===l)?.AllotementId};await Q(s),Z.success("Competition marked as finished!")}catch(s){console.error("Error marking as finished:",s),Z.error("Failed to mark competition as finished.")}finally{P(!1)}}};return e.jsx(be,{children:e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx(je,{heading:"Scoring Panel",subHeading:"Select a judge and competition to begin scoring participants",rightChildren:n.length>0&&l&&e.jsxs("button",{onClick:te,disabled:N,className:q("inline-flex items-center gap-x-2 rounded-md px-4 py-2 text-sm font-semibold shadow-sm",N?"bg-surface text-onSurfaceVariant cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"),children:[e.jsx(xe,{className:"h-4 w-4"}),N?"Finishing...":"Mark as Finished"]})}),e.jsxs("div",{className:"px-2 lg:px-6 py-2",children:[p.length>0&&e.jsx("div",{className:"lg:mb-6",children:e.jsxs("div",{className:"bg-white rounded-t-lg lg:rounded-lg py-2 px-2 lg:px-6 ",children:[e.jsx("div",{className:"lg:hidden lg:mb-4 mt-1",children:e.jsx("select",{value:u,onChange:s=>g(s.target.value),className:"block w-full rounded-md border-border shadow-sm focus:border-darkprimary focus:ring-primary text-sm",children:oe.map(s=>e.jsxs("option",{value:s.value,children:[s.label," (",s.count,")"]},s.value))})}),e.jsx("nav",{className:"hidden lg:flex -mb-px space-x-4 overflow-x-auto",children:oe.map(s=>e.jsxs("button",{onClick:()=>g(s.value),className:`whitespace-nowrap py-2 px-6 border-b-2 font-medium text-sm transition-all duration-200 ${u===s.value?"border-primary text-primary bg-blue-50":"border-transparent text-onSurfaceVariant hover:text-onSurface hover:border-border"}`,children:[s.label," (",s.count,")"]},s.value))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-2",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsx("div",{className:"bg-white lg:border-t-2 lg:border-primary rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx(Te,{competitions:v,processedCompetitions:p,competitionsStatus:X,selectedCompetition:l,onCompetitionSelect:ae,getCompetitionStatusPriority:ee,selectedGroupFilter:u,setSelectedGroupFilter:g})})})}),e.jsxs("div",{className:"lg:col-span-3 space-y-2",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx(Ve,{processedCompetitions:p,selectedCompetition:l,selectedJudges:n,onJudgeSelect:i})})}),n.length>0&&l&&e.jsx("div",{className:"space-x-1 flex flex-row overflow-x-auto",children:n.map((s,d)=>{const r=p.find(S=>S.competitionId==l)?.judges?.find(S=>S.judgeId.toString()===s.toString());return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-primary",children:["Judge: ",r?.judgeName||`Judge ${s}`]}),e.jsxs("p",{className:"text-xs text-onSurfaceVariant mt-1",children:["Status: ",r?.scoreStatus===1||r?.scoreStatus==="1"?"Filled":r?.scoreStatus===2||r?.scoreStatus==="2"?"Published":"Allowed To Fill"]})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("div",{className:"w-28 flex-shrink-0",children:e.jsx(ke,{participants:R,participantsStatus:re,activeParticipantId:V,currentParticipantIndex:L,participantScores:D,onParticipantSelect:j,onNavigateParticipant:y,judgeId:s,showJudgeSpecificScores:n.length>1})}),e.jsx("div",{className:"flex-1",children:e.jsx(Ee,{activeParticipantId:V,participants:R,competitionDetails:z,criteriaScores:a,participantScores:D,participantNotes:J,onScoreChange:I,onNotesChange:A,onSaveScore:U,onDeleteScore:K,selectedCompetition:l,processedCompetitions:p,selectedJudges:[s],currentJudgeId:s})})]})]},s)})})]})]}),(n.length===0||!l)&&e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-8 text-center",children:[e.jsx(we,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-onSurface mb-2",children:"Welcome to Judge Scoring Panel"}),e.jsx("p",{className:"text-onSurfaceVariant mb-4",children:"Please select a judge and competition to begin scoring participants."}),e.jsx("div",{className:"text-sm text-onSurfaceVariant",children:"Enhanced with modern UX patterns and interactive scoring features"})]})]})]})})};export{Ue as default};
