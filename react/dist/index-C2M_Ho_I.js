import{j as t,x as A,r as p,u as x,p as I,z as r}from"./main-BxwnD9jH.js";import{L as B}from"./layoutOuter-ByjML5xi.js";import{P as E}from"./pageHeader-BXGuln3I.js";import{O}from"./OldNewTabLayout-4ImcNKBD.js";import{F as $}from"./ChevronUpIcon-B43jHPmA.js";import{F}from"./ChevronDownIcon-DZ0Iv1Pe.js";import"./navigationUtils-DlEZgzL7.js";function V(){return t.jsx(O,{oldUrl:"/Coordinator/Results",newComponent:t.jsx(M,{}),title:"Competition Results Management"})}function M(){const{eventDetails:f}=A(),[a,k]=p.useState(null),[l,y]=p.useState(null),[C,N]=p.useState({}),{rows:m=[]}=x("/CompetitionStructureJson/Get",{filter:`EventCategory=${f?.EventCategoryId||0}`,select:"CompetitionStructureId,Order,GroupGroupName,CompetitionItemTitle,GenderGenderTitle,LanguageLanguageName,ParticipantTypeTitle,CompetitionStatus,CompetitionStatusCompetitionStatusTitle",sort:"Order asc"}),{rows:o=[],refetch:w}=x("/JudgesScoreCardResultReportJson/Get",{filter:a?`ParticipantCompetition=${a}`:"",select:"Participant,CandidateIdentityNumber,TeamIdentityNumber,CandidateUserName,TeamTeamName,IdentityNumber,Score,JudgesCount,ScorecardIdRankTitle,ScorecardIdRank,ScorecardIdResultId,CalculatedScore,AutoIncreasePoints,BonusPoints,ProblematicJudge",sort:"Score desc",noGet:!a}),{rows:u=[]}=x("/RankPositionsJson/Get",{select:"RankId,Title",sort:"BonusPoints desc"}),{rows:R=[]}=x("/CompetitionStatusJson/Get",{select:"CompetitionStatusId,CompetitionStatusTitle"});p.useEffect(()=>{if(a&&m.length>0){const e=m.find(s=>s.CompetitionStructureId===a);e&&y(e.CompetitionStatus)}},[a,m]);const P=e=>{k(parseInt(e)),N({})},S=async(e,s)=>{const n=o.find(i=>i.Participant===e);if(n)try{await I("/CoordinatorJson/SaveResultReport",{Competition:a,Participant:e,Rank:s,ResultId:n.ScorecardIdResultId,Status:1,Remarks:"Updated via Results Management",AutoGenerated:0}),r.success("Rank updated successfully"),w()}catch{r.error("Failed to update rank")}},b=async e=>{if(a)try{await I("/CompetitionStructureJson/Save",{CompetitionStructureId:a,CompetitionStatus:e}),y(e),r.success("Competition status updated")}catch{r.error("Failed to update status")}},j=async(e=2)=>{if(!o.length||!u.length){r.error("No results or ranks available");return}const s=[...o].sort((d,c)=>c.Score-d.Score);let n=0,i=null,h=0;for(let d=0;d<s.length&&n<e;d++){const c=s[d];if(i===null||c.Score<i){if(n+=h,n>=e)break;h=1,i=c.Score}else h++;if(n<u.length){const J=u[n].RankId;await S(c.Participant,J),await new Promise(L=>setTimeout(L,100))}}await b(1),r.success(`Auto-generated top ${e} ranks successfully`)},T=e=>{N(s=>({...s,[e]:!s[e]}))},G=e=>{const s=[e.Order,"-",e.GroupGroupName,e.CompetitionItemTitle];return e.GenderGenderTitle&&e.GenderGenderTitle!=="Both"&&s.push(e.GenderGenderTitle),e.LanguageLanguageName&&e.LanguageLanguageName!=="Any"&&s.push(e.LanguageLanguageName),s.push(`(${e.ParticipantTypeTitle})`),s.push(`- ${e.CompetitionStatusCompetitionStatusTitle||"Not Started"}`),s.join(" ")},v=l===1,g=l===2||l===6;return t.jsxs(B,{children:[t.jsx(E,{title:`Manage Results - ${f?.EventName||""}`,description:"Manage competition results, assign ranks, and publish results"}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"md:col-span-1",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Competition *"}),t.jsxs("select",{value:a||"",onChange:e=>P(e.target.value),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset text-sm leading-6 text-gray-900 focus:border-darkprimary ring-gray-300",children:[t.jsx("option",{value:"",children:"Select Competition"}),m.map(e=>t.jsx("option",{value:e.CompetitionStructureId,children:G(e)},e.CompetitionStructureId))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Change Status"}),t.jsxs("select",{value:l||"",onChange:e=>b(parseInt(e.target.value)),disabled:!a,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset text-sm leading-6 text-onSurface focus:border-darkprimary ring-border disabled:bg-surface",children:[t.jsx("option",{value:"",children:"Select Status"}),R.map(e=>t.jsx("option",{value:e.CompetitionStatusId,children:e.CompetitionStatusTitle},e.CompetitionStatusId))]})]}),g&&t.jsxs("div",{className:"flex items-end gap-x-2",children:[t.jsx("button",{onClick:()=>j(2),className:"inline-flex items-center gap-x-2 rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700",children:"Generate Rank 1 & 2"}),t.jsx("button",{onClick:()=>j(3),className:"inline-flex items-center gap-x-2 rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700",children:"Generate Rank 1 - 3"})]})]})}),a&&t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:o.length===0?t.jsx("div",{className:"text-center py-12 bg-surface",children:t.jsx("p",{className:"text-sm text-gray-600",children:"No results available for this competition yet."})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-surface",children:t.jsxs("tr",{children:[v&&t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Rank"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Participant"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID Number"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Score Details"}),g&&t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Assign Rank"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(e=>t.jsxs("tr",{className:"hover:bg-surface",children:[v&&t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:e.ScorecardIdRankTitle||"-"}),t.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[t.jsx("span",{className:"font-mono text-primary",children:e.CandidateIdentityNumber||e.TeamIdentityNumber})," - ",e.CandidateUserName||e.TeamTeamName]}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-mono text-gray-600",children:e.IdentityNumber}),t.jsxs("td",{className:"px-4 py-3 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-x-2",children:[t.jsxs("button",{onClick:()=>T(e.Participant),className:"inline-flex items-center gap-x-1 text-primary hover:text-primaryHover font-medium",children:[t.jsx("span",{className:"text-base",children:e.Score}),C[e.Participant]?t.jsx($,{className:"h-4 w-4"}):t.jsx(F,{className:"h-4 w-4"})]}),t.jsxs("span",{className:"text-gray-600 text-xs",children:["(",e.JudgesCount," Judge",e.JudgesCount!==1?"s":"",")"]}),e.ProblematicJudge&&t.jsx("span",{className:"text-red-600 text-xs",title:e.ProblematicJudge,children:"âš "})]}),C[e.Participant]&&t.jsxs("div",{className:"mt-2 p-2 bg-surface rounded text-xs space-y-1",children:[e.AutoIncreasePoints>0&&t.jsxs("div",{children:["TieBreak Score = ",e.AutoIncreasePoints]}),e.CalculatedScore>0&&t.jsxs("div",{children:["Total Calculated Points = ",e.CalculatedScore]}),e.Score>0&&t.jsxs("div",{children:["Total Actual Points = ",e.Score]}),e.BonusPoints>0&&t.jsxs("div",{children:["Total Bonus Points = ",e.BonusPoints]})]})]}),g&&t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsxs("select",{value:e.ScorecardIdRank||"",onChange:s=>S(e.Participant,parseInt(s.target.value)),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset text-sm leading-6 text-gray-900 focus:border-darkprimary ring-gray-300",children:[t.jsx("option",{value:"",children:"Select Rank"}),u.map(s=>t.jsx("option",{value:s.RankId,children:s.Title},s.RankId))]})})]},e.Participant))})]})})})]})]})}export{V as default};
