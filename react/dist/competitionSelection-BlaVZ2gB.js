import{p as fe,r as K,j as e,R as ye,b as Ne,_ as $}from"./mainweb-DgNQVP_C.js";import{M as Ie}from"./index.modern-N5KL8RuR.js";import{c as se}from"./utilities-CN4lTu6a.js";import{u as Fe}from"./index.esm-5B1XIooB.js";import{p as Ce}from"./httpService-DHUpyI-2.js";import{B as we}from"./box-BevremPX.js";import{F as ve}from"./PencilIcon-CUcIho-I.js";import{F as Re}from"./XMarkIcon-C0jcn5YN.js";import{F as ke}from"./CheckIcon-C3fFAuR7.js";import{F as Pe}from"./PlusIcon-th41B1Jh.js";import{u as je}from"./useBackend-noNOONC8.js";import"./index-t--hEgTQ.js";const Ee=ye.lazy(()=>Ne(()=>import("./renderComponents-Bw9mrN2O.js"),[]));function Se({item:O,competitionStructureId:ie,eventDetails:F,participantsList:D,formData:j,participantId:ee,candidateId:n}){const{register:w,control:H,errors:R,handleSubmit:le,setValue:E,getValues:Y}=Fe({defaultValues:{customCompetitionFields:[]}});console.log("CustomCompetitionFields",{item:O,eventDetails:F,register:w,errors:R,control:H,setValue:E,getValues:Y,formData:j,participantId:ee,candidateId:n});let M=D.find(i=>i.CandidateId==n&&i.Competition==ie);const f=fe(O==null?void 0:O.JsonSettings),oe=(f==null?void 0:f.AdditionalTextFieldsForPubRegForm)||[],J=(f==null?void 0:f.AdditionalTextFieldsMaxLength)||1/0,Q=(f==null?void 0:f.AdditionalTextFieldsMinLength)||1;console.log("participantDetails",{participantDetails:M});let _=fe(M==null?void 0:M.JsonSettings),b=(_==null?void 0:_.customCompetitionFields)||[];const S=oe.map(i=>{var r,p;return{key:i.FieldName.replace(/\s+/g,"_").toLowerCase(),label:i.FieldName,name:`customCompetitionFields[0].${i.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:((r=i.FieldType)==null?void 0:r.toLowerCase())||"text",isRequired:((p=i.IsRequired)==null?void 0:p.toLowerCase())==="yes",conditions:[],options:[],placeholder:"",defaultValue:""}}),[y,T]=K.useState([{id:Date.now(),values:{},fields:[...S],disabled:!1}]);K.useEffect(()=>{if(b.length>0){let i=[],r=b.map((p,N)=>{console.log("row",{row:p,index:N});let m={},k={};return S.forEach(a=>{m[`customCompetitionFields[${N}].${a.key}`]=p==null?void 0:p[a.key],k[a.key]=p==null?void 0:p[a.key]}),i.push(k),{id:Date.now()+N,values:m,fields:S.map(a=>({...a,name:`customCompetitionFields[${N}].${a.key}`})),disabled:!0}});E("customCompetitionFields",i),T(r)}},[]);const q=()=>{if(y.length>=J){$.error(`You can add a maximum of ${J} rows.`);return}T(i=>[...i,{id:Date.now(),values:{},fields:S.map(r=>({...r,name:`customCompetitionFields[${i.length}].${r.key}`})),disabled:!1}])},X=async i=>{var z;let r=Y();console.log("values",{values:r});let{candidate:p,customCompetitionFields:N}=r,m=y.findIndex(A=>A.id===i);const k=N[m];if(S.filter(A=>A.isRequired&&!k.values[A.name]).length>0){$.error("Please fill all required fields before adding a new row.");return}try{let A=(z=D.find(B=>B.CandidateId==n&&B.Competition==ie))==null?void 0:z.ParticipantId;if(!A){$.error("Participant ID not found.");return}let te=await Ce("/CandidateJson/UpdateParticipantJson",{participantId:A,candidateId:j==null?void 0:j.candidate,JsonSettings:JSON.stringify(r)});console.log("API response:",te),$.success("Data saved successfully!");let Z=y[m];Z.disabled=!0,S.forEach(B=>{Z.values[`customCompetitionFields[${m}].${B.key}`]=k[B.key]}),T([...y])}catch(A){console.error("Error updating participant JSON:",A),$.error("Failed to save data.")}},u=i=>{T(r=>r.map(p=>p.id===i?{...p,disabled:!1}:p))},G=i=>{if(y.length<=Q){$.error(`You must have at least ${Q} rows.`);return}T(a=>a.filter(z=>z.id!==i));let r=Y(),{candidate:p,customCompetitionFields:N}=r,m=y.findIndex(a=>a.id===i);N.splice(m,1),E("customCompetitionFields",N),console.log("customCompetitionFields",{customCompetitionFields:N}),console.log("values",{values:r});let k=M==null?void 0:M.ParticipantId;if(!k){$.error("Participant ID not found.");return}Ce("/CandidateJson/UpdateParticipantJson",{participantId:k,candidateId:j==null?void 0:j.candidate,JsonSettings:JSON.stringify(r)}).then(a=>{console.log("API response:",a),$.success("Data deleted successfully!")}).catch(a=>{console.error("Error updating participant JSON:",a),$.error("Failed to delete data.")})};let U=S.map(i=>i.label).join(", "),s=U.lastIndexOf(",");return s>-1&&(U=U.substring(0,s)+" and"+U.substring(s)),console.log("fieldRows",{fieldRows:y}),console.log("getValues",{getValues:Y()}),S.length>0&&M&&e.jsx(we,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:"Please fill some additional inputs here, fields are "+U+" and minimum "+Q+" and maximum "+J+" rows if items are required.",headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:"Additional Inputs",children:e.jsxs("div",{className:"flex flex-col flex-grow",children:[y.map(i=>e.jsxs("div",{className:"flex flex-row gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[e.jsx(Ee,{singleRow:!0,eventDetails:F,components:i.fields,errors:R,register:w,handleSelect:()=>{},control:H,setValue:E,getValues:Y,formData:i.values,isSubmitted:i.disabled,onChangeValue:(r,p)=>{T(N=>N.map(m=>m.id===i.id?{...m,values:{...m.values,[r]:p}}:m))}},i.id),e.jsx("div",{className:"flex items-baseline gap-x-2 print:hidden",children:i.disabled?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>u(i.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:e.jsx(ve,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+i.id),e.jsx("button",{type:"button",onClick:()=>G(i.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:e.jsx(Re,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+i.id)]}):e.jsx("button",{type:"button",onClick:()=>X(i.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:e.jsx(ke,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+i.id)})]},i.id)),y.length<J&&e.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:e.jsx("button",{type:"button",onClick:q,disabled:y.length>=J,className:`rounded-full p-1.5 text-white shadow-sm ${y.length>=J?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:e.jsx(Pe,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const Ue=({fieldName:O,label:ie,errors:F,isGroupMandatory:D,participantType:j,setValue:ee,formData:n,eventDetails:w,competitions:H,participantsList:R,onChange:le,disabled:E,register:Y,control:M})=>{var te,Z,B,de,re,ae,ce,ue,pe,me,ge,xe;const{rows:f}=je("/CandidateJson/GetByAge",{sort:{sortOrder:"DESC",sortColumn:"id"},filter:{ParticipantType:(n==null?void 0:n.participantType)=="Individual"?1:(n==null?void 0:n.participantType)=="Team"?2:0,DobString:n==null?void 0:n.userDobString},doCache:!0,select:"AgeFrom,AgeTo,EventGroupId,GroupName,Status"});console.log({competitions:H,ageWiseGroup:f});let oe=F==null?void 0:F[O],[J,Q]=K.useState(oe);K.useEffect(()=>{Q(F==null?void 0:F[O])},[F==null?void 0:F[O]]);let _=(R==null?void 0:R.map(t=>t.Competition))??[],[b,S]=K.useState(_);E&&(b=_);let y=_.join(",");K.useEffect(()=>{y&&_.length>0&&S(_)},[y]);let T=function(t){t.forEach(l=>{let g=`competitionCheckBox_${l.Competition}`,d=document.querySelector(`input[name='${g}']`);d&&(d.checked=!0,le&&ee(g,!0))})};K.useEffect(()=>{(R==null?void 0:R.length)>0&&T(R)},[R]);var q=f==null?void 0:f.filter(t=>{let l=t.JsonSettings;return!!(l&&(l=JSON.parse(l),(l==null?void 0:l.IsCommon)=="Yes"))});let X=q==null?void 0:q.map(t=>t.EventGroupId),u=H??[];if(n!=null&&n.group||D)u=u.filter(t=>E&&!b.find(l=>l==t.CompetitionStructureId)?!1:!!(t.Group==(n==null?void 0:n.group)||X!=null&&X.find(l=>l==t.Group)));else{let t=[];u=u.filter(l=>!(t.find(g=>g.Title==l.Title)||(t.push(l),E&&!b.find(g=>g==l.CompetitionStructureId)))),u=t}n!=null&&n.gender&&(u=u.filter(t=>{if((n==null?void 0:n.gender)=="Male"){if(t.Gender==1||t.Gender==3)return!0}else if((n==null?void 0:n.gender)=="Female"){if(t.Gender==2||t.Gender==3)return!0}else return!0;return!1}));const G=[],U=(t,l)=>{l.target.checked?b=[...b,t]:b=b.filter(d=>d!==t),S(b),le(b)};let s=JSON.parse((w==null?void 0:w.JsonSettings)??"{}"),i=10;j=="Individual"?i=((te=s==null?void 0:s.AdditionalSettings)==null?void 0:te.MaximumParticipationPerCandidate)??10:i=((Z=s==null?void 0:s.AdditionalSettings)==null?void 0:Z.MaximumParticipationPerGroup)??10;let r=((B=s==null?void 0:s.AdditionalSettings)==null?void 0:B.FeesCurrency)??"USD",p=((de=s==null?void 0:s.AdditionalSettings)==null?void 0:de.EnablePublicAndPrivateRegistration)=="Yes",N=((re=s==null?void 0:s.AdditionalSettings)==null?void 0:re.UsePublicAndPrivateRegistrationByRegId)=="Yes",m=((ae=s==null?void 0:s.AdditionalSettings)==null?void 0:ae.CustomMaxParticipationPerCandidate)??[];if(console.log("customMaxSettings",m),u.length>0&&p&&!E)if(N){let t=s==null?void 0:s.AdditionalSettings;console.log({jsonSettings:s});let l=(ue=(ce=s==null?void 0:s.components)==null?void 0:ce.User)==null?void 0:ue.find(I=>I.type=="RegistrationIdBox");console.log({registrationBox:l});let g=t==null?void 0:t.EligibleRegistrationNumbers,d=g==null?void 0:g.find(I=>I.RegistrationNumber==(n==null?void 0:n.registrationId)),P=!1;if(l!=null&&l.conditions){let I=!0;for(let v=0;v<l.conditions.length;v++){let x=l.conditions[v],h=((me=(pe=x.key)==null?void 0:pe.charAt(0))==null?void 0:me.toLowerCase())+((ge=x.key)==null?void 0:ge.slice(1)),o=n[h];if((o==null?void 0:o.toString())!=((xe=x.value)==null?void 0:xe.toString())){I=!1;break}}I?P=!0:P=!1}else P=!0;d&&P||(u=u.filter(I=>{if(I.AllowPublicRegistration=="1")return!0}))}else u=u.filter(t=>{if(t.AllowPublicRegistration=="1")return!0});let k=b.filter(t=>u.find(l=>l.CompetitionStructureId==t)),a=(k==null?void 0:k.length)>=i;m.length>0&&j=="Individual"&&(a=!1);const z=[...new Set(u.map(t=>t.CompetitionCategoryName))],A=u.reduce((t,l)=>t.find(d=>d.CompetitionName===l.CompetitionName)?t:t.concat([l]),[]);return console.log("uniqueCategories",z),f==null||f.forEach(t=>{z.forEach(l=>{var v;let g=A.filter(x=>x.CompetitionCategoryName==l&&x.Group==t.EventGroupId),d={};if(d.CategoryName=l,d.CompetitionNames=[],g.forEach(x=>{let h=u.filter(V=>V.CompetitionCategoryName==l&&V.CompetitionName==x.CompetitionName),o={};o.CompetitionName=x.CompetitionName,o.competitions=h,d.CompetitionNames.push(o)}),m.length>0){let x=m.filter(C=>{var c;return(c=C.CompetitionCategoryId)==null?void 0:c.startsWith(l)});console.log("matchingCategories",x);let h=m.find(C=>C.CompetitionCategoryId==l);console.log("currentCategoryMax",h);let o=u.filter(C=>x.find(c=>c.CompetitionCategoryId==C.CompetitionCategoryName));console.log("items",o);var P=b.filter(C=>o.find(c=>c.CompetitionStructureId==C));console.log("filteredItemsInCategory",P);let V=P.length>=(h==null?void 0:h.MaxParticipation);if(console.log("isExceeded",V),V&&(d.isExceeded=V,d.MaxParticipation=(h==null?void 0:h.MaxParticipation)??1),l.split("-").length>1){let C=l.split(" - ")[0],c=m.find(L=>L.CompetitionCategoryId==C),he=u.filter(L=>c.CompetitionCategoryId==L.CompetitionCategoryName);console.log("parentItems",he);var I=b.filter(L=>he.find(be=>be.CompetitionStructureId==L));console.log("filteredParentItemsInCategory",I);let ne=I.length+P.length>=(c==null?void 0:c.MaxParticipation);console.log("isParentExceeded",ne),ne&&(d.isExceeded=ne,d.MaxParticipation=(c==null?void 0:c.MaxParticipation)??1)}}if(g.length>0){let x=(v=g[0])==null?void 0:v.GroupName;if(G.find(h=>h.GroupName==x))G.find(o=>o.GroupName==x).items.push(d);else{let h={GroupName:x,items:[d]};G.push(h)}}})}),console.log("competitionItems",H),e.jsx("div",{className:"mt-4  print:mt-0",children:e.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[G.length==0&&e.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}),a&&e.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:e.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",i," competition per ",j=="Individual"?"candidate":"team","."]})}),G==null?void 0:G.map((t,l)=>{var g;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-3 print:mb-0 rounded-md print:border-0 print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-3  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-2xl px-5 print:text-lg font-semibold leading-6 text-blue-900",children:t.GroupName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500"})]})}),(g=t==null?void 0:t.items)==null?void 0:g.map((d,P)=>{var I;return e.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-xl  print:text-lg font-semibold leading-6 text-cyan-600",children:d.CategoryName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Competitions"})]})}),e.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:(I=d.CompetitionNames)==null?void 0:I.map((v,x)=>{var h;return e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:e.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[e.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:v.CompetitionName}),e.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),e.jsx("div",{className:"mt-2 flex flex-wrap",children:(h=v.competitions)==null?void 0:h.map((o,V)=>{let W=b.find(c=>c==o.CompetitionStructureId)!=null,C=!!(E||!W&&a);return d.isExceeded&&!W&&(C=!0),q==null||q.find(c=>c.EventGroupId==o.Group),console.log("item",o),console.log("item2",v),console.log("item3",d),e.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("label",{onClick:c=>{if((a||d.isExceeded)&&C){d.isExceeded?$.error("You can't select more than "+d.MaxParticipation+" competitions from "+d.CategoryName):$.error("You can select maximum "+i+" competitions only");return}},className:se(C?"":"ml-2","block text-sm text-gray-900"),children:[!C&&e.jsx("input",{type:"checkbox",id:`competitionCheckBox_${o.CompetitionStructureId}`,className:se(" h-5 w-5 optiontext-darkprimary ",J?"border-red-300  text-red-600 focus:ring-red-800":C?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:C,fieldName:`competitionCheckBox_${o.CompetitionStructureId}`,checked:W,onChange:c=>{U(o.CompetitionStructureId,c)}},V),C&&!W&&e.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),e.jsxs("span",{className:"hidden print:flex",children:[(w==null?void 0:w.AllowDisplayCompetitionOrder)==1?o.CompetitionOrder+" - ":""," ",o.Title]}),e.jsx("span",{className:se(E?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(J?"text-danger":"text-gray-900")),children:((w==null?void 0:w.AllowDisplayCompetitionOrder)==1?o.CompetitionOrder+" - ":"")+(o.Title.replace(v.CompetitionName,"").replace(/ /gi,"").trim()!==""?o.Title.replace(v.CompetitionName,"").trim():v.CompetitionName.trim())})]})}),e.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:(o==null?void 0:o.Remarks)&&e.jsx(Ie,{children:o.Remarks})}),o.Fees>0&&e.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:e.jsxs("b",{children:["Fees:",e.jsxs("i",{className:"text-green-700 font-medium",children:[" ",o.Fees,r]})]})}),e.jsx(Se,{eventDetails:w,item:o,competitionStructureId:o.CompetitionStructureId,candidateId:o.CandidateId,register:Y,errors:F,control:M,participantsList:R,setValue:ee,getValues:null,setFormData1:()=>{},formData:n})]},P+"_"+x+"_"+o.CompetitionStructureId)})})]},P+"_"+x)})})]},P)})]},l)})})]})})};export{Ue as default};
