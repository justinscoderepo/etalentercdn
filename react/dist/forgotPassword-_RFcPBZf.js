import{r,j as t,N as B}from"./mainweb-B3qkTOUv.js";import{a as u}from"./index-BtuGy7By.js";import{B as a,Q as G}from"./ReactToastify-Cb4S0pQU.js";import"./clsx-B-dksMZM.js";const L=()=>{const[o,E]=r.useState(""),[g,w]=r.useState(!0),[v,x]=r.useState(!1),[O,P]=r.useState(!1),[C,m]=r.useState(!1),[i,j]=r.useState(!1),[h,k]=r.useState(""),[b,f]=r.useState(!0),[N,l]=r.useState(!1),[n,S]=r.useState(""),[d,F]=r.useState(""),[c,I]=r.useState(""),V="https://etalenterapi.azurewebsites.net/PublicJson/GetUserCheck",A="https://etalenterapi.azurewebsites.net/PublicJson/UsersActivation",D="https://etalenterapi.azurewebsites.net/PublicJson/GetOTPCheck",R="https://etalenterapi.azurewebsites.net/PublicJson/UsersForgotPassword",p=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),y=e=>e.length===6&&/^\d{6}$/.test(e);r.useEffect(()=>{const e=setTimeout(()=>{k(o)},500);return()=>{clearTimeout(e)}},[o]),r.useEffect(()=>{if(p(h)){const e={Email:h};u.post(V,e,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{s.data===!0?f(!0):(f(!1),a.error("This email ID is not registered with us."))}).catch(s=>{console.error("Error checking user:",s),f(!1),a.error("Error checking user, please try again.")})}else w(!1)},[h]);const U=e=>{const s=e.target.value;E(s),P(!1),w(p(s)),x(!1)},z=()=>{if(p(o)){m(!0),a.info("OTP button will activate in 20 seconds."),setTimeout(()=>{m(!1),a.success("OTP is sent to your email. Please check and fill the fields. Sometimes it may take a few seconds to receive the email, kindly wait. If not found, check the spam folder.")},2e4);const e={Email:o,isForgotPassword:!0};u.post(A,e,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{x(!0),P(!0)}).catch(s=>{console.error("Error sending OTP:",s),a.error("Failed to send OTP, please try again."),m(!1)})}else a.error("Please enter a valid email address.")},T=()=>{y(n)?u.post(D,{Email:o,OTP:n},{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e.data===!0?(l(!0),a.success("OTP is valid.")):(a.error("OTP is not valid."),l(!1))}).catch(e=>{console.error("Error validating OTP:",e),a.error("Invalid OTP. Please try again."),l(!1)}):a.error("Please enter a valid 6-digit OTP.")},J=e=>{const s=e.target.value;S(s),j(y(s)),i&&T()};r.useEffect(()=>{i&&T()},[i]);const q=()=>{if(!o||!n||!d||!c){a.error("All fields are required.");return}if(d!==c){a.error("Passwords do not match.");return}try{const e={"Content-Type":"multipart/form-data"};u.post(R,{Email:o,OTP:n,Password:d,confirmPassword:c},{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{s.data===!0?(a.success("Password Changed."),B("/")):(a.error("Password not Changed."),l(!1))}).catch(s=>{console.error("Error Changing Password:",s),a.error("Error Changing Password."),l(!1)})}catch(e){console.error("Unexpected error:",e),a.error("An unexpected error occurred. Please try again."),l(!1)}};return t.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md mx-auto mt-10",children:[t.jsx("h1",{className:"text-2xl font-bold text-center mb-6 text-blue-800",children:"Forgot Password"}),t.jsxs("form",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),t.jsx("input",{type:"email",id:"email",value:o,onChange:U,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter your email",required:!0}),!g&&o&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Please enter a valid email address."}),!b&&o&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"This email ID is not registered with us."})]}),g&&b&&!v&&t.jsx("button",{onClick:z,type:"button",disabled:C,className:"w-full py-2 px-4 bg-green-600 text-white rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Get OTP via Email"}),O&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700",children:"Enter OTP"}),t.jsx("input",{type:"text",id:"otp",value:n,onChange:J,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter OTP"})," "]}),i&&N&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700",children:"New Password"}),t.jsx("input",{type:"password",id:"newPassword",value:d,onChange:e=>F(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter new password"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),t.jsx("input",{type:"password",id:"confirmPassword",value:c,onChange:e=>I(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Confirm new password"})]}),t.jsx("button",{type:"button",onClick:q,className:"w-full py-2 px-4 bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700",children:"Change Password"})]})]}),t.jsx(G,{})]})};export{L as default};
