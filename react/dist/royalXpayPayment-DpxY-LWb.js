import { r as reactExports, j as jsxRuntimeExports, i as classNames, p as post, z as zt } from "./main-B7w5eCOl.js";
import { V as ValidationMessage } from "./validationMessage-D3Gjn0ek.js";
import { F as ForwardRef } from "./CheckCircleIcon-BMZ-5cUh.js";
import { F as ForwardRef$1 } from "./ExclamationTriangleIcon-D83nSzlE.js";
import { F as ForwardRef$2 } from "./CreditCardIcon-ByH6krF8.js";
import { F as ForwardRef$3 } from "./GlobeAltIcon-kUk_6aZB.js";
import { F as ForwardRef$4 } from "./ShieldCheckIcon-DFqwosKz.js";
import { F as ForwardRef$5 } from "./ArrowPathIcon-BKnvswe3.js";
const RoyalXpayPayment = ({ label, errors, register, formData, onChangeValue, disabled, readOnly, optional, component }) => {
  const fieldName = "royalXpayPayment";
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [paymentCompleted, setPaymentCompleted] = reactExports.useState(false);
  const [orderId, setOrderId] = reactExports.useState(null);
  const [paymentLink, setPaymentLink] = reactExports.useState(null);
  const merchantKey = component?.merchantKey || "";
  const merchantSecret = component?.merchantSecret || "";
  const amount = component?.amount || formData?.amount || "0.00";
  const currency = component?.currency || "AED";
  const description = component?.description || "Payment";
  const isLiveMode = component?.isLiveMode || false;
  const customerInfo = {
    email: formData?.email || formData?.customerEmail || "",
    firstName: formData?.firstName || formData?.customerFirstName || "",
    lastName: formData?.lastName || formData?.customerLastName || "",
    mobilePhone: formData?.mobilePhone || formData?.customerPhone || "",
    phone: formData?.phone || formData?.customerPhone || ""
  };
  const billingInfo = {
    city: formData?.city || formData?.billingCity || "",
    stateProvince: formData?.state || formData?.billingState || "",
    country: formData?.country || formData?.billingCountry || "UAE",
    postcodeZip: formData?.zipCode || formData?.billingZip || "",
    street: formData?.address || formData?.billingAddress || "",
    street2: formData?.address2 || formData?.billingAddress2 || ""
  };
  let errorsForField = errors?.[fieldName];
  let [error, setError] = reactExports.useState(errorsForField);
  reactExports.useEffect(() => {
    setError(errors?.[fieldName]);
  }, [errors?.[fieldName]]);
  reactExports.useEffect(() => {
    setPaymentCompleted(formData?.[fieldName] === true);
  }, [formData?.[fieldName]]);
  const validateRequiredFields = () => {
    const required = [];
    if (!customerInfo.email) required.push("Email");
    if (!customerInfo.firstName) required.push("First Name");
    if (!customerInfo.lastName) required.push("Last Name");
    if (!customerInfo.mobilePhone) required.push("Mobile Phone");
    if (!billingInfo.city) required.push("City");
    if (!billingInfo.stateProvince) required.push("State/Province");
    if (!billingInfo.street) required.push("Address");
    if (parseFloat(amount) <= 0) required.push("Amount");
    return required;
  };
  const createRoyalXpayOrder = async () => {
    try {
      setIsProcessing(true);
      setError("");
      const missingFields = validateRequiredFields();
      if (missingFields.length > 0) {
        throw new Error(`Missing required fields: ${missingFields.join(", ")}`);
      }
      const orderRequest = {
        registrationId: formData?.registrationId || formData?.id || null,
        billing: {
          address: {
            city: billingInfo.city,
            stateProvince: billingInfo.stateProvince,
            country: billingInfo.country,
            postcodeZip: billingInfo.postcodeZip,
            street: billingInfo.street,
            street2: billingInfo.street2
          }
        },
        order: {
          amount: parseFloat(amount).toFixed(2),
          currency,
          description,
          id: ""
          // Will be generated by API
        },
        customer: {
          email: customerInfo.email,
          firstName: customerInfo.firstName,
          lastName: customerInfo.lastName,
          mobilePhone: customerInfo.mobilePhone,
          phone: customerInfo.phone || customerInfo.mobilePhone
        }
      };
      const response = await post("/api/royalxpay/create-order", orderRequest);
      if (response.success) {
        setOrderId(response.orderId);
        setPaymentLink(response.paymentLink);
        zt.success("Payment order created successfully!");
        if (response.paymentLink) {
          window.open(response.paymentLink, "_blank", "width=800,height=600,scrollbars=yes,resizable=yes");
        }
      } else {
        throw new Error(response.message || "Failed to create payment order");
      }
    } catch (error2) {
      console.error("RoyalXpay order creation failed:", error2);
      setError(error2.message);
      zt.error(error2.message);
    } finally {
      setIsProcessing(false);
    }
  };
  const markPaymentCompleted = () => {
    setPaymentCompleted(true);
    if (onChangeValue) {
      onChangeValue(fieldName, true);
    }
    setError("");
    zt.success("Payment marked as completed!");
  };
  const resetPayment = () => {
    setPaymentCompleted(false);
    setOrderId(null);
    setPaymentLink(null);
    if (onChangeValue) {
      onChangeValue(fieldName, false);
    }
  };
  const isConfigured = merchantKey && merchantSecret;
  const canInitiatePayment = isConfigured && !disabled && !readOnly && !paymentCompleted;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "sm:col-span-4 mb-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-blue-600 to-purple-600 px-4 py-2 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("img", { src: "https://royalxpay.com/assets_frontend/images/RoyalXpay-whitewithtransparent.png", alt: "RoyalXpay", className: "h-8 object-contain filter brightness-0 invert" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "ml-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-gray-900", children: [
            label || "RoyalXpay Payment",
            !optional && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-red-500 ml-1", children: "*" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center mt-1", children: isLiveMode ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-green-600", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Live Mode" })
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-orange-600", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-orange-500 rounded-full mr-2" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Test Mode" })
          ] }) })
        ] })
      ] }),
      paymentCompleted && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-green-600", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef, { className: "h-6 w-6 mr-2" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Completed" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("input", { type: "hidden", ...register(fieldName, { required: !optional }), value: paymentCompleted ? "true" : "" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: classNames("border rounded-lg p-6 bg-gradient-to-br from-white to-gray-50", paymentCompleted ? "border-green-300 bg-green-50" : "border-gray-300", error ? "border-red-300" : ""),
        children: [
          !isConfigured && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-4 p-4 bg-amber-50 border border-amber-200 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef$1, { className: "h-5 w-5 text-amber-600 mr-2" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-amber-800", children: "RoyalXpay not configured. Please set up merchant credentials." })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "font-medium text-gray-900 flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef$2, { className: "h-5 w-5 mr-2 text-gray-600" }),
                "Payment Details"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Amount:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-medium", children: [
                    currency,
                    " ",
                    parseFloat(amount).toFixed(2)
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Currency:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: currency })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Description:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: description })
                ] }),
                orderId && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Order ID:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-mono text-xs", children: orderId })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "font-medium text-gray-900 flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef$3, { className: "h-5 w-5 mr-2 text-gray-600" }),
                "Customer Info"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Email:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium truncate ml-2", children: customerInfo.email || "Not provided" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Name:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-medium", children: [
                    customerInfo.firstName,
                    " ",
                    customerInfo.lastName
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-600", children: "Phone:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: customerInfo.mobilePhone || "Not provided" })
                ] })
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef$4, { className: "h-5 w-5 text-blue-600 mr-2" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-blue-900", children: "Secure Payment Features" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-sm text-blue-800 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• 3D Secure Authentication" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• PCI DSS Compliant" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• SSL Encrypted Transactions" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Supports Major Credit Cards (Visa, Mastercard, Amex)" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col sm:flex-row gap-3", children: !paymentCompleted ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                type: "button",
                onClick: createRoyalXpayOrder,
                disabled: !canInitiatePayment || isProcessing,
                className: classNames(
                  "flex-1 inline-flex items-center justify-center gap-x-2 rounded-md px-6 py-3 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",
                  canInitiatePayment && !isProcessing ? "bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700 focus-visible:outline-blue-600" : "bg-gray-200 text-gray-700 cursor-not-allowed"
                ),
                children: isProcessing ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef$5, { className: "h-5 w-5 animate-spin" }),
                  "Creating Order..."
                ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef$2, { className: "h-5 w-5" }),
                  "Pay with RoyalXpay"
                ] })
              }
            ),
            paymentLink && /* @__PURE__ */ jsxRuntimeExports.jsx("button", { type: "button", onClick: markPaymentCompleted, className: "px-4 py-2 text-sm font-medium text-green-700 bg-green-100 border border-green-300 rounded-md hover:bg-green-200", children: "Mark as Completed" })
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between w-full", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-green-600", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(ForwardRef, { className: "h-6 w-6 mr-2" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Payment Completed Successfully" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("button", { type: "button", onClick: resetPayment, className: "px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200", children: "Reset" })
          ] }) }),
          !isLiveMode && isConfigured && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "font-medium text-yellow-900 mb-3", children: "Testing Information" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-3 bg-blue-50 border border-blue-200 rounded", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium text-blue-900 mb-1", children: "Test Merchant Credentials" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-blue-800 text-xs", children: "• Merchant Key: Any 16-digit number (e.g., live-1234567890123456)" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-blue-800 text-xs", children: "• Merchant Secret: Any 23-digit number (e.g., sec-12345678901234567890123)" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h6", { className: "font-medium text-yellow-900 mb-2", children: "Test Cards" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4 text-sm", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium text-yellow-800", children: "Mastercard" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-700", children: "5123450000000008 (3D Secure)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-700", children: "5111111111111118 (No 3D)" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium text-yellow-800", children: "Visa" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-700", children: "4508750015741019 (3D Secure)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-700", children: "4012000033330026 (No 3D)" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium text-yellow-800", children: "American Express" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-700", children: "345678901234564 (3D Secure)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-700", children: "371449635398431 (No 3D)" })
              ] })
            ] })
          ] })
        ]
      }
    ),
    error && /* @__PURE__ */ jsxRuntimeExports.jsx(ValidationMessage, { message: error })
  ] });
};
export {
  RoyalXpayPayment as default
};
