import{r as a,u as b,j as e,L as E,z as l,p as R}from"./main-BN7QtsnD.js";function C({title:i,titleId:d,...n},c){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":d},n),i?a.createElement("title",{id:d},i):null,a.createElement("path",{fillRule:"evenodd",d:"M10.5 3.75a6 6 0 0 0-5.98 6.496A5.25 5.25 0 0 0 6.75 20.25H18a4.5 4.5 0 0 0 2.206-8.423 3.75 3.75 0 0 0-4.133-4.303A6.001 6.001 0 0 0 10.5 3.75Zm2.03 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72v4.94a.75.75 0 0 0 1.5 0v-4.94l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z",clipRule:"evenodd"}))}const S=a.forwardRef(C),P=({onEventDataImported:i,currentUser:d})=>{const[n,c]=a.useState(""),[f,u]=a.useState(!1),[o,v]=a.useState([228,229]),{rows:m,status:j}=b("/RankPositionsJson/Get",{select:"RankId,Title",doCache:!0}),{rows:p,status:h}=b("/UsersRolesPlusUsersJson/GetCoordinatorEvents",{select:"Event,EventEventName",sort:{sortOrder:"desc",sortField:"UserRoleId"},doCache:!0});console.log("All Coordinator Events:",p);const y=p,N=async()=>{if(!n){l.error("Please select an event");return}u(!0);try{const{data:t}=await R("/CoordinatorJson/GetEventDataForSubmission",{sourceEventId:parseInt(n),allowedRanks:o.length>0?o:null});if(t.Results){const s=t.Results;if(s.ParticipantCount===0){l.error("No participants found for the selected criteria. Try adjusting rank filters or verify the source event has results."),u(!1);return}const r=g(s),x=w(s),k={headers:r,data:x,sourceInfo:{type:"event",sourceEventName:s.SourceEventName,sourceEventId:s.SourceEventId,participantCount:s.ParticipantCount}};i(k),l.success(`Ready to import ${s.ParticipantCount} participants from ${s.SourceEventName}`),c("")}else l.error(t.Message||"Failed to load event data")}catch(t){console.error("Error loading event data:",t),l.error("Error loading event data")}finally{u(!1)}},g=t=>{const s=["UserName","IdentityNumber","RegistrationId"];return s.push("GroupName"),t.EventLevels&&t.EventLevels.forEach(r=>{s.push(`${r.LevelName}Name`)}),s.push("UserDob","UserGender","UserPhone","UserMobile","UserEmail","UserProfilePicture"),t.CompetitionColumns&&s.push(...t.CompetitionColumns),s},w=t=>{if(!t.ExcelData)return[];const s=g(t);return t.ExcelData.map(r=>s.map(x=>r[x]||""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-onSurface mb-2",children:"Select Source Event"}),h==="loading"?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(E,{info:"Loading your coordinator events..."})}):e.jsxs("select",{value:n,onChange:t=>c(t.target.value),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset  focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary focus:ring-0 placeholder:text-onSurfaceVariant ring-border",children:[e.jsx("option",{value:"",children:"Select an event"}),p?.map(t=>e.jsx("option",{value:t.Event,children:t.EventEventName},t.Event))]}),y?.length===0&&h!=="loading"&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"No coordinator events found. You must be a coordinator of other events to use this feature."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-onSurface mb-2",children:"Import Participants by Rank (Optional)"}),j==="loading"?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(E,{info:"Loading ranks..."})}):e.jsx("div",{className:"flex flex-wrap gap-3",children:m&&m.length>0?m.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.includes(t.RankId),onChange:s=>{s.target.checked?v([...o,t.RankId]):v(o.filter(r=>r!==t.RankId))},className:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t.Title})]},t.RankId)):e.jsx("p",{className:"text-sm text-gray-500",children:"No ranks available"})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave unchecked to import all participants regardless of rank"})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:N,disabled:!n||f,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin -ml-1 mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"-mr-0.5 h-5 w-5"}),"Prepare for Import"]})})})]})};export{P as default};
