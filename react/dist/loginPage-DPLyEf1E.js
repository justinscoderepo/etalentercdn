import{a as x,r as v,b as q,j as a}from"./mainweb-4_qHxBOH.js";import{a as A}from"./axios-CCb-kr4I.js";import{Q as G,B as P}from"./ReactToastify-WiEfZZjy.js";import{A as $}from"./authContext-DYjkHNtS.js";import"./clsx-B-dksMZM.js";const H=()=>{let s=null;return typeof localStorage<"u"&&localStorage.getItem("USER")&&(s=JSON.parse(localStorage.getItem("USER"))),s};let I=new Date,R=1;function U(...s){if((new Date().getTime()-I.getTime())/1e3>10&&(console.info(`%c===========================================

                Session ${R}

===========================================`,"color: white; font-style: italic; font-weight:bold; font-size:14px"),R++,I=new Date),s.length>0)try{if(localStorage.getItem("development")){console.info("%c"+s[0],"color: orange; font-style: italic; font-weight:bold; font-size:14px");let n=s.reduce(function(o,r,i){return i!=0?typeof r=="object"?Object.assign(o,r):Object.assign(o,{[i-1]:r}):o},{});console.info(n)}}catch{}}let u=window.location.origin;function g(s){location.origin.includes("bksbahrain")?u="https://gcckalotsavam.bksbahrain.com/":location.origin.includes("talentmaster")?u="https://talentmaster.pypa.live/":s===!0?u="https://talenter.azurewebsites.net/":u="https://etalenterapi3.azurewebsites.net/"}const h={headers:{"Content-Type":"application/x-www-form-urlencoded","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest"}};console.log("apiRoot"+u);const m=A.create({baseURL:u}),M=s=>{if(s.headers.Platform="Web",g(),localStorage.USER&&s.url.indexOf("login")==-1){let{token:e,refreshToken:t}=H();e&&(s.headers.Authorization=`Bearer ${e}`),t&&(s.headers.RefreshToken=t)}return s},W=s=>{if(U("responseFailed",s),s&&s.response&&s.response.data&&s.response.data.statusCode===401){var e=window.location.search.replace("?","").split("&"),t=e.filter(o=>o.toLowerCase().indexOf("dataset=")!=-1);if(t&&t.length>0){var n=t[0].split("=")[1];n&&(localStorage.clear(),window.location.href=""+window.location.href)}if(localStorage.userData){let{roleId:o}=JSON.parse(localStorage.userData).user;o==5&&(localStorage.clear(),window.location.href=""+window.location.href)}return localStorage.clear(),window.location.href="#logout",Promise.reject({...s})}return s.request&&s.request.status&&(s.request.status==="400"||s.request.status==="404")?Promise.reject({...s}):Promise.reject({...s})},B=s=>{if(localStorage.userData){let e=JSON.parse(localStorage.userData),{accesstoken:t,refreshtoken:n}=s.headers;t!=null&&n!==null&&t!==e.accessToken&&n!==e.refreshToken&&(e.accessToken=t,e.refreshToken=n,localStorage.removeItem("userData"),localStorage.setItem("userData",JSON.stringify(e)))}return s};function w(s){if(U("errorHandler",s),s){let{response:e}=s,{data:t}=e||{};s&&s.isAxiosError&&!e?x.error("Network Issue or Server Down",{autoClose:3e3,toastId:"network"}):e&&e.status==401&&t.message&&typeof t.message=="string"?x.error(t.message,{autoClose:3e3,toastId:"network"}):e&&e.status==401?x.error(JSON.stringify(t),{autoClose:3e3,toastId:"network"}):t&&t.statusCode&&t.statusCode==400&&t.message&&typeof t.message=="string"?x.error(t.message,{autoClose:3e3,toastId:"network"}):t&&t.statusCode&&t.statusCode==400&&t.message?x.error(t.message,{autoClose:3e3,toastId:"network"}):x.error(JSON.stringify(t),{autoClose:3e3,toastId:"network"})}}function X(s,e,t){if(e){s+="?";let n=[],o=["query","createUrl","filter"];for(const i in e)if(Object.hasOwnProperty.call(e,i)){let l=e[i];o.indexOf(i.toString())===-1&&l!=null&&n.push(`${i}=${l.toString()}`)}let r=[];for(const i in t)if(Object.hasOwnProperty.call(t,i)){let l=t[i];typeof l=="string"?r.push(`${i}=${l}`):r.push(`${i}=${l}`)}return r.length&&n.push(`${r.join("&")}`),s+=n.join("&"),s}return s}class f{constructor(){m.interceptors.request.handlers.length===0&&(m.interceptors.request.use(e=>M(e)),m.interceptors.response.use(e=>B(e),e=>W(e)))}getWithHeader(e,t){if(g(),e)return m.get(u+e,t,h)}async get(e,t,n,o,r,i){g();let l={};return l.select=t??["id"],o!=null&&o.sortOrder&&(o!=null&&o.sortField)&&(l.sortField=o.sortField,l.sortOrder=o.sortOrder),l.filter=n,l.page=r+1,l.take=i??10,e=X(e,l,n),new Promise((b,p)=>{if(e)try{m.get(u+e,h).then(d=>{b(d)}).catch(d=>{w(d),p(d)})}catch(d){p(d)}})}async postAsGet(e,t,n,o,r,i){g();let l={};return l.select=t??["id"],o!=null&&o.sortOrder&&(o!=null&&o.sortColumn)&&(l.sortColumn=o.sortColumn,l.sortOrder=o.sortOrder),l.PageNumber=r+1,l.pageSize=i??10,l={...l,...n},new Promise((b,p)=>{if(e)try{m.post(u+e,l,h).then(d=>{b(d)}).catch(d=>{w(d),p(d)})}catch(d){p(d)}})}async blob(e,t){return g(),new Promise((n,o)=>{if(e)try{m.get(u+e,t,{...h,responseType:"blob"}).then(r=>{n(r)}).catch(r=>{w(r),o(r)})}catch(r){o(r)}})}post(e,t,n=!1){return n===!0?g(n):g(),new Promise((o,r)=>{if(e)try{return m.post(u+e,t,{...h}).then(i=>{o(i)}).catch(i=>{w(i),r(i)})}catch(i){r(i)}})}upload(e,t){return g(),new Promise((n,o)=>{if(e)try{return m.post(u+e,t,{...h,headers:{...h.headers,"Content-Type":"multipart/form-data"}}).then(r=>{n(r)}).catch(r=>{w(r),o(r)})}catch(r){o(r)}})}put(e,t){return g(),new Promise((n,o)=>{if(e)try{return m.put(u+e,t,h).then(r=>{n(r)}).catch(r=>{w(r),o(r)})}catch(r){o(r)}})}remove(e,t){return g(),new Promise((n,o)=>{if(e)try{return m.delete(u+e,{...h,data:t}).then(r=>{n(r)}).catch(r=>{w(r),o(r)})}catch(r){o(r)}})}}new f;new f;new f;new f;new f;const{post:E}=new f;new f;new f;new f;new f;const Z=()=>{const[s,e]=v.useState(""),[t,n]=v.useState(""),[o,r]=v.useState(!1),i=q(),[l,b]=v.useState(""),{setAccessToken:p,setUser:d}=v.useContext($),T="Account/LoginUser",D="UsersRolesPlusUsersJson/GetRoles",z=async y=>{var k,O;y.preventDefault();const J={email:s,password:t,IsCrossRequest:!0},C=new FormData,L=["*","ApprovalStatus","CompetitionLevel","CreatedByIn","CreatedDateString","Event","EventCategory","EventEventName","Group","GroupCompetitions","GroupGroupName","IdentityNumber","IsPasswordSet","JsonSettings","Message","ModifiedDateString","Order","Organization","OrganizationName","ParticipantType","Participations","RegistrationId","Role","RowFrom","RowTo","SearchTerm","SixDigitPassword","Status","TotalRowCount","User","UserComments","UserDobString","UserEmail","UserEmailCode","UserJsonSettings","UserMobile","UserName","UserNameCode","UserNameTitle","UserPhone","UserProfilePicture","UserRoleId","UserTitleNameTitle"];C.append("isCaching","true"),C.append("select",L);try{const S=await E(T,J,!0),{user:c,token:N}=S.data;if(!N||!c)throw new Error("Token or user data is missing.");localStorage.setItem("accessToken",N),localStorage.setItem("userInfo",JSON.stringify(c)),p(N),d(c);const F={token:N,user:{Name:c.Name,EventName:c.EventName,EventCategory:c.EventCategory,Event:c.Event,Email:c.Email,Role:c.Role,RoleTitle:c.RoleTitle,UserRoleId:c.UserRoleId,UId:c.UId,Organization:c.Organization,OrganizationLevel:c.OrganizationLevel,OrganizationLogo:c.OrganizationLogo,EventLogo:c.EventLogo}};localStorage.setItem("USER",JSON.stringify(F));try{const j=await E(D,C);localStorage.setItem("roles",JSON.stringify(j.data))}catch(j){console.error("Roles fetch error:",j),P.error("Failed to fetch roles.")}i("/JudgeScoreCard")}catch(S){console.error("Error:",S),b(S.message||"An unexpected error occurred."),P.error(((O=(k=S.response)==null?void 0:k.data)==null?void 0:O.message)||"Login failed. Please try again.")}};return a.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md mx-auto",children:[a.jsx("h1",{className:"text-2xl font-bold text-center mb-6 text-blue-800",children:"LOGIN"}),a.jsxs("blockquote",{className:"text-sm text-gray-600 mb-6",children:["Welcome to the login portal, where you can access different roles:",a.jsxs("ul",{className:"list-disc pl-5 mt-2 text-left",children:[a.jsx("li",{children:"Event Manager"}),a.jsx("li",{children:"Coordinator"}),a.jsx("li",{children:"Sub-Coordinator"}),a.jsx("li",{children:"Projector Operator"}),a.jsx("li",{children:"Competition Judge"}),a.jsx("li",{children:"Content/Print Administrator"})]})]}),a.jsx("blockquote",{className:"text-sm text-gray-600 mb-6",children:a.jsx("div",{className:"warning",children:a.jsxs("p",{children:["Note: If you are a ",a.jsx("b",{children:"candidate"}),"/",a.jsx("b",{children:"guardian"}),", please login from the ",a.jsx("b",{children:"email link"})," you have received."]})})}),a.jsxs("form",{onSubmit:z,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),a.jsx("input",{type:"email",id:"email",value:s,onChange:y=>e(y.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter your email",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx("input",{type:o?"text":"password",id:"password",value:t,onChange:y=>n(y.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-4 py-3",placeholder:"Enter your password",required:!0}),a.jsxs("button",{type:"button",onClick:()=>r(!o),className:"absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-gray-700",children:[o?"Hide":"Show"," "]})]})]}),l&&a.jsx("div",{className:"text-red-600 text-sm mt-2",children:l}),a.jsx("button",{type:"submit",className:"w-full py-2 px-4 bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Log In"})]}),a.jsx("div",{className:"mt-6 text-center",children:a.jsx("a",{onClick:()=>i("/ForgotPasswordPage"),className:"text-blue-600 hover:underline text-sm cursor-pointer",children:"Forgot Password? Reset here"})}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("a",{href:"/register",className:"text-blue-600 hover:underline text-sm",children:"New User? Register as an Event Manager"})}),a.jsx(G,{})]})};export{Z as default};
