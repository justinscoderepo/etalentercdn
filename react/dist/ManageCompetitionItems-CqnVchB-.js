import{r as s,m as D,C as v,z as c,p as y,j as e,L as F,i as $}from"./main-C46Odvrx.js";import{B as z}from"./box-Dy_m9RWA.js";import{F as B}from"./XMarkIcon-CkMFG6CF.js";import{F as H}from"./PlusIcon-C2oHB7gR.js";import{F as G}from"./TableCellsIcon-bfSvHTfI.js";import{F as N}from"./TrophyIcon-CDPCbJWG.js";import{F as q}from"./StarIcon-Cpc9IBwJ.js";import{F as Z}from"./PencilSquareIcon--9V6oqAB.js";import{F as U}from"./TrashIcon-DGGIM1aT.js";function W({title:n,titleId:d,...a},m){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":d},a),n?s.createElement("title",{id:d},n):null,s.createElement("path",{d:"M9.375 3a1.875 1.875 0 0 0 0 3.75h1.875v4.5H3.375A1.875 1.875 0 0 1 1.5 9.375v-.75c0-1.036.84-1.875 1.875-1.875h3.193A3.375 3.375 0 0 1 12 2.753a3.375 3.375 0 0 1 5.432 3.997h3.943c1.035 0 1.875.84 1.875 1.875v.75c0 1.036-.84 1.875-1.875 1.875H12.75v-4.5h1.875a1.875 1.875 0 1 0-1.875-1.875V6.75h-1.5V4.875C11.25 3.839 10.41 3 9.375 3ZM11.25 12.75H3v6.75a2.25 2.25 0 0 0 2.25 2.25h6v-9ZM12.75 12.75v9h6.75a2.25 2.25 0 0 0 2.25-2.25v-6.75h-9Z"}))}const Y=s.forwardRef(W),K=()=>new Promise((n,d)=>{if(window.JSONEditor){n(window.JSONEditor);return}const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js",a.onload=()=>n(window.JSONEditor),a.onerror=d,document.head.appendChild(a)});function ie(){const{eventDetails:n}=D(),[d,a]=s.useState(!1),[m,J]=s.useState([]),[k,T]=s.useState([]),[R,I]=s.useState([]),[f,x]=s.useState(!1),[p,w]=s.useState(null),i=s.useRef(null),b=s.useRef(null),[o,h]=s.useState({Title:"",Category:"",ScoreLabel:"",JsonSettings:"{}"});s.useEffect(()=>{u(),P(),A()},[n]);const u=s.useCallback(async()=>{if(n?.EventCategory){a(!0);try{const t=await v("/CompetitionItemsJson/Get",{EventCategory:n.EventCategory,PageSize:1e3});t&&t.Results&&(J(t.Results),t.Results.length===0&&x(!0))}catch(t){console.error("Error loading competitions:",t),c.error("Failed to load competitions")}finally{a(!1)}}},[n]),P=s.useCallback(async()=>{try{const t=await v("/CompetitionCategoriesJson/Get",{PageSize:1e3});t&&t.Results&&T(t.Results)}catch(t){console.error("Error loading categories:",t)}},[]),A=s.useCallback(async()=>{try{const t=await v("/ScoreLabelJson/Get",{PageSize:1e3});t&&t.Results&&I(t.Results)}catch(t){console.error("Error loading scoring methods:",t)}},[]),E=s.useCallback(async()=>{if(b.current)try{const t=await K();let r={};try{r=o.JsonSettings?JSON.parse(o.JsonSettings):{}}catch{r={}}const l={title:"Competition Settings",type:"object",properties:{TimeCalculation:{type:"string",title:"Time Calculation Method",enum:["PerHead","PerPhase","TotalTime"],options:{enum_titles:["Per Head","Per Phase","Total Time"],inputAttributes:{class:"form-control"},containerAttributes:{class:"col-sm-25"}}},MaxParticipants:{type:"number",title:"Maximum Participants",options:{inputAttributes:{class:"form-control"},containerAttributes:{class:"col-sm-25"}}},AllowTeamRegistration:{type:"string",title:"Allow Team Registration",enum:["No","Yes"],options:{inputAttributes:{class:"form-control"},containerAttributes:{class:"col-sm-25"}}}}};Object.keys(r).forEach(g=>{l.properties[g]&&(l.properties[g].default=r[g])}),i.current&&i.current.destroy();const S=new t(b.current,{theme:"bootstrap4",schema:l,disable_array_add:!1,disable_array_delete:!1,disable_array_reorder:!1,disable_collapse:!0,disable_edit_json:!1,disable_properties:!0,no_additional_properties:!1,startval:r});S.on("change",()=>{const g=S.getValue();h(_=>({..._,JsonSettings:JSON.stringify(g)}))}),i.current=S}catch(t){console.error("Failed to load JSON Editor:",t),c.error("Failed to load settings editor")}},[o.JsonSettings]);s.useEffect(()=>{if(f){const t=setTimeout(()=>{E()},100);return()=>clearTimeout(t)}else i.current&&(i.current.destroy(),i.current=null)},[f,p,E]);const j=s.useCallback(()=>{i.current&&(i.current.destroy(),i.current=null),h({Title:"",Category:"",ScoreLabel:"",JsonSettings:"{}"}),w(null),x(!1)},[]),C=s.useCallback((t,r)=>{h(l=>({...l,[t]:r}))},[]),O=s.useCallback(async()=>{if(!o.Title.trim()){c.error("Competition Title is required");return}if(!o.Category){c.error("Competition Type is required");return}if(!o.ScoreLabel){c.error("Scoring Method is required");return}try{o.JsonSettings&&o.JsonSettings.trim()&&JSON.parse(o.JsonSettings)}catch{c.error("Invalid JSON format in JSON Settings");return}a(!0);try{const t={...o,CompetitionId:p,EventCategory:n?.EventCategory},r=await y("/CompetitionItemsJson/Save",t);if(r&&r.success!==!1)c.success(p?"Competition updated successfully":"Competition saved successfully"),j(),await u();else throw new Error(r?.message||"Failed to save competition")}catch(t){console.error("Error saving competition:",t),c.error(t.message||"Failed to save competition")}finally{a(!1)}},[o,p,n,j,u]),L=s.useCallback(t=>{i.current&&(i.current.destroy(),i.current=null),h({Title:t.Title||"",Category:t.Category||"",ScoreLabel:t.ScoreLabel||"",JsonSettings:t.JsonSettings||"{}"}),w(t.CompetitionId),x(!0)},[]),M=s.useCallback(async t=>{if(window.confirm("Are you sure you want to delete this competition?")){a(!0);try{const r=await y("/CompetitionItemsJson/Remove",{CompetitionId:t});if(r&&r.success!==!1)c.success("Competition deleted successfully"),await u();else throw new Error(r?.message||"Failed to delete competition")}catch(r){console.error("Error deleting competition:",r),c.error(r.message||"Failed to delete competition")}finally{a(!1)}}},[u]),V=s.useCallback(async t=>{const r=t.Status===2?1:2;a(!0);try{const l=await y("/CompetitionItemsJson/Save",{...t,Status:r});if(l&&l.success!==!1)c.success(`Competition ${r===2?"activated":"deactivated"} successfully`),await u();else throw new Error(l?.message||"Failed to update competition status")}catch(l){console.error("Error updating competition status:",l),c.error(l.message||"Failed to update competition status")}finally{a(!1)}},[u]);return d&&m.length===0?e.jsx(F,{}):e.jsx(z,{heading:"Competition Categories Setup",description:"Define competition items like Dance, Music, Speech, etc. with appropriate scoring methods",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center justify-between",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("button",{onClick:()=>x(!f),className:$("inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200",f?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),children:f?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Hide Form"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"New Competition"]})})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("a",{href:`/CompetitionItems/Manage/${n?.EventCategory||""}/null`,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 rounded-lg transition-colors duration-200",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Table View"]})})]}),f&&e.jsxs("div",{className:"bg-surfaceCard rounded-lg p-6 border-2 border-dashed border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-onSurface mb-4 flex items-center",children:[e.jsx(N,{className:"w-5 h-5 mr-2 text-blue-600"}),p?"Edit Competition Item":"Add New Competition Item"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-1",children:"Competition Title *"}),e.jsx("input",{type:"text",value:o.Title,onChange:t=>C("Title",t.target.value),placeholder:"e.g., Song, Dance, Speech",className:"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-1",children:"Competition Type *"}),e.jsxs("select",{value:o.Category,onChange:t=>C("Category",t.target.value),className:"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Please Select"}),k.map(t=>e.jsx("option",{value:t.ProgramCategoryId,children:t.CategoryName},t.ProgramCategoryId))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-1",children:"Scoring Method *"}),e.jsxs("select",{value:o.ScoreLabel,onChange:t=>C("ScoreLabel",t.target.value),className:"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Please Select"}),R.map(t=>e.jsx("option",{value:t.LabelId,children:t.Label},t.LabelId))]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-onSurface mb-2",children:["Competition Settings",e.jsx("span",{className:"text-xs text-onSurfaceVariant ml-2",children:"(Optional - Advanced configuration)"})]}),e.jsx("div",{ref:b,className:"border border-border rounded-md p-4 bg-white",style:{minHeight:"200px"}}),e.jsx("p",{className:"text-xs text-onSurfaceVariant mt-2",children:"Configure advanced settings like time calculation method, participant limits, and team registration options."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-4 border-t",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 text-sm font-medium text-onSurfaceVariant bg-surfaceVariant hover:bg-surfaceCard rounded-lg transition-colors duration-200",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:d,className:"px-6 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors duration-200 disabled:opacity-50",children:d?"Saving...":p?"Update Competition":"Save Competition"})]})]}),e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsxs("div",{className:"text-center py-8 bg-surfaceCard rounded-lg border-2 border-dashed border-border",children:[e.jsx(N,{className:"w-12 h-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("p",{className:"text-onSurfaceVariant mb-2",children:"No competition items found"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Please add new competition items to get started"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(t=>e.jsxs("div",{className:"bg-contentBgOuter border border-border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 flex items-center mb-1",children:[e.jsx(Y,{className:"w-5 h-5 mr-2 text-blue-600"}),t.Title]})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.Status===2,onChange:()=>V(t),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-surfaceVariant peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-contentBgOuter after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(N,{className:"w-4 h-4 mr-2 text-sky-500"}),e.jsx("span",{className:"text-onSurfaceVariant",children:"Type:"}),e.jsx("span",{className:"ml-1 font-medium text-onSurface",children:t.CategoryCategoryName||"Not specified"})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(q,{className:"w-4 h-4 mr-2 text-yellow-500"}),e.jsx("span",{className:"text-onSurfaceVariant",children:"Scoring:"}),e.jsx("span",{className:"ml-1 font-medium text-onSurface",children:t.ScoreLabelLabel||"Not specified"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>L(t),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-green-700 bg-green-100 hover:bg-green-200 rounded transition-colors duration-200",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs("button",{onClick:()=>M(t.CompetitionId),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-700 bg-red-100 hover:bg-red-200 rounded transition-colors duration-200",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},t.CompetitionId))})}),m.length>0&&e.jsxs("div",{className:"bg-surface border border-primary/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-blue-900 font-medium mb-2",children:"What's next?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["•"," ",e.jsx("a",{href:"/CompetitionStructure/Tab",className:"underline hover:text-blue-600",children:"Assign Competition Items to Age Groups?"})]}),e.jsxs("li",{children:["•"," ",e.jsx("a",{href:"/SetUp/ScoreSettings",className:"underline hover:text-blue-600",children:"Configure Scoring Criteria & Points?"})]}),e.jsxs("li",{children:["•"," ",e.jsx("a",{href:"/Coordinator/ManageBulkParticipants",className:"underline hover:text-blue-600",children:"Add Participants to Competitions?"})]})]})]}),d&&m.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-contentBgOuter rounded-lg p-6 shadow-lg",children:e.jsx(F,{})})})]})})}export{ie as default};
