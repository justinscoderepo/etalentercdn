import{p as y}from"./mainweb-B3qkTOUv.js";function q(i,P,n){var w,U,k,x,E,M;if(n!=null&&n.JsonSettings){let s=y(n==null?void 0:n.UserJsonSettings),c=y(n==null?void 0:n.JsonSettings);n={...n,...s,...c}}let J={};Object.keys(n).forEach(s=>{var l;let c=((l=s[0])==null?void 0:l.toLowerCase())+s.slice(1);J[c]||(J[c]=n[s])}),n={...n,...J},n!=null&&n.RegistrationId&&!(n!=null&&n.registrationId)&&(n.registrationId=n.RegistrationId);const _=n?Object.keys(n).filter(s=>s.includes("extra_payment_")):[],b=i==null?void 0:i.AdditionalSettings,u=(U=(w=i==null?void 0:i.components)==null?void 0:w.User)==null?void 0:U.find(s=>s.type==="RegistrationIdBox"),A=b==null?void 0:b.EligibleRegistrationNumbers;let e=[];if(((k=n==null?void 0:n.teamMembers)==null?void 0:k.length)>0&&((x=i==null?void 0:i.AdditionalSettings)==null?void 0:x.AllowTeamDiscountIfCaptainIsEligible)==="Yes"){const s=(E=n==null?void 0:n.teamMembers)==null?void 0:E.find(p=>p.Designation===4),c=y(s==null?void 0:s.UserJsonSettings),l=y(s==null?void 0:s.JsonSettings);n={...n,...c,...l,...s},n.registrationId=s==null?void 0:s.RegistrationId}const K=A==null?void 0:A.find(s=>s.RegistrationNumber===((n==null?void 0:n.registrationId)??"-"));let L=u!=null&&u.conditions?u.conditions.every(s=>{var p,O;const c=n[`${s.key.charAt(0).toLowerCase()}${s.key.slice(1)}`],l=n[s.key];return(c==null?void 0:c.toString())===((p=s.value)==null?void 0:p.toString())||(l==null?void 0:l.toString())===((O=s.value)==null?void 0:O.toString())}):!0;if(K&&L&&(u!=null&&u.discountPercentage)){const s=parseFloat(u.discountPercentage);e.push({Title:u.discountTitle,DiscountPercent:s})}const T=P.reduce((s,c)=>s+parseFloat(c.Fees),0),g=P.map(s=>({name:`${s.Title} - ${s.CompetitionCategoryName}`,total:s.Fees})),C=_.flatMap(s=>{const c=y(n[s]);return Object.entries(c).filter(([l,p])=>p.checked).map(([l,p])=>({name:l,total:p.fees}))}),R=C.reduce((s,c)=>s+parseFloat(c.total),0);let h=0;if(e.length>0){const s=e[0],c=parseFloat(s.DiscountPercent);h=T*c/100}const $=T+R,N=$-h,v=((M=i==null?void 0:i.AdditionalSettings)==null?void 0:M.FeesCurrency)??"USD",I=[];return g.length>0&&I.push({heading:"Competitions Fees",total:g.reduce((s,c)=>s+parseFloat(c.total),0),products:g}),C.length>0&&I.push({heading:"Extra Fees",total:R,products:C}),e.length>0&&I.push({heading:"Discount",total:`-${h}`,products:e.map(s=>({name:s.Title,total:`-${h}`}))}),{products:g,subTotal:$,discountPrice:h,extraPayments:C,total:N,feesCurrency:v,discounts:e,orders:I}}export{q as c};
