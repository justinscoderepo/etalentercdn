import{r as N,m as xt,e as Rt,z as j,j as t,p as Mt,u as Lt,L as $t}from"./main-D6fL8wl5.js";import{u as Ut}from"./useConfirmation-EFq2LVbL.js";import{r as Dt,u as Tt}from"./xlsx-BojT3SgY.js";import{F as Pt}from"./CheckIcon-Dq_28et7.js";import{F as Gt}from"./DocumentArrowDownIcon-3j2aa7uA.js";import{F as Ye}from"./ArrowPathIcon-Cc1XK9BG.js";import{F as we}from"./XMarkIcon-D6ixvQvE.js";import{F as je}from"./CheckIcon-Df_DGzMi.js";import{h as pt,L as ht,z as gt,Q as Nt}from"./dialog-B0FPhjVi.js";import{F as At}from"./ExclamationTriangleIcon-51HDBAVC.js";import"./TrashIcon-BCKCcSC1.js";import"./keyboard-B66pbDPr.js";import"./description-DAT-36ca.js";import"./use-is-mounted-QNgqEsQy.js";import"./navigationUtils-iQi8X97Q.js";function _t({title:xe,titleId:p,...Y},le){return N.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:le,"aria-labelledby":p},Y),xe?N.createElement("title",{id:p},xe):null,N.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const He=N.forwardRef(_t),Ot=({competitions:xe,selectedGroupFilter:p,selectedParticipantType:Y,currentUser:le,updateParticipantLocal:k,usersList:F,participantsList:me,setParticipantFilter:Je,eventDataToImport:T=null,onEventDataProcessed:de=null})=>{const u=e=>e?e.trim().replace(/\s+/g," "):"",C=xe.map(e=>({...e,Title:u(e.Title||e.CompetitionName),GroupName:u(e.GroupName||e.GroupName)}));console.log({competitions:C});const ce=`excelImport_${le?.Event}_${p}_${Y}`,[Ce,qe]=N.useState(!0),[We,Ie]=N.useState([]),[De,pe]=N.useState(""),[Q,G]=N.useState([]),[he,Ee]=N.useState(new Set),[bt,Fe]=N.useState([]),[Qe,Se]=N.useState(1),[vt,Te]=N.useState(!1),[Re,X]=N.useState(!1),Me=N.useRef(!1),se=N.useRef({}),{groups:R,eventLevels:Pe}=xt();Rt();const g={USER_NAME:"UserName",IDENTITY_NUMBER:"IdentityNumber",REGISTRATION_ID:"RegistrationId",GROUP_NAME:"GroupName",USER_DOB:"UserDob",USER_GENDER:"UserGender",USER_PHONE:"UserPhone",USER_MOBILE:"UserMobile",USER_EMAIL:"UserEmail",USER_PROFILE_PICTURE:"UserProfilePicture"},P=(Pe||[]).slice(1).map(e=>`${e.LevelName}Name`),Le=P.length>0?P.join(", "):null,ue=e=>{try{const s={rawCsv:e,timestamp:Date.now()};sessionStorage.setItem(ce,JSON.stringify(s))}catch(s){console.error("Failed to save to session storage:",s)}},$e=(e,s)=>{const n=[];let r="",l=!1;for(let o=0;o<e.length;o++){const a=e[o],i=e[o+1];a==='"'?l&&i==='"'?(r+='"',o++):l=!l:a===s&&!l?(n.push(r.trim()),r=""):r+=a}return n.push(r.trim()),n},J=e=>{if(e)try{const s=e.split(`
`).filter(M=>M.trim()),n=s[0]||"",r=n.includes("	")?"	":n.includes(";")?";":",",l=s.map(M=>$e(M,r));if(l.length===0){j.error("No data found in CSV");return}const o=l[0],a=l.slice(1),i=o.map(M=>u(M)),c=(!p||p==="all")&&i.filter(M=>R.filter(w=>M.toLowerCase().indexOf(w.GroupName.toLowerCase())>-1&&M.toLowerCase()!=="groupname").length>0).length>0,v=(()=>{const M=C.some(U=>{const H=U.GroupName?u(`${U.Title} (${U.GroupName})`):null;return H&&i.some(be=>u(be)===H)}),w=C.some(U=>{const H=u(U.Title);return i.some(be=>u(be)===H)});return M||w})(),B=(()=>{if(!v)return[];if(c){const M=C.map(w=>w.GroupName?u(`${w.Title} (${w.GroupName})`):u(w.Title));return[...new Set(M)]}else return[...new Set(C.map(w=>u(w.Title)))]})(),Z=[g.USER_NAME,g.IDENTITY_NUMBER,g.REGISTRATION_ID,...!p||p=="all"?[g.GROUP_NAME]:[],g.USER_DOB,g.USER_GENDER,...P,g.USER_PHONE,g.USER_MOBILE,g.USER_EMAIL,g.USER_PROFILE_PICTURE,...B],{headers:V,data:b,mapping:L}=h(o,a,Z);if(V.length!==Z.length){j.error(`Header mismatch: Expected ${Z.length} columns, got ${V.length}`);return}const oe=[V,...b];Ie(oe),X(!0),setTimeout(()=>{try{Ct(V,b,Z,c,B)}finally{X(!1)}},10)}catch(s){console.error("Failed to process CSV:",s),j.error("Failed to process CSV data"),X(!1)}};N.useEffect(()=>{try{const e=sessionStorage.getItem(ce);if(e){const{rawCsv:s,timestamp:n}=JSON.parse(e);(Date.now()-n)/(1e3*60*60)<24&&s?(pe(s),J(s),j.success("Restored CSV data from previous session")):sessionStorage.removeItem(ce)}}catch(e){console.error("Failed to load from session storage:",e)}},[ce]),N.useEffect(()=>{if(T&&T.headers&&T.data){console.log("Processing event data import:",T),X(!0);const e=T.headers.join(","),s=T.data.map(r=>r.join(",")),n=[e,...s].join(`
`);qe(!0),pe(n),J(n),ue(n),de&&de(T.sourceInfo),j.success(`Loaded ${T.sourceInfo?.participantCount||0} participants from ${T.sourceInfo?.sourceEventName||"event"}`)}},[T,de]);const[A,ge]=N.useState(null),Ze=({title:e,description:s,confirmButtonLabel:n,cancelButtonLabel:r,showConfirmAllButton:l})=>new Promise(o=>{ge({title:e,description:s,confirmButtonLabel:n,cancelButtonLabel:r,showConfirmAllButton:l,onConfirm:()=>{ge(null),o(!0)},onConfirmAll:()=>{ge(null),o("confirmAll")},onCancel:()=>{ge(null),o(!1)}})});(()=>{const e={};return[].forEach(n=>{const r=n.CompetitionName?.toLowerCase().replace(/[^a-z0-9]/g,"");r&&(e[r]||(e[r]=[]),e[r].push({CompetitionStructureId:n.CompetitionStructureId,CompetitionName:n.CompetitionName,GroupName:n.GroupName,GenderName:n.GenderName,LanguageName:n.LanguageName,EventGroupId:n.EventGroupId}))}),e})();const re=e=>{if(!F||F.length===0)return null;const s=F.filter(n=>{const r=Y==2?n.TeamTeamName:n.UserName;return e.name=="Jisa P Reji"&&r=="Jisa P Reji",r?.toLowerCase().trim()===e.name?.toLowerCase().trim()?P.every(a=>{const i=n.LevelSettings?.[a]||n[a],c=e[a];return i?.toLowerCase().trim()===c?.toLowerCase().trim()}):!1});return s.length>1?{error:!0,type:"MULTIPLE_MATCHES",count:s.length,matches:s}:s.length===1?s[0]:null},Ue=(e,s)=>{if(!Q||Q.length===0)return null;const n=Q.filter((r,l)=>{if(l===s)return!1;const o=u(r.name||""),a=u(e.name||"");if(!(o.toLowerCase()===a.toLowerCase()))return!1;const c=u(r.dob||""),v=u(e.dob||"");return c.toLowerCase()===v.toLowerCase()?P.every(V=>{const b=r[V],L=e[V];return u(b||"").toLowerCase()===u(L||"").toLowerCase()}):!1});return n.length>0?{error:!0,type:"LOCAL_DUPLICATES",count:n.length,matches:n,indices:Q.map((r,l)=>n.includes(r)?l:-1).filter(r=>r!==-1)}:null},q=(e,s)=>{if(!me||me.length===0)return!1;const n=re(e);if(n?.error&&n.type==="MULTIPLE_MATCHES"||!n)return!1;const r=Y==2?n.Team||n.TeamId:n.Candidate||n.UserRoleId;return r?me.some(o=>o.Competition===s.toString()&&o.Candidate===r.toString()):!1},Ge=e=>re(e)?!e.participations||Object.keys(e.participations).length===0?!0:Object.keys(e.participations).every(r=>{const l=e.participations[r];return!l||!l.CompetitionStructureId?!0:q(e,l.CompetitionStructureId)}):!1,Ae=e=>e?.toLowerCase().replace(/[^a-z0-9]/g,"")||"",f=(e,s)=>{const n=Ae(s);return e.findIndex(r=>Ae(r)===n)},h=(e,s,n)=>{const r=n.map(a=>f(e,a)),l=n.map((a,i)=>{const c=r[i];return c>=0?e[c]:a}),o=s.map(a=>n.map((i,c)=>{const v=r[c];return v>=0&&a[v]!==void 0&&a[v]||""}));return{headers:l,data:o,mapping:r}},y=async e=>{const s=e.target.files?.[0];if(!s)return;const n=s.name.split(".").pop()?.toLowerCase();X(!0);try{if(n==="csv"){const r=await s.text();pe(r),J(r),ue(r),j.success("CSV file loaded successfully")}else if(n==="xlsx"||n==="xls")try{const r=await s.arrayBuffer(),l=Dt(r,{type:"array"}),o=l.SheetNames[0],a=l.Sheets[o],i=Tt.sheet_to_csv(a);pe(i),J(i),ue(i),j.success("Excel file loaded and converted successfully")}catch(r){console.error("Excel processing error:",r),j.error("Failed to process Excel file. Please try again or use CSV format."),X(!1)}else j.error("Unsupported file format. Please upload CSV or Excel (.xlsx, .xls) files."),X(!1)}catch(r){console.error("File upload error:",r),j.error("Failed to process file"),X(!1)}e.target.value=""},te=e=>!e||e.trim()===""?{valid:!0,error:null}:(e.match(/[a-zA-Z]/g)||[]).length<3?{valid:!1,error:"Name must have at least 3 letters"}:{valid:!0,error:null},$=e=>!e||e.trim()===""?{valid:!0,error:null}:(e.match(/\d/g)||[]).length<5?{valid:!1,error:"Phone must have at least 5 digits"}:{valid:!0,error:null},ne=e=>!e||e.trim()===""?{valid:!1,error:"This field is required and cannot be empty"}:e.trim().length<3?{valid:!1,error:"Must have at least 3 characters"}:{valid:!0,error:null},Ne=(e,s,n)=>{const r=String(e).padStart(2,"0"),l=String(s).padStart(2,"0"),o=String(n);return`${r}-${l}-${o}`},_e=e=>{if(!e||e.trim()==="")return{valid:!0,error:null,formattedDate:null};const s=e.trim();if(s.includes("-")){const n=s.split("-");if(n.length!==3)return{valid:!1,error:"Date with - must have format: YYYY-MM-DD or DD-MM-YYYY"};const[r,l,o]=n.map(B=>parseInt(B,10));if(isNaN(r)||isNaN(l)||isNaN(o))return{valid:!1,error:"Date parts must be valid numbers"};let a,i,c;if(r>31?(a=r,i=l,c=o):(c=r,i=l,a=o),a<1900||a>2100)return{valid:!1,error:"Year must be between 1900 and 2100"};if(i<1||i>12)return{valid:!1,error:"Month must be between 1 and 12"};if(c<1||c>31)return{valid:!1,error:"Day must be between 1 and 31"};const v=new Date(a,i-1,c);return v.getMonth()!==i-1||v.getDate()!==c?{valid:!1,error:"Invalid day for the given month"}:{valid:!0,error:null,formattedDate:Ne(c,i,a)}}else if(s.includes("/")){const n=s.split("/");if(n.length!==3)return{valid:!1,error:"Date with / must have format: DD/MM/YYYY or MM/DD/YYYY"};const[r,l,o]=n.map(B=>parseInt(B,10));if(isNaN(r)||isNaN(l)||isNaN(o))return{valid:!1,error:"Date parts must be valid numbers"};let a,i,c;if(r>12?(a=r,i=l,c=o):l>12?(i=r,a=l,c=o):(a=r,i=l,c=o),c<1900||c>2100)return{valid:!1,error:"Year must be between 1900 and 2100"};if(i<1||i>12)return{valid:!1,error:"Month must be between 1 and 12"};if(a<1||a>31)return{valid:!1,error:"Day must be between 1 and 31"};const v=new Date(c,i-1,a);return v.getMonth()!==i-1||v.getDate()!==a?{valid:!1,error:"Invalid day for the given month"}:{valid:!0,error:null,formattedDate:Ne(a,i,c)}}else return{valid:!1,error:"Date must contain / or - separator"}},wt=e=>!e||e.trim()===""?{valid:!0,error:null}:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())?{valid:!0,error:null}:{valid:!1,error:"Invalid email format"},jt=e=>{if(!e||e.trim()==="")return{valid:!0,error:null};const s=e.trim().toLowerCase();return s!=="male"&&s!=="female"?{valid:!1,error:"Gender must be 'Male' or 'Female'"}:{valid:!0,error:null}},Ct=(e,s,n,r,l)=>{if(!s||s.length===0)return;const o=[],a=[],i=W=>n.indexOf(W),c=i(g.USER_NAME),v=i(g.IDENTITY_NUMBER),B=i(g.REGISTRATION_ID),Z=i(g.GROUP_NAME),V=i(g.USER_DOB),b=i(g.USER_GENDER),L=i(g.USER_PHONE),oe=i(g.USER_MOBILE),M=i(g.USER_EMAIL),w=i(g.USER_PROFILE_PICTURE),U=P.map(W=>i(W)),H=C.length>0?i(r&&C[0]?.GroupName?`${C[0]?.GroupName} ${C[0]?.Title}`:C[0]?.Title):n.length,be=n.length;for(let W=0;W<s.length;W++){const I=s[W];if(I.length<3||I.every(m=>!m||String(m).trim()===""))continue;const E=[],_=W+2,Xe=u(c>=0?I[c]||"":I[0]||""),Oe=u(v>=0&&I[v]||""),ke=u(B>=0&&I[B]||"");let O=u(Z>=0&&I[Z]||"");const et=u(L>=0&&I[L]||""),tt=u(oe>=0&&I[oe]||""),st=u(M>=0&&I[M]||""),rt=u(V>=0&&I[V]||""),nt=u(b>=0&&I[b]||""),Be=u(w>=0&&I[w]||""),ot=te(Xe);if(ot.valid||E.push(`Row ${_} (Name): ${ot.error}`),Oe&&Oe.trim()===""&&E.push(`Row ${_} (IdentityNumber): Cannot be empty whitespace`),ke&&ke.trim()===""&&E.push(`Row ${_} (RegistrationId): Cannot be empty whitespace`),(r||p&&p!=="all"||l?.length)&&(!p||p==="all")){const m=ne(O);m.valid||E.push(`Row ${_} (GroupName): ${m.error}`),O&&R&&(R.some(x=>x.GroupName?.toLowerCase()===O.toLowerCase())||E.push(`Row ${_} (GroupName): Group "${O}" not found in event groups`))}const at=$(et);at.valid||E.push(`Row ${_} (Phone): ${at.error}`);const it=$(tt);it.valid||E.push(`Row ${_} (Mobile): ${it.error}`);const lt=wt(st);lt.valid||E.push(`Row ${_} (Email): ${lt.error}`);const ve=_e(rt);ve.valid||E.push(`Row ${_} (DOB): ${ve.error}`);const ae=ve.valid&&ve.formattedDate?ve.formattedDate:rt,mt=jt(nt);mt.valid||E.push(`Row ${_} (Gender): ${mt.error}`),Be&&Be.trim()===""&&E.push(`Row ${_} (ProfilePicture): Cannot be empty whitespace`),U.forEach((m,d)=>{if(m>=0){const x=I[m]||"",S=ne(x);S.valid||E.push(`Row ${_} (${P[d]}): ${S.error}`)}});const dt={};U.forEach((m,d)=>{m>=0&&(dt[P[d]]=I[m]||"")});const ye={};let ee=null;if(r)O&&R&&(ee=R.find(d=>d.GroupName?.toLowerCase()===O.toLowerCase())?.EventGroupId);else if(p&&p!=="all"&&R){const m=R.find(d=>d.EventGroupId===p);ee=m?.EventGroupId,m?.GroupName}else if(ae&&R){let m=null;if(ae.includes("-")){const d=ae.split("-");if(d.length===3){const x=parseInt(d[0],10),S=parseInt(d[1],10),z=parseInt(d[2],10);if(x>=1&&x<=31&&S>=1&&S<=12&&z>=1900&&z<=2100&&(m=new Date(z,S-1,x),(m.getMonth()!==S-1||m.getDate()!==x)&&(m=null)),!m||isNaN(m.getTime())){const D=parseInt(d[1],10),K=parseInt(d[0],10),ie=parseInt(d[2],10);D>=1&&D<=31&&K>=1&&K<=12&&ie>=1900&&ie<=2100&&(m=new Date(ie,K-1,D),(m.getMonth()!==K-1||m.getDate()!==D)&&(m=null))}}}else if(ae.includes("/")){const d=ae.split("/");if(d.length===3){const x=parseInt(d[0],10),S=parseInt(d[1],10),z=parseInt(d[2],10);if(x>=1&&x<=31&&S>=1&&S<=12&&z>=1900&&z<=2100&&(m=new Date(z,S-1,x),(m.getMonth()!==S-1||m.getDate()!==x)&&(m=null)),!m||isNaN(m.getTime())){const D=parseInt(d[1],10),K=parseInt(d[0],10),ie=parseInt(d[2],10);D>=1&&D<=31&&K>=1&&K<=12&&ie>=1900&&ie<=2100&&(m=new Date(ie,K-1,D),(m.getMonth()!==K-1||m.getDate()!==D)&&(m=null))}}}if(m&&!isNaN(m.getTime())){const d=R.filter(x=>{if(!x.MaxAgeDate||!x.MinAgeDate)return!1;const S=new Date(x.MaxAgeDate),z=new Date(x.MinAgeDate);let D={};try{D=JSON.parse(x.JsonSettings||"{}")}catch{}return D?.IsCommon==="Yes"||x.GroupName?.toLowerCase()==="common"?!1:m>=z&&m<=S});if(d.length==0&&!O&&E.push(`Row ${_} (GroupName/DOB): Unable to determine group automatically from DOB "${ae}". Please provide GroupName or correct the DOB format.`),d.length>0)ee=d[0].EventGroupId,d[0].GroupName,O=d[0].GroupName;else if(O){const x=R.find(S=>S.GroupName?.toLowerCase()===O.toLowerCase());ee=x?.EventGroupId,x?.GroupName}}else if(O){const d=R.find(x=>x.GroupName?.toLowerCase()===O.toLowerCase());ee=d?.EventGroupId,d?.GroupName}}else if(O){const m=R.find(d=>d.GroupName?.toLowerCase()===O.toLowerCase());ee=m?.EventGroupId,m?.GroupName}let ct=[];R.forEach(m=>{let d={};try{d=JSON.parse(m.JsonSettings||"{}")}catch(x){console.error(`Error parsing JSON for group ${m.GroupName}:`,x)}(m.GroupName?.toLowerCase()==="Common".toLowerCase()||d?.IsCommon==="Yes")&&ct.push(m.EventGroupId.toString())});let Ve=[];H>=0&&I.forEach((m,d)=>{d>=H&&d<=be&&m&&Ve.push(m)}),H>=0&&l.forEach(m=>{const d=u(m);d.includes("Solo Male");const x=C.find(D=>D.Group.toString()==ee.toString()&&u(D.Title)===d||ct.includes(D.Group)&&u(D.Title)===d);if(!x){j.error(`Competition "${m}" with Group ID "${ee}" not found in event competitions.`);return}let S;r?S=x.GroupName?u(`${x.GroupName} ${x.Title}`):u(x.Title):S=u(x.Title);const z=i(S);z>=0&&I[z]&&(ye[x.Title]={value:I[z],CompetitionStructureId:x.CompetitionStructureId,Title:x.Title})});const ut=Object.keys(ye).length,St=Object.keys(ye).map(m=>ye[m].Title),ft=Ve.length;ut!==ft&&E.push(`Regarding Row ${_-1}, Expected ${ft} competitions (${Ve.join(", ")}) , but found ${ut} matching columns (${St.join(", ")}). Please ensure all competition columns have values or check column names.`),E.length>0&&a.push(...E);const fe={name:Xe,identityNumber:Oe,registrationId:ke,groupName:O,groupId:ee,dob:ae,gender:nt,phone:et,mobile:tt,email:st,profilePicture:Be,...dt,rowIndex:W,status:E.length>0?"error":"pending",error:E.length>0?E.join("; "):null,participations:ye},ze=Ue(fe,o.length);if(ze?.error&&ze.type==="LOCAL_DUPLICATES"){const m=ze.indices.map(x=>x+2).join(", "),d=`Row ${_}: Duplicate participant found. Same name, DOB, and level settings already exist in rows: ${m}`;E.push(d),a.push(d),fe.status="error",fe.error=fe.error?`${fe.error}; ${d}`:d}o.push(fe)}a.length>0&&(a.forEach((W,I)=>{setTimeout(()=>{j.error(W,{duration:5e3})},I*100)}),setTimeout(()=>{j.error(`Total validation issues: ${a.length}`,{duration:6e3})},a.length*100)),G(o)},It=e=>{const s=[];if(s.push(`Name: ${e.name||"-"}`),e.identityNumber&&s.push(`Identity Number: ${e.identityNumber}`),e.registrationId&&s.push(`Registration ID: ${e.registrationId}`),e.groupName){const n=e.groupId&&e.groupName?`${e.groupId} - ${e.groupName}`:e.groupName;s.push(`Group: ${n}`)}return e.dob&&s.push(`Date of Birth: ${e.dob}`),e.gender&&s.push(`Gender: ${e.gender}`),P.forEach(n=>{e[n]&&s.push(`${n}: ${e[n]}`)}),e.phone&&s.push(`Phone: ${e.phone}`),e.mobile&&s.push(`Mobile: ${e.mobile}`),e.email&&s.push(`Email: ${e.email}`),console.log(e),e.participations&&Object.keys(e.participations).length>0&&(s.push(`
Competitions:`),Object.entries(e.participations).forEach(([n,r])=>{const l=C.find(o=>o.CompetitionStructureId===r.CompetitionStructureId);if(l){const o=l.GroupName?` [${l.GroupName}]`:"";s.push(`  â€¢ ${l.Title}${o} (ID: ${l.CompetitionStructureId}) - Value: ${r.value}`)}})),s.join(`
`)},Ke=async(e,s,n=!1)=>{const r=re(e);if(r?.error&&r.type==="MULTIPLE_MATCHES"){j.error(`Cannot import: ${r.count} users found with matching name and level settings. Please ensure unique combinations.`),G(o=>o.map((a,i)=>i===s?{...a,status:"error",error:`Multiple matches found (${r.count} users)`}:a));return}const l=Ue(e,s);if(l?.error&&l.type==="LOCAL_DUPLICATES"){const o=l.indices.map(a=>a+2).join(", ");j.error(`Cannot import: Duplicate participant found. Same name, DOB, and level settings already exist in rows: ${o}`),G(a=>a.map((i,c)=>c===s?{...i,status:"error",error:`Local duplicate found in rows: ${o}`}:i));return}if(!Me.current&&!n){const o=await Ze({title:`Import Participant ${s+1} of ${Q.length}`,description:It(e),confirmButtonLabel:"Import",cancelButtonLabel:"Skip",showConfirmAllButton:!0});if(o==="confirmAll")Me.current=!0,Te(!0);else if(!o){G(a=>a.map((i,c)=>c===s?{...i,status:"skipped"}:i));return}}Ee(o=>new Set(o).add(s)),G(o=>o.map((a,i)=>i===s?{...a,status:"importing"}:a));try{const o={};P.forEach(b=>{if(e[b])o[b]=e[b];else{j.error(`Missing value for mandatory organization level: ${b}`);return}});const a=[];e.participations&&Object.keys(e.participations).forEach(b=>{const L=e.participations[b];L&&L.CompetitionStructureId&&a.push(L.CompetitionStructureId)});const i={};P.forEach(b=>{e[b]&&(i[b]=e[b])});const c=re(e),v=c?Y==2?c.Team||c.TeamId:c.Candidate||c.UserRoleId:null;let B=p;(!p||p==="all")&&(B=R?.find(L=>L.GroupName?.toLowerCase()===e.groupName?.toLowerCase())?.EventGroupId||e.groupName);const Z={isImport:!0,isCrossSite:!0,EventCategory:le?.EventCategory,Event:le?.Event,ParticipantType:Y,Group:B,CompetitionParticipantsModel:{CompetitionList:a},...Y==1?{"UsersModel[UserName]":e.name,"UsersModel[UserDobString]":e.dob,"UsersModel[UserGender]":e.gender,"UsersModel[UserPhone]":e.phone,"UsersModel[UserMobile]":e.mobile,"UsersModel[UserEmail]":e.email,"UsersModel[UserImage]":e.profilePicture||"","UsersModel[CandidateIdentityNumber]":e.identityNumber,"UsersModel[RegistrationId]":e.registrationId,...v?{"UsersModel[Candidate]":v}:{}}:{"UsersModel[TeamTeamName]":e.name,"UsersModel[TeamIdentityNumber]":e.identityNumber,"UsersModel[RegistrationId]":e.registrationId,...v?{"UsersModel[Candidate]":v,"UsersModel[TeamId]":v,"UsersModel[Team]":v}:{}},...Y==1?Object.keys(i).reduce((b,L)=>(b[`UsersRolesModel[LevelSettings][${L}]`]=i[L],b),{}):Object.keys(i).reduce((b,L)=>(b[`TeamModel[LevelSettings][${L}]`]=i[L],b),{})},{data:V}=await Mt("/CoordinatorJson/SaveParticipants",Z);if(V){const b=V.split(","),L=parseInt(b[0]),oe=parseInt(b[1]),M=b.length>2?parseInt(b[2]):null;if(M)G(w=>w.map((U,H)=>H===s?(console.log("Preserving participations:",U.participations),{...U,status:"success",savedParticipantId:M,participations:U.participations}):U)),j.success(`Participant ${s+1} imported successfully`),setTimeout(()=>{const w=se.current[s];w&&w.scrollIntoView({behavior:"smooth",block:"center"})},100);else if(oe>0)G(w=>w.map((U,H)=>H===s?(console.log("Preserving participations:",U.participations),{...U,status:"success",Candidate:oe,participations:{}}):U)),setTimeout(()=>{const w=se.current[s];w&&w.scrollIntoView({behavior:"smooth",block:"center"})},100);else throw new Error("Invalid response from server")}else throw new Error("No response from server")}catch(o){console.error("Error importing participant:",o),G(a=>a.map((i,c)=>c===s?{...i,status:"error",error:o.message||"Import failed"}:i)),j.error(`Failed to import participant ${s+1}: ${o.message}`)}finally{Ee(o=>{const a=new Set(o);return a.delete(s),a})}},Et=async()=>{let e=0,s=0,n=0,r=0;G(l=>((async()=>{for(let a=0;a<l.length;a++){const i=l[a];if(Ge(i)){r++;continue}(i.status==="pending"||i.status==="error")&&(await Ke(i,a),G(c=>{const v=c[a];return v.status==="success"?e++:v.status==="skipped"?s++:v.status==="error"&&n++,c}),a<l.length-1&&await new Promise(c=>setTimeout(c,500)))}const o=[];e>0&&o.push(`${e} imported`),r>0&&o.push(`${r} already exist`),s>0&&o.push(`${s} skipped`),n>0&&o.push(`${n} failed`),e>0?j.success(`Import completed: ${o.join(", ")}`):j.success(`Import completed: ${o.join(", ")}`),Me.current=!1,Te(!1)})(),l))};return t.jsxs(t.Fragment,{children:[A&&t.jsxs(pt,{open:!0,onClose:A.onCancel,className:"relative z-50",children:[t.jsx(ht,{className:"fixed inset-0 bg-gray-500/75 transition-opacity"}),t.jsx("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto",children:t.jsx("div",{className:"flex min-h-full items-end justify-center p-3 text-center sm:items-center sm:p-0",children:t.jsxs(gt,{className:"relative transform overflow-hidden rounded-lg bg-surfaceCard px-3 pb-3 pt-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-4",children:[t.jsxs("div",{className:"sm:flex sm:items-start",children:[t.jsx("div",{className:"mx-auto flex size-10 shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:size-9",children:t.jsx(He,{"aria-hidden":"true",className:"size-5 text-blue-600"})}),t.jsxs("div",{className:"mt-2 text-center sm:ml-3 sm:mt-0 sm:text-left flex-1",children:[t.jsx(Nt,{as:"h3",className:"text-base font-semibold leading-6 text-onSurface mb-2",children:A.title}),t.jsx("div",{className:"mt-2 overflow-y-auto",children:t.jsx("div",{className:"text-xs leading-relaxed text-gray-700 space-y-1",children:A.description.split(`
`).map((e,s)=>{if(e.trim()==="")return t.jsx("div",{className:"h-2"},s);if(e.trim().startsWith("â€¢"))return t.jsxs("div",{className:"flex gap-2 pl-2",children:[t.jsx("span",{className:"text-primary font-medium",children:"â€¢"}),t.jsx("span",{className:"flex-1",children:e.trim().substring(1).trim()})]},s);if(e.includes(":")){const[n,...r]=e.split(":"),l=r.join(":").trim();return t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("span",{className:"font-medium text-onSurface min-w-fit",children:[n.trim(),":"]}),t.jsx("span",{className:"text-onSurfaceVariant",children:l})]},s)}return t.jsx("div",{className:"font-medium text-onSurface",children:e},s)})})})]})]}),t.jsxs("div",{className:"mt-4 sm:mt-5 sm:flex sm:flex-row-reverse gap-2",children:[t.jsx("button",{type:"button",onClick:A.onConfirm,className:"cursor-pointer inline-flex w-full justify-center rounded-md bg-primary px-4 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary sm:w-auto",children:A.confirmButtonLabel||"Confirm"}),A.showConfirmAllButton&&t.jsx("button",{type:"button",onClick:A.onConfirmAll,className:"cursor-pointer inline-flex w-full justify-center rounded-md bg-green-600 px-4 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600 sm:w-auto",children:"Confirm All"}),t.jsx("button",{type:"button",onClick:A.onCancel,className:"cursor-pointer mt-2 inline-flex w-full justify-center rounded-md bg-gray-200 px-4 py-1.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary sm:mt-0 sm:w-auto",children:A.cancelButtonLabel||"Cancel"})]})]})})})]}),t.jsxs("div",{className:"mt-2 p-3 bg-surfaceCard rounded-lg w-full shadow-md",children:[t.jsx("h3",{className:"text-base font-medium leading-5 text-onSurface mb-2",children:"Excel Import - Paste from Google Sheets"}),t.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-1 text-sm",children:"Instructions:"}),t.jsxs("ol",{className:"text-xs text-blue-800 space-y-0.5",children:[t.jsx("li",{children:"1. Upload CSV or Excel file using the file input below"}),t.jsxs("li",{children:["2. Columns will be ",t.jsx("strong",{children:"automatically reordered"})," to match required format"]}),t.jsx("li",{children:"3. Review the parsed data in the table below"}),t.jsx("li",{children:'4. Click "Import to List" to save participants and their participations'})]}),t.jsxs("div",{className:"mt-2 p-2 bg-surfaceCard rounded border border-primary/20",children:[t.jsx("div",{className:"text-xs font-medium text-blue-900 mb-1",children:"Required Columns (any order in Excel):"}),t.jsxs("div",{className:"text-xs text-onSurfaceVariant space-y-0.5",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Base Fields:"})," ",[g.USER_NAME,g.IDENTITY_NUMBER,g.REGISTRATION_ID,...!p||p==="all"?[g.GROUP_NAME]:[],g.USER_DOB,g.USER_GENDER].join(", ")]}),Le&&t.jsxs("div",{children:[t.jsx("strong",{children:"Organization Levels:"})," ",Le]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Contact:"})," ",[g.USER_PHONE,g.USER_MOBILE,g.USER_EMAIL,g.USER_PROFILE_PICTURE].join(", ")]}),C.length>0&&t.jsx(t.Fragment,{children:!p||p==="all"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Competitions (with Group in Headings):"}),t.jsx("div",{className:"ml-2 mt-1",children:(()=>{const e=new Map;return C.forEach(s=>{const n=s.GroupName?u(`${s.Title} (${s.GroupName})`):u(s.Title);e.has(n)||e.set(n,s)}),Array.from(e.values()).map((s,n)=>t.jsx("span",{className:"inline-block mr-2 mb-1 px-2 py-0.5 bg-blue-50 text-blue-700 rounded text-xxs",children:s.GroupName?`${s.Title} (${s.GroupName})`:s.Title},n))})()})]}),t.jsxs("div",{className:"mt-1",children:[t.jsx("strong",{children:"Competitions (without Group in Headings):"}),t.jsx("div",{className:"ml-2 mt-1",children:[...new Set(C.map(e=>u(e.Title)))].map((e,s)=>t.jsx("span",{className:"inline-block mr-2 mb-1 px-2 py-0.5 bg-green-50 text-green-700 rounded text-xxs",children:e},s))})]})]}):t.jsxs("div",{children:[t.jsx("strong",{children:"Competitions:"})," ",[...new Set(C.map(e=>e.Title))].join(", ")]})})]})]}),t.jsxs("div",{className:"mt-1 text-xs text-blue-600 flex items-start gap-1",children:[t.jsx(Pt,{className:"h-3 w-3 flex-shrink-0 mt-0.5 text-green-600"}),t.jsxs("div",{className:"space-y-0.5",children:[t.jsx("div",{className:"font-medium text-green-700",children:"âœ“ Columns can be in any order - system will automatically reorder them!"}),(!p||p==="all")&&t.jsxs("div",{className:"font-medium text-blue-700",children:["ðŸ“‹ All Groups mode: Include ",t.jsx("strong",{children:"GroupName"})," column to specify group for each participant"]}),p&&p!=="all"&&t.jsx("div",{children:"Group auto-detection: System will detect group from DOB (age range) if not specified."})]})]})]}),T&&T.sourceInfo&&t.jsxs("div",{className:"mb-3 bg-green-50 border border-green-200 rounded-lg p-3",children:[t.jsxs("h4",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[t.jsx(Gt,{className:"h-5 w-5"}),"Event Data Imported"]}),t.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Source Event:"})," ",T.sourceInfo.sourceEventName]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Participants Loaded:"})," ",T.sourceInfo.participantCount]}),t.jsx("p",{className:"text-xs text-green-600 mt-2",children:"âœ“ Data has been automatically loaded from your coordinator event. Review and import participants below."})]})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Min Similarity"}),t.jsxs("select",{value:Qe,onChange:e=>Se(parseInt(e.target.value)),className:"form-control text-sm py-1",children:[t.jsx("option",{value:"1",children:"1"}),t.jsx("option",{value:"2",children:"2"}),t.jsx("option",{value:"3",children:"3"})]})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Upload CSV/Excel File"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:y,disabled:Re,className:"block w-full text-xs text-onSurface border border-border rounded-md cursor-pointer bg-surface focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent file:mr-2 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-primary file:text-white hover:file:bg-primaryHover disabled:opacity-50 disabled:cursor-not-allowed"})}),t.jsx("p",{className:"mt-0.5 text-xs text-gray-500",children:"Supported formats: CSV, Excel (.xlsx, .xls)."})]}),Re&&t.jsx("div",{className:"mb-4 flex items-center justify-center py-8 border border-border rounded-lg bg-surface",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ye,{className:"h-6 w-6 text-primary animate-spin"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Processing data, please wait..."})]})}),!Re&&Q.length>0&&t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("h4",{className:"text-sm font-medium text-onSurface",children:["Parsed Participants (",Q.length,")"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>{G([]),Ie([]),Ee(new Set),Fe([]),sessionStorage.removeItem(ce),j.success("All data cleared")},className:"cursor-pointer inline-flex items-center gap-x-1.5 rounded-md bg-gray-200 px-3 py-1.5 text-xs font-semibold text-gray-700 shadow-sm hover:bg-gray-300",children:[t.jsx(we,{className:"h-3 w-3"}),"Clear All"]}),t.jsxs("button",{onClick:Et,disabled:he.size>0,className:"cursor-pointer inline-flex items-center gap-x-1.5 rounded-md bg-primary px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-primaryHover disabled:opacity-50 disabled:cursor-not-allowed",children:[he.size>0?t.jsx(Ye,{className:"h-3 w-3 animate-spin"}):t.jsx(He,{className:"h-3 w-3"}),"Import to List"]})]})]}),t.jsx("div",{className:"overflow-x-auto overflow-y-auto border border-border rounded-lg shadow-sm ",children:t.jsxs("table",{className:"min-w-full divide-y divide-border table-auto text-xs",children:[t.jsxs("thead",{className:"bg-gray-50 sticky top-0 z-10",children:[(!p||p==="all")&&(()=>{const e=new Map,s=new Map;C.forEach(r=>{const l=r.GroupName?u(`${r.Title} (${r.GroupName})`):u(r.Title);if(!s.has(l)){s.set(l,r);const o=u(r.GroupName||"Common");e.has(o)||e.set(o,[]),e.get(o).push(r)}});const n=11+P.length+(!p||p==="all"?1:0);return t.jsxs("tr",{className:"border-b border-gray-300",children:[t.jsx("th",{colSpan:n,className:"px-1 py-1 text-left text-xs font-medium text-gray-500 bg-gray-100"}),Array.from(e.entries()).map(([r,l],o)=>t.jsx("th",{colSpan:l.length,className:"px-1 py-1 text-center text-xs font-semibold text-white bg-primary border-l border-r border-gray-300",children:r},o))]})})(),t.jsxs("tr",{children:[t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Actions"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Status"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Name"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Identity No"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Reg ID"}),(!p||p==="all")&&t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Group"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"DoB"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Gender"}),P.map((e,s)=>t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:e},s)),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Phone"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Mobile"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Email"}),t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-gray-500 ",children:"Profile Pic"}),(()=>{const e=new Map;return C.forEach(s=>{const n=s.GroupName?u(`${s.Title} (${s.GroupName})`):u(s.Title);e.has(n)||e.set(n,s)}),Array.from(e.values()).map((s,n)=>t.jsx("th",{className:"px-1 py-1 text-left text-xs font-medium text-onSurfaceVariant border-l border-border",children:t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:[s.CompetitionOrder," - ",s.Title]}),t.jsxs("span",{className:"text-xxs text-gray-500",children:["ID: ",s.CompetitionStructureId]})]})},n))})()]})]}),t.jsx("tbody",{className:"bg-surfaceCard divide-y divide-border",children:Q.map((e,s)=>{const n=Ge(e),r=re(e),l=r?.error&&r.type==="MULTIPLE_MATCHES";return t.jsxs("tr",{ref:o=>se.current[s]=o,className:`hover:bg-gray-50 transition-colors ${l?"bg-red-50":""}`,children:[t.jsxs("td",{className:"px-1 py-1 ",children:[l?t.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Error: Multiple Matches"}):(e.status==="pending"||e.status==="error")&&!n&&t.jsxs("button",{onClick:()=>Ke(e,s),disabled:he.has(s),className:"cursor-pointer inline-flex items-center gap-x-1 rounded-md bg-primary px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-primaryHover disabled:opacity-50 disabled:cursor-not-allowed",title:r?"Import additional competitions":"Import this participant",children:[t.jsx(He,{className:"h-3 w-3"}),r?"Import Comps":"Import"]}),n&&e.status==="pending"&&t.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Fully Imported"}),e.status==="success"&&t.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Imported"}),e.status==="importing"&&t.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Importing..."}),e.status==="skipped"&&t.jsx("span",{className:"text-xs text-yellow-600 font-medium",children:"Skipped"})]}),t.jsx("td",{className:"px-1 py-1 ",children:l?t.jsx(we,{className:"h-5 w-5 text-red-500",title:`Error: ${r.count} users found with matching name and levels. Please ensure unique combinations.`}):e.status==="success"?t.jsx(je,{className:"h-5 w-5 text-white bg-green-500 rounded-full p-0.5",title:"Imported successfully"}):e.status==="error"?t.jsx(we,{className:"h-5 w-5 text-red-500",title:e.error||"Import failed"}):e.status==="importing"?t.jsx(Ye,{className:"h-5 w-5 text-blue-500 animate-spin",title:"Importing..."}):e.status==="skipped"?t.jsx(we,{className:"h-5 w-5 text-yellow-500",title:"Skipped by user"}):e.status==="pending"?t.jsx(t.Fragment,{children:n?t.jsx(je,{className:"h-5 w-5 text-white bg-green-500 rounded-full p-0.5",title:"Participant and all competitions already imported"}):r?t.jsx(je,{className:"h-5 w-5 text-white bg-yellow-500 rounded-full p-0.5",title:"Participant exists, but some competitions not assigned"}):t.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-gray-300",title:"Pending import"})}):null}),t.jsx("td",{className:"px-1 py-1 text-xs font-medium text-onSurface  max-w-24 overflow-hidden text-ellipsis",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:e.name||"-"}),l?t.jsx(we,{className:"h-4 w-4 text-red-500 flex-shrink-0",title:`${r.count} matching users found`}):r&&!r.error?t.jsx(je,{className:"h-4 w-4 text-white bg-green-500 rounded-full p-0.5 flex-shrink-0",title:"Participant already exists in server"}):null]})}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.identityNumber||"-"}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.registrationId||"-"}),(!p||p==="all")&&t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xxs font-medium bg-blue-100 text-blue-800",children:e.groupId&&e.groupName?`${e.groupId} - ${e.groupName}`:e.groupName||"-"})}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 whitespace-nowrap",children:e.dob||"-"}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.gender||"-"}),P.map((o,a)=>t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 max-w-24 overflow-hidden text-ellipsis",children:e[o]||"-"},a)),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.phone||"-"}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.mobile||"-"}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.email||"-"}),t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:e.profilePicture?t.jsx("a",{href:e.profilePicture,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:"View"}):"-"}),C.map((o,a)=>{const i=e.participations?.[o.Title]?.CompetitionStructureId===o.CompetitionStructureId,c=q(e,o.CompetitionStructureId);return t.jsx("td",{className:"px-1 py-1 text-xs text-gray-500 ",children:i?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("span",{className:"text-xs text-gray-700 whitespace-nowrap",title:o.Title,children:["ID: ",o.CompetitionStructureId]}),c&&t.jsx(je,{className:"h-4 w-4 text-white bg-green-500 rounded-full p-0.5 flex-shrink-0",title:"Competition already assigned in server"})]}):t.jsx("span",{children:"-"})},a)})]},s)})})]})}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Table is scrollable both horizontally and vertically - showing all imported columns."})]})]})]})},ss=({onEdit:xe,onView:p,onDelete:Y,onTeamManage:le,selectedGroupFilter:k,selectedParticipantType:F,selectedOrganization:me,pageSize:Je,currentPage:T,filterCriterias:de,currentUser:u,onAssignmentChange:C,onPageChange:ce,selectedOrganizations:Ce,onClearFilters:qe,eventDataToImport:We=null,onEventDataProcessed:Ie=null})=>{const{groups:De}=xt(),[pe,Q]=N.useState(384),[G,he]=N.useState(!1),[Ee,bt]=N.useState(null),[Fe,Qe]=N.useState({competitionId:null,candidateId:null}),[Se,vt]=N.useState(null),[Te,Re]=N.useState(new Set),[X,Me]=N.useState(null);N.useRef(null);const se=N.useRef(null),{row:R,status:Pe,setFilter:g,updateLocal:P,delete:Le}=Lt("/CoordinatorJson/GetParticipants",{select:"participantList,userList,UserEmail,UserName,UserDobString,UserImage,UserMobile,UserPhone,Email,Group,Candidate,CandidateUser,JsonSettings,Gender,GroupName,GenderName,LanguageName,Fees,TeamTeamName,Team,TeamStrength,TeamMembersList,TeamMembers,TeamStrength,CandidateIdentityNumber,TeamIdentityNumber,CompetitionOrder,CreatedBy,CreatedByUserName,ParticipantId,UserJsonSettings,TeamJsonSettings,Remarks,LevelSettings,RegistrationId,UniqueCandidateId,UniqueTeamId,CreatedDate,ModifiedDate,CreatedByEmail,CreatedByMobile,Order",filter:{EventCategory:u?.EventCategory,Event:u?.Event,ParticipantType:F},limit:1e5,offset:(T-1)*Je,updateUrl:"/CoordinatorJson/SaveParticipants",deleteUrl:"/CompetitionParticipantsJson/Remove",noGet:!0});let ue=R?.ParticipantsList||[];const $e=R?.UsersList||[],J=R?.Competitions||[],A=R?.OrganizationLevels||[];(()=>{const f={};return J.forEach(h=>{const y=h.CompetitionName?.toLowerCase().replace(/[^a-z0-9]/g,"");y&&(f[y]||(f[y]=[]),f[y].push({CompetitionStructureId:h.CompetitionStructureId,CompetitionName:h.CompetitionName,GroupName:h.GroupName,GenderName:h.GenderName,LanguageName:h.LanguageName,EventGroupId:h.EventGroupId}))}),f})(),(()=>{const f=[];f.push("UserName"),f.push("IdentityNumber"),f.push("RegistrationId"),(!k||k==="all")&&f.push("GroupName"),f.push("UserDob"),f.push("UserGender"),(A||[]).forEach(($,ne)=>{ne!==0&&f.push(`Level_${$.LevelName}Name`)}),f.push("UserPhone"),f.push("UserMobile"),f.push("UserEmail"),f.push("UserProfilePicture");let y=[];k&&k!=="all"?y=J.filter($=>$.EventGroupId===k||$.Group===k).map($=>$.CompetitionName):y=J.map($=>$.CompetitionName);const te=[...new Set(y)].filter(Boolean);return f.push(...te),f})(),(()=>{const f=A||[],h=[];if(f.forEach((te,$)=>{$!==0&&h.push(`${te.LevelName}Name`)}),h.length===0)return"";if(h.length===1)return h[0];const y=h.pop();return h.join(", ")+" and "+y})(),$e.map(f=>{const h=ue.filter(y=>f.Team>0?y.Team===f.Team.toString()||y.Candidate===f.Team.toString():f.Candidate>0?y.Candidate===f.Candidate.toString():!1);return{...f,participations:h}});let re=JSON.stringify(de);N.useEffect(()=>{if(F&&k){let f={};Ce&&Ce.length>0&&Ce.forEach(y=>{f={...f,...y}});const h={EventCategory:u?.EventCategory,Event:u?.Event,ParticipantType:F,OrganizationId:me||void 0,...de||{},...f};k!=="all"&&(h.Group=k,h.AgeFrom=De?.find(y=>y.EventGroupId===k)?.AgeFrom,h.AgeTo=De?.find(y=>y.EventGroupId===k)?.AgeTo),g(h,!0)}},[F,k,me,re]),N.useEffect(()=>{const f=y=>{if(!G||!se.current)return;const te=se.current.getBoundingClientRect(),$=te.right-y.clientX,ne=280,Ne=Array.isArray(A)?A.length:0,_e=Ne>0?Math.max(ne,Ne*120):te.width*.6;$>=ne&&$<=_e&&Q($)},h=()=>{he(!1)};return G&&(document.addEventListener("mousemove",f),document.addEventListener("mouseup",h)),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",h)}},[G]),N.useCallback((f,h)=>f.participations?f.participations.some(y=>y.Competition===h):!1,[]);const[Ue]=Ut(),[q,Ge]=N.useState(null);return Pe!=="finished"?t.jsx($t,{info:"Loading participants...",className:"h-64"}):F?t.jsxs("div",{ref:se,className:"flex-1 flex overflow-hidden",children:[t.jsx(Ue,{title:"Delete Participant",description:"Are you sure you want to delete this participant?",confirmButtonLabel:"Delete",confirmButtonClick:async f=>{try{await Le(f),j.success("Participant Deleted Successfully"),typeof Y=="function"&&Y(f)}catch{j.error("Failed to delete participant")}},className:"w-96 print:hidden"}),q&&t.jsxs(pt,{open:!0,onClose:q.onCancel,className:"relative z-50",children:[t.jsx(ht,{className:"fixed inset-0 bg-gray-500/75 transition-opacity"}),t.jsx("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto",children:t.jsx("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:t.jsxs(gt,{className:"relative transform overflow-hidden rounded-lg bg-surfaceCard px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6",children:[t.jsxs("div",{className:"sm:flex sm:items-start",children:[t.jsx("div",{className:"mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10",children:t.jsx(At,{"aria-hidden":"true",className:"size-6 text-red-600"})}),t.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[t.jsx(Nt,{as:"h3",className:"text-base font-semibold text-onSurface",children:q.title}),t.jsx("div",{className:"mt-2",children:t.jsx("p",{className:"text-sm text-gray-500",children:q.message})})]})]}),t.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[t.jsx("button",{type:"button",onClick:q.onConfirm,className:"inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto",children:q.confirmText}),t.jsx("button",{type:"button",onClick:q.onCancel,className:"mt-3 inline-flex w-full justify-center rounded-md bg-surfaceCard px-3 py-2 text-sm font-semibold text-onSurface shadow-sm ring-1 ring-inset ring-border hover:bg-surface sm:mt-0 sm:w-auto",children:q.cancelText})]})]})})})]}),t.jsx("style",{children:`
        table:has(th.competition-header:hover) tbody tr td:nth-child(n+5) {
          background-color: transparent;
        }
        ${J?.map((f,h)=>`
          table:has(th.competition-header:nth-child(${h+5}):hover) tbody tr td:nth-child(${h+5}) {
            background-color: rgb(219 234 254) !important;
          }
        `).join("")}

        ${Se?J?.map((f,h)=>f.CompetitionStructureId===Se?`tbody tr td:nth-child(${h+5}) {
                    background-color: rgb(191 219 254) !important;
                  }`:"").join(""):""}
      `}),t.jsx("div",{className:"flex-1 overflow-hidden bg-surfaceCard",children:t.jsx("div",{className:"h-full flex flex-col",children:t.jsx("div",{className:"px-2 py-2 border-b border-border",children:t.jsx("div",{className:"flex flex-col items-center justify-between",children:t.jsx(Ot,{usersList:$e,setParticipantFilter:g,participantsList:ue,competitions:J,selectedGroupFilter:k,selectedParticipantType:F,currentUser:u,updateParticipantLocal:P,eventDataToImport:We,onEventDataProcessed:Ie})})})})})]}):t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-sm text-gray-600",children:"Please select a group and participant type."})})})};export{ss as default};
