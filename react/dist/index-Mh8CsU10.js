import{r as t,j as e,h as T,z as k,b as te,l as ae,p as $}from"./main-CalEMNEI.js";import{L as re}from"./layoutOuter-QY3rFcnm.js";import{u as le}from"./index.esm-B2033FvW.js";import{F as P}from"./XMarkIcon-DIgwVPDV.js";import{F as M}from"./EyeIcon-Bke5UWJ-.js";import{F as L}from"./EyeSlashIcon-qYkpAYD3.js";import{u as E,w as ie}from"./xlsx-DSqvgYLF.js";import{F as G}from"./ArrowDownTrayIcon-CI1PPk_6.js";import{F as ne}from"./PlusIcon-edeMf-KY.js";import{F as oe}from"./UserGroupIcon-Dn0-J2h-.js";import{F as B}from"./UserIcon-CgisBqwC.js";import{F as O}from"./CheckIcon-Bw2UxRcZ.js";import{F as z}from"./ChevronDownIcon-D5dz1BOR.js";import{F as _}from"./ChevronRightIcon-CVwsNmB2.js";import{F as ce}from"./FunnelIcon-CATLvZ0x.js";import{F as de}from"./TableCellsIcon-BDKo2UIU.js";import{F as U}from"./ArrowPathIcon-BjgrZqIH.js";import{F as me}from"./PrinterIcon-DOM1Pym3.js";import{F as xe}from"./DocumentTextIcon-9vXUz5TQ.js";function ue({title:c,titleId:a,...l},x){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":a},l),c?t.createElement("title",{id:a},c):null,t.createElement("path",{fillRule:"evenodd",d:"M12 2.25a.75.75 0 0 1 .75.75v16.19l6.22-6.22a.75.75 0 1 1 1.06 1.06l-7.5 7.5a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 1 1 1.06-1.06l6.22 6.22V3a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))}const pe=t.forwardRef(ue);function he({title:c,titleId:a,...l},x){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":a},l),c?t.createElement("title",{id:a},c):null,t.createElement("path",{fillRule:"evenodd",d:"M11.47 2.47a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06l-6.22-6.22V21a.75.75 0 0 1-1.5 0V4.81l-6.22 6.22a.75.75 0 1 1-1.06-1.06l7.5-7.5Z",clipRule:"evenodd"}))}const fe=t.forwardRef(he),be=({availableColumns:c,visibleColumns:a,onChange:l,onClose:x})=>{const[o,u]=t.useState(""),m=t.useCallback(n=>{const y=a.includes(n);l(y?a.filter(h=>h!==n):[...a,n])},[a,l]),g=t.useCallback(()=>{l(c)},[c,l]),r=t.useCallback(()=>{l([])},[l]),s=c.filter(n=>n.toLowerCase().includes(o.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-50 overflow-hidden",children:e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:x}),e.jsx("div",{className:"fixed inset-y-0 right-0 max-w-md w-full flex",children:e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"h-full flex flex-col bg-surfaceCard shadow-xl",children:[e.jsxs("div",{className:"px-6 py-4 bg-surface border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-onSurface",children:"Column Manager"}),e.jsx("button",{type:"button",onClick:x,className:"text-onSurfaceVariant hover:text-onSurface",children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Select columns to display in the report"})]}),e.jsxs("div",{className:"px-6 py-4 border-b border-border",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",value:o,onChange:n=>u(n.target.value),className:"block w-full rounded-md border-0 py-2 px-3 ring-1 ring-inset ring-border placeholder:text-onSurfaceVariant focus:ring-2 focus:ring-primary text-sm"}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:g,className:"flex-1 inline-flex items-center justify-center gap-x-1 rounded-md bg-gray-100 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-200",children:[e.jsx(M,{className:"h-4 w-4"}),"Show All"]}),e.jsxs("button",{type:"button",onClick:r,className:"flex-1 inline-flex items-center justify-center gap-x-1 rounded-md bg-gray-100 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-200",children:[e.jsx(L,{className:"h-4 w-4"}),"Hide All"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[a.length," of ",c.length," columns selected"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[e.jsx("div",{className:"space-y-2",children:s.map(n=>{const y=a.includes(n);return e.jsxs("div",{className:T("flex items-center justify-between p-3 rounded-md border transition-all cursor-pointer",y?"border-primary bg-blue-50":"border-border bg-surfaceCard hover:bg-surface"),onClick:()=>m(n),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:()=>m(n),className:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded",onClick:h=>h.stopPropagation()}),e.jsx("span",{className:T("text-sm font-medium",y?"text-onSurface":"text-onSurfaceVariant"),children:n})]}),y?e.jsx(M,{className:"h-4 w-4 text-primary"}):e.jsx(L,{className:"h-4 w-4 text-gray-300"})]},n)})}),s.length===0&&e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:['No columns found matching "',o,'"']})]}),e.jsx("div",{className:"px-6 py-4 border-t border-border bg-surface",children:e.jsx("button",{type:"button",onClick:x,className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primaryHover",children:"Apply Changes"})})]})})})]})})},ge=({reportData:c,groupBy:a,visibleColumns:l,onClose:x,eventDetails:o})=>{const[u,m]=t.useState("excel"),[g,r]=t.useState(!0),[s,n]=t.useState(!1),y=t.useCallback((d,b=0,N={})=>{const j=[];return d.forEach(v=>{if(v.Participants&&Array.isArray(v.Participants)){const R=v._groupField||a[b],S=v._groupKey||v[R],F={...N,[R]:S},w=y(v.Participants,b+1,F);j.push(...w)}else j.push({...N,...v})}),j},[a]),h=t.useCallback(async()=>{n(!0);try{const d=y(c.data),b=E.book_new(),N=d.map(S=>{const F={};return l.forEach(w=>{F[w]=S[w]||""}),a.forEach(w=>{S[w]&&(F[w]=S[w])}),F}),j=E.json_to_sheet(N);if(g){const S=E.json_to_sheet([{Field:"Event Name",Value:o?.EventName||""},{Field:"Report Generated",Value:new Date().toLocaleString()},{Field:"Total Records",Value:c.meta.totalRecords},{Field:"Execution Time (ms)",Value:c.meta.executionTimeMs},{Field:"Grouped By",Value:a.join(" â†’ ")},{Field:"Filters Applied",Value:JSON.stringify(c.meta.filters||{})}]);E.book_append_sheet(b,S,"Metadata")}E.book_append_sheet(b,j,"Report Data");const v=new Date().toISOString().split("T")[0],R=`${o?.EventName||"Report"}_${v}.xlsx`;ie(b,R),k.success("Excel file exported successfully!"),x()}catch(d){console.error("Excel export failed:",d),k.error("Failed to export Excel file")}finally{n(!1)}},[c,a,l,y,g,o,x]),i=t.useCallback(()=>{k.success("Opening print dialog..."),setTimeout(()=>{window.print(),x()},500)},[x]),f=t.useCallback(()=>{u==="excel"?h():u==="pdf"&&i()},[u,h,i]);return e.jsx("div",{className:"fixed inset-0 z-50 overflow-hidden",children:e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:x}),e.jsx("div",{className:"fixed inset-y-0 right-0 max-w-md w-full flex",children:e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"h-full flex flex-col bg-surfaceCard shadow-xl",children:[e.jsxs("div",{className:"px-6 py-4 bg-surface border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-onSurface",children:"Export Report"}),e.jsx("button",{type:"button",onClick:x,className:"text-onSurfaceVariant hover:text-onSurface",children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsx("p",{className:"mt-1 text-sm text-onSurfaceVariant",children:"Choose export format and options"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-3",children:"Export Format"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-md cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"exportFormat",value:"excel",checked:u==="excel",onChange:d=>m(d.target.value),className:"h-4 w-4 text-primary focus:ring-primary border-gray-300"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"ðŸ“Š Excel (XLSX)"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Export as spreadsheet with all data"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-md cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"exportFormat",value:"pdf",checked:u==="pdf",onChange:d=>m(d.target.value),className:"h-4 w-4 text-primary focus:ring-primary border-gray-300"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"ðŸ“„ PDF (Print)"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Print to PDF using browser's print dialog"})]})]})]})]}),u==="excel"&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:d=>r(d.target.checked),className:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Include metadata sheet"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:"Adds a separate sheet with report information"})]}),e.jsxs("div",{className:"bg-surface border border-primary/20 rounded-md p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Export Summary"}),e.jsxs("div",{className:"space-y-1 text-xs text-blue-800",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Records:"}),e.jsx("span",{className:"font-medium",children:c.meta.totalRecords})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Columns:"}),e.jsx("span",{className:"font-medium",children:l.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Grouping Levels:"}),e.jsx("span",{className:"font-medium",children:a.length})]})]})]}),c.meta.totalRecords>1e3&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsx("p",{className:"text-xs text-yellow-800",children:"âš ï¸ Large dataset detected. Export may take a moment to complete."})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{type:"button",onClick:f,disabled:s,className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primaryHover disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4"}),"Export Report"]})})})]})})})]})})},ye=({filters:c,onChange:a,onClose:l,eventLevels:x})=>{const[o,u]=t.useState(c||{}),m=t.useCallback((i,f)=>{u(d=>({...d,[i]:f}))},[]),g=t.useCallback((i,f)=>{u(d=>{const b=d[i]||[],N=parseInt(f);return b.includes(N)?{...d,[i]:b.filter(j=>j!==N)}:{...d,[i]:[...b,N]}})},[]),r=t.useCallback(()=>{a(o),l()},[o,a,l]),s=t.useCallback(()=>{u({})},[]),n=[{value:1,label:"Draft"},{value:2,label:"Active/Published"},{value:4,label:"Score Entry"},{value:6,label:"Finished"}],y=[{value:1,label:"Individual"},{value:2,label:"Team"}],h=[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}];return e.jsx("div",{className:"fixed inset-0 z-50 overflow-hidden",children:e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:l}),e.jsx("div",{className:"fixed inset-y-0 left-0 max-w-md w-full flex",children:e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"h-full flex flex-col bg-surfaceCard shadow-xl",children:[e.jsxs("div",{className:"px-6 py-4 bg-surface border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-onSurface",children:"Filter Panel"}),e.jsx("button",{type:"button",onClick:l,className:"text-onSurfaceVariant hover:text-onSurface",children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsx("p",{className:"mt-1 text-sm text-onSurfaceVariant",children:"Configure filters for the report"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-3",children:"Competition Status"}),e.jsx("div",{className:"space-y-2",children:n.map(i=>{const f=(o.CompetitionStatus||[]).includes(i.value);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>g("CompetitionStatus",i.value),className:"h-4 w-4 text-primary focus:ring-primary border-border rounded"}),e.jsx("span",{className:"text-sm text-onSurface",children:i.label})]},i.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-3",children:"Participant Type"}),e.jsx("div",{className:"space-y-2",children:y.map(i=>{const f=(o.ParticipantType||[]).includes(i.value);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>g("ParticipantType",i.value),className:"h-4 w-4 text-primary focus:ring-primary border-border rounded"}),e.jsx("span",{className:"text-sm text-onSurface",children:i.label})]},i.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-onSurface mb-3",children:"Gender"}),e.jsx("div",{className:"space-y-2",children:h.map(i=>{const f=(o.Gender||[]).includes(i.value);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>{const d=o.Gender||[];d.includes(i.value)?m("Gender",d.filter(b=>b!==i.value)):m("Gender",[...d,i.value])},className:"h-4 w-4 text-primary focus:ring-primary border-border rounded"}),e.jsx("span",{className:"text-sm text-onSurface",children:i.label})]},i.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by Name"}),e.jsx("input",{type:"text",value:o.NameSearch||"",onChange:i=>m("NameSearch",i.target.value),placeholder:"Enter name to search...",className:"block w-full rounded-md border-0 py-2 px-3 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-primary text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by ID"}),e.jsx("input",{type:"text",value:o.IdentityNumberSearch||"",onChange:i=>m("IdentityNumberSearch",i.target.value),placeholder:"Enter ID to search...",className:"block w-full rounded-md border-0 py-2 px-3 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-primary text-sm"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 space-y-2",children:[e.jsx("button",{type:"button",onClick:s,className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-300",children:"Clear All Filters"}),e.jsx("button",{type:"button",onClick:r,className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primaryHover",children:"Apply Filters"})]})]})})})]})})},je=({availableFields:c,selectedGroups:a,onChange:l})=>{const x=t.useCallback(r=>{a.includes(r)||l([...a,r])},[a,l]),o=t.useCallback(r=>{l(a.filter(s=>s!==r))},[a,l]),u=t.useCallback(r=>{if(r===0)return;const s=[...a];[s[r-1],s[r]]=[s[r],s[r-1]],l(s)},[a,l]),m=t.useCallback(r=>{if(r===a.length-1)return;const s=[...a];[s[r],s[r+1]]=[s[r+1],s[r]],l(s)},[a,l]),g=c.filter(r=>!a.includes(r));return e.jsxs("div",{className:"space-y-4",children:[a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Selected Groups (Order Matters)"}),a.map((r,s)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-surface border border-primary/20 rounded-md",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{type:"button",onClick:()=>u(s),disabled:s===0,className:"p-0.5 text-gray-500 hover:text-gray-700 disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:e.jsx(fe,{className:"h-3 w-3"})}),e.jsx("button",{type:"button",onClick:()=>m(s),disabled:s===a.length-1,className:"p-0.5 text-gray-500 hover:text-gray-700 disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:e.jsx(pe,{className:"h-3 w-3"})})]}),e.jsxs("span",{className:"flex-1 text-sm font-medium text-gray-900",children:[s+1,". ",r]}),e.jsx("button",{type:"button",onClick:()=>o(r),className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-100 rounded",title:"Remove",children:e.jsx(P,{className:"h-4 w-4"})})]},r))]}),g.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Fields"}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-gray-200 rounded-md p-2",children:g.map(r=>e.jsxs("button",{type:"button",onClick:()=>x(r),className:"w-full flex items-center justify-between p-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx("span",{children:r}),e.jsx(ne,{className:"h-4 w-4 text-gray-400"})]},r))})]}),a.length===0&&e.jsx("div",{className:"text-center py-4 text-sm text-gray-500 border-2 border-dashed border-gray-300 rounded-md",children:"No grouping selected. Select fields above to group data."})]})},Ne=({data:c,groupBy:a,visibleColumns:l,expandedGroups:x,onToggleGroup:o})=>{const u=t.useMemo(()=>({UserName:"Name",TeamName:"Team Name",UserImage:"Photo",UserDobString:"Date of Birth",UserGender:"Gender",UserMobile:"Mobile",UserPhone:"Phone",UserEmail:"Email",CandidateIdentityNumber:"ID Number",TeamIdentityNumber:"Team ID",RegistrationId:"Reg. ID",ChestNumber:"Chest No.",CompetitionTitle:"Competition",CompetitionOrder:"Order",GroupName:"Group",Fees:"Fees",Score:"Score",OrganizationLevel:"Organization",MembershipType:"Membership",JudgeName:"Judge",CreatedDate:"Created"}),[]),m=t.useCallback((r,s,n)=>{if(!s&&s!==0)return e.jsx("span",{className:"text-onSurfaceVariant",children:"-"});if(r==="UserImage")return s?e.jsx("img",{src:s,alt:"Profile",className:"h-10 w-10 rounded-full object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:n.TeamName?e.jsx(oe,{className:"h-5 w-5 text-gray-500"}):e.jsx(B,{className:"h-5 w-5 text-gray-500"})});if(typeof s=="boolean")return s?e.jsx(O,{className:"h-5 w-5 text-green-600"}):e.jsx(P,{className:"h-5 w-5 text-gray-300"});if(r==="Fees"||r==="Score")return e.jsx("span",{className:"font-medium text-gray-900",children:s});if(r.includes("Date")&&s)try{return new Date(s).toLocaleDateString()}catch{return s}return e.jsx("span",{className:"text-gray-900",children:s})},[]),g=t.useCallback((r,s=0,n="")=>!r||r.length===0?null:!r[0].Participants||r[0].Participants.length===0?r.map((h,i)=>{const f=`${n}-leaf-${i}`;return e.jsx("tr",{className:"hover:bg-surface",children:l.map(d=>e.jsx("td",{className:"px-4 py-3 text-sm border-b border-gray-200",children:m(d,h[d],h)},d))},f)}):r.map((h,i)=>{const f=`${n}-${s}-${i}`,d=x[f],b=h._groupField||a[s],N=h._groupKey||h[b],j=h.Participants?.length||0;return e.jsxs("tbody",{children:[e.jsx("tr",{className:"bg-surface border-t-2 border-border",children:e.jsx("td",{colSpan:l.length,className:"px-4 py-3",children:e.jsxs("button",{type:"button",onClick:()=>o(f),className:"w-full flex items-center gap-2 text-left",style:{paddingLeft:`${s*1.5}rem`},children:[d?e.jsx(z,{className:"h-5 w-5 text-gray-600 flex-shrink-0"}):e.jsx(_,{className:"h-5 w-5 text-gray-600 flex-shrink-0"}),e.jsxs("span",{className:"font-medium text-gray-900 text-sm",children:[u[b]||b,": ",N]}),e.jsxs("span",{className:"text-xs text-gray-600 ml-2",children:["(",j," ",j===1?"item":"items",")"]})]})})}),d&&g(h.Participants,s+1,f)]},f)}),[a,l,x,o,m,u]);return!c||c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(B,{className:"h-12 w-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Data Available"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters or grouping"})]}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-surface sticky top-0 z-10",children:e.jsx("tr",{children:l.map(r=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b-2 border-gray-300",children:u[r]||r},r))})}),g(c,0,"root")]})})},ve=({templates:c,onSelect:a,selectedTemplate:l})=>{const x=t.useCallback(o=>{a(o)},[a]);return e.jsx("div",{className:"space-y-2",children:c.map(o=>{const u=l===o.id;return e.jsx("button",{type:"button",onClick:()=>x(o),className:T("w-full text-left p-3 rounded-md border transition-all",u?"border-primary bg-blue-50 ring-2 ring-primary ring-opacity-50":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.name}),u&&e.jsx(O,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:o.description}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[o.groupBy.length>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:[o.groupBy.length," groups"]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[o.visibleColumns.length," columns"]})]})]})})},o.id)})})},we=()=>{const{user:c}=te()||{},{eventDetails:a,eventLevels:l}=ae(),{control:x,register:o,watch:u,setValue:m,getValues:g,formState:{errors:r}}=le({defaultValues:{template:"",groupBy:[],visibleColumns:[],filters:{}}}),s=u(),[n,y]=t.useState(null),[h,i]=t.useState(!1),[f,d]=t.useState(null),[b,N]=t.useState(!1),[j,v]=t.useState(!1),[R,S]=t.useState(!1),[F,w]=t.useState({}),[I,Ce]=t.useState(1),[A,Se]=t.useState(1e5),H=t.useMemo(()=>[{id:"competition-wise",name:"ðŸ† Competition Wise View",description:"Group by competition with participant details",groupBy:["CompetitionTitle","GroupName"],visibleColumns:["UserName","TeamName","CandidateIdentityNumber","TeamIdentityNumber","UserGender","GroupName","OrganizationLevel","Score"],filters:{CompetitionStatus:[2,4,6]}},{id:"membership-wise",name:"ðŸ‘¥ Membership Wise View",description:"Group by organization levels with fees",groupBy:["OrganizationLevel","OrganizationLevelName"],visibleColumns:["UserName","TeamName","CandidateIdentityNumber","RegistrationId","GroupName","Fees","CompetitionTitle","MembershipType"],filters:{}},{id:"judge-score",name:"ðŸ‘¨â€âš–ï¸ Judge Score View",description:"Judge-specific score view",groupBy:["JudgeName","CompetitionTitle"],visibleColumns:["UserName","TeamName","CandidateIdentityNumber","Score","CompetitionTitle","GroupName","OrganizationLevel"],filters:{CompetitionStatus:[4,6]}},{id:"participant-list",name:"ðŸ“‹ Complete Participant List",description:"Flat list of all participants",groupBy:[],visibleColumns:["UserImage","UserName","TeamName","CandidateIdentityNumber","TeamIdentityNumber","RegistrationId","UserGender","UserDobString","UserMobile","UserEmail","GroupName","CompetitionTitle","OrganizationLevel"],filters:{}},{id:"score-card",name:"ðŸŽ¯ Score Card Print",description:"Print-ready score cards",groupBy:["CompetitionTitle"],visibleColumns:["CompetitionOrder","UserName","TeamName","CandidateIdentityNumber","TeamIdentityNumber","GroupName","OrganizationLevel","UserImage"],filters:{CompetitionStatus:[2,4]}}],[]);t.useEffect(()=>{(async()=>{try{const C=await $("/api/reports/fields",{});d(C)}catch(C){console.error("Failed to fetch available fields:",C),k.error("Failed to load report configuration")}})()},[]);const J=t.useCallback(async()=>{if(!s.groupBy||s.groupBy.length===0){k.error("Please select at least one grouping field");return}if(!s.visibleColumns||s.visibleColumns.length===0){k.error("Please select at least one column to display");return}i(!0);try{const p={groupBy:s.groupBy,fields:s.visibleColumns,filters:{...s.filters,EventId:a?.EVId,EventCategory:c?.EventCategory},pagination:{page:I,pageSize:A},sort:{field:s.groupBy[0],order:"ASC"}},C=await $("/api/reports/dynamic",p);y(C),k.success(`Report generated successfully (${C.meta.totalRecords} records)`)}catch(p){console.error("Failed to fetch report data:",p),k.error("Failed to generate report. Please try again.")}finally{i(!1)}},[s,I,A,a,c]),K=t.useCallback(p=>{m("template",p.id),m("groupBy",p.groupBy),m("visibleColumns",p.visibleColumns),m("filters",p.filters),k.success(`Applied template: ${p.name}`)},[m]),W=t.useCallback(p=>{w(C=>({...C,[p]:!C[p]}))},[]),X=t.useCallback(()=>{if(!n?.data)return;const p={},C=(Y,ee="")=>{Y.forEach((V,se)=>{const D=`${ee}${se}`;p[D]=!0,V.Participants&&Array.isArray(V.Participants)&&C(V.Participants,`${D}-`)})};C(n.data),w(p)},[n]),Z=t.useCallback(()=>{w({})},[]),q=t.useCallback(p=>{m("visibleColumns",p)},[m]),Q=t.useCallback(p=>{m("filters",p)},[m]);return e.jsxs("div",{className:"min-h-screen bg-surface",children:[e.jsx("div",{className:"bg-surfaceCard shadow-sm border-b",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-medium text-primary",children:"Dynamic Report Builder"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a?.EventName||"Event"," - Unified Reporting Interface"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>v(!j),className:T("inline-flex items-center gap-x-2 rounded-md px-4 py-2 text-sm font-medium shadow-sm transition-colors",j?"bg-primary text-white hover:bg-primaryHover":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.jsx(ce,{className:"h-4 w-4"}),"Filters"]}),e.jsxs("button",{type:"button",onClick:()=>N(!b),className:T("inline-flex items-center gap-x-2 rounded-md px-4 py-2 text-sm font-medium shadow-sm transition-colors",b?"bg-primary text-white hover:bg-primaryHover":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.jsx(de,{className:"h-4 w-4"}),"Columns"]}),e.jsx("button",{type:"button",onClick:J,disabled:h,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:h?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4"}),"Generate Report"]})})]})]})})}),e.jsxs("div",{className:"flex h-[calc(100vh-120px)]",children:[e.jsxs("div",{className:"w-80 bg-surfaceCard border-r border-border flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h2",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Report Templates"}),e.jsx(ve,{templates:H,onSelect:K,selectedTemplate:s.template})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("h2",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Group By"}),e.jsx(je,{availableFields:f?.groupableFields||[],selectedGroups:s.groupBy,onChange:p=>m("groupBy",p)})]}),n&&e.jsxs("div",{className:"p-6 border-t border-border",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"border-b-[#4852573e] text-[#206689] items-center font-medium pb-1 px-1 uppercase border-b text-sm",children:"View Controls"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:X,className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-gray-100 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200",children:[e.jsx(z,{className:"h-4 w-4"}),"Expand All"]}),e.jsxs("button",{type:"button",onClick:Z,className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-gray-100 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200",children:[e.jsx(_,{className:"h-4 w-4"}),"Collapse All"]}),e.jsxs("button",{type:"button",onClick:()=>S(!0),className:"w-full inline-flex items-center justify-center gap-x-2 rounded-md bg-primary px-3 py-2 text-sm font-medium text-white hover:bg-primaryHover",children:[e.jsx(G,{className:"h-4 w-4"}),"Export"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden bg-surfaceCard",children:h?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generating report..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This may take a moment for large datasets"})]})}):n?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 py-3 bg-surface border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-onSurfaceVariant",children:["Total Records: ",e.jsx("span",{className:"font-medium text-onSurface",children:n.meta.totalRecords})]}),e.jsxs("span",{className:"text-onSurfaceVariant",children:["Execution Time: ",e.jsxs("span",{className:"font-medium text-onSurface",children:[n.meta.executionTimeMs,"ms"]})]}),e.jsxs("span",{className:"text-gray-600",children:["Grouped By: ",e.jsx("span",{className:"font-medium text-gray-900",children:n.meta.groupBy.join(" â†’ ")})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:()=>window.print(),className:"inline-flex items-center gap-x-1 rounded-md bg-surface px-3 py-1.5 text-xs font-medium text-onSurface hover:bg-surfaceHover",children:[e.jsx(me,{className:"h-3 w-3"}),"Print"]})})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(Ne,{data:n.data,groupBy:s.groupBy,visibleColumns:s.visibleColumns,expandedGroups:F,onToggleGroup:W})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx(xe,{className:"h-16 w-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Report Generated"}),e.jsx("p",{className:"text-sm mt-2",children:'Select a template or configure grouping and columns, then click "Generate Report"'})]})})]}),b&&e.jsx(be,{availableColumns:f?.selectableFields||[],visibleColumns:s.visibleColumns,onChange:q,onClose:()=>N(!1)}),j&&e.jsx(ye,{filters:s.filters,onChange:Q,onClose:()=>v(!1),eventLevels:l}),R&&n&&e.jsx(ge,{reportData:n,groupBy:s.groupBy,visibleColumns:s.visibleColumns,onClose:()=>S(!1),eventDetails:a})]})};function He(){return e.jsx(re,{children:e.jsx("div",{className:"flex flex-col grow -m-5 lg:-m-5",children:e.jsx(we,{})})})}export{He as default};
