import{r as c,j as t,L as x,D as h}from"./main-CR4yjmzD.js";import v from"./publicRegistrationOuter-B1Jq6nCx.js";import{f as E,a as R}from"./navigationUtils-BQipJ1Np.js";import"./disclosure-D6f74p4l.js";import"./use-resolve-button-type-C9L_NJtR.js";import"./keyboard-wVITeywd.js";import"./dialog-wQOmLddz.js";import"./description-B8camfmG.js";import"./use-is-mounted-9b4uVAvv.js";import"./bugs-DpR80Nz7.js";import"./renderRegistrationForm-DXUa9mb5.js";import"./useConfirmation-DSHEuDne.js";import"./CheckIcon-BgWF5W5t.js";import"./TrashIcon-CDaz7FLr.js";import"./eventDetailedView-iHPrterB.js";import"./UserPlusIcon-CG4ihLvB.js";import"./UserGroupIcon-DisVhDJy.js";import"./publicRegistrationHelper-Dy4djtqT.js";import"./PencilIcon-BtBxBm14.js";import"./box-CPk050ji.js";import"./ChevronRightIcon-CMY6M_w2.js";import"./TrashIcon-rf7URs9m.js";const j=()=>{let e=window.location.origin;const l=localStorage.getItem("siteConfig");if(l)try{const s=JSON.parse(l);window.location.href.indexOf("localhost")===-1?e=s.apiUrl||"https://etalenterapi.azurewebsites.net":e="http://localhost:8888"}catch(s){console.warn("Error parsing siteConfig:",s)}else window.location.href.indexOf("localhost")===-1?e="https://etalenterapi.azurewebsites.net":e="http://localhost:8888";return e};function H(){const{eventName:e}=E(),l=R(),[s,i]=c.useState(!0),[m,p]=c.useState(null),[f,g]=c.useState(null);return c.useEffect(()=>{(async()=>{if(!e){p("Event name is required"),i(!1);return}try{i(!0),console.log("ðŸ”µ EventRegistrationWrapper - Initializing for slug:",e);const o=localStorage.getItem("user");let a=null;if(o)try{const r=JSON.parse(o);if(a=r?.token,a&&r?.user&&r.user.EventName?.replace(/ /g,"-")===e){console.log("âœ… EventRegistrationWrapper - Existing valid token found"),g(r),i(!1);return}}catch(r){console.warn("EventRegistrationWrapper - Error parsing existing user data:",r)}const d=`${j()}/api/PublicJson/ValidateEventRegistration/${e}`,u={"Content-Type":"application/json",Platform:"Web"};a&&(u.Authorization=`Bearer ${a}`);const n=await h.get(d,{headers:u});if(console.log("ðŸ”µ EventRegistrationWrapper - API Response:",n.data),n.data?.success){const r={token:n.data.token,user:n.data.userdata};localStorage.setItem("user",JSON.stringify(r)),console.log("âœ… EventRegistrationWrapper - Token stored in localStorage"),g(n.data),i(!1)}else p(n.data?.message||"Event registration validation failed"),i(!1)}catch(o){console.error("âŒ EventRegistrationWrapper - Initialization error:",o);const a=o?.response?.data?.message||o?.message||"Failed to initialize event registration. Please try again.";p(a),i(!1)}})()},[e]),s?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-surface",children:t.jsx(x,{info:"Initializing event registration..."})}):m?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-surface",children:t.jsx("div",{className:"max-w-md mx-auto p-6 bg-surfaceCard rounded-lg shadow-lg",children:t.jsxs("div",{className:"text-center",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),t.jsx("h3",{className:"mt-4 text-lg font-medium text-onSurface",children:"Registration Error"}),t.jsx("p",{className:"mt-2 text-sm text-onSurfaceVariant",children:m}),t.jsx("button",{onClick:()=>l("/Account/Login"),className:"mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-primaryHover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Go to Login"})]})})}):t.jsx(v,{eventData:f})}export{H as default};
