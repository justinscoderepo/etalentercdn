import{p}from"./mainweb-BW4Oeajf.js";function R(d,I,e){if(e?.JsonSettings){let s=p(e?.UserJsonSettings),n=p(e?.JsonSettings);e={...e,...s,...n}}let b={};Object.keys(e).forEach(s=>{let n=s[0]?.toLowerCase()+s.slice(1);b[n]||(b[n]=e[s])}),e={...e,...b},e?.RegistrationId&&!e?.registrationId&&(e.registrationId=e.RegistrationId);const T=e?Object.keys(e).filter(s=>s.includes("extra_payment_")):[],S=d?.AdditionalSettings,u=d?.components?.User?.find(s=>s.type==="RegistrationIdBox"),$=S?.EligibleRegistrationNumbers;let t=[];if(e?.teamMembers?.length>0&&d?.AdditionalSettings?.AllowTeamDiscountIfCaptainIsEligible==="Yes"){const s=e?.teamMembers?.find(g=>g.Designation===4),n=p(s?.UserJsonSettings),l=p(s?.JsonSettings);e={...e,...n,...l,...s},e.registrationId=s?.RegistrationId}const v=$?.find(s=>s.RegistrationNumber===(e?.registrationId??"-"));let A=u?.conditions?u.conditions.every(s=>{const n=e[`${s.key.charAt(0).toLowerCase()}${s.key.slice(1)}`],l=e[s.key];return n?.toString()===s.value?.toString()||l?.toString()===s.value?.toString()}):!0;if(v&&A&&u?.discountPercentage){const s=parseFloat(u.discountPercentage);t.push({Title:u.discountTitle,DiscountPercent:s})}const x=I.reduce((s,n)=>s+parseFloat(n.Fees),0),h=I.map(s=>({name:`${s.Title} - ${s.CompetitionCategoryName}`,total:s.Fees})),r=T.flatMap(s=>{const n=p(e[s]);return Object.entries(n).filter(([l,g])=>g.checked).map(([l,g])=>({name:l,total:g.fees}))}),y=r.reduce((s,n)=>s+parseFloat(n.total),0);let i=0;if(t.length>0){const s=t[0],n=parseFloat(s.DiscountPercent);i=x*n/100}let c=0;const o=parseFloat(S?.MaxIndividualTotalFees);if(o&&!isNaN(o)&&o>0){const s=x+y-i;s>o&&(c=s-o)}const C=x+y,P=C-i-c,J=d?.AdditionalSettings?.FeesCurrency??"USD",a=[];return h.length>0&&a.push({heading:"Competitions Fees",total:h.reduce((s,n)=>s+parseFloat(n.total),0),products:h}),r.length>0&&a.push({heading:"Extra Fees",total:y,products:r}),t.length>0&&a.push({heading:"Discount",total:`-${i}`,products:t.map(s=>({name:s.Title,total:`-${i}`}))}),c>0&&a.push({heading:"Maximum Fees Discount",total:`-${c}`,products:[{name:`Maximum Individual Fees Cap (${o}${J})`,total:`-${c}`}]}),{products:h,subTotal:C,discountPrice:i,maxIndividualFeesDiscount:c,extraPayments:r,total:P,feesCurrency:J,discounts:t,orders:a}}export{R as c};
