import{r as a,u as E,j as e,L as R}from"./main-CYp90Aiy.js";import{B as x}from"./react-toastify.esm-BeGiI1q1.js";import{F as p}from"./EnvelopeIcon-VRcsQQAB.js";import{F as U}from"./CheckCircleIcon-CGUCs_Mz.js";import{F as L}from"./XCircleIcon-D0wB_BVg.js";import{F as k}from"./MagnifyingGlassIcon-DyJAeSle.js";import"./clsx-B-dksMZM.js";function A({title:r,titleId:l,...i},c){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":l},i),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const F=a.forwardRef(A);function C({title:r,titleId:l,...i},c){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":l},i),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))}const u=a.forwardRef(C),B=()=>{const[r,l]=a.useState(new Set),[i,c]=a.useState(""),[m,b]=a.useState("all"),[h,f]=a.useState(!1),{rows:o=[],isLoading:j}=E("/EventRemindersJson/GetEligibleUsersForReminder",{doCache:!1}),d=a.useMemo(()=>{let s=o;if(m==="not-sent"?s=s.filter(t=>!t.AlreadySentReminder&&!t.OptedOut):m==="already-sent"?s=s.filter(t=>t.AlreadySentReminder):m==="opted-out"&&(s=s.filter(t=>t.OptedOut)),i){const t=i.toLowerCase();s=s.filter(n=>n.UserName?.toLowerCase().includes(t)||n.Email?.toLowerCase().includes(t)||n.Mobile?.includes(t))}return s},[o,m,i]),N=()=>{if(r.size===d.length)l(new Set);else{const s=d.filter(t=>!t.OptedOut);l(new Set(s.map(t=>t.UserId)))}},w=s=>{const t=new Set(r);t.has(s)?t.delete(s):t.add(s),l(t)},y=async()=>{if(r.size===0){x.warning("Please select at least one user");return}if(window.confirm(`Send reminders to ${r.size} user(s)?`)){f(!0);try{const t=await(await fetch("/EventRemindersJson/SendReminders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({UserIds:Array.from(r)})})).json();if(t.items){const n=t.items;x.success(n.Message||"Reminders sent successfully!"),n.Errors&&n.Errors.length>0&&(console.error("Errors:",n.Errors),n.Errors.slice(0,3).forEach(O=>x.error(O))),l(new Set),window.location.reload()}else x.error("Failed to send reminders")}catch(s){console.error("Error sending reminders:",s),x.error("Error sending reminders: "+s.message)}finally{f(!1)}}},v=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",g=d.filter(s=>!s.OptedOut).length,S=g>0&&r.size===g;return j?e.jsx(R,{from:"SendReminders"}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 md:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(p,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Send Event Reminders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Notify past participants about your new event"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(u,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total Eligible"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(U,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900",children:"Not Sent"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.filter(s=>!s.AlreadySentReminder&&!s.OptedOut).length})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(p,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-900",children:"Already Sent"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:o.filter(s=>s.AlreadySentReminder).length})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(L,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-900",children:"Opted Out"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:o.filter(s=>s.OptedOut).length})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or mobile...",value:i,onChange:s=>c(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:m,onChange:s=>b(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"not-sent",children:"Not Sent"}),e.jsx("option",{value:"already-sent",children:"Already Sent"}),e.jsx("option",{value:"opted-out",children:"Opted Out"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:N,disabled:g===0,className:"h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r.size>0?`${r.size} selected`:`${d.length} user${d.length!==1?"s":""}`})]}),e.jsx("button",{onClick:y,disabled:r.size===0||h,className:`px-6 py-2 rounded-lg font-medium flex items-center gap-2 ${r.size===0||h?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"h-5 w-5"}),"Send Reminders"]})})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:d.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(u,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No eligible users found"})]}):d.map(s=>e.jsx("div",{className:`p-4 hover:bg-gray-50 transition-colors ${s.OptedOut?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"checkbox",checked:r.has(s.UserId),onChange:()=>w(s.UserId),disabled:s.OptedOut,className:"h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.UserImage?e.jsx("img",{src:s.UserImage,alt:s.UserName,className:"h-12 w-12 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:e.jsx(u,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.UserName}),s.OptedOut&&e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded-full",children:"Opted Out"}),s.AlreadySentReminder&&!s.OptedOut&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded-full",children:"Already Sent"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:s.Email}),s.Mobile&&e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ“± ",s.Mobile]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-900",children:[s.TotalEventsParticipated," event",s.TotalEventsParticipated!==1?"s":""]}),s.LastEventName&&e.jsx("p",{className:"text-xs text-gray-600 truncate max-w-xs",title:s.LastEventName,children:s.LastEventName}),s.LastParticipationDate&&e.jsx("p",{className:"text-xs text-gray-500",children:v(s.LastParticipationDate)})]})]})},s.UserId))})]})]})})};export{B as default};
