import{j as e,r as o}from"./mainweb-DknN_MIJ.js";import{a as A}from"./index-BtuGy7By.js";import{F as ce,a as de,C as ie}from"./ClipLoader-hPvBb7qB.js";const Y=({token:a,selectedParticipant:m,selectedCompetition:n,setSelectedParticipant:g,setCompetitionParticipants:l,setParticipantMark:d,fetchCompetitionParticipantsScoreCard:x})=>{const j=async()=>{try{const f=await A.delete("https://etalenterapi.azurewebsites.net/JudgesScoreCardJson/Remove",{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${a}`},params:{ScorecardId:m.ParticipantIdScorecardId}});f.data?(g(null),l([]),d(""),await x(n)):(console.error("Error deleting score:",f.data.message||"Unknown error"),alert("Error deleting score: "+(f.data.message||"Unknown error")))}catch(f){console.error("Error deleting score:",f),alert("An error occurred while deleting the score.")}};return e.jsx("button",{className:"btn-delete",onClick:j,title:"Delete Score",children:e.jsx(ce,{size:16})})},ue=({selectedCompetition:a,selectedAllotmentId:m,token:n,userRoleId:g,fetchJudgesAllotmentData:l,fetchCompetitionParticipantsScoreCard:d})=>{const x=async()=>{try{const j=new FormData;j.append("Competition",a),j.append("AllotementId",m);const f=await A.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/SaveJudgeStatus",j,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${n}`}});f.data?(l(g),d(a)):(console.error("Error saving score:",f.data.message||"Unknown error"),alert("Error saving score: "+(f.data.message||"Unknown error")))}catch(j){console.error("Error:",j),alert("An error occurred")}};return e.jsxs("div",{className:"completion-section",children:[e.jsx("p",{children:'If you finished all score updates for this selected competition, press "Mark as Completed". After marking as finished, it will move to the finished section.'}),e.jsx("button",{className:"btn-completed",onClick:x,children:"Mark as Completed"})]})},pe=({index:a,details:m,CriteriaMarks:n,competitionMaxScore:g,competitionDetails:l,handleMarkChange:d})=>{var f;const x=C=>{var S;return C/(g/((S=l==null?void 0:l.Results)==null?void 0:S.length))*100},j=C=>{var y;const S=g/((y=l==null?void 0:l.Results)==null?void 0:y.length);return C<=S/4?"red":C<=S/3?"#FF8C00":C<=S/3?"#FFB900":C<=S/1.5?"blue":"#03fc77"};return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs("div",{className:"relative range-slider",children:[e.jsx("div",{style:{width:`${x(n[a]||m.Score||0)}%`,backgroundColor:j(n[a]||m.Score||0)},className:"absolute h-full"}),e.jsx("div",{className:"absolute top-1 left-0 w-full flex justify-center items-center space-x-1",children:[...Array(10)].map((C,S)=>e.jsx("span",{className:"text-gray-400 text-xs",children:"★"},S))}),e.jsx("input",{type:"range",id:`range-slider-${m.Score}`,min:"0",max:"10",step:"0.1",value:n[a]===0?0:n[a]/(g/((f=l==null?void 0:l.Results)==null?void 0:f.length))*10,onChange:C=>{var z;const y=Number(C.target.value)/10*(g/((z=l==null?void 0:l.Results)==null?void 0:z.length));d(a,y)},className:"range-slider-input no-thumb"})]})}),e.jsx("input",{type:"number",id:`mark-${m.Score}`,className:"input-mark",placeholder:m.Score??0,value:n[a]||"",onChange:C=>d(a,Number(C.target.value)),step:"0.1",style:{marginBottom:"16px"}})]})},me=({participantMark:a,setParticipantMark:m,selectedParticipant:n})=>{const g=d=>d/10*100,l=d=>d<=3?"red":d<=4?"#FF8C00":d<=5.5?"#FFB900":d<=7?"blue":"#03fc77";return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{className:"relative range-slider",children:[e.jsx("div",{style:{width:`${g(a===0?n.ParticipantIdScore:a)}%`,backgroundColor:l(a===0?n.ParticipantIdScore:a)},className:"absolute h-full"}),e.jsx("div",{className:"absolute top-1 left-0 w-full flex justify-center items-center space-x-1",children:[...Array(10)].map((d,x)=>e.jsx("span",{className:"text-gray-400 text-xs",children:"★"},x))}),e.jsx("input",{type:"range",id:`range-slider-${n.ParticipantId}`,min:"0",max:"10",step:"0.1",value:a===0?n.ParticipantIdScore:a,onChange:d=>m(Number(d.target.value)),className:"range-slider-input no-thumb"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",marginTop:"8px"},children:[e.jsx("span",{children:"0"})," ",e.jsx("span",{children:"10"})," "]})]}),e.jsx("input",{type:"number",id:`mark-${n.ParticipantId}`,className:"input-mark",placeholder:n.ParticipantIdScore>0?n.ParticipantIdScore:"Enter mark",value:a,onChange:d=>{const x=d.target.value;m(x===""?null:Number(x))},step:"0.1",style:{marginBottom:"16px"}})]})},he=({message:a,onClose:m,duration:n=3e3})=>(o.useEffect(()=>{if(a){const g=setTimeout(()=>{m()},n);return()=>clearTimeout(g)}},[a,m,n]),e.jsx("div",{className:`snackbar ${a?"show":""}`,children:a})),Z=({participantMark:a,competitionMaxScore:m,CriteriaMarks:n=[],selectedParticipant:g,competitionDetails:l,totalMark:d,userRoleId:x,token:j,fetchCompetitionParticipantsScoreCard:f,selectedCompetition:C,setSelectedParticipant:S,SetCompetitionParticipants:y,setParticipantMark:z,scoreLabel:F})=>{var G;const[B,U]=o.useState(""),W=async()=>{if((!a||isNaN(a)||a<0)&&(!n||n.length===0||n.some(i=>isNaN(i)||i<0))){alert("Please enter a valid score.");return}if(a>m){alert(`The score cannot exceed the maximum allowed score of ${m}.`);return}try{const i=new FormData;n.length>0&&!a?n.forEach((L,v)=>{var O;if(v===n.length-1)i.append(`Scores[${v}][ScoreCardParticipant]`,g.ParticipantId),i.append(`Scores[${v}][IsActAsJudge]`,"true"),i.append(`Scores[${v}][ScoreCardScore]`,d),i.append(`Scores[${v}][ScoreCardScorecardId]`,g.ParticipantIdScorecardId||0);else{const u=((O=l==null?void 0:l.Results)==null?void 0:O[v])||{},$=u.DetailId||u.Criteria||`Criteria ${v+1}`;i.append(`Scores[${v}][ScoreCard]`,u.ScoreCard||""),i.append(`Scores[${v}][IsActAsJudge]`,"true"),i.append(`Scores[${v}][Criteria]`,$),i.append(`Scores[${v}][Score]`,L),i.append(`Scores[${v}][Status]`,u.Status||1),i.append(`Scores[${v}][DetailedScoreCardCriteriaId]`,u.DetailedScoreCardCriteriaId||"")}}):(i.append("Scores[0][ScoreCardParticipant]",g.ParticipantId),i.append("Scores[0][IsActAsJudge]",!!l.Status),i.append("Scores[0][ScoreCardScore]",a),i.append("Scores[0][ScoreCardScorecardId]",g.ParticipantIdScorecardId)),i.append("JudgeId",x);const T=await A.post("https://etalenterapi.azurewebsites.net/JudgeJson/SaveScore",i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`}});T.data?(U("Score saved successfully!"),S(null),y([]),z(""),await f(C)):(console.error("Error saving score:",T.data.message||"Unknown error"),alert("Error saving score: "+(T.data.message||"Unknown error")),U("Score not saved!"))}catch(i){console.error("Error posting score:",i),alert("An error occurred while saving the score.")}};return e.jsxs("div",{children:[e.jsx("button",{className:"btn-save",onClick:W,title:"Save",disabled:isNaN(a)||a<0||a>(F==="Rating out of 10"?m/((G=l==null?void 0:l.Results)==null?void 0:G.length):m),children:e.jsx(de,{size:16})}),console.log("Snackbar message:",B),B&&e.jsx(he,{message:B,onClose:()=>U("")})]})},R=localStorage.getItem("accessToken");function Ne({user:a}){var X;const[m,n]=o.useState([]),[g,l]=o.useState(""),[d,x]=o.useState(null),[j,f]=o.useState([]),[C,S]=o.useState([]),[y,z]=o.useState(null),[F,B]=o.useState([]),[U,W]=o.useState(null),[G,i]=o.useState(!1),[T,L]=o.useState(!1),[v,O]=o.useState(!1),[u,$]=o.useState(null),[p,H]=o.useState(null),[J,k]=o.useState((u==null?void 0:u.ParticipantIdScore)||""),[ge,Se]=o.useState({top:0,left:0}),[fe,Ce]=o.useState(!1),[N,M]=o.useState(0),[D,ee]=o.useState(null),[I,te]=o.useState(""),[xe,je]=o.useState(0),[w,K]=o.useState([]),[V,_]=o.useState(0);o.useEffect(()=>{if(p!=null&&p.Results){const r=p.Results.map(c=>c.Score||0);let t=0;if(I==="Rating out of 10"){const c=r.filter(h=>h>0);t=c.length>0?c.reduce((h,b)=>h+b,0)/c.length:0}else I==="Marks"&&(t=r.reduce((c,h)=>c+(h>0?h:0),0));const s=[...r,Number(t.toFixed(2))];K(s),_(Number(t.toFixed(2)))}},[p,I]);const q=(r,t)=>{const s=[...w],c=s.length-1;if(r<c){s[r]=t;let h=0;if(I==="Rating out of 10"){const b=s.slice(0,-1).filter(P=>P>0);h=b.length>0?b.reduce((P,le)=>P+le,0)/b.length:0}else I==="Marks"&&(h=s.slice(0,-1).reduce((b,P)=>b+(P>0?P:0),0));s[c]=Number(h.toFixed(2))}else if(r===c){const h=t/(s.length-1);for(let b=0;b<c;b++)s[b]=Number(h.toFixed(2));s[c]=Number(t.toFixed(2))}K(s),_(s[c])};o.useEffect(()=>{(async()=>{i(!0);try{const t=new FormData;t.append("CreatedBy","12007"),t.append("Role",a.Role),t.append("isCaching","true");const s=await A.post("https://etalenterapi.azurewebsites.net/UsersRolesJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${R}`}});if(s.data&&s.data.Results){n(s.data.Results);const c=filteredJudges.map(h=>h.UserName||"Unknown");W(c)}}catch(t){console.error("Error fetching selected judges:",t)}finally{i(!1)}})()},[]);const re=r=>{const t=Number(r.target.value);l(t),m.find(c=>c.UserRoleId===t)&&(i(!0),x(t),Q(t).finally(()=>i(!1)))};o.useEffect(()=>{},[d,g]);const Q=async r=>{L(!0);try{const t=new FormData;t.append("Status","1"),t.append("PageSize","500"),t.append("Judge",r),t.append("SortOrder","asc");const s=await A.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentWithScoreLabelJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${R}`}});if(s.data&&s.data.Results){const c=s.data.Results;f(c)}}catch(t){console.error("Error fetching judges allotment data:",t)}finally{L(!1)}},se=r=>{const t=Number(r.target.value);z(t);const s=j.filter(h=>h.Competition===t);if(B(s),s.length>0){const h=s[0].AllotementId;ee(h)}const c=s[0].ScoreLabelLabel;te(c),E(t)};o.useEffect(()=>{F&&F.length>0},[F]);const E=async r=>{try{const t=new FormData;t.append("PageSize","100"),t.append("IsActAsJudge","true"),t.append("Judge",d),t.append("Competition",r),t.append("SortColumn","ParticipantId"),t.append("SortOrder","asc"),t.append("PageNumber","1");const s=await A.post("https://etalenterapi.azurewebsites.net/CompetitionParticipantsScoreCardJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${R}`}});if(s.data&&s.data.Results){const c=s.data.Results;S(c);const h=c[0];M(h.CompetitionMaximumScore)}}catch(t){console.error("Error fetching CompetitionParticipants Scorecard data:",t)}},ae=r=>{_(0),$(r),r.ParticipantIdScore>0?oe(r):ne(r)},ne=async r=>{try{const t=new FormData;t.append("LanguageGlobal",r.CompetitionLanguage),t.append("GroupGlobal",r.CompetitionGroup),t.append("GenderGlobal",r.CompetitionGender),t.append("ParticipantTypeGlobal",r.CompetitionParticipantType),t.append("CompetitionItemGlobal",r.CompetitionCompetitionItem),t.append("isCaching","true");const s=await A.post("https://etalenterapi.azurewebsites.net/CompetitionDetailsJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${R}`}});s.data&&H(s.data)}catch(t){console.error("Error fetching competition details:",t)}};o.useEffect(()=>{},[p]);const oe=async r=>{try{const t=new FormData;t.append("IsActAsJudge","true"),t.append("Judge",d),t.append("ScoreCard",r.ParticipantIdScorecardId);const s=await A.post("https://etalenterapi.azurewebsites.net/JudgesDetailedScoreCardJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${R}`}});s.data&&H(s.data)}catch(t){console.error("Error fetching detailed score card:",t)}};return e.jsxs("div",{className:"body",children:[e.jsx("h2",{className:"scorecard-title",style:{textTransform:"uppercase"},children:"JUdges ScoreCard"}),e.jsxs("div",{className:"competition-selection form-group",children:[e.jsx("label",{className:"form-label",children:"Select Judge"}),e.jsxs("select",{className:"form-control",value:g,onChange:re,disabled:G,children:[e.jsx("option",{value:"",children:"--Select Judge--"}),m.map(r=>e.jsx("option",{value:r.UserRoleId,children:r.UserName||"Unknown"},r.UserRoleId))]}),e.jsx("label",{className:"form-label",children:"Select Competition"}),T?e.jsx("div",{className:"spinner-container",children:e.jsx(ie,{color:"#36d7b7",loading:T,size:50})}):e.jsxs("select",{className:"form-control",value:y,onChange:se,children:[e.jsx("option",{value:"",children:"--Select Competition--"}),j.map(r=>e.jsxs("option",{value:r.Competition,children:[r.CompetitionGroupGroupName," - ",r.ScoreStatusScoreResultStatus," "," | ",r.CompetitionItemTitle||"Unknown"," "," (",r.CompetitionParticipantTypeTitle,")"]},r.AllotementId))]})]}),e.jsxs("div",{className:"participants-container",children:[e.jsx("div",{className:"participants-list",children:C.length>0?C.map(r=>e.jsx("div",{className:`participant-container ${(u==null?void 0:u.ParticipantId)===r.ParticipantId?"selected":""}`,onClick:()=>ae(r),children:e.jsxs("div",{className:"participant-summary",children:[e.jsx("div",{className:"participant-id",children:r.CandidateIdentityNumber||0}),e.jsx("div",{className:"participant-score",children:r.ParticipantIdScore||0})]})},r.ParticipantId)):e.jsx("p",{className:"no-participants-message",children:"No participants found."})}),e.jsx("div",{className:`expanded-content-container ${u?"visible":""}`,children:u&&e.jsx("div",{className:"input-mark",children:e.jsx("div",{className:"mark-section",children:((X=p==null?void 0:p.Results)==null?void 0:X.length)>1?e.jsxs(e.Fragment,{children:[p.Results.map((r,t)=>{var s,c,h,b;return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[r.CriteriaCriteriaName||r.CriteriaName,((s=p==null?void 0:p.Results)==null?void 0:s.length)>0?e.jsxs("span",{children:["(",r.SecondValue||N/((c=p==null?void 0:p.Results)==null?void 0:c.length),")"]}):e.jsxs("span",{children:["(",r.SecondValue||N,")"]})]}),I==="Rating out of 10"?e.jsx(pe,{index:t,details:r,CriteriaMarks:w,competitionMaxScore:N,competitionDetails:p,handleMarkChange:q},t):e.jsx("input",{type:"number",id:`mark-${r.Score}`,className:"input-mark",placeholder:r.Score??0,value:w[t]||"",onChange:P=>q(t,Number(P.target.value)),style:{marginBottom:"16px"}}),w[t]&&(isNaN(w[t])||w[t]<0)&&e.jsx("div",{style:{color:"red",fontSize:"12px"},children:"Please enter a valid score (must be a positive number)."}),(w[t]>(I==="Rating out of 10"?N/((h=p==null?void 0:p.Results)==null?void 0:h.length):N)||(r.SecondValue?w[t]>r.SecondValue:w[t]>N))&&e.jsxs("div",{style:{color:"red",fontSize:"12px"},children:["The score cannot exceed the maximum score of ",r.SecondValue||N/((b=p==null?void 0:p.Results)==null?void 0:b.length),"."]})]},t)}),e.jsxs("div",{style:{marginBottom:"8px"},children:["Total",e.jsxs("span",{children:["(",F.CompetitionMaximumScore??N,")"]})]}),e.jsx("input",{type:"number",id:`mark-${V}`,className:"input-mark",placeholder:"Total",value:V||"",onChange:r=>q(w.length-1,Number(r.target.value)),style:{marginBottom:"16px"}}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(Z,{participantMark:J,competitionMaxScore:N,CriteriaMarks:w,selectedParticipant:u,competitionDetails:p,totalMark:V,userRoleId:d,token:R,fetchCompetitionParticipantsScoreCard:E,selectedCompetition:y,setSelectedParticipant:$,SetCompetitionParticipants:S,setParticipantMark:k,scoreLabel:I}),u.ParticipantIdScore>0&&e.jsx(Y,{token:R,selectedParticipant:u,selectedCompetition:y,setSelectedParticipant:$,setCompetitionParticipants:S,setParticipantMark:k,fetchCompetitionParticipantsScoreCard:E})]})]}):e.jsxs("div",{children:[I==="Rating out of 10"?e.jsx(me,{participantMark:J,setParticipantMark:k,selectedParticipant:u}):e.jsxs("div",{children:["Total ",e.jsx("span",{children:u.CompetitionMaximumScore}),e.jsx("input",{type:"number",id:`mark-${u.ParticipantId}`,className:"input-mark",placeholder:u.ParticipantIdScore>0?u.ParticipantIdScore:"Enter mark",value:J,onChange:r=>{const t=r.target.value;k(t===""?null:Number(t))},style:{marginBottom:"16px"}})]}),J&&(isNaN(J)||J<0)&&e.jsx("div",{style:{color:"red",fontSize:"12px"},children:"Please enter a valid score (must be a positive number)."}),J>(I==="Rating out of 10"?10:N)&&e.jsxs("div",{style:{color:"red",fontSize:"12px"},children:["The score cannot exceed the maximum score of ",I==="Rating out of 10"?10:N,"."]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(Z,{participantMark:J,competitionMaxScore:N,CriteriaMarks:w,selectedParticipant:u,competitionDetails:p,totalMark:V,userRoleId:d,token:R,fetchCompetitionParticipantsScoreCard:E,selectedCompetition:y,setSelectedParticipant:$,SetCompetitionParticipants:S,setParticipantMark:k,scoreLabel:I}),u.ParticipantIdScore>0&&e.jsx(Y,{token:R,selectedParticipant:u,selectedCompetition:y,setSelectedParticipant:$,setCompetitionParticipants:S,setParticipantMark:k,fetchCompetitionParticipantsScoreCard:E})]})]})})})})]}),e.jsx("div",{className:"completion-section",children:e.jsx(ue,{selectedCompetition:y,selectedAllotmentId:D,token:R,userRoleId:d,fetchJudgesAllotmentData:Q,fetchCompetitionParticipantsScoreCard:E})})]})}export{Ne as default};
