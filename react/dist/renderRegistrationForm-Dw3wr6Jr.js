import{j as e,i as Fe,L as He,_ as Pe,B as Me,u as Ve,m as We,r as N,b as qe,o as G,p as xe,z as fe}from"./main-DF5MPKRF.js";import{r as Ke,e as Qe,g as Xe,a as Ye,b as Ze,u as $e,s as et}from"./publicRegistrationHelper-DqxIhYAr.js";import{B as Ce}from"./box-CIo4Y4ip.js";import{E as tt}from"./alert-MFEluBH_.js";import"./PencilIcon-C96_7Rqw.js";function st({isSubmitted:v,availableSteps:f,submittedSteps:n,handleClick:r}){return e.jsx("nav",{"aria-label":"Progress",className:"mb-2 flex w-full",children:e.jsx("ol",{role:"list",className:"divide-y divide-gray-300 rounded-md border border-gray-300 flex md:divide-y-0  w-full flex-wrap",children:f?.map((t,x)=>e.jsxs("li",{className:"relative md:flex md:flex-1 ",children:[t.status==="active"?e.jsx("a",{href:t.href,"aria-current":"step",className:"group max-w-40 flex items-center truncate text-ellipsis overflow-hidden whitespace-nowrap",children:e.jsxs("span",{className:"flex items-center px-2 py-2 text-xs font-medium",children:[e.jsx("span",{className:"flex h-6 w-6 sm:h-8 sm:w-8 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-white text-xs",children:t.id})}),e.jsx("span",{className:"ml-1 mr-3 text-xs font-medium text-indigo-600",children:t.label??t.name})]})}):n?.find(a=>a.name==t.name)||v?e.jsx("a",{href:t.href,className:"group max-w-40 flex items-center truncate text-ellipsis overflow-hidden whitespace-nowrap",onClick:a=>r(x,a),children:e.jsxs("span",{className:"flex items-center px-2 py-2 text-xs font-medium",children:[e.jsx("span",{className:"flex h-6 w-6 sm:h-8 sm:w-8 items-center justify-center rounded-full bg-gray-300 group-hover:bg-gray-400",children:e.jsx("span",{className:"text-gray-500 group-hover:text-gray-900",children:t.id})}),e.jsx("span",{className:"ml-1 mr-3 text-xs font-medium text-gray-400 group-hover:text-gray-900",children:t.label??t.name})]})}):e.jsx("a",{href:t.href,className:"group max-w-40 flex items-center truncate text-ellipsis overflow-hidden whitespace-nowrap",onClick:a=>r(x,a),children:e.jsxs("span",{className:"flex items-center px-2 py-2 text-xs font-medium",children:[e.jsx("span",{className:"flex h-6 w-6 sm:h-8 sm:w-8 items-center justify-center rounded-full border-2 border-gray-300 group-hover:border-gray-400",children:e.jsx("span",{className:"text-gray-500 group-hover:text-gray-900",children:t.id})}),e.jsx("span",{className:"ml-1 mr-3 text-xs font-medium text-gray-500 group-hover:text-gray-900",children:t.label??t.name})]})}),x!==f.length-1?e.jsx(e.Fragment,{children:e.jsx("div",{"aria-hidden":"true",className:"absolute right-0 top-0 hidden h-full w-5 md:block",children:e.jsx("svg",{fill:"none",viewBox:"0 0 22 80",preserveAspectRatio:"none",className:"h-full w-full text-gray-300",children:e.jsx("path",{d:"M0 -2L20 40L0 82",stroke:"currentcolor",vectorEffect:"non-scaling-stroke",strokeLinejoin:"round"})})})}):null]},t.name))})})}const at=Fe.lazy(()=>Pe(()=>import("./formSubmission-tuoIG13A.js"),[])),rt=Fe.lazy(()=>Pe(()=>import("./modalForm-B2QjXW2a.js"),[]));function nt({steps:v,userRoleJson:f,isCoordinatorView:n,gotoHome:r,participantType:t,isSubmitted:x,selectedUser:a,selectedTeam:j,eventDetails:c,activeStep:O,isLoading:i,updateIndex:l,availableSteps:d,submittedSteps:z,allStepsComponents:P,customComponents:b,data:H,onChange:M,handleClick:L,handleNext:E,components:A,tempUser:J,selectedComponent:u,setSelectedComponent:o,isDirectOpen:Z=!1,isProperlyLoaded:$=!0}){if(!d||d?.length==0)return e.jsx("div",{className:"text-center text-2xl text-gray-500",children:a||j?"Steps Loading/No Steps Found":"Unfortunately, no steps are available at this time."});let K=d.findIndex(g=>g.status==="active")+1===d.length,k=d.findIndex(g=>g.name==="Guardian Registration")>-1;if(a||j||k||Z){let g=e.jsxs("span",{className:"text-gray-500",children:[c?.EventName+""," ",e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-200 px-4 py-1 text-[10px] font-medium text-green-700 ring-1 ring-inset ring-green-600/20 ml-2",children:"New Participant Registration"})]});t==="Team"&&(g=e.jsxs("span",{className:"text-gray-500",children:[c?.EventName+""," ",e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-200 px-4 py-1 text-[10px] font-medium text-green-700 ring-1 ring-inset ring-green-600/20 ml-2",children:"New Team Registration"})]})),a&&a.Name&&(g=c?.EventName+" - "+a.Name),f?.FinishedSteps==!0&&(g=c?.EventName+" - "+a.Name+" - Submitted");let h="Registration Form",S="Please fill the form to register for the event";return a&&a.Name&&(h=a.Name+" - Registration Form",S="Please continue remaining steps to complete the registration"),j&&j.TeamName&&(h=j.TeamName+" - Registration Form",S="Please continue remaining steps to complete the registration"),x&&(h="View",S="Please view the details submitted in the registration form"),J&&(g=c?.EventName+" - First User Registration",h="Registration Form",S="Please fill the form to register for the event"),k&&(g=c?.EventName+" - Account Registration",h="Account Registration Form",S="Please fill the form to register an account for adding participants"),e.jsx(rt,{title:h,description:S,open:!0,customHeading:b||null,setOpen:()=>{r()},children:e.jsx(Ce,{heading:g,outerClasses:"relative w-full",headingClasses:"px-1 lg:px-4  w-full",children:e.jsx("div",{className:"w-full mt-5 min-h-[800px]",id:"registrationBox",children:O?e.jsxs(e.Fragment,{children:[d?.length>1&&e.jsx(st,{isSubmitted:x,availableSteps:d,submittedSteps:z,handleClick:L}),$?i?e.jsx(He,{}):e.jsx(e.Fragment,{children:e.jsx(at,{isCoordinatorView:n,participantType:t,isGuardianRegistration:k,handleNext:E,isSubmitted:x,eventDetails:c,isPlayGround:!1,onChange:M,data:H,isLastStep:K,existingComponents:A,selectedComponent:u,setSelectedComponent:o,components:A},l)}):e.jsx(tt,{info:"We couldn't find the selected user or team."})]}):e.jsx("div",{className:"text-center text-2xl text-gray-500",children:"Please select a step to proceed"})})})})}else if(J&&t==="individual")return e.jsx(Ce,{heading:c+" - Event Registration",outerClasses:"relative w-3/4",headingClasses:"px-1 md:px-6  w-full",children:e.jsx("div",{className:"w-full mt-5",children:e.jsx("div",{className:"text-center text-2xl text-gray-500",children:"Please click on add button and proceed"})})})}const it=v=>{const{getParticipantsLink:f,participantTypeInt:n,candidateId:r,isDirectOpen:t=!1}=v,{eventDetails:x,jsonSettings:a,allStepsComponents:j,participationDetails:c,participationsStatus:O,refreshParticipationDetails:i}=Me(),l={...r&&n==1?{Candidate:r,participantType:"1"}:r&&n==2?{Candidate:r,TeamId:r,participantType:"2"}:t?{participantType:n==1?"1":"2"}:{}},{row:d,update:z,status:P,setFilter:b,filters:H}=Ve(f||"/CandidateJson/GetParticipants",{deleteUrl:"/CandidateJson/RemoveUser",mandatoryParams:["participantType","Candidate"],select:"participantList,userList,UserEmail,UserName,UserDobString,UserImage,UserMobile,UserPhone,Email,Group,Candidate,CandidateUser,JsonSettings,Gender,GroupName,Fees,TeamTeamName,Team,TeamStrength,TeamMembersList,TeamMembers,TeamStrength,CandidateIdentityNumber,TeamIdentityNumber,CompetitionOrder,CreatedBy,CreatedByUserName,ParticipationId,UserJsonSettings,TeamJsonSettings,Remarks,LevelSettings,RegistrationId",updateUrl:"/CandidateJson/UpdateParticipant",doCache:!0,noGet:!r||!l.participantType,limit:r?1:0,filter:l}),M=r?d:c,L=r?P:O,E=async u=>{try{return await xe("/CandidateJson/UpdateTeam",u)}catch(o){throw console.error("Update team error:",o),o}},A=async u=>{try{return await xe("/CandidateJson/UpdateUser",u)}catch(o){throw console.error("Update user error:",o),o}},J=async u=>{try{return await xe("/CandidateJson/UpdateUserRoles",u)}catch(o){throw console.error("Update role error:",o),o}};return e.jsx(lt,{...v,refreshParticipationDetails:i,eventDetails:x,jsonSettings:a,allStepsComponents:j,participationDetails:M,participationsStatus:L,currentFilters:H,updateParticipations:z,setParticipationsFilter:b,updateTeam:E,updateUser:A,updateRole:J,isDataLoading:We(L)})},lt=({view:v,isCoordinatorView:f,participantTypeInt:n,candidateId:r,closeModel:t,customComponents:x,allowEdit:a,isDirectOpen:j=!1,eventDetails:c,jsonSettings:O,allStepsComponents:i,participationDetails:l,currentFilters:d,updateParticipations:z,setParticipationsFilter:P,updateTeam:b,updateUser:H,updateRole:M,isDataLoading:L,refreshParticipationDetails:E})=>{const[A,J]=N.useState(!0),{user:u}=qe()||{};if(!u||!u.Email)return e.jsx("div",{children:"Please log in to access this form."});const o=u?.RoleTitle==="Guardian",Z=u?.Email?.indexOf("justnshalom")!=-1,[$,K]=N.useState(0),[k,g]=N.useState(null),[h,S]=N.useState({});let[he,ee]=N.useState(null),[pe,Ne]=N.useState(!1);const[te,ve]=N.useState([]),[m,se]=N.useState(r),w=n==1?"Individual":n==2?"Team":"";let[ae,be]=N.useState([...Ke]),je={},re={};const ne=s=>g(s);m&&(n==1?l?.UsersList?.length&&l.UsersList[0]:n==2&&l?.UsersList?.length&&l.UsersList[0]),console.log({participationDetails:l}),N.useEffect(()=>{m&&(n==1&&d?.Candidate!=m?P({Candidate:m,participantType:"2"}):n==2&&(d?.Candidate!=m||d?.TeamId!=m)&&P({Candidate:m,participantType:"2",TeamId:m}))},[m,d?.Candidate]);let Le=Qe(l,m,k?.UId,he?.Team),{userRoles:ye,userRole:I,users:ie,userData:T,teams:Se,teamData:C}=Le;console.log({participationDetails:l,selectedUser:k,selectedTeam:he}),console.log({userRoles:ye,userRole:I,users:ie,userData:T,teams:Se,teamData:C});let le=T,oe=C,Q=ie?.length?null:G(localStorage.user)?.user;if(o&&!Z&&(Q=null),w=="Team"){let s=G(localStorage.user)?.user;s&&(Q=s?.Email?.indexOf("justnshalom")==-1?null:s)}let X=Q?{UId:Q?.UId}:null;X&&(T={UId:X?.UId});const Ee=L||pe;let y=G(I?.JsonSettings),de=G(T?.JsonSettings),V=G(C?.TeamJsonSettings);const Ae=O?.AdditionalSettings,Je=Object.keys(i??{});let ke=G(h?.JsonSettings),me=Je?.includes("Agreement")&&i?.Agreement?.filter(s=>s?.validate?.required&&!y[s.name]&&!ke[s.name])?.length==0;me&&localStorage.setItem("isAgreementStepFilled","true"),localStorage.getItem("isAgreementStepFilled")=="true"&&(me=!0);let U=Xe(i,ae,me,w,ie,X,v,f),p=Ye(U),we=Ze(i,p),ce=p?$e(p.name,{},K,p,I,y,T,de,w,C,l,i,le,oe,V,!1,h):{};const Ue=(s,W,_,F,Te,B,q,ue,Oe)=>{if(W.preventDefault(),!F)return;let ze=F[s];if(!(ue?.FinishedSteps||Oe?.FinishedSteps||m)&&!_&&!(F.findIndex(ge=>ge.status==="active")>s)&&!te.find(ge=>ge.name==ze.name)){fe.error("Please complete the current step/click the next button for proceed to the next step.");return}const Y=F?.map((R,D)=>D===s?{...R,status:"active"}:{...R,status:"inactive"});if(F=Y,B=Y.find(R=>R.status==="active"),i[B.name]){let R=i[B.name];R.forEach(D=>{D.name=D.name.charAt(0).toLowerCase()+D.name.slice(1)}),re[B.name]=[...R]}else re[B.name]=[];window.scrollTo({top:0,behavior:"smooth"}),ae=Y,be(Y)},_e=async(s,W,_,F)=>{Ne(!0),J(!0),je={...je,...s};let Te=U.findIndex(q=>q.status==="active")+1;if(_||Te>=U.length&&(w=="Individual"?y.FinishedSteps=!0:s.FinishedSteps=!0),await et(s,h,p,I,ye,y,T,de,w,C,l,we,M,H,b,P,z,le,ne,oe,ee,S,V,Se,Ae,_,se)){ve([...te,p]),W();let q=U.findIndex(ue=>ue.status==="active")+1;q<U.length&&!_&&!F?Ue(q,{preventDefault:()=>{}},!0,U,ce,p,I,y,V):(ne(null),I={},de={},y={},C={},ee(null),t&&(se(null),t(),A&&E({takeNew:!0})),fe.success("Registration saved successfully!"))}else fe.error("Failed to save data");Ne(!1),K($+1)},Be=s=>{re[p.name]=s},De=(s,W)=>{Ue(s,W,!1,U,ce,p,I,y,V)};let Re=w=="Individual"&&y?.FinishedSteps||w=="Team"&&V?.FinishedSteps;a&&m&&(Re=!1),i?.User&&i?.User?.length>0,i?.Team&&i?.Team?.length>0;let Ge=()=>{ne(null),ee(null),ve([]),t&&(se(null),t(),E({takeNew:!0}))};var Ie=!0;return m>0&&l?.UsersList?.length>0&&(!T&&n==1||!C&&n==2)&&(Ie=!1),m>0&&!l&&(pe=!0),e.jsx("div",{className:"relative",children:e.jsx(nt,{isDirectOpen:j,isCoordinatorView:f,customComponents:x,isProperlyLoaded:Ie,userRoleJson:y,participantType:w,steps:ae,gotoHome:Ge,isSubmitted:Re,selectedTeam:oe,tempUser:X,selectedUser:le,eventDetails:c,activeStep:p,isLoading:Ee,onChange:Be,availableSteps:U,submittedSteps:te,allStepsComponents:i,data:{...ce},handleClick:De,handleNext:_e,components:we,setSelectedComponent:()=>{}})})},xt=v=>e.jsx(it,{...v});export{lt as RegistrationFormComponent,xt as RenderRegistrationForm,it as WithRegistrationFormData,xt as default};
