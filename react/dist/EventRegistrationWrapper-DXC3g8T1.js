import{r as c,j as t,L as x,D as h}from"./main-CalEMNEI.js";import v from"./publicRegistrationOuter-Y1gyso9u.js";import{f as E,a as R}from"./navigationUtils-Dw3s0N_F.js";import"./disclosure-B5T7CFAP.js";import"./use-resolve-button-type-DV6PgDl_.js";import"./keyboard-DuNWlJIA.js";import"./open-closed-hjR-G-rZ.js";import"./bugs-Chek1JIE.js";import"./dom-CW5fUG2t.js";import"./renderRegistrationForm-BToO6UiH.js";import"./publicRegistrationHelper-DNqOg_Zs.js";import"./PencilIcon-VZpjWVKU.js";import"./box-EeDfeq5r.js";import"./alert-C_Rrmiye.js";const j=()=>{let e=window.location.origin;const l=localStorage.getItem("siteConfig");if(l)try{const s=JSON.parse(l);window.location.href.indexOf("localhost")===-1?e=s.apiUrl||"https://etalenterapi.azurewebsites.net":e="http://localhost:8888"}catch(s){console.warn("Error parsing siteConfig:",s)}else window.location.href.indexOf("localhost")===-1?e="https://etalenterapi.azurewebsites.net":e="http://localhost:8888";return e};function U(){const{eventName:e}=E(),l=R(),[s,i]=c.useState(!0),[p,g]=c.useState(null),[f,u]=c.useState(null);return c.useEffect(()=>{(async()=>{if(!e){g("Event name is required"),i(!1);return}try{i(!0),console.log("ðŸ”µ EventRegistrationWrapper - Initializing for slug:",e);const a=localStorage.getItem("user");let n=null;if(a)try{const r=JSON.parse(a);if(n=r?.token,n&&r?.user&&r.user.EventName?.replace(/ /g,"-")===e){console.log("âœ… EventRegistrationWrapper - Existing valid token found"),u(r),i(!1);return}}catch(r){console.warn("EventRegistrationWrapper - Error parsing existing user data:",r)}const d=`${j()}/api/PublicJson/ValidateEventRegistration/${e}`,m={"Content-Type":"application/json",Platform:"Web"};n&&(m.Authorization=`Bearer ${n}`);const o=await h.get(d,{headers:m});if(console.log("ðŸ”µ EventRegistrationWrapper - API Response:",o.data),o.data?.success){const r={token:o.data.token,user:o.data.userdata};localStorage.setItem("user",JSON.stringify(r)),console.log("âœ… EventRegistrationWrapper - Token stored in localStorage"),u(o.data),i(!1)}else g(o.data?.message||"Event registration validation failed"),i(!1)}catch(a){console.error("âŒ EventRegistrationWrapper - Initialization error:",a);const n=a?.response?.data?.message||a?.message||"Failed to initialize event registration. Please try again.";g(n),i(!1)}})()},[e]),s?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-surface",children:t.jsx(x,{info:"Initializing event registration..."})}):p?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-surface",children:t.jsx("div",{className:"max-w-md mx-auto p-6 bg-surfaceCard rounded-lg shadow-lg",children:t.jsxs("div",{className:"text-center",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),t.jsx("h3",{className:"mt-4 text-lg font-medium text-onSurface",children:"Registration Error"}),t.jsx("p",{className:"mt-2 text-sm text-onSurfaceVariant",children:p}),t.jsx("button",{onClick:()=>l("/Account/Login"),className:"mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-primaryHover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Go to Login"})]})})}):t.jsx(v,{eventData:f})}export{U as default};
