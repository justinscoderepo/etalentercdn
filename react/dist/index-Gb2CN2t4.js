import{r as l,u as h,j as e,z as r}from"./main-C0u1OoiM.js";import{u as I}from"./index.esm-D7dylj8Z.js";import{L as E}from"./layoutOuter-D0r5PUsY.js";import{P as R}from"./pageHeader-CRTP0JLy.js";import{F as b}from"./UserGroupIcon-DI3Zn5iK.js";import{F as M}from"./PlusIcon-CJj1gwCW.js";import{F as k}from"./PencilIcon-iBmJtDiS.js";import{F as J}from"./TrashIcon-CIvwwO-l.js";const G=()=>{const[a,u]=l.useState(null),[c,y]=l.useState(null),[s,n]=l.useState([]),[A,C]=l.useState(!0),{register:g,handleSubmit:v,reset:p,formState:{errors:d}}=I(),{rows:m}=h("/EventJson/Get",{select:"EVId,JsonSettings,EventSecret",noGet:!1});l.useEffect(()=>{if(m&&m.length>0){const t=m[0];if(y(t),t.JsonSettings)try{const o=JSON.parse(t.JsonSettings)?.AdditionalSettings?.CustomMaxParticipationPerCandidate||[];n(o)}catch(i){console.error("Error parsing JsonSettings:",i),n([])}C(!1)}},[m]);const{rows:f}=h("/CompetitionCategoryJson/Get",{select:"CompetitionCategoryId,CompetitionCategoryName",noGet:!1}),j=t=>{if(a!==null){const i=s.map((o,x)=>x===a?{CompetitionCategoryId:t.CompetitionCategoryId,MaxParticipation:parseInt(t.MaxParticipation)}:o);n(i),r.success("Rule updated successfully"),u(null)}else{const i={CompetitionCategoryId:t.CompetitionCategoryId,MaxParticipation:parseInt(t.MaxParticipation)};n([...s,i]),r.success("Rule added successfully")}p()},S=t=>{const i=s[t];u(t),p({CompetitionCategoryId:i.CompetitionCategoryId,MaxParticipation:i.MaxParticipation})},N=t=>{const i=s.filter((o,x)=>x!==t);n(i),r.success("Rule deleted successfully")},w=async()=>{if(!c){r.error("Event details not loaded");return}try{let t={};c.JsonSettings&&(t=JSON.parse(c.JsonSettings)),t.AdditionalSettings||(t.AdditionalSettings={}),t.AdditionalSettings.CustomMaxParticipationPerCandidate=s,(await fetch("/EventJson/Save",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({Select:"EVId,JsonSettings",EVId:c.EVId,JsonSettings:JSON.stringify(t)})})).ok?r.success("All participation rules saved successfully"):r.error("Failed to save participation rules")}catch(t){console.error("Error saving participation rules:",t),r.error("Error saving participation rules")}},P=t=>f?.find(o=>o.CompetitionCategoryId===t)?.CompetitionCategoryName||t;return e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx(R,{heading:"Maximum Participation Per Candidate",subHeading:"Configure custom maximum participation limits by competition category",icon:b,rightChildren:s.length>0&&e.jsx("button",{onClick:w,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:"Save All Changes"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-contentBgOuter rounded-lg shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-onSurface mb-4",children:a!==null?"Edit Participation Rule":"Add New Participation Rule"}),e.jsxs("form",{onSubmit:v(j),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-1",children:"Competition Category *"}),e.jsxs("select",{...g("CompetitionCategoryId",{required:"Competition category is required"}),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border",children:[e.jsx("option",{value:"",children:"Select Competition Category"}),f?.map(t=>e.jsx("option",{value:t.CompetitionCategoryId,children:t.CompetitionCategoryName},t.CompetitionCategoryId))]}),d.CompetitionCategoryId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.CompetitionCategoryId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-1",children:"Maximum Participation *"}),e.jsx("input",{type:"number",min:"1",...g("MaxParticipation",{required:"Maximum participation is required",min:{value:1,message:"Must be at least 1"}}),className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border",placeholder:"Enter maximum participation count"}),d.MaxParticipation&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.MaxParticipation.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[a!==null&&e.jsx("button",{type:"button",onClick:()=>{u(null),p()},className:"inline-flex items-center gap-x-2 rounded-md bg-surfaceVariant px-6 py-2.5 text-sm font-semibold text-onSurfaceVariant shadow-sm hover:bg-surfaceCard focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",children:[e.jsx(M,{className:"-mr-0.5 h-5 w-5"}),a!==null?"Update Rule":"Add Rule"]})]})]})]}),s.length>0?e.jsx("div",{className:"bg-contentBgOuter rounded-lg shadow-sm border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-surfaceCard",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Competition Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Maximum Participation"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-onSurface uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-contentBgOuter divide-y divide-border",children:s.map((t,i)=>e.jsxs("tr",{className:"hover:bg-surface",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:P(t.CompetitionCategoryId)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-onSurface",children:t.MaxParticipation}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:[e.jsx("button",{onClick:()=>S(i),className:"text-primary hover:text-primaryHover mr-3",title:"Edit",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>N(i),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(J,{className:"h-5 w-5"})})]})]},i))})]})})}):e.jsxs("div",{className:"bg-contentBgOuter rounded-lg shadow-sm border border-border p-12 text-center",children:[e.jsx(b,{className:"mx-auto h-12 w-12 text-onSurfaceVariant mb-3"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-1",children:"No participation rules configured"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Add your first participation rule using the form above"})]})]})]})})};export{G as default};
