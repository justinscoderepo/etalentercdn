import{j as e,r as c}from"./mainweb-CqMFqOvn.js";import{a as P}from"./axios-CCb-kr4I.js";import{F as oe,a as le,C as ce}from"./ClipLoader-BE2oRKvE.js";const Q=({token:a,selectedParticipant:m,selectedCompetition:l,setSelectedParticipant:g,setCompetitionParticipants:d,setParticipantMark:u,fetchCompetitionParticipantsScoreCard:C})=>{const v=async()=>{try{const S=await P.delete("https://etalenterapi3.azurewebsites.net/JudgesScoreCardJson/Remove",{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${a}`},params:{ScorecardId:m.ParticipantIdScorecardId}});S.data?(console.log("Score deleted successfully:",S.data),g(null),d([]),u(""),await C(l)):(console.error("Error deleting score:",S.data.message||"Unknown error"),alert("Error deleting score: "+(S.data.message||"Unknown error")))}catch(S){console.error("Error deleting score:",S),alert("An error occurred while deleting the score.")}};return e.jsx("button",{className:"btn-delete",onClick:v,title:"Delete Score",children:e.jsx(oe,{size:16})})},de=({selectedCompetition:a,selectedAllotmentId:m,token:l,userRoleId:g,fetchJudgesAllotmentData:d,fetchCompetitionParticipantsScoreCard:u})=>{const C=async()=>{try{const v=new FormData;v.append("Competition",a),v.append("AllotementId",m);const S=await P.post("https://etalenterapi3.azurewebsites.net/JudgesAllotmentJson/SaveJudgeStatus",v,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${l}`}});S.data?(console.log("Score saved successfully:",S.data),d(g),u(a)):(console.error("Error saving score:",S.data.message||"Unknown error"),alert("Error saving score: "+(S.data.message||"Unknown error")))}catch(v){console.error("Error:",v),alert("An error occurred")}};return e.jsxs("div",{className:"completion-section",children:[e.jsx("p",{children:'If you finished all score updates for this selected competition, press "Mark as Completed". After marking as finished, it will move to the finished section.'}),e.jsx("button",{className:"btn-completed",onClick:C,children:"Mark as Completed"})]})},ie=({index:a,details:m,CriteriaMarks:l,competitionMaxScore:g,competitionDetails:d,handleMarkChange:u})=>{var S;const C=x=>{var f;return x/(g/((f=d==null?void 0:d.Results)==null?void 0:f.length))*100},v=x=>{var b;const f=g/((b=d==null?void 0:d.Results)==null?void 0:b.length);return x<=f/4?"red":x<=f/3?"#FF8C00":x<=f/3?"#FFB900":x<=f/1.5?"blue":"#03fc77"};return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs("div",{className:"relative range-slider",children:[e.jsx("div",{style:{width:`${C(l[a]||m.Score||0)}%`,backgroundColor:v(l[a]||m.Score||0)},className:"absolute h-full"}),e.jsx("div",{className:"absolute top-1 left-0 w-full flex justify-center items-center space-x-1",children:[...Array(10)].map((x,f)=>e.jsx("span",{className:"text-gray-400 text-xs",children:"★"},f))}),e.jsx("input",{type:"range",id:`range-slider-${m.Score}`,min:"0",max:"10",step:"0.1",value:l[a]===0?0:l[a]/(g/((S=d==null?void 0:d.Results)==null?void 0:S.length))*10,onChange:x=>{var z;const b=Number(x.target.value)/10*(g/((z=d==null?void 0:d.Results)==null?void 0:z.length));u(a,b)},className:"range-slider-input no-thumb"})]})}),e.jsx("input",{type:"number",id:`mark-${m.Score}`,className:"input-mark",placeholder:m.Score??0,value:l[a]||"",onChange:x=>u(a,Number(x.target.value)),step:"0.1",style:{marginBottom:"16px"}})]})},ue=({participantMark:a,setParticipantMark:m,selectedParticipant:l})=>{const g=u=>u/10*100,d=u=>u<=3?"red":u<=4?"#FF8C00":u<=5.5?"#FFB900":u<=7?"blue":"#03fc77";return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{className:"relative range-slider",children:[e.jsx("div",{style:{width:`${g(a===0?l.ParticipantIdScore:a)}%`,backgroundColor:d(a===0?l.ParticipantIdScore:a)},className:"absolute h-full"}),e.jsx("div",{className:"absolute top-1 left-0 w-full flex justify-center items-center space-x-1",children:[...Array(10)].map((u,C)=>e.jsx("span",{className:"text-gray-400 text-xs",children:"★"},C))}),e.jsx("input",{type:"range",id:`range-slider-${l.ParticipantId}`,min:"0",max:"10",step:"0.1",value:a===0?l.ParticipantIdScore:a,onChange:u=>m(Number(u.target.value)),className:"range-slider-input no-thumb"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",marginTop:"8px"},children:[e.jsx("span",{children:"0"})," ",e.jsx("span",{children:"10"})," "]})]}),e.jsx("input",{type:"number",id:`mark-${l.ParticipantId}`,className:"input-mark",placeholder:l.ParticipantIdScore>0?l.ParticipantIdScore:"Enter mark",value:a,onChange:u=>{const C=u.target.value;m(C===""?null:Number(C))},step:"0.1",style:{marginBottom:"16px"}})]})},pe=({message:a,onClose:m,duration:l=3e3})=>(c.useEffect(()=>{if(a){const g=setTimeout(()=>{m()},l);return()=>clearTimeout(g)}},[a,m,l]),e.jsx("div",{className:`snackbar ${a?"show":""}`,children:a})),X=({participantMark:a,competitionMaxScore:m,CriteriaMarks:l=[],selectedParticipant:g,competitionDetails:d,totalMark:u,userRoleId:C,token:v,fetchCompetitionParticipantsScoreCard:S,selectedCompetition:x,setSelectedParticipant:f,SetCompetitionParticipants:b,setParticipantMark:z,scoreLabel:F})=>{var U;const[E,B]=c.useState(""),W=async()=>{if((!a||isNaN(a)||a<0)&&(!l||l.length===0||l.some(p=>isNaN(p)||p<0))){alert("Please enter a valid score.");return}if(a>m){alert(`The score cannot exceed the maximum allowed score of ${m}.`);return}try{const p=new FormData;l.length>0&&!a?l.forEach((G,n)=>{var R;if(n===l.length-1)p.append(`Scores[${n}][ScoreCardParticipant]`,g.ParticipantId),p.append(`Scores[${n}][IsActAsJudge]`,"true"),p.append(`Scores[${n}][ScoreCardScore]`,u),p.append(`Scores[${n}][ScoreCardScorecardId]`,g.ParticipantIdScorecardId||0);else{const o=((R=d==null?void 0:d.Results)==null?void 0:R[n])||{},L=o.DetailId||o.Criteria||`Criteria ${n+1}`;p.append(`Scores[${n}][ScoreCard]`,o.ScoreCard||""),p.append(`Scores[${n}][IsActAsJudge]`,"true"),p.append(`Scores[${n}][Criteria]`,L),p.append(`Scores[${n}][Score]`,G),p.append(`Scores[${n}][Status]`,o.Status||1),p.append(`Scores[${n}][DetailedScoreCardCriteriaId]`,o.DetailedScoreCardCriteriaId||"")}}):(p.append("Scores[0][ScoreCardParticipant]",g.ParticipantId),p.append("Scores[0][IsActAsJudge]",!!d.Status),p.append("Scores[0][ScoreCardScore]",a),p.append("Scores[0][ScoreCardScorecardId]",g.ParticipantIdScorecardId)),p.append("JudgeId",C);const $=await P.post("https://etalenterapi3.azurewebsites.net/JudgeJson/SaveScore",p,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${v}`}});$.data?(console.log("Score saved successfully:",$.data),B("Score saved successfully!"),f(null),b([]),z(""),await S(x)):(console.error("Error saving score:",$.data.message||"Unknown error"),alert("Error saving score: "+($.data.message||"Unknown error")),B("Score not saved!"))}catch(p){console.error("Error posting score:",p),alert("An error occurred while saving the score.")}};return e.jsxs("div",{children:[e.jsx("button",{className:"btn-save",onClick:W,title:"Save",disabled:isNaN(a)||a<0||a>(F==="Rating out of 10"?m/((U=d==null?void 0:d.Results)==null?void 0:U.length):m),children:e.jsx(le,{size:16})}),console.log("Snackbar message:",E),E&&e.jsx(pe,{message:E,onClose:()=>B("")})]})},w=localStorage.getItem("accessToken");function Se({user:a}){var K;const[m,l]=c.useState([]),[g,d]=c.useState(""),[u,C]=c.useState(null),[v,S]=c.useState([]),[x,f]=c.useState([]),[b,z]=c.useState(null),[F,E]=c.useState([]),[B,W]=c.useState(null),[U,p]=c.useState(!1),[$,G]=c.useState(!1);c.useState(!1);const[n,R]=c.useState(null),[o,L]=c.useState(null),[J,k]=c.useState((n==null?void 0:n.ParticipantIdScore)||"");c.useState({top:0,left:0}),c.useState(!1);const[y,Y]=c.useState(0),[Z,M]=c.useState(null),[N,D]=c.useState("");c.useState(0);const[I,q]=c.useState([]),[V,O]=c.useState(0);c.useEffect(()=>{if(o!=null&&o.Results){const r=o.Results.map(i=>i.Score||0);let t=0;if(N==="Rating out of 10"){const i=r.filter(h=>h>0);t=i.length>0?i.reduce((h,j)=>h+j,0)/i.length:0}else N==="Marks"&&(t=r.reduce((i,h)=>i+(h>0?h:0),0));const s=[...r,Number(t.toFixed(2))];q(s),O(Number(t.toFixed(2)))}},[o,N]);const _=(r,t)=>{const s=[...I],i=s.length-1;if(r<i){s[r]=t;let h=0;if(N==="Rating out of 10"){const j=s.slice(0,-1).filter(A=>A>0);h=j.length>0?j.reduce((A,ne)=>A+ne,0)/j.length:0}else N==="Marks"&&(h=s.slice(0,-1).reduce((j,A)=>j+(A>0?A:0),0));s[i]=Number(h.toFixed(2))}else if(r===i){const h=t/(s.length-1);for(let j=0;j<i;j++)s[j]=Number(h.toFixed(2));s[i]=Number(t.toFixed(2))}q(s),O(s[i])};c.useEffect(()=>{(async()=>{p(!0);try{const t=new FormData;t.append("CreatedBy","12007"),t.append("Role",a.Role),t.append("isCaching","true");const s=await P.post("https://etalenterapi3.azurewebsites.net/UsersRolesJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${w}`}});if(s.data&&s.data.Results){l(s.data.Results);const i=filteredJudges.map(h=>h.UserName||"Unknown");W(i)}}catch(t){console.error("Error fetching selected judges:",t)}finally{p(!1)}})()},[]);const ee=r=>{const t=Number(r.target.value);d(t),m.find(i=>i.UserRoleId===t)&&(p(!0),C(t),H(t).finally(()=>p(!1)))};c.useEffect(()=>{},[u,g]);const H=async r=>{G(!0);try{const t=new FormData;t.append("Status","1"),t.append("PageSize","500"),t.append("Judge",r),t.append("SortOrder","asc");const s=await P.post("https://etalenterapi3.azurewebsites.net/JudgesAllotmentWithScoreLabelJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${w}`}});if(s.data&&s.data.Results){const i=s.data.Results;S(i)}}catch(t){console.error("Error fetching judges allotment data:",t)}finally{G(!1)}},te=r=>{const t=Number(r.target.value);z(t);const s=v.filter(h=>h.Competition===t);if(E(s),s.length>0){const h=s[0].AllotementId;M(h)}const i=s[0].ScoreLabelLabel;D(i),T(t)};c.useEffect(()=>{F&&F.length>0},[F]);const T=async r=>{try{const t=new FormData;t.append("PageSize","100"),t.append("IsActAsJudge","true"),t.append("Judge",u),t.append("Competition",r),t.append("SortColumn","ParticipantId"),t.append("SortOrder","asc"),t.append("PageNumber","1");const s=await P.post("https://etalenterapi3.azurewebsites.net/CompetitionParticipantsScoreCardJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${w}`}});if(s.data&&s.data.Results){const i=s.data.Results;f(i);const h=i[0];Y(h.CompetitionMaximumScore)}}catch(t){console.error("Error fetching CompetitionParticipants Scorecard data:",t)}},re=r=>{O(0),R(r),r.ParticipantIdScore>0?ae(r):se(r)},se=async r=>{try{const t=new FormData;t.append("LanguageGlobal",r.CompetitionLanguage),t.append("GroupGlobal",r.CompetitionGroup),t.append("GenderGlobal",r.CompetitionGender),t.append("ParticipantTypeGlobal",r.CompetitionParticipantType),t.append("CompetitionItemGlobal",r.CompetitionCompetitionItem),t.append("isCaching","true");const s=await P.post("https://etalenterapi3.azurewebsites.net/CompetitionDetailsJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${w}`}});s.data&&L(s.data)}catch(t){console.error("Error fetching competition details:",t)}};c.useEffect(()=>{},[o]);const ae=async r=>{try{const t=new FormData;t.append("IsActAsJudge","true"),t.append("Judge",u),t.append("ScoreCard",r.ParticipantIdScorecardId);const s=await P.post("https://etalenterapi3.azurewebsites.net/JudgesDetailedScoreCardJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${w}`}});s.data&&L(s.data)}catch(t){console.error("Error fetching detailed score card:",t)}};return e.jsxs("div",{className:"body",children:[e.jsx("h2",{className:"scorecard-title",style:{textTransform:"uppercase"},children:"JUdges ScoreCard"}),e.jsxs("div",{className:"competition-selection form-group",children:[e.jsx("label",{className:"form-label",children:"Select Judge"}),e.jsxs("select",{className:"form-control",value:g,onChange:ee,disabled:U,children:[e.jsx("option",{value:"",children:"--Select Judge--"}),m.map(r=>e.jsx("option",{value:r.UserRoleId,children:r.UserName||"Unknown"},r.UserRoleId))]}),e.jsx("label",{className:"form-label",children:"Select Competition"}),$?e.jsx("div",{className:"spinner-container",children:e.jsx(ce,{color:"#36d7b7",loading:$,size:50})}):e.jsxs("select",{className:"form-control",value:b,onChange:te,children:[e.jsx("option",{value:"",children:"--Select Competition--"}),v.map(r=>e.jsxs("option",{value:r.Competition,children:[r.CompetitionGroupGroupName," - ",r.ScoreStatusScoreResultStatus," "," | ",r.CompetitionItemTitle||"Unknown"," "," (",r.CompetitionParticipantTypeTitle,")"]},r.AllotementId))]})]}),e.jsxs("div",{className:"participants-container",children:[e.jsx("div",{className:"participants-list",children:x.length>0?x.map(r=>e.jsx("div",{className:`participant-container ${(n==null?void 0:n.ParticipantId)===r.ParticipantId?"selected":""}`,onClick:()=>re(r),children:e.jsxs("div",{className:"participant-summary",children:[e.jsx("div",{className:"participant-id",children:r.CandidateIdentityNumber||0}),e.jsx("div",{className:"participant-score",children:r.ParticipantIdScore||0})]})},r.ParticipantId)):e.jsx("p",{className:"no-participants-message",children:"No participants found."})}),e.jsx("div",{className:`expanded-content-container ${n?"visible":""}`,children:n&&e.jsx("div",{className:"input-mark",children:e.jsx("div",{className:"mark-section",children:((K=o==null?void 0:o.Results)==null?void 0:K.length)>1?e.jsxs(e.Fragment,{children:[o.Results.map((r,t)=>{var s,i,h,j;return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[r.CriteriaCriteriaName||r.CriteriaName,((s=o==null?void 0:o.Results)==null?void 0:s.length)>0?e.jsxs("span",{children:["(",r.SecondValue||y/((i=o==null?void 0:o.Results)==null?void 0:i.length),")"]}):e.jsxs("span",{children:["(",r.SecondValue||y,")"]})]}),N==="Rating out of 10"?e.jsx(ie,{index:t,details:r,CriteriaMarks:I,competitionMaxScore:y,competitionDetails:o,handleMarkChange:_},t):e.jsx("input",{type:"number",id:`mark-${r.Score}`,className:"input-mark",placeholder:r.Score??0,value:I[t]||"",onChange:A=>_(t,Number(A.target.value)),style:{marginBottom:"16px"}}),I[t]&&(isNaN(I[t])||I[t]<0)&&e.jsx("div",{style:{color:"red",fontSize:"12px"},children:"Please enter a valid score (must be a positive number)."}),(I[t]>(N==="Rating out of 10"?y/((h=o==null?void 0:o.Results)==null?void 0:h.length):y)||(r.SecondValue?I[t]>r.SecondValue:I[t]>y))&&e.jsxs("div",{style:{color:"red",fontSize:"12px"},children:["The score cannot exceed the maximum score of ",r.SecondValue||y/((j=o==null?void 0:o.Results)==null?void 0:j.length),"."]})]},t)}),e.jsxs("div",{style:{marginBottom:"8px"},children:["Total",e.jsxs("span",{children:["(",F.CompetitionMaximumScore??y,")"]})]}),e.jsx("input",{type:"number",id:`mark-${V}`,className:"input-mark",placeholder:"Total",value:V||"",onChange:r=>_(I.length-1,Number(r.target.value)),style:{marginBottom:"16px"}}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(X,{participantMark:J,competitionMaxScore:y,CriteriaMarks:I,selectedParticipant:n,competitionDetails:o,totalMark:V,userRoleId:u,token:w,fetchCompetitionParticipantsScoreCard:T,selectedCompetition:b,setSelectedParticipant:R,SetCompetitionParticipants:f,setParticipantMark:k,scoreLabel:N}),n.ParticipantIdScore>0&&e.jsx(Q,{token:w,selectedParticipant:n,selectedCompetition:b,setSelectedParticipant:R,setCompetitionParticipants:f,setParticipantMark:k,fetchCompetitionParticipantsScoreCard:T})]})]}):e.jsxs("div",{children:[N==="Rating out of 10"?e.jsx(ue,{participantMark:J,setParticipantMark:k,selectedParticipant:n}):e.jsxs("div",{children:["Total ",e.jsx("span",{children:n.CompetitionMaximumScore}),e.jsx("input",{type:"number",id:`mark-${n.ParticipantId}`,className:"input-mark",placeholder:n.ParticipantIdScore>0?n.ParticipantIdScore:"Enter mark",value:J,onChange:r=>{const t=r.target.value;k(t===""?null:Number(t))},style:{marginBottom:"16px"}})]}),J&&(isNaN(J)||J<0)&&e.jsx("div",{style:{color:"red",fontSize:"12px"},children:"Please enter a valid score (must be a positive number)."}),J>(N==="Rating out of 10"?10:y)&&e.jsxs("div",{style:{color:"red",fontSize:"12px"},children:["The score cannot exceed the maximum score of ",N==="Rating out of 10"?10:y,"."]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(X,{participantMark:J,competitionMaxScore:y,CriteriaMarks:I,selectedParticipant:n,competitionDetails:o,totalMark:V,userRoleId:u,token:w,fetchCompetitionParticipantsScoreCard:T,selectedCompetition:b,setSelectedParticipant:R,SetCompetitionParticipants:f,setParticipantMark:k,scoreLabel:N}),n.ParticipantIdScore>0&&e.jsx(Q,{token:w,selectedParticipant:n,selectedCompetition:b,setSelectedParticipant:R,setCompetitionParticipants:f,setParticipantMark:k,fetchCompetitionParticipantsScoreCard:T})]})]})})})})]}),e.jsx("div",{className:"completion-section",children:e.jsx(de,{selectedCompetition:b,selectedAllotmentId:Z,token:w,userRoleId:u,fetchJudgesAllotmentData:H,fetchCompetitionParticipantsScoreCard:T})})]})}export{Se as default};
