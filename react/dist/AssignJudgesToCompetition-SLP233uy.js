import{r,j as e}from"./mainweb-BeiKRFEr.js";import{a as z}from"./index-BtuGy7By.js";import{A as xe}from"./authContext-BD8HGNMr.js";import{F as fe}from"./XMarkIcon-D2bjrMzO.js";function Se({JudgesAllotment:R,competitionStructure:U,selectedItems:N,handleCheckboxChange:d,handleCardDataChange:T,saveChanges:B,eventStages:u,userRoles:x,cancelEdit:O,JudgeAllotmentRemove:D,JudgeAllotmentSave:L,setEditCompetitionData:S}){const[E,J]=r.useState(null),[k,F]=r.useState(null),[n,i]=r.useState({}),m=(a,y)=>{i(j=>{const I=j[y]||"Allowed to Fill",$=I==="Allowed to Fill"?{status:"Filled",value:1}:I==="Filled"?{status:"Published",value:2}:{status:"Allowed to Fill",value:3};return L({competition:(a==null?void 0:a.competition)||"",scoreStatus:$.value,stage:(a==null?void 0:a.stage)||"",judge:(a==null?void 0:a.UserRoleId)||"",remarks:(a==null?void 0:a.remarks)||"",order:(a==null?void 0:a.order)||"",AllotementId:y}),{...j,[y]:$.status}})},P=(a,y)=>{J(a),F(y)},f=x==null?void 0:x.find(a=>(a==null?void 0:a.UserRoleId)===E),p=(R==null?void 0:R.filter(a=>(a==null?void 0:a.JudgeUserName)===k))||[];return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1/3 bg-white shadow-sm rounded-md",children:x.length===0?e.jsx("div",{className:"w-full text-left py-2 bg-gray-100 rounded-md",children:e.jsx("p",{className:"text-sm",children:"No data available."})}):x.map(a=>e.jsx("div",{className:`cursor-pointer py-2 border-b hover:bg-gray-50 ${E===a.UserRoleId?"bg-gray-100":""}`,onClick:()=>P(a==null?void 0:a.UserRoleId,a==null?void 0:a.UserName),children:e.jsx("h3",{className:"text-xs font-small text-left",children:(a==null?void 0:a.UserName)||"No Name"})},(a==null?void 0:a.UserRoleId)||"unknown"))}),e.jsx("div",{className:"w-full sm:w-2/3 bg-white shadow-sm rounded-md py-2 space-y-2",children:p.length>0?p.map(a=>{const y=a==null?void 0:a.AllotementId,j=n[y]||(a==null?void 0:a.ScoreStatusScoreResultStatus)||"Allowed to Fill";let I="bg-yellow-500";return j==="Filled"?I="bg-blue-500":j==="Published"&&(I="bg-green-500"),e.jsxs("div",{className:"py-2 px-3 bg-grey-50 border rounded-md",children:[e.jsxs("div",{className:"py-1 bg-blue-50 border border-blue-300 rounded-md w-full",children:[e.jsxs("p",{className:"text-xs text-center font-semibold",children:[(a==null?void 0:a.CompetitionGroupGroupName)||"No Group"," - ",(a==null?void 0:a.CompetitionCompetitionItemTitle)||"No Title"]}),e.jsx("p",{className:"text-xs text-gray-800  text-center font-semibold",children:j})]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:`${I} text-white text-xs rounded-md w-full py-1 hover:bg-blue-600 transition duration-150`,onClick:()=>m(a,y),children:j==="Allowed to Fill"?"Fill":j==="Filled"?"Publish":"Allowed to Fill"})}),f&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"bg-red-500 text-white text-xs rounded-md w-full py-1 hover:bg-red-600 transition duration-150",onClick:()=>D(a==null?void 0:a.AllotementId),children:"Delete Judge"})})]},(a==null?void 0:a.CompetitionId)||`comp-${Math.random()}`)}):e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"No related competitions found."})})]})}function be({isModalOpen:R,setIsModalOpen:U,handleSubmit:N,formData:d,handleEditCompetition:T,handleDeleteCompetition:B,handleInputChange:u,modalTitle:x,buttonText:O,modalType:D,competitionStructure:L,eventStages:S,userRoles:E}){if(!R)return null;const k=D==="filter"?["Competition order number","competition","scoreStatus","stage","judge"]:Object.keys(d),F=n=>{const i=Array.from(n.target.selectedOptions,m=>m.value);u({target:{name:"competition",value:i}})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-container",children:[e.jsx("span",{className:"close-btn",onClick:()=>U(!1),children:"×"}),e.jsx("h3",{className:"modal-title",children:x}),e.jsxs("form",{className:"modal-form",onSubmit:n=>{n.preventDefault(),N()},children:[k.map(n=>{if(n==="competition"){const i=L.reduce((m,P)=>{const f=P.GroupGroupName||"Others";return m[f]||(m[f]=[]),m[f].push(P),m},{});return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:n,className:"form-label",children:"Competition:"}),e.jsx("div",{className:"styled-select-wrapper",children:e.jsxs("select",{id:n,name:n,value:d[n],onChange:F,className:"styled-select",required:!0,multiple:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),Object.keys(i).sort().map((m,P)=>e.jsx("optgroup",{label:m,children:i[m].sort((f,p)=>f.CompetitionItemTitle.localeCompare(p.CompetitionItemTitle)).map(f=>e.jsx("option",{value:f.CompetitionStructureId,children:f.CompetitionItemTitle},f.CompetitionStructureId))},P))]})}),e.jsxs("p",{className:"selection-count",children:[d[n].length," ",d[n].length===1?"Competition Selected":"Competitions Selected"]})]},n)}return n==="scoreStatus"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:n,children:"Score Status:"}),e.jsxs("select",{id:n,name:n,value:d[n],onChange:u,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),e.jsx("option",{value:"3",children:"Allowed to Fill"}),e.jsx("option",{value:"2",children:"Filled"}),e.jsx("option",{value:"1",children:"Published"})]})]},n):n==="stage"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:n,children:"Stage:"}),e.jsxs("select",{id:n,name:n,value:d[n],onChange:u,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),S.map((i,m)=>e.jsx("option",{value:i.Title,children:i.Title},m))]})]},n):n==="judge"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:n,children:"Judge:"}),e.jsxs("select",{id:n,name:n,value:d[n],onChange:u,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),E.map((i,m)=>e.jsx("option",{value:i.UserRoleId,children:i.UserName},m))]})]},n):e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:n,children:[n.charAt(0).toUpperCase()+n.slice(1),":"]}),e.jsx("input",{type:n==="order"?"number":"text",id:n,name:n,value:d[n],onChange:u,className:"form-input",required:n!=="order"})]},n)}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"submit",className:"submit-btn",children:O}),e.jsx("button",{type:"button",onClick:()=>U(!1),className:"cancel-btn",children:"Cancel"})]})]})]})})}const Ce=({competitionStructure:R,handleSubmit:U,handleFilterInputChange:N,currentFilters:d,setIsDropdownOpen:T,onCategorySelect:B})=>{const[u,x]=r.useState(!1),[O,D]=r.useState(""),[L,S]=r.useState(""),[E,J]=r.useState(""),[k,F]=r.useState(""),n=r.useRef(null),[i,m]=r.useState([]),[P,f]=r.useState(null),p=[{value:"all",label:"All"},{value:"category",label:"Category"},{value:"competition",label:"Competition"},{value:"stage",label:"Stage"}],a=()=>{m([])},y=l=>{const g=l.target.value;m(c=>c.includes(g)?c.filter(b=>b!==g):[...c,g])},j=R.reduce((l,g)=>{const c=g.GroupGroupName||"Others";return l[c]||(l[c]=[]),l[c].push(g),l},{}),I=l=>{const{name:g,value:c}=l.target;N(g,c)},$=l=>{const g=l.target.value;N("category",g),B(g)},q=()=>{x(!u),T(!u)};return r.useEffect(()=>{const l=g=>{n.current&&!n.current.contains(g.target)&&(x(!1),T(!0))};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),e.jsxs("div",{className:"relative inline-block w-48",ref:n,children:[e.jsx("button",{type:"button",onClick:q,className:"w-full px-2 py-1 bg-white border border-gray-300 text-gray-700 text-sm rounded-md shadow-sm hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:i.length>0?`Selected (${i.length})`:"Select filters..."}),i.length>0&&e.jsx("button",{onClick:a,className:"absolute top-0 right-0 p-1 text-gray-500 hover:text-gray-700",children:e.jsx(fe,{className:"h-4 w-4"})}),u&&e.jsx("div",{className:"absolute left-0 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:p.map(l=>e.jsxs("label",{className:"block px-2 py-1 text-gray-700 hover:bg-gray-100 cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",value:l.value,checked:i.includes(l.value),onChange:y,className:"mr-2"}),l.label]},l.value))}),i.includes("category")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-xs font-medium text-gray-700",children:"Select Category:"}),e.jsxs("select",{id:"category",name:"category",value:d.category||"",onChange:$,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a category"}),Object.keys(j).sort().map(l=>e.jsx("option",{value:l,children:l},l))]})]}),i.includes("competition")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"competition",className:"block text-xs font-medium text-gray-700",children:"Select Competition:"}),e.jsxs("select",{id:"competition",name:"competition",value:d.competition||"",onChange:I,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a competition"}),Object.keys(j).sort().map((l,g)=>e.jsx("optgroup",{label:l,children:j[l].sort((c,b)=>c.CompetitionItemTitle.localeCompare(b.CompetitionItemTitle)).map(c=>e.jsx("option",{value:c.CompetitionStructureId,children:c.CompetitionItemTitle},c.CompetitionStructureId))},g))]})]}),i.includes("stage")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"stage",className:"block text-xs font-medium text-gray-700",children:"Stage"}),e.jsx("input",{type:"text",id:"stage",name:"stages",value:d.stages||"",onChange:I,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),i.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:U,className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-xs",children:"Apply Filters"})})]})};function Re({user:R}){const U=()=>r.useContext(xe),{accessToken:N}=U(),[d,T]=r.useState([]),[B,u]=r.useState(!0),[x,O]=r.useState([]),[D,L]=r.useState(!1),[S,E]=r.useState(d),[J,k]=r.useState([]),[F,n]=r.useState([]),[i,m]=r.useState([]),[P,f]=r.useState(!1),[p,a]=r.useState(1),[y,j]=r.useState([]),[I,$]=r.useState(null),[q,l]=r.useState(null),[g,c]=r.useState(!1),[b,te]=r.useState(""),[G,Y]=r.useState({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""}),[V,Z]=r.useState({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""}),[A,W]=r.useState({order:"",competition:"",scoreStatus:"",stages:"",judgeUserName:""}),se=()=>{const{order:t,competition:s,scoreStatus:o,stages:h,judgeUserName:v}=A;M(p,t,s,o,h)};r.useEffect(()=>{},[A,S]);const ae=()=>{if(b==="edit"){const t=d.map(s=>s.AllotementId===V.AllotementId?V:s);K(),T(t)}else if(b==="new")T([...d,G]),K(),Y({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""});else if(b==="filter"){const{order:t,competition:s,scoreStatus:o,judgeUserName:h}=G;W({order:t,competition:s,scoreStatus:o,judgeUserName:h}),M(p,t,s,o,h)}c(!1)},[je,Ne]=r.useState("all"),ne=t=>{const{name:s,value:o}=t.target;(b==="edit"?Z:Y)(v=>({...v,[s]:o}))},re=(t,s)=>{W(o=>({...o,[t]:s}))};r.useEffect(()=>{D&&Q()},[D]);const M=async(t=1,s="",o="",h="",v="")=>{u(!0);try{const C=["AllotementId","Competition","CompetitionCompetitionItemTitle","CompetitionGender","CompetitionGenderGenderTitle","CompetitionGroupGroupName","CompetitionLanguage","CompetitionLanguageLanguageName","CompetitionOrder","CompetitionParticipantTypeTitle","Judge","JudgeUserName","Order","Phase","PhaseTitle","Remarks","ScoreStatus","ScoreStatusScoreResultStatus","Stage","StageTitle","Status"],w=new FormData;w.append("CompetitionOrder",s??""),w.append("PageSize","10"),w.append("Competition",o??""),w.append("ScoreStatus",h??""),w.append("JudgeUserName",v??""),w.append("SortOrder","desc"),w.append("SortColumn","ModifiedDate"),w.append("select",C),w.append("PageNumber",t.toString());const X=await z.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentPlusUsersRolesJson/Get",w,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}});X.data&&X.data.Results&&T(X.data.Results)}catch(C){console.error("Error fetching JudgesAllotment:",C)}finally{u(!1)}};r.useEffect(()=>{M(p)},[p]);const H=async()=>{f(!0);try{const t=new FormData,s=["*","CreatedDateString","Description","ESGId","Event","EventCategory","EventEventName","Message","ModifiedDateString","Order","RowFrom","RowTo","Status","Title","TitleEquals","TotalRowCount","Venue"];t.append("status","1"),t.append("PageSize","1000"),t.append("SortColumn","ModifiedDate"),t.append("SortOrder","desc"),t.append("PageNumber","1"),t.append("select",s);const o=new FormData,h=["*","CreatedDateString","Event","EventCategory","EventEventName","Group","GroupGroupName","IdentityNumber","JsonSettings","Message","ModifiedDateString","Order","Organization","OrganizationAllowOrganizationId","OrganizationName","OrganizationShortName","ParticipantType","RegistrationId","Role","RowFrom","RowTo","Status","TeamId","TotalRowCount","User","UserComments","UserDobString","UserEmail","UserJsonSettings","UserName","UserNameTitle","UserPhone","UserProfilePicture","UserRoleId"];o.append("status","1"),o.append("Role",R.Role),o.append("CreatedBy","12007"),o.append("select",h);const[v,C]=await z.all([z.post("https://etalenterapi.azurewebsites.net/EventStagesJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}}),z.post("https://etalenterapi.azurewebsites.net/UsersRolesJson/Get",o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}})]);v.data&&n(v.data.Results||[]),C.data&&m(C.data.Results||[])}catch(t){console.error("Error fetching new data:",t)}finally{f(!1)}};r.useEffect(()=>{},[d,F,i]);const K=async t=>{u(!0);try{const s=new FormData;t!=null?(s.append("AllowNumberUpdate","true"),s.append("Competition",t.competition),s.append("ScoreStatus[]",t.scoreStatus),s.append("Phase","0"),s.append("Stage",t.stage),s.append("Judge",t.judge),s.append("Remarks",t.remarks),s.append("Status","1"),s.append("Order",t.order),s.append("AllotementId",t.AllotementId)):(s.append("CompetitionList[]",G.competition),s.append("undefined",""),s.append("PageSize","1000"),s.append("ScoreStatusList[]",G.scoreStatus),s.append("StageList[]",G.stage),s.append("JudgeList[]",G.judge),s.append("Remarks","desc"),s.append("Order","ModifiedDate"),s.append("AllotementId",""),s.append("IsMultiple","true"));const o=await z.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/Save",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}});o.data&&o.data.Results&&M(p)}catch(s){console.error("Error Saving JudgesAllotment:",s)}finally{u(!1)}},_=async t=>{u(!0);try{const s=await z.delete("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/Remove",{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`},params:{AllotementId:t}});s.data&&s.data.Results&&M(p)}catch(s){console.error("Error Deleting JudgesAllotment:",s)}finally{u(!1)}},Q=async()=>{u(!0);try{const t=new FormData;t.append("status","1");const s=["*","AllowPublicRegistration","AllowPublicRegistrationTitle","CompetitionItem","CompetitionItemTitle","CompetitionStatus","CompetitionStatusCompetitionStatusTitle","CompetitionStructureId","CreatedDateString","Event","EventCategory","EventEventName","Fees","Gender","GenderGenderTitle","GenerateRanks","Group","GroupGroupName","JsonSettings","Language","LanguageLanguageName","MaximumCandidates","MaximumContestantsPerUnit","MaximumMinutes","MaximumScore","MaximumSeconds","Message","MinimumMinutes","MinimumSeconds","ModifiedDateString","Order","ParticipantType","ParticipantTypeTitle","Remarks","RowFrom","RowTo","Status","TotalRowCount","Visibility","WarningMinute","WarningSecond"];t.append("select",s);const o=await z.post("https://etalenterapi.azurewebsites.net/CompetitionStructureJson/GetForAllotment",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}});o.data&&o.data.Results&&k(o.data.Results||[])}catch(t){console.error("Error Fetching Competition Structures:",t)}finally{u(!1)}};r.useEffect(()=>{},[J]);const oe=t=>{Q(),H(),te(t),c(!0)},le=()=>{c(!1)},ie=()=>{c(!1)},de=t=>{Q(),H(),O(s=>s.includes(t)?s.filter(o=>o!==t):[...s,t])},[ue,ee]=r.useState([]),ce=(t,s,o)=>{T(h=>h.map(v=>v.AllotementId===t?{...v,[s]:o}:v)),ee(h=>{if(h.find(C=>C.AllotementId===t))return h.map(C=>C.AllotementId===t?{...C,[s]:o}:C);{const C=d.find(w=>w.AllotementId===t);return[...h,{...C,[s]:o}]}})},me=t=>{ue.find(o=>o.AllotementId===t)&&ee(o=>o.filter(h=>h.AllotementId!==t))},pe=t=>{O(s=>s.filter(o=>o!==t))},ge=async()=>{u(!0);try{for(const s of x)await _(s);const t=d.filter(s=>!x.includes(s.AllotementId));T(t),O([])}catch(t){console.error("Error deleting selected items:",t)}finally{u(!1)}},[ve,we]=r.useState({order:"",competition:"",scoreStatus:"",judgeUserName:""}),he=t=>{if(W(s=>({...s,category:t})),t){const s=d.filter(o=>o.CompetitionGroupGroupName===t);E(s),l(t)}else E(d)};return r.useEffect(()=>{},[S,q]),e.jsxs("div",{className:"AssignJudgesToCompetition",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Judges Allotment"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4 mx-auto",children:[e.jsx(Ce,{handleSubmit:se,handleFilterInputChange:re,competitionStructure:J,JudgesAllotment:d,eventStages:F,userRoles:i,currentFilters:A,setIsDropdownOpen:L,onCategorySelect:he}),e.jsx("button",{onClick:()=>{H(),oe("new")},className:"bg-green-500 text-white font-medium rounded-md px-12 py-1 text-sm hover:bg-green-600 transition",children:e.jsx("i",{className:"fas fa-plus mr-2"})}),x.length>0&&e.jsxs("button",{className:"bg-red-500 text-white font-medium rounded-md px-3 py-1 text-sm hover:bg-red-600 transition",onClick:ge,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete Selected"]})]}),e.jsx(be,{isModalOpen:g,setIsModalOpen:c,handleEditCompetition:le,handleDeleteCompetition:ie,handleSubmit:ae,formData:b==="edit"?V:G,handleInputChange:ne,modalTitle:b==="new"?"Create Competition":b==="edit"?"Edit":"Filter Competition",buttonText:b==="new"?"Create":b==="edit"?"Save changes":"Apply Filters",modalType:b,competitionStructure:J,eventStages:F,userRoles:i}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(Se,{JudgesAllotment:(S==null?void 0:S.length)>0||(S==null?void 0:S.length)===0&&q!==null?S:d,competitionStructure:J,selectedItems:x,handleCheckboxChange:de,handleCardDataChange:ce,saveChanges:me,cancelEdit:pe,JudgeAllotmentRemove:_,JudgeAllotmentSave:K,eventStages:F,userRoles:i,setEditCompetitionData:Z})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4",children:[e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition",disabled:p===1,onClick:()=>{const t=p-1;a(t),M(t,A.order,A.competition,A.scoreStatus,A.judgeUserName)},children:"←"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:["Page ",p]}),e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition",onClick:()=>{const t=p+1;a(t),M(t,A.order,A.competition,A.scoreStatus,A.judgeUserName)},children:"→"})]})]})}export{Re as default};
