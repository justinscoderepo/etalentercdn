import{p as ue,r as U,j as t,R as xe,b as he,_ as A}from"./mainweb-ChkdoDLB.js";import{M as fe}from"./index.modern-BayGwmH_.js";import{c as te}from"./utilities-CN4lTu6a.js";import{u as Ce}from"./index.esm-Dlri1keI.js";import{p as pe}from"./httpService-VA373_DX.js";import{B as be}from"./box-CgoAxsvR.js";import{F as ye}from"./PencilIcon-dQr2D3v7.js";import{F as Ne}from"./XMarkIcon-D-JMOduM.js";import{F as Fe}from"./CheckIcon-D722kR8I.js";import{F as Ie}from"./PlusIcon-D_0RlVKU.js";import"./index-t--hEgTQ.js";const we=xe.lazy(()=>he(()=>import("./renderComponents-Cx95ksE3.js"),[]));function Re({item:S,competitionStructureId:Z,eventDetails:b,participantsList:L,formData:v,participantId:D,candidateId:r}){const{register:y,control:z,errors:I,handleSubmit:ie,setValue:w,getValues:T}=Ce({defaultValues:{customCompetitionFields:[]}});console.log("CustomCompetitionFields",{item:S,eventDetails:b,register:y,errors:I,control:z,setValue:w,getValues:T,formData:v,participantId:D,candidateId:r});let $=L.find(i=>i.CandidateId==r&&i.Competition==Z);const j=ue(S==null?void 0:S.JsonSettings),K=(j==null?void 0:j.AdditionalTextFieldsForPubRegForm)||[],O=(j==null?void 0:j.AdditionalTextFieldsMaxLength)||1/0,J=(j==null?void 0:j.AdditionalTextFieldsMinLength)||1;console.log("participantDetails",{participantDetails:$});let g=ue($==null?void 0:$.JsonSettings),W=(g==null?void 0:g.customCompetitionFields)||[];const E=K.map(i=>{var n,c;return{key:i.FieldName.replace(/\s+/g,"_").toLowerCase(),label:i.FieldName,name:`customCompetitionFields[0].${i.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:((n=i.FieldType)==null?void 0:n.toLowerCase())||"text",isRequired:((c=i.IsRequired)==null?void 0:c.toLowerCase())==="yes",conditions:[],options:[],placeholder:"",defaultValue:""}}),[N,d]=U.useState([{id:Date.now(),values:{},fields:[...E],disabled:!1}]);U.useEffect(()=>{if(W.length>0){let i=[],n=W.map((c,x)=>{console.log("row",{row:c,index:x});let h={},M={};return E.forEach(m=>{h[`customCompetitionFields[${x}].${m.key}`]=c==null?void 0:c[m.key],M[m.key]=c==null?void 0:c[m.key]}),i.push(M),{id:Date.now()+x,values:h,fields:E.map(m=>({...m,name:`customCompetitionFields[${x}].${m.key}`})),disabled:!0}});w("customCompetitionFields",i),d(n)}},[]);const B=()=>{if(N.length>=O){A.error(`You can add a maximum of ${O} rows.`);return}d(i=>[...i,{id:Date.now(),values:{},fields:E.map(n=>({...n,name:`customCompetitionFields[${i.length}].${n.key}`})),disabled:!1}])},le=async i=>{var G;let n=T();console.log("values",{values:n});let{candidate:c,customCompetitionFields:x}=n,h=N.findIndex(R=>R.id===i);const M=x[h];if(E.filter(R=>R.isRequired&&!M.values[R.name]).length>0){A.error("Please fill all required fields before adding a new row.");return}try{let R=(G=L.find(q=>q.CandidateId==r&&q.Competition==Z))==null?void 0:G.ParticipantId;if(!R){A.error("Participant ID not found.");return}let ee=await pe("/CandidateJson/UpdateParticipantJson",{participantId:R,candidateId:v==null?void 0:v.candidate,JsonSettings:JSON.stringify(n)});console.log("API response:",ee),A.success("Data saved successfully!");let Q=N[h];Q.disabled=!0,E.forEach(q=>{Q.values[`customCompetitionFields[${h}].${q.key}`]=M[q.key]}),d([...N])}catch(R){console.error("Error updating participant JSON:",R),A.error("Failed to save data.")}},o=i=>{d(n=>n.map(c=>c.id===i?{...c,disabled:!1}:c))},V=i=>{if(N.length<=J){A.error(`You must have at least ${J} rows.`);return}d(m=>m.filter(G=>G.id!==i));let n=T(),{candidate:c,customCompetitionFields:x}=n,h=N.findIndex(m=>m.id===i);x.splice(h,1),w("customCompetitionFields",x),console.log("customCompetitionFields",{customCompetitionFields:x}),console.log("values",{values:n});let M=$==null?void 0:$.ParticipantId;if(!M){A.error("Participant ID not found.");return}pe("/CandidateJson/UpdateParticipantJson",{participantId:M,candidateId:v==null?void 0:v.candidate,JsonSettings:JSON.stringify(n)}).then(m=>{console.log("API response:",m),A.success("Data deleted successfully!")}).catch(m=>{console.error("Error updating participant JSON:",m),A.error("Failed to delete data.")})};let Y=E.map(i=>i.label).join(", "),H=Y.lastIndexOf(",");return H>-1&&(Y=Y.substring(0,H)+" and"+Y.substring(H)),console.log("fieldRows",{fieldRows:N}),console.log("getValues",{getValues:T()}),E.length>0&&$&&t.jsx(be,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:"Please fill some additional inputs here, fields are "+Y+" and minimum "+J+" and maximum "+O+" rows if items are required.",headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:"Additional Inputs",children:t.jsxs("div",{className:"flex flex-col flex-grow",children:[N.map(i=>t.jsxs("div",{className:"flex flex-row gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[t.jsx(we,{singleRow:!0,eventDetails:b,components:i.fields,errors:I,register:y,handleSelect:()=>{},control:z,setValue:w,getValues:T,formData:i.values,isSubmitted:i.disabled,onChangeValue:(n,c)=>{d(x=>x.map(h=>h.id===i.id?{...h,values:{...h.values,[n]:c}}:h))}},i.id),t.jsx("div",{className:"flex items-baseline gap-x-2 print:hidden",children:i.disabled?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>o(i.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:t.jsx(ye,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+i.id),t.jsx("button",{type:"button",onClick:()=>V(i.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:t.jsx(Ne,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+i.id)]}):t.jsx("button",{type:"button",onClick:()=>le(i.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:t.jsx(Fe,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+i.id)})]},i.id)),N.length<O&&t.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:t.jsx("button",{type:"button",onClick:B,disabled:N.length>=O,className:`rounded-full p-1.5 text-white shadow-sm ${N.length>=O?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:t.jsx(Ie,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const Oe=({fieldName:S,label:Z,errors:b,isGroupMandatory:L,participantType:v,setValue:D,formData:r,eventDetails:y,competitions:z,participantsList:I,onChange:ie,disabled:w,register:T,control:$})=>{var m,G,R,ee,Q,q,se,ne,de,re,ae,ce;console.log({competitions:z});let j=b==null?void 0:b[S],[K,O]=U.useState(j);U.useEffect(()=>{O(b==null?void 0:b[S])},[b==null?void 0:b[S]]);let J=(I==null?void 0:I.map(e=>e.Competition))??[],[g,W]=U.useState(J);w&&(g=J);let E=J.join(",");U.useEffect(()=>{E&&J.length>0&&W(J)},[E]);let N=function(e){e.forEach(s=>{let a=`competitionCheckBox_${s.Competition}`,u=document.querySelector(`input[name='${a}']`);u&&(u.checked=!0,ie&&D(a,!0))})};U.useEffect(()=>{(I==null?void 0:I.length)>0&&N(I)},[I]);let d=z??[];if(r!=null&&r.group||L)d=d.filter(e=>w&&!g.find(s=>s==e.CompetitionStructureId)?!1:e.Group==(r==null?void 0:r.group));else{let e=[];d=d.filter(s=>!(e.find(a=>a.Title==s.Title)||(e.push(s),w&&!g.find(a=>a==s.CompetitionStructureId)))),d=e}r!=null&&r.gender&&(d=d.filter(e=>{if((r==null?void 0:r.gender)=="Male"){if(e.Gender==1||e.Gender==3)return!0}else if((r==null?void 0:r.gender)=="Female"){if(e.Gender==2||e.Gender==3)return!0}else return!0;return!1}));const B=[],le=(e,s)=>{s.target.checked?g=[...g,e]:g=g.filter(u=>u!==e),W(g),ie(g)};let o=JSON.parse((y==null?void 0:y.JsonSettings)??"{}"),V=10;v=="Individual"?V=((m=o==null?void 0:o.AdditionalSettings)==null?void 0:m.MaximumParticipationPerCandidate)??10:V=((G=o==null?void 0:o.AdditionalSettings)==null?void 0:G.MaximumParticipationPerGroup)??10;let Y=((R=o==null?void 0:o.AdditionalSettings)==null?void 0:R.FeesCurrency)??"USD",H=((ee=o==null?void 0:o.AdditionalSettings)==null?void 0:ee.EnablePublicAndPrivateRegistration)=="Yes",i=((Q=o==null?void 0:o.AdditionalSettings)==null?void 0:Q.UsePublicAndPrivateRegistrationByRegId)=="Yes",n=((q=o==null?void 0:o.AdditionalSettings)==null?void 0:q.CustomMaxParticipationPerCandidate)??[];if(console.log("customMaxSettings",n),d.length>0&&H&&!w)if(i){let e=o==null?void 0:o.AdditionalSettings;console.log({jsonSettings:o});let s=(ne=(se=o==null?void 0:o.components)==null?void 0:se.User)==null?void 0:ne.find(p=>p.type=="RegistrationIdBox");console.log({registrationBox:s});let a=e==null?void 0:e.EligibleRegistrationNumbers,u=a==null?void 0:a.find(p=>p.RegistrationNumber==(r==null?void 0:r.registrationId)),_=!1;if(s!=null&&s.conditions){let p=!0;for(let l=0;l<s.conditions.length;l++){let k=s.conditions[l],F=((re=(de=k.key)==null?void 0:de.charAt(0))==null?void 0:re.toLowerCase())+((ae=k.key)==null?void 0:ae.slice(1)),P=r[F];if((P==null?void 0:P.toString())!=((ce=k.value)==null?void 0:ce.toString())){p=!1;break}}p?_=!0:_=!1}else _=!0;u&&_||(d=d.filter(p=>{if(p.AllowPublicRegistration=="1")return!0}))}else d=d.filter(e=>{if(e.AllowPublicRegistration=="1")return!0});let c=g.filter(e=>d.find(s=>s.CompetitionStructureId==e)),x=(c==null?void 0:c.length)>=V;n.length>0&&v=="Individual"&&(x=!1);const h=[...new Set(d.map(e=>e.CompetitionCategoryName))],M=d.reduce((e,s)=>e.find(u=>u.CompetitionName===s.CompetitionName)?e:e.concat([s]),[]);return console.log("uniqueCategories",h),h.forEach(e=>{let s=M.filter(p=>p.CompetitionCategoryName==e),a={};if(a.CategoryName=e,a.CompetitionNames=[],s.forEach(p=>{let l=d.filter(F=>F.CompetitionCategoryName==e&&F.CompetitionName==p.CompetitionName),k={};k.CompetitionName=p.CompetitionName,k.competitions=l,a.CompetitionNames.push(k)}),n.length>0){let p=n.filter(f=>{var C;return(C=f.CompetitionCategoryId)==null?void 0:C.startsWith(e)});console.log("matchingCategories",p);let l=n.find(f=>f.CompetitionCategoryId==e);console.log("currentCategoryMax",l);let k=d.filter(f=>p.find(C=>C.CompetitionCategoryId==f.CompetitionCategoryName));console.log("items",k);var u=g.filter(f=>k.find(C=>C.CompetitionStructureId==f));console.log("filteredItemsInCategory",u);let F=u.length>=(l==null?void 0:l.MaxParticipation);if(console.log("isExceeded",F),F&&(a.isExceeded=F,a.MaxParticipation=(l==null?void 0:l.MaxParticipation)??1),e.split("-").length>1){let f=e.split(" - ")[0],C=n.find(X=>X.CompetitionCategoryId==f),me=d.filter(X=>C.CompetitionCategoryId==X.CompetitionCategoryName);console.log("parentItems",me);var _=g.filter(X=>me.find(ge=>ge.CompetitionStructureId==X));console.log("filteredParentItemsInCategory",_);let oe=_.length+u.length>=(C==null?void 0:C.MaxParticipation);console.log("isParentExceeded",oe),oe&&(a.isExceeded=oe,a.MaxParticipation=(C==null?void 0:C.MaxParticipation)??1)}}B.push(a)}),console.log("competitionItems",z),t.jsxs("div",{className:"mt-4  print:mt-0",children:[!w&&t.jsx("label",{htmlFor:S,className:te("block text-sm font-medium leading-6 ",K?"text-danger":"text-gray-900"),children:Z||S}),t.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[B.length==0&&t.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}),x&&t.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:t.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",V," competition per ",v=="Individual"?"candidate":"team","."]})}),B==null?void 0:B.map((e,s)=>{var a;return t.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[t.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:t.jsxs("div",{className:"flex flex-wrap items-baseline",children:[t.jsx("h3",{className:"mt-1 text-2xl  print:text-lg font-semibold leading-6 text-blue-800",children:e.CategoryName}),t.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Programs"})]})}),t.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:(a=e.CompetitionNames)==null?void 0:a.map((u,_)=>{var p;return t.jsxs("div",{children:[t.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:t.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[t.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:u.CompetitionName}),t.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),t.jsx("div",{className:"mt-2 flex flex-wrap",children:(p=u.competitions)==null?void 0:p.map((l,k)=>{let F=g.find(f=>f==l.CompetitionStructureId)!=null,P=!!(w||!F&&x);return e.isExceeded&&!F&&(P=!0),console.log("item",l),console.log("item2",u),console.log("item3",e),t.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[t.jsx("div",{className:"flex gap-3",children:t.jsxs("label",{onClick:f=>{if((x||e.isExceeded)&&P){e.isExceeded?A.error("You can't select more than "+e.MaxParticipation+" competitions from "+e.CategoryName):A.error("You can select maximum "+V+" competitions only");return}},className:te(P?"":"ml-2","block text-sm text-gray-900"),children:[!P&&t.jsx("input",{type:"checkbox",id:`competitionCheckBox_${l.CompetitionStructureId}`,className:te(" h-5 w-5 optiontext-darkprimary ",K?"border-red-300  text-red-600 focus:ring-red-800":P?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:P,fieldName:`competitionCheckBox_${l.CompetitionStructureId}`,checked:F,onChange:f=>{le(l.CompetitionStructureId,f)}},k),P&&!F&&t.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),t.jsxs("span",{className:"hidden print:flex",children:[(y==null?void 0:y.AllowDisplayCompetitionOrder)==1?l.CompetitionOrder+" - ":""," ",l.Title]}),t.jsx("span",{className:te(w?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(K?"text-danger":"text-gray-900")),children:((y==null?void 0:y.AllowDisplayCompetitionOrder)==1?l.CompetitionOrder+" - ":"")+(l.Title.replace(u.CompetitionName,"").replace(/ /gi,"").trim()!==""?l.Title.replace(u.CompetitionName,"").trim():u.CompetitionName.trim())})]})}),t.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:(l==null?void 0:l.Remarks)&&t.jsx(fe,{children:l.Remarks})}),l.Fees>0&&t.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:t.jsxs("b",{children:["Fees:",t.jsxs("i",{className:"text-green-700 font-medium",children:[" ",l.Fees,Y]})]})}),t.jsx(Re,{eventDetails:y,item:l,competitionStructureId:l.CompetitionStructureId,candidateId:l.CandidateId,register:T,errors:b,control:$,participantsList:I,setValue:D,getValues:null,setFormData1:()=>{},formData:r})]},s+"_"+_+"_"+l.CompetitionStructureId)})})]},s+"_"+_)})})]},s)})]})]})};export{Oe as default};
