import{r as a,j as e}from"./mainweb-CAGpoPTC.js";import{a as z}from"./index-t--hEgTQ.js";import{A as xe}from"./authContext-Dc7OwetT.js";import{F as fe}from"./XMarkIcon-BWsRG_0V.js";function Se({JudgesAllotment:P,competitionStructure:D,selectedItems:j,handleCheckboxChange:d,handleCardDataChange:A,saveChanges:B,eventStages:c,userRoles:b,cancelEdit:U,JudgeAllotmentRemove:O,JudgeAllotmentSave:L,setEditCompetitionData:R}){const[F,E]=a.useState(null),[k,I]=a.useState(null),[o,i]=a.useState({}),m=(r,w)=>{i(C=>{const T=C[w]||"Allowed to Fill",$=T==="Allowed to Fill"?{status:"Filled",value:1}:T==="Filled"?{status:"Published",value:2}:{status:"Allowed to Fill",value:3};return L({competition:r?.competition||"",scoreStatus:$.value,stage:r?.stage||"",judge:r?.UserRoleId||"",remarks:r?.remarks||"",order:r?.order||"",AllotementId:w}),{...C,[w]:$.status}})},J=(r,w)=>{E(r),I(w)},x=b?.find(r=>r?.UserRoleId===F),p=P?.filter(r=>r?.JudgeUserName===k)||[];return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1/3 bg-white shadow-sm rounded-md",children:b.length===0?e.jsx("div",{className:"w-full text-left py-2 bg-gray-100 rounded-md",children:e.jsx("p",{className:"text-sm",children:"No data available."})}):b.map(r=>e.jsx("div",{className:`cursor-pointer py-2 border-b hover:bg-gray-50 ${F===r.UserRoleId?"bg-gray-100":""}`,onClick:()=>J(r?.UserRoleId,r?.UserName),children:e.jsx("h3",{className:"text-xs font-small text-left",children:r?.UserName||"No Name"})},r?.UserRoleId||"unknown"))}),e.jsx("div",{className:"w-full sm:w-2/3 bg-white shadow-sm rounded-md py-2 space-y-2",children:p.length>0?p.map(r=>{const w=r?.AllotementId,C=o[w]||r?.ScoreStatusScoreResultStatus||"Allowed to Fill";let T="bg-yellow-500";return C==="Filled"?T="bg-blue-500":C==="Published"&&(T="bg-green-500"),e.jsxs("div",{className:"py-2 px-3 bg-grey-50 border rounded-md",children:[e.jsxs("div",{className:"py-1 bg-blue-50 border border-blue-300 rounded-md w-full",children:[e.jsxs("p",{className:"text-xs text-center font-semibold",children:[r?.CompetitionGroupGroupName||"No Group"," - ",r?.CompetitionCompetitionItemTitle||"No Title"]}),e.jsx("p",{className:"text-xs text-gray-800  text-center font-semibold",children:C})]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:`${T} text-white text-xs rounded-md w-full py-1 hover:bg-blue-600 transition duration-150`,onClick:()=>m(r,w),children:C==="Allowed to Fill"?"Fill":C==="Filled"?"Publish":"Allowed to Fill"})}),x&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"bg-red-500 text-white text-xs rounded-md w-full py-1 hover:bg-red-600 transition duration-150",onClick:()=>O(r?.AllotementId),children:"Delete Judge"})})]},r?.CompetitionId||`comp-${Math.random()}`)}):e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"No related competitions found."})})]})}function be({isModalOpen:P,setIsModalOpen:D,handleSubmit:j,formData:d,handleEditCompetition:A,handleDeleteCompetition:B,handleInputChange:c,modalTitle:b,buttonText:U,modalType:O,competitionStructure:L,eventStages:R,userRoles:F}){if(!P)return null;const k=O==="filter"?["Competition order number","competition","scoreStatus","stage","judge"]:Object.keys(d),I=o=>{const i=Array.from(o.target.selectedOptions,m=>m.value);c({target:{name:"competition",value:i}})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-container",children:[e.jsx("span",{className:"close-btn",onClick:()=>D(!1),children:"×"}),e.jsx("h3",{className:"modal-title",children:b}),e.jsxs("form",{className:"modal-form",onSubmit:o=>{o.preventDefault(),j()},children:[k.map(o=>{if(o==="competition"){const i=L.reduce((m,J)=>{const x=J.GroupGroupName||"Others";return m[x]||(m[x]=[]),m[x].push(J),m},{});return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,className:"form-label",children:"Competition:"}),e.jsx("div",{className:"styled-select-wrapper",children:e.jsxs("select",{id:o,name:o,value:d[o],onChange:I,className:"styled-select",required:!0,multiple:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),Object.keys(i).sort().map((m,J)=>e.jsx("optgroup",{label:m,children:i[m].sort((x,p)=>x.CompetitionItemTitle.localeCompare(p.CompetitionItemTitle)).map(x=>e.jsx("option",{value:x.CompetitionStructureId,children:x.CompetitionItemTitle},x.CompetitionStructureId))},J))]})}),e.jsxs("p",{className:"selection-count",children:[d[o].length," ",d[o].length===1?"Competition Selected":"Competitions Selected"]})]},o)}return o==="scoreStatus"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,children:"Score Status:"}),e.jsxs("select",{id:o,name:o,value:d[o],onChange:c,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),e.jsx("option",{value:"3",children:"Allowed to Fill"}),e.jsx("option",{value:"2",children:"Filled"}),e.jsx("option",{value:"1",children:"Published"})]})]},o):o==="stage"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,children:"Stage:"}),e.jsxs("select",{id:o,name:o,value:d[o],onChange:c,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),R.map((i,m)=>e.jsx("option",{value:i.Title,children:i.Title},m))]})]},o):o==="judge"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:o,children:"Judge:"}),e.jsxs("select",{id:o,name:o,value:d[o],onChange:c,className:"form-input",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Please select"}),F.map((i,m)=>e.jsx("option",{value:i.UserRoleId,children:i.UserName},m))]})]},o):e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:o,children:[o.charAt(0).toUpperCase()+o.slice(1),":"]}),e.jsx("input",{type:o==="order"?"number":"text",id:o,name:o,value:d[o],onChange:c,className:"form-input",required:o!=="order"})]},o)}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"submit",className:"submit-btn",children:U}),e.jsx("button",{type:"button",onClick:()=>D(!1),className:"cancel-btn",children:"Cancel"})]})]})]})})}const Ce=({competitionStructure:P,handleSubmit:D,handleFilterInputChange:j,currentFilters:d,setIsDropdownOpen:A,onCategorySelect:B})=>{const[c,b]=a.useState(!1),[U,O]=a.useState(""),[L,R]=a.useState(""),[F,E]=a.useState(""),[k,I]=a.useState(""),o=a.useRef(null),[i,m]=a.useState([]),[J,x]=a.useState(null),p=[{value:"all",label:"All"},{value:"category",label:"Category"},{value:"competition",label:"Competition"},{value:"stage",label:"Stage"}],r=()=>{m([])},w=l=>{const g=l.target.value;m(u=>u.includes(g)?u.filter(f=>f!==g):[...u,g])},C=P.reduce((l,g)=>{const u=g.GroupGroupName||"Others";return l[u]||(l[u]=[]),l[u].push(g),l},{}),T=l=>{const{name:g,value:u}=l.target;j(g,u)},$=l=>{const g=l.target.value;j("category",g),B(g)},q=()=>{b(!c),A(!c)};return a.useEffect(()=>{const l=g=>{o.current&&!o.current.contains(g.target)&&(b(!1),A(!0))};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),e.jsxs("div",{className:"relative inline-block w-48",ref:o,children:[e.jsx("button",{type:"button",onClick:q,className:"w-full px-2 py-1 bg-white border border-gray-300 text-gray-700 text-sm rounded-md shadow-sm hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:i.length>0?`Selected (${i.length})`:"Select filters..."}),i.length>0&&e.jsx("button",{onClick:r,className:"absolute top-0 right-0 p-1 text-gray-500 hover:text-gray-700",children:e.jsx(fe,{className:"h-4 w-4"})}),c&&e.jsx("div",{className:"absolute left-0 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:p.map(l=>e.jsxs("label",{className:"block px-2 py-1 text-gray-700 hover:bg-gray-100 cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",value:l.value,checked:i.includes(l.value),onChange:w,className:"mr-2"}),l.label]},l.value))}),i.includes("category")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-xs font-medium text-gray-700",children:"Select Category:"}),e.jsxs("select",{id:"category",name:"category",value:d.category||"",onChange:$,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a category"}),Object.keys(C).sort().map(l=>e.jsx("option",{value:l,children:l},l))]})]}),i.includes("competition")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"competition",className:"block text-xs font-medium text-gray-700",children:"Select Competition:"}),e.jsxs("select",{id:"competition",name:"competition",value:d.competition||"",onChange:T,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a competition"}),Object.keys(C).sort().map((l,g)=>e.jsx("optgroup",{label:l,children:C[l].sort((u,f)=>u.CompetitionItemTitle.localeCompare(f.CompetitionItemTitle)).map(u=>e.jsx("option",{value:u.CompetitionStructureId,children:u.CompetitionItemTitle},u.CompetitionStructureId))},g))]})]}),i.includes("stage")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"stage",className:"block text-xs font-medium text-gray-700",children:"Stage"}),e.jsx("input",{type:"text",id:"stage",name:"stages",value:d.stages||"",onChange:T,className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),i.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:D,className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-xs",children:"Apply Filters"})})]})};function Ie({user:P}){const D=()=>a.useContext(xe),{accessToken:j}=D(),[d,A]=a.useState([]),[B,c]=a.useState(!0),[b,U]=a.useState([]),[O,L]=a.useState(!1),[R,F]=a.useState(d),[E,k]=a.useState([]),[I,o]=a.useState([]),[i,m]=a.useState([]),[J,x]=a.useState(!1),[p,r]=a.useState(1),[w,C]=a.useState([]),[T,$]=a.useState(null),[q,l]=a.useState(null),[g,u]=a.useState(!1),[f,te]=a.useState(""),[G,Y]=a.useState({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""}),[V,Z]=a.useState({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""}),[y,W]=a.useState({order:"",competition:"",scoreStatus:"",stages:"",judgeUserName:""}),se=()=>{const{order:t,competition:s,scoreStatus:n,stages:h,judgeUserName:N}=y;M(p,t,s,n,h)};a.useEffect(()=>{},[y,R]);const oe=()=>{if(f==="edit"){const t=d.map(s=>s.AllotementId===V.AllotementId?V:s);K(),A(t)}else if(f==="new")A([...d,G]),K(),Y({competition:"",scoreStatus:"",stage:"",judge:"",remarks:"",order:""});else if(f==="filter"){const{order:t,competition:s,scoreStatus:n,judgeUserName:h}=G;W({order:t,competition:s,scoreStatus:n,judgeUserName:h}),M(p,t,s,n,h)}u(!1)},[je,Ne]=a.useState("all"),ae=t=>{const{name:s,value:n}=t.target;(f==="edit"?Z:Y)(N=>({...N,[s]:n}))},ne=(t,s)=>{W(n=>({...n,[t]:s}))};a.useEffect(()=>{O&&Q()},[O]);const M=async(t=1,s="",n="",h="",N="")=>{c(!0);try{const S=["AllotementId","Competition","CompetitionCompetitionItemTitle","CompetitionGender","CompetitionGenderGenderTitle","CompetitionGroupGroupName","CompetitionLanguage","CompetitionLanguageLanguageName","CompetitionOrder","CompetitionParticipantTypeTitle","Judge","JudgeUserName","Order","Phase","PhaseTitle","Remarks","ScoreStatus","ScoreStatusScoreResultStatus","Stage","StageTitle","Status"],v=new FormData;v.append("CompetitionOrder",s??""),v.append("PageSize","10"),v.append("Competition",n??""),v.append("ScoreStatus",h??""),v.append("JudgeUserName",N??""),v.append("SortOrder","desc"),v.append("SortColumn","ModifiedDate"),v.append("select",S),v.append("PageNumber",t.toString());const X=await z.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentPlusUsersRolesJson/Get",v,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`}});X.data&&X.data.Results&&A(X.data.Results)}catch(S){console.error("Error fetching JudgesAllotment:",S)}finally{c(!1)}};a.useEffect(()=>{M(p)},[p]);const H=async()=>{x(!0);try{const t=new FormData,s=["*","CreatedDateString","Description","ESGId","Event","EventCategory","EventEventName","Message","ModifiedDateString","Order","RowFrom","RowTo","Status","Title","TitleEquals","TotalRowCount","Venue"];t.append("status","1"),t.append("PageSize","1000"),t.append("SortColumn","ModifiedDate"),t.append("SortOrder","desc"),t.append("PageNumber","1"),t.append("select",s);const n=new FormData,h=["*","CreatedDateString","Event","EventCategory","EventEventName","Group","GroupGroupName","IdentityNumber","JsonSettings","Message","ModifiedDateString","Order","Organization","OrganizationAllowOrganizationId","OrganizationName","OrganizationShortName","ParticipantType","RegistrationId","Role","RowFrom","RowTo","Status","TeamId","TotalRowCount","User","UserComments","UserDobString","UserEmail","UserJsonSettings","UserName","UserNameTitle","UserPhone","UserProfilePicture","UserRoleId"];n.append("status","1"),n.append("Role",P.Role),n.append("CreatedBy","12007"),n.append("select",h);const[N,S]=await z.all([z.post("https://etalenterapi.azurewebsites.net/EventStagesJson/Get",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`}}),z.post("https://etalenterapi.azurewebsites.net/UsersRolesJson/Get",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`}})]);N.data&&o(N.data.Results||[]),S.data&&m(S.data.Results||[])}catch(t){console.error("Error fetching new data:",t)}finally{x(!1)}};a.useEffect(()=>{},[d,I,i]);const K=async t=>{c(!0);try{const s=new FormData;t!=null?(s.append("AllowNumberUpdate","true"),s.append("Competition",t.competition),s.append("ScoreStatus[]",t.scoreStatus),s.append("Phase","0"),s.append("Stage",t.stage),s.append("Judge",t.judge),s.append("Remarks",t.remarks),s.append("Status","1"),s.append("Order",t.order),s.append("AllotementId",t.AllotementId)):(s.append("CompetitionList[]",G.competition),s.append("undefined",""),s.append("PageSize","1000"),s.append("ScoreStatusList[]",G.scoreStatus),s.append("StageList[]",G.stage),s.append("JudgeList[]",G.judge),s.append("Remarks","desc"),s.append("Order","ModifiedDate"),s.append("AllotementId",""),s.append("IsMultiple","true"));const n=await z.post("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/Save",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`}});n.data&&n.data.Results&&M(p)}catch(s){console.error("Error Saving JudgesAllotment:",s)}finally{c(!1)}},_=async t=>{c(!0);try{const s=await z.delete("https://etalenterapi.azurewebsites.net/JudgesAllotmentJson/Remove",{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`},params:{AllotementId:t}});s.data&&s.data.Results&&M(p)}catch(s){console.error("Error Deleting JudgesAllotment:",s)}finally{c(!1)}},Q=async()=>{c(!0);try{const t=new FormData;t.append("status","1");const s=["*","AllowPublicRegistration","AllowPublicRegistrationTitle","CompetitionItem","CompetitionItemTitle","CompetitionStatus","CompetitionStatusCompetitionStatusTitle","CompetitionStructureId","CreatedDateString","Event","EventCategory","EventEventName","Fees","Gender","GenderGenderTitle","GenerateRanks","Group","GroupGroupName","JsonSettings","Language","LanguageLanguageName","MaximumCandidates","MaximumContestantsPerUnit","MaximumMinutes","MaximumScore","MaximumSeconds","Message","MinimumMinutes","MinimumSeconds","ModifiedDateString","Order","ParticipantType","ParticipantTypeTitle","Remarks","RowFrom","RowTo","Status","TotalRowCount","Visibility","WarningMinute","WarningSecond"];t.append("select",s);const n=await z.post("https://etalenterapi.azurewebsites.net/CompetitionStructureJson/GetForAllotment",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${j}`}});n.data&&n.data.Results&&k(n.data.Results||[])}catch(t){console.error("Error Fetching Competition Structures:",t)}finally{c(!1)}};a.useEffect(()=>{},[E]);const re=t=>{Q(),H(),te(t),u(!0)},le=()=>{u(!1)},ie=()=>{u(!1)},de=t=>{Q(),H(),U(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},[ce,ee]=a.useState([]),ue=(t,s,n)=>{A(h=>h.map(N=>N.AllotementId===t?{...N,[s]:n}:N)),ee(h=>{if(h.find(S=>S.AllotementId===t))return h.map(S=>S.AllotementId===t?{...S,[s]:n}:S);{const S=d.find(v=>v.AllotementId===t);return[...h,{...S,[s]:n}]}})},me=t=>{ce.find(n=>n.AllotementId===t)&&ee(n=>n.filter(h=>h.AllotementId!==t))},pe=t=>{U(s=>s.filter(n=>n!==t))},ge=async()=>{c(!0);try{for(const s of b)await _(s);const t=d.filter(s=>!b.includes(s.AllotementId));A(t),U([])}catch(t){console.error("Error deleting selected items:",t)}finally{c(!1)}},[ve,we]=a.useState({order:"",competition:"",scoreStatus:"",judgeUserName:""}),he=t=>{if(W(s=>({...s,category:t})),t){const s=d.filter(n=>n.CompetitionGroupGroupName===t);F(s),l(t)}else F(d)};return a.useEffect(()=>{},[R,q]),e.jsxs("div",{className:"AssignJudgesToCompetition",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Judges Allotment"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4 mx-auto",children:[e.jsx(Ce,{handleSubmit:se,handleFilterInputChange:ne,competitionStructure:E,JudgesAllotment:d,eventStages:I,userRoles:i,currentFilters:y,setIsDropdownOpen:L,onCategorySelect:he}),e.jsx("button",{onClick:()=>{H(),re("new")},className:"bg-green-500 text-white font-medium rounded-md px-12 py-1 text-sm hover:bg-green-600 transition",children:e.jsx("i",{className:"fas fa-plus mr-2"})}),b.length>0&&e.jsxs("button",{className:"bg-red-500 text-white font-medium rounded-md px-3 py-1 text-sm hover:bg-red-600 transition",onClick:ge,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete Selected"]})]}),e.jsx(be,{isModalOpen:g,setIsModalOpen:u,handleEditCompetition:le,handleDeleteCompetition:ie,handleSubmit:oe,formData:f==="edit"?V:G,handleInputChange:ae,modalTitle:f==="new"?"Create Competition":f==="edit"?"Edit":"Filter Competition",buttonText:f==="new"?"Create":f==="edit"?"Save changes":"Apply Filters",modalType:f,competitionStructure:E,eventStages:I,userRoles:i}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(Se,{JudgesAllotment:R?.length>0||R?.length===0&&q!==null?R:d,competitionStructure:E,selectedItems:b,handleCheckboxChange:de,handleCardDataChange:ue,saveChanges:me,cancelEdit:pe,JudgeAllotmentRemove:_,JudgeAllotmentSave:K,eventStages:I,userRoles:i,setEditCompetitionData:Z})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4",children:[e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition",disabled:p===1,onClick:()=>{const t=p-1;r(t),M(t,y.order,y.competition,y.scoreStatus,y.judgeUserName)},children:"←"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:["Page ",p]}),e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition",onClick:()=>{const t=p+1;r(t),M(t,y.order,y.competition,y.scoreStatus,y.judgeUserName)},children:"→"})]})]})}export{Ie as default};
