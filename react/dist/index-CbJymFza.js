import{r as L,j as r,t as xe,m as Te,u as je,z as $}from"./main-DAQuJgkC.js";import{L as Ne}from"./layoutOuter-CvJTETMo.js";import{P as Oe}from"./pageHeader-B4TFDVOz.js";import{O as Me}from"./OldNewTabLayout-B5R6U425.js";import{e as te}from"./navigationUtils-QyJ0rWZU.js";import Fe from"./formEditor-Do-cMmMF.js";import{F as re}from"./UserGroupIcon-OrEIAgBF.js";import{F as be}from"./UserIcon-5a3hgr_W.js";import{F as ye}from"./XCircleIcon-D8H5Hb6t.js";import{F as De}from"./CheckCircleIcon-Bw0beXO9.js";import{F as ke}from"./PencilIcon-CCoLyfnB.js";import{F as Ie}from"./TrashIcon-uHoDBa-x.js";import{F as Ce}from"./PlusIcon-Dx8M0rKh.js";import{F as Ee}from"./TableCellsIcon-Di3mPolP.js";import"./index.esm-C1JQWqFs.js";import"./renderComponents-95HSod-h.js";import"./validationMessage-DqH985Az.js";import"./CheckCircleIcon-B224va4G.js";import"./modalForm-BU0U0JGp.js";import"./dialog-DhbST_eT.js";import"./keyboard-BYsHtR-Z.js";import"./description-DResQ0Vr.js";import"./use-is-mounted-Ao2wPgvu.js";import"./XMarkIcon-CR-RVEZx.js";function Re({title:t,titleId:y,...M},v){return L.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:v,"aria-labelledby":y},M),t?L.createElement("title",{id:y},t):null,L.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))}const Pe=L.forwardRef(Re);function Be({title:t,titleId:y,...M},v){return L.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:v,"aria-labelledby":y},M),t?L.createElement("title",{id:y},t):null,L.createElement("path",{fillRule:"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z",clipRule:"evenodd"}))}const ae=L.forwardRef(Be),Ye=(t,y)=>{const M=new Date(t);M.setHours(0,0,0,0);const v=new Date(y);v.setHours(0,0,0,0),v.setDate(v.getDate()+1);let I=v.getFullYear()-M.getFullYear(),S=v.getMonth()-M.getMonth(),p=v.getDate()-M.getDate();if(p<0){S--;const A=new Date(v.getFullYear(),v.getMonth(),0);p+=A.getDate()}return S<0&&(I--,S+=12),{years:I,months:S,days:p}},Ge=(t,y)=>{const M=new Date(t);M.setHours(0,0,0,0);const v=new Date(y);v.setHours(0,0,0,0),v.setDate(v.getDate()+1);const I=Math.abs(v-M);return Math.ceil(I/(1e3*60*60*24))+1},_e=t=>{if(t.years===0&&t.months===0)return`${t.days} ${t.days===1?"day":"days"}`;if(t.years===0)return t.days===0?`${t.months} ${t.months===1?"month":"months"}`:`${t.months} ${t.months===1?"month":"months"}, ${t.days} ${t.days===1?"day":"days"}`;{const y=[];return y.push(`${t.years} ${t.years===1?"year":"years"}`),t.months>0&&y.push(`${t.months} ${t.months===1?"month":"months"}`),t.days>0&&y.push(`${t.days} ${t.days===1?"day":"days"}`),y.join(", ")}},de=t=>{if(!t)return null;const y=t.split("-");return y.length!==3?null:new Date(parseInt(y[2]),parseInt(y[1])-1,parseInt(y[0]))};function Le({formData:t,getValues:y}){const M=t?.BirthDateTo||y?.("BirthDateTo"),v=t?.BirthDateFrom||y?.("BirthDateFrom");if(!M||!v)return null;const I=de(M),S=de(v);if(!I||!S)return null;const p=new Date().getFullYear(),A=new Date(p,S.getMonth(),S.getDate()),P=p-S.getFullYear(),R=p-I.getFullYear(),_=Ye(I,S),O=Ge(I,S),m=_.years===0;return r.jsxs("div",{className:"p-4 bg-surface border border-primary/20 rounded-md",children:[r.jsxs("h4",{className:"text-sm font-semibold text-onSurface mb-3 flex items-center gap-2",children:[r.jsx(ae,{className:"h-5 w-5 text-cyan-600"}),"Calculated Age Group Preview"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[r.jsxs("div",{className:"bg-surfaceCard p-3 rounded border border-cyan-100",children:[r.jsx("span",{className:"text-xs text-onSurfaceVariant block mb-1",children:"Age From (Youngest)"}),r.jsxs("span",{className:"text-base font-semibold text-onSurface",children:[P," years"]})]}),r.jsxs("div",{className:"bg-surfaceCard p-3 rounded border border-cyan-100",children:[r.jsx("span",{className:"text-xs text-onSurfaceVariant block mb-1",children:"Age To (Oldest)"}),r.jsxs("span",{className:"text-base font-semibold text-onSurface",children:[R," years"]})]}),r.jsxs("div",{className:"bg-surfaceCard p-3 rounded border border-cyan-100",children:[r.jsx("span",{className:"text-xs text-onSurfaceVariant block mb-1",children:"Calculation Date"}),r.jsxs("span",{className:"text-base font-semibold text-onSurface",children:[String(A.getDate()).padStart(2,"0"),"-",String(A.getMonth()+1).padStart(2,"0"),"-",p]})]})]}),r.jsx("div",{className:"bg-emerald-50 p-3 rounded border border-emerald-200",children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("span",{className:"text-xs text-emerald-700 font-medium block mb-1",children:"Birth Date Range Span"}),r.jsx("span",{className:"text-sm font-semibold text-emerald-900",children:_e(_)})]}),m&&r.jsxs("div",{className:"text-right",children:[r.jsx("span",{className:"text-xs text-emerald-700 font-medium block mb-1",children:"Total Days"}),r.jsxs("span",{className:"text-sm font-semibold text-emerald-900",children:[O," ",O===1?"day":"days"]})]})]})}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-onSurfaceVariant bg-surfaceCard p-2 rounded",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"From (Oldest):"})," ",M]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"To (Youngest):"})," ",v]})]})]})]})}const Ue=[{text:"Any",value:"Any",icon:re},{text:"Individual",value:"Individual",icon:be},{text:"Team",value:"Team",icon:re}],Ve=[{text:"No",value:"No",icon:ye},{text:"Yes (Multiple age groups)",value:"Yes",icon:De}],ue=t=>{const y=String(t.getDate()).padStart(2,"0"),M=String(t.getMonth()+1).padStart(2,"0"),v=t.getFullYear();return`${y}-${M}-${v}`};function ze({editingGroup:t,existingGroups:y=[],onSubmit:M,onCancel:v,open:I}){const S=L.useMemo(()=>{if(y&&y.length>0){const m=y[0];return{day:m.AgeStartDate||1,month:m.AgeStartMonth||1,year:m.AgeStartYear||new Date().getFullYear()}}return{day:1,month:1,year:new Date().getFullYear()}},[y]),p=(m,l,e)=>{if(!m||!l||!e)return{birthDateFrom:"",birthDateTo:""};try{const a=new Date(e.year,e.month-1,e.day),i=new Date(a);i.setFullYear(i.getFullYear()-l),i.setDate(i.getDate()+1);const h=new Date(a);return h.setFullYear(h.getFullYear()-m+1),{birthDateFrom:ue(h),birthDateTo:ue(i)}}catch(a){return console.error("Error calculating birth dates from ages:",a),{birthDateFrom:"",birthDateTo:""}}},A=L.useMemo(()=>t?{EventGroupId:t.EventGroupId,GroupName:t.GroupName,BirthDateFrom:t.BirthDateFrom||"",BirthDateTo:t.BirthDateTo||"",AgeFrom:t.AgeFrom||"",AgeTo:t.AgeTo||"",ParticipantType:t.parsedSettings.ParticipantType,IsCommon:t.parsedSettings.IsCommon,NoAgeIdPrefix:t.parsedSettings.NoAgeIdPrefix,Order:t.Order,Status:t.Status}:{Status:2,ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No",AgeFrom:"",AgeTo:""},[t]),P=[{name:"GroupName",label:"Group Name",type:"text",placeholder:"e.g., Juniors, Children, Seniors",validate:{required:!0,minLength:2,maxLength:50}},{name:"ParticipantType",label:"Participant Type",type:"toggle",options:Ue,validate:{required:!0}},{name:"BirthDateTo",label:"Birth Date From (Oldest Eligible)",type:"normalDate",maxDate:new Date,placeholder:"Select the birth date of the oldest eligible participant (earliest date)",validate:{required:!0,toField:"BirthDateFrom"}},{name:"BirthDateFrom",label:"Birth Date To (Youngest Eligible)",type:"normalDate",maxDate:new Date,placeholder:"Select the birth date of the youngest eligible participant (most recent)",validate:{required:!0,fromField:"BirthDateTo"}},{name:"AgeFrom",label:"Age From (Youngest Age)",type:"number",placeholder:"e.g., 5",description:`Ages calculated on ${S.day}/${S.month}/${S.year}`,min:0,max:100,validate:{required:!0,min:0,max:100,lessThanOrEqualTo:"AgeTo"}},{name:"AgeTo",label:"Age To (Oldest Age)",type:"number",placeholder:"e.g., 12",min:0,max:100,validate:{required:!0,min:0,max:100,greaterThanOrEqualTo:"AgeFrom"}},{name:"AgePreview",type:"custom",render:m=>r.jsx(Le,{...m})},{name:"IsCommon",label:"Is Common Group",type:"toggle",options:Ve},{name:"NoAgeIdPrefix",label:"No Age-Based ID Prefix",type:"toggle",options:[{text:"No (Use age prefix)",value:"No",icon:ye},{text:"Yes (No prefix)",value:"Yes",icon:De}],conditions:[{key:"IsCommon",value:"No"}]}],R=async(m,...l)=>(m.IsCommon==="Yes"&&(m.NoAgeIdPrefix="Yes"),M(m,...l)),_=(m,l,e)=>{const a=parseInt(m)||0,i=parseInt(l.AgeTo)||0,{birthDateFrom:h,birthDateTo:f}=p(a+1,i,S);e("BirthDateFrom",h),e("BirthDateTo",f)},O=(m,l,e)=>{const a=parseInt(m)||0,i=parseInt(l.AgeFrom)||0,{birthDateFrom:h,birthDateTo:f}=p(i,a,S);e("BirthDateFrom",h),e("BirthDateTo",f)};return r.jsx(Fe,{title:t?"Edit Age Group":"Add New Age Group",description:t?"Update age group details by modifying age ranges and calculation dates":"Create a new age group by specifying age ranges and calculation dates",row:A,fields:P,onSave:R,onCancel:v,ageFromOnChange:_,ageToOnChange:O})}function qe({gapInfo:t}){return r.jsxs("div",{className:"relative pb-8",children:[r.jsx("span",{className:"absolute left-6 top-4 -ml-px h-full w-0.5 bg-red-300 border-l-2 border-dashed","aria-hidden":"true"}),r.jsxs("div",{className:"relative flex items-start space-x-3",children:[r.jsx("div",{className:"relative flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-full bg-red-100 border-2 border-red-400 border-dashed",children:r.jsx("span",{className:"text-xs font-bold text-red-600",children:"GAP"})}),r.jsx("div",{className:"min-w-0 flex-1",children:r.jsxs("div",{className:"rounded-lg border-2 border-red-200 border-dashed bg-red-50 shadow-sm p-4",children:[r.jsx("h3",{className:"text-sm font-semibold text-red-700 mb-2",children:"⚠️ Missing Age Range"}),r.jsxs("div",{className:"text-xs text-red-600 space-y-1",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Gap Ages:"})," ",t.missingAges]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Date Range:"})," ",t.dateFrom," to ",t.dateTo]}),r.jsx("p",{className:"italic text-red-500 mt-2",children:"Participants born in this range have no age group assigned!"})]})]})})]})]})}function Je({group:t,onEdit:y,onDelete:M,isLast:v}){const I=t.parsedSettings.ParticipantType==="Individual"?"bg-cyan-500":t.parsedSettings.ParticipantType==="Team"?"bg-emerald-500":"bg-indigo-500",S=t.parsedSettings.ParticipantType==="Individual"?"border-cyan-200":t.parsedSettings.ParticipantType==="Team"?"border-emerald-200":"border-indigo-200",p=t.parsedSettings.ParticipantType==="Individual"?"text-cyan-600":t.parsedSettings.ParticipantType==="Team"?"text-emerald-600":"text-indigo-600",A=O=>{const m=new Date(O),l=String(m.getDate()).padStart(2,"0"),e=String(m.getMonth()+1).padStart(2,"0"),a=m.getFullYear();return`${l}-${e}-${a}`},P=new Date(t.MinAgeDate),R=new Date(t.MaxAgeDate),_={from:A(t.MinAgeDate),to:A(t.MaxAgeDate),minYear:P.getFullYear(),maxYear:R.getFullYear()};return r.jsxs("div",{className:"relative pb-8",children:[!v&&r.jsx("span",{className:"absolute left-6 top-8 -ml-px h-full w-0.5 bg-border","aria-hidden":"true"}),r.jsxs("div",{className:"relative flex items-start space-x-3",children:[r.jsx("div",{className:`relative flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-full ${I} shadow-sm`,children:r.jsxs("span",{className:"text-base font-bold text-white",children:[t.AgeFrom,"-",t.AgeTo]})}),r.jsxs("div",{className:"min-w-0 flex-1 space-y-3",children:[r.jsxs("div",{className:`rounded-lg border ${S} bg-surfaceCard shadow-sm p-4`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:`text-base font-semibold ${p}`,children:t.GroupName}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>y(t),className:"text-onSurfaceVariant hover:text-primary transition-colors",title:"Edit",children:r.jsx(ke,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>M(t.EventGroupId),className:"text-onSurfaceVariant hover:text-red-600 transition-colors",title:"Delete",children:r.jsx(Ie,{className:"h-4 w-4"})})]})]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-onSurfaceVariant",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(ae,{className:"h-4 w-4 text-onSurfaceVariant"}),r.jsxs("span",{children:["Age on: ",t.AgeStartDate,"/",t.AgeStartMonth,"/",t.AgeStartYear]})]}),t.parsedSettings.IsCommon==="Yes"&&r.jsx("span",{className:"rounded-full bg-yellow-100 px-2 py-1 text-xs font-medium text-yellow-800",children:"Common"}),t.Status!==1&&r.jsx("span",{className:"rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800",children:"Inactive"})]}),r.jsxs("div",{className:"mt-2 text-xs text-onSurfaceVariant",children:["Order: ",t.Order]})]}),r.jsx("div",{className:"rounded-md border border-border bg-surfaceCard shadow-sm p-3",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(ae,{className:"h-5 w-5 text-onSurfaceVariant flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-xs font-semibold text-onSurface mb-1",children:"Birth Date Range (Eligible Participants)"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-onSurfaceVariant",children:"From:"}),r.jsx("span",{className:"ml-1 font-medium text-onSurface",children:_.from}),r.jsxs("span",{className:"ml-1 text-onSurfaceVariant",children:["(",_.minYear,")"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-onSurfaceVariant",children:"To:"}),r.jsx("span",{className:"ml-1 font-medium text-onSurface",children:_.to}),r.jsxs("span",{className:"ml-1 text-onSurfaceVariant",children:["(",_.maxYear,")"]})]})]}),r.jsxs("p",{className:"mt-1 text-xs text-onSurfaceVariant italic",children:["Participants born within this date range will be age ",t.AgeFrom,"-",t.AgeTo," on ",t.AgeStartDate,"/",t.AgeStartMonth,"/",t.AgeStartYear]})]})]})})]})]})]})}function We({groups:t,onEdit:y,onDelete:M,detectGaps:v}){const I=t.filter(A=>A.parsedSettings.ParticipantType==="Individual"||A.parsedSettings.ParticipantType==="Any").sort((A,P)=>(A.Order||0)-(P.Order||0)),S=t.filter(A=>A.parsedSettings.ParticipantType==="Team"||A.parsedSettings.ParticipantType==="Any").sort((A,P)=>(A.Order||0)-(P.Order||0)),p=(A,P,R,_,O)=>{const m=[];return A.forEach((l,e)=>{m.push(r.jsx("li",{children:r.jsx(Je,{group:l,onEdit:y,onDelete:M,isLast:!1})},l.EventGroupId));const a=P.find(i=>i.afterIndex===e);a&&m.push(r.jsx("li",{children:r.jsx(qe,{gapInfo:a})},`gap-${e}`))}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:`flex items-center gap-2 mb-4 pb-2 border-b-2 ${O.border}`,children:[_,r.jsx("h2",{className:`text-base font-semibold ${O.text}`,children:R}),r.jsxs("span",{className:`ml-auto rounded-full ${O.bg} px-2 py-1 text-xs font-medium ${O.badge}`,children:[A.length," groups"]})]}),A.length===0?r.jsxs("p",{className:"text-sm text-gray-500",children:["No ",R.toLowerCase()," defined"]}):r.jsx("div",{className:"flow-root",children:r.jsx("ul",{className:"-mb-8",children:m})})]})};return r.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[I.length>0&&p(I,v(I),"Individual Groups",r.jsx(be,{className:"h-6 w-6 text-cyan-600"}),{border:"border-cyan-300",text:"text-cyan-700",bg:"bg-cyan-100",badge:"text-cyan-800"}),S.length>0&&p(S,v(S),"Team Groups",r.jsx(re,{className:"h-6 w-6 text-emerald-600"}),{border:"border-emerald-300",text:"text-emerald-700",bg:"bg-emerald-100",badge:"text-emerald-800"})]})}var K={},z={},X={},Q={},he;function ne(){if(he)return Q;he=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.Direction=void 0;var t;return(function(y){y.Right="to right",y.Left="to left",y.Down="to bottom",y.Up="to top"})(t||(Q.Direction=t={})),Q}var me;function we(){return me||(me=1,(function(t){var y=X&&X.__spreadArray||function(n,o,d){if(d||arguments.length===2)for(var x=0,T=o.length,D;x<T;x++)(D||!(x in o))&&(D||(D=Array.prototype.slice.call(o,0,x)),D[x]=o[x]);return n.concat(D||Array.prototype.slice.call(o))};Object.defineProperty(t,"__esModule",{value:!0}),t.isIOS=t.useThumbOverlap=t.assertUnreachable=t.voidFn=t.getTrackBackground=t.replaceAt=t.schd=t.translate=t.getClosestThumbIndex=t.translateThumbs=t.getPaddingAndBorder=t.getMargin=t.checkInitialOverlap=t.checkValuesAgainstBoundaries=t.checkBoundaries=t.isVertical=t.relativeValue=t.normalizeValue=t.isStepDivisible=t.isTouchEvent=t.getStepDecimals=void 0;var M=xe(),v=ne(),I=function(n){var o=n.toString().split(".")[1];return o?o.length:0};t.getStepDecimals=I;function S(n){return n.touches&&n.touches.length||n.changedTouches&&n.changedTouches.length}t.isTouchEvent=S;function p(n,o,d){var x=(o-n)/d,T=8,D=Number(x.toFixed(T));return parseInt(D.toString(),10)===D}t.isStepDivisible=p;function A(n,o,d,x,T,D,N){var k=1e11;if(n=Math.round(n*k)/k,!D){var Y=N[o-1],E=N[o+1];if(Y&&Y>n)return Y;if(E&&E<n)return E}if(n>x)return x;if(n<d)return d;var J=Math.floor(n*k-d*k)%Math.floor(T*k),U=Math.floor(n*k-Math.abs(J)),V=J===0?n:U/k,G=Math.abs(J/k)<T/2?V:V+T,B=(0,t.getStepDecimals)(T);return parseFloat(G.toFixed(B))}t.normalizeValue=A;function P(n,o,d){return(n-o)/(d-o)}t.relativeValue=P;function R(n){return n===v.Direction.Up||n===v.Direction.Down}t.isVertical=R;function _(n,o,d){if(o>=d)throw new RangeError("min (".concat(o,") is equal/bigger than max (").concat(d,")"));if(n<o)throw new RangeError("value (".concat(n,") is smaller than min (").concat(o,")"));if(n>d)throw new RangeError("value (".concat(n,") is bigger than max (").concat(d,")"))}t.checkBoundaries=_;function O(n,o,d){return n<o?o:n>d?d:n}t.checkValuesAgainstBoundaries=O;function m(n){if(!(n.length<2)&&!n.slice(1).every(function(o,d){return n[d]<=o}))throw new RangeError("values={[".concat(n,"]} needs to be sorted when allowOverlap={false}"))}t.checkInitialOverlap=m;function l(n){var o=window.getComputedStyle(n);return{top:parseInt(o["margin-top"],10),bottom:parseInt(o["margin-bottom"],10),left:parseInt(o["margin-left"],10),right:parseInt(o["margin-right"],10)}}t.getMargin=l;function e(n){var o=window.getComputedStyle(n);return{top:parseInt(o["padding-top"],10)+parseInt(o["border-top-width"],10),bottom:parseInt(o["padding-bottom"],10)+parseInt(o["border-bottom-width"],10),left:parseInt(o["padding-left"],10)+parseInt(o["border-left-width"],10),right:parseInt(o["padding-right"],10)+parseInt(o["border-right-width"],10)}}t.getPaddingAndBorder=e;function a(n,o,d){var x=d?-1:1;n.forEach(function(T,D){return h(T,x*o[D].x,o[D].y)})}t.translateThumbs=a;function i(n,o,d,x){for(var T=0,D=g(n[0],o,d,x),N=1;N<n.length;N++){var k=g(n[N],o,d,x);k<D&&(D=k,T=N)}return T}t.getClosestThumbIndex=i;function h(n,o,d){n.style.transform="translate(".concat(o,"px, ").concat(d,"px)")}t.translate=h;var f=function(n){var o=[],d=null,x=function(){for(var T=[],D=0;D<arguments.length;D++)T[D]=arguments[D];o=T,!d&&(d=requestAnimationFrame(function(){d=null,n.apply(void 0,o)}))};return x};t.schd=f;function j(n,o,d){var x=n.slice(0);return x[o]=d,x}t.replaceAt=j;function F(n){var o=n.values,d=n.colors,x=n.min,T=n.max,D=n.direction,N=D===void 0?v.Direction.Right:D,k=n.rtl,Y=k===void 0?!1:k;Y&&N===v.Direction.Right?N=v.Direction.Left:Y&&v.Direction.Left&&(N=v.Direction.Right);var E=o.slice(0).sort(function(U,V){return U-V}).map(function(U){return(U-x)/(T-x)*100}),J=E.reduce(function(U,V,G){return"".concat(U,", ").concat(d[G]," ").concat(V,"%, ").concat(d[G+1]," ").concat(V,"%")},"");return"linear-gradient(".concat(N,", ").concat(d[0]," 0%").concat(J,", ").concat(d[d.length-1]," 100%)")}t.getTrackBackground=F;function s(){}t.voidFn=s;function u(n){throw new Error("Didn't expect to get here")}t.assertUnreachable=u;var w=function(n,o,d,x,T){T===void 0&&(T=function(N){return N});var D=Math.ceil(y([n],Array.from(n.children),!0).reduce(function(N,k){var Y=Math.ceil(k.getBoundingClientRect().width);if(k.innerText&&k.innerText.includes(d)&&k.childElementCount===0){var E=k.cloneNode(!0);E.innerHTML=T(o.toFixed(x)),E.style.visibility="hidden",document.body.appendChild(E),Y=Math.ceil(E.getBoundingClientRect().width),document.body.removeChild(E)}return Y>N?Y:N},n.getBoundingClientRect().width));return D},b=function(n,o,d,x,T,D,N){N===void 0&&(N=function(E){return E});var k=[],Y=function(E){var J=w(d[E],x[E],T,D,N),U=o[E].x;o.forEach(function(V,G){var B=V.x,q=w(d[G],x[G],T,D,N);E!==G&&(U>=B&&U<=B+q||U+J>=B&&U+J<=B+q)&&(k.includes(G)||(k.push(E),k.push(G),k=y(y([],k,!0),[E,G],!1),Y(G)))})};return Y(n),Array.from(new Set(k.sort()))},c=function(n,o,d,x,T,D){x===void 0&&(x=.1),T===void 0&&(T=" - "),D===void 0&&(D=function(G){return G});var N=(0,t.getStepDecimals)(x),k=(0,M.useState)({}),Y=k[0],E=k[1],J=(0,M.useState)(D(o[d].toFixed(N))),U=J[0],V=J[1];return(0,M.useEffect)(function(){if(n){var G=n.getThumbs();if(G.length<1)return;var B={},q=n.getOffsets(),W=b(d,q,G,o,T,N,D),Z=D(o[d].toFixed(N));if(W.length){var ee=W.reduce(function(H,ie,ce,le){return H.length?y(y([],H,!0),[q[le[ce]].x],!1):[q[le[ce]].x]},[]);if(Math.min.apply(Math,ee)===q[d].x){var se=[];W.forEach(function(H){se.push(o[H].toFixed(N))}),Z=Array.from(new Set(se.sort(function(H,ie){return parseFloat(H)-parseFloat(ie)}))).map(D).join(T);var Ae=Math.min.apply(Math,ee),oe=Math.max.apply(Math,ee),Se=G[W[ee.indexOf(oe)]].getBoundingClientRect().width;B.left="".concat(Math.abs(Ae-(oe+Se))/2,"px"),B.transform="translate(-50%, 0)"}else B.visibility="hidden"}V(Z),E(B)}},[n,o]),[U,Y]};t.useThumbOverlap=c;function g(n,o,d,x){var T=n.getBoundingClientRect(),D=T.left,N=T.top,k=T.width,Y=T.height;return R(x)?Math.abs(d-(N+Y/2)):Math.abs(o-(D+k/2))}var C=function(){var n,o=((n=navigator.userAgentData)===null||n===void 0?void 0:n.platform)||navigator.platform;return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(o)||navigator.userAgent.includes("Mac")&&"ontouchend"in document};t.isIOS=C})(X)),X}var ge;function $e(){if(ge)return z;ge=1;var t=z&&z.__extends||(function(){var O=function(m,l){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])},O(m,l)};return function(m,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");O(m,l);function e(){this.constructor=m}m.prototype=l===null?Object.create(l):(e.prototype=l.prototype,new e)}})(),y=z&&z.__createBinding||(Object.create?(function(O,m,l,e){e===void 0&&(e=l);var a=Object.getOwnPropertyDescriptor(m,l);(!a||("get"in a?!m.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return m[l]}}),Object.defineProperty(O,e,a)}):(function(O,m,l,e){e===void 0&&(e=l),O[e]=m[l]})),M=z&&z.__setModuleDefault||(Object.create?(function(O,m){Object.defineProperty(O,"default",{enumerable:!0,value:m})}):function(O,m){O.default=m}),v=z&&z.__importStar||function(O){if(O&&O.__esModule)return O;var m={};if(O!=null)for(var l in O)l!=="default"&&Object.prototype.hasOwnProperty.call(O,l)&&y(m,O,l);return M(m,O),m},I=z&&z.__spreadArray||function(O,m,l){if(l||arguments.length===2)for(var e=0,a=m.length,i;e<a;e++)(i||!(e in m))&&(i||(i=Array.prototype.slice.call(m,0,e)),i[e]=m[e]);return O.concat(i||Array.prototype.slice.call(m))};Object.defineProperty(z,"__esModule",{value:!0});var S=v(xe()),p=we(),A=ne(),P=["ArrowRight","ArrowUp","k","PageUp"],R=["ArrowLeft","ArrowDown","j","PageDown"],_=(function(O){t(m,O);function m(l){var e=O.call(this,l)||this;if(e.trackRef=S.createRef(),e.thumbRefs=[],e.state={draggedTrackPos:[-1,-1],draggedThumbIndex:-1,thumbZIndexes:new Array(e.props.values.length).fill(0).map(function(a,i){return i}),isChanged:!1,markOffsets:[]},e.getOffsets=function(){var a=e.props,i=a.direction,h=a.values,f=a.min,j=a.max,F=e.trackRef.current;if(!F)return console.warn("No track element found."),[];var s=F.getBoundingClientRect(),u=(0,p.getPaddingAndBorder)(F);return e.getThumbs().map(function(w,b){var c={x:0,y:0},g=w.getBoundingClientRect(),C=(0,p.getMargin)(w);switch(i){case A.Direction.Right:return c.x=(C.left+u.left)*-1,c.y=((g.height-s.height)/2+u.top)*-1,c.x+=s.width*(0,p.relativeValue)(h[b],f,j)-g.width/2,c;case A.Direction.Left:return c.x=(C.right+u.right)*-1,c.y=((g.height-s.height)/2+u.top)*-1,c.x+=s.width-s.width*(0,p.relativeValue)(h[b],f,j)-g.width/2,c;case A.Direction.Up:return c.x=((g.width-s.width)/2+C.left+u.left)*-1,c.y=-u.left,c.y+=s.height-s.height*(0,p.relativeValue)(h[b],f,j)-g.height/2,c;case A.Direction.Down:return c.x=((g.width-s.width)/2+C.left+u.left)*-1,c.y=-u.left,c.y+=s.height*(0,p.relativeValue)(h[b],f,j)-g.height/2,c;default:return(0,p.assertUnreachable)(i)}})},e.getThumbs=function(){return e.trackRef&&e.trackRef.current?Array.from(e.trackRef.current.children).filter(function(a){return a.hasAttribute("aria-valuenow")}):(console.warn("No thumbs found in the track container. Did you forget to pass & spread the `props` param in renderTrack?"),[])},e.getTargetIndex=function(a){return e.getThumbs().findIndex(function(i){return i===a.target||i.contains(a.target)})},e.addTouchEvents=function(a){document.addEventListener("touchmove",e.schdOnTouchMove,{passive:!1}),document.addEventListener("touchend",e.schdOnEnd,{passive:!1}),document.addEventListener("touchcancel",e.schdOnEnd,{passive:!1})},e.addMouseEvents=function(a){document.addEventListener("mousemove",e.schdOnMouseMove),document.addEventListener("mouseup",e.schdOnEnd)},e.onMouseDownTrack=function(a){var i;if(!(a.button!==0||(0,p.isIOS)()))if(a.persist(),a.preventDefault(),e.addMouseEvents(a.nativeEvent),e.props.values.length>1&&e.props.draggableTrack){if(e.thumbRefs.some(function(f){var j;return(j=f.current)===null||j===void 0?void 0:j.contains(a.target)}))return;e.setState({draggedTrackPos:[a.clientX,a.clientY]},function(){return e.onMove(a.clientX,a.clientY)})}else{var h=(0,p.getClosestThumbIndex)(e.thumbRefs.map(function(f){return f.current}),a.clientX,a.clientY,e.props.direction);(i=e.thumbRefs[h].current)===null||i===void 0||i.focus(),e.setState({draggedThumbIndex:h},function(){return e.onMove(a.clientX,a.clientY)})}},e.onResize=function(){(0,p.translateThumbs)(e.getThumbs(),e.getOffsets(),e.props.rtl),e.calculateMarkOffsets()},e.onTouchStartTrack=function(a){var i;if(a.persist(),e.addTouchEvents(a.nativeEvent),e.props.values.length>1&&e.props.draggableTrack){if(e.thumbRefs.some(function(f){var j;return(j=f.current)===null||j===void 0?void 0:j.contains(a.target)}))return;e.setState({draggedTrackPos:[a.touches[0].clientX,a.touches[0].clientY]},function(){return e.onMove(a.touches[0].clientX,a.touches[0].clientY)})}else{var h=(0,p.getClosestThumbIndex)(e.thumbRefs.map(function(f){return f.current}),a.touches[0].clientX,a.touches[0].clientY,e.props.direction);(i=e.thumbRefs[h].current)===null||i===void 0||i.focus(),e.setState({draggedThumbIndex:h},function(){return e.onMove(a.touches[0].clientX,a.touches[0].clientY)})}},e.onMouseOrTouchStart=function(a){if(!e.props.disabled){var i=(0,p.isTouchEvent)(a);if(!(!i&&a.button!==0)){var h=e.getTargetIndex(a);h!==-1&&(i?e.addTouchEvents(a):e.addMouseEvents(a),e.setState({draggedThumbIndex:h,thumbZIndexes:e.state.thumbZIndexes.map(function(f,j){return j===h?Math.max.apply(Math,e.state.thumbZIndexes):f<=e.state.thumbZIndexes[h]?f:f-1})}))}}},e.onMouseMove=function(a){a.preventDefault(),e.onMove(a.clientX,a.clientY)},e.onTouchMove=function(a){a.preventDefault(),e.onMove(a.touches[0].clientX,a.touches[0].clientY)},e.onKeyDown=function(a){var i=e.props,h=i.values,f=i.onChange,j=i.step,F=i.rtl,s=i.direction,u=e.state.isChanged,w=e.getTargetIndex(a.nativeEvent),b=F||s===A.Direction.Left||s===A.Direction.Down?-1:1;w!==-1&&(P.includes(a.key)?(a.preventDefault(),e.setState({draggedThumbIndex:w,isChanged:!0}),f((0,p.replaceAt)(h,w,e.normalizeValue(h[w]+b*(a.key==="PageUp"?j*10:j),w)))):R.includes(a.key)?(a.preventDefault(),e.setState({draggedThumbIndex:w,isChanged:!0}),f((0,p.replaceAt)(h,w,e.normalizeValue(h[w]-b*(a.key==="PageDown"?j*10:j),w)))):a.key==="Tab"?e.setState({draggedThumbIndex:-1},function(){u&&e.fireOnFinalChange()}):u&&e.fireOnFinalChange())},e.onKeyUp=function(a){var i=e.state.isChanged;e.setState({draggedThumbIndex:-1},function(){i&&e.fireOnFinalChange()})},e.onMove=function(a,i){var h=e.state,f=h.draggedThumbIndex,j=h.draggedTrackPos,F=e.props,s=F.direction,u=F.min,w=F.max,b=F.onChange,c=F.values,g=F.step,C=F.rtl;if(f===-1&&j[0]===-1&&j[1]===-1)return null;var n=e.trackRef.current;if(!n)return null;var o=n.getBoundingClientRect(),d=(0,p.isVertical)(s)?o.height:o.width;if(j[0]!==-1&&j[1]!==-1){var x=a-j[0],T=i-j[1],D=0;switch(s){case A.Direction.Right:case A.Direction.Left:D=x/d*(w-u);break;case A.Direction.Down:case A.Direction.Up:D=T/d*(w-u);break;default:(0,p.assertUnreachable)(s)}if(C&&(D*=-1),Math.abs(D)>=g/2){for(var N=0;N<e.thumbRefs.length;N++){if(c[N]===w&&Math.sign(D)===1||c[N]===u&&Math.sign(D)===-1)return;var k=c[N]+D;k>w?D=w-c[N]:k<u&&(D=u-c[N])}for(var Y=c.slice(0),N=0;N<e.thumbRefs.length;N++)Y=(0,p.replaceAt)(Y,N,e.normalizeValue(c[N]+D,N));e.setState({draggedTrackPos:[a,i]}),b(Y)}}else{var E=0;switch(s){case A.Direction.Right:E=(a-o.left)/d*(w-u)+u;break;case A.Direction.Left:E=(d-(a-o.left))/d*(w-u)+u;break;case A.Direction.Down:E=(i-o.top)/d*(w-u)+u;break;case A.Direction.Up:E=(d-(i-o.top))/d*(w-u)+u;break;default:(0,p.assertUnreachable)(s)}C&&(E=w+u-E),Math.abs(c[f]-E)>=g/2&&b((0,p.replaceAt)(c,f,e.normalizeValue(E,f)))}},e.normalizeValue=function(a,i){var h=e.props,f=h.min,j=h.max,F=h.step,s=h.allowOverlap,u=h.values;return(0,p.normalizeValue)(a,i,f,j,F,s,u)},e.onEnd=function(a){if(a.preventDefault(),document.removeEventListener("mousemove",e.schdOnMouseMove),document.removeEventListener("touchmove",e.schdOnTouchMove),document.removeEventListener("mouseup",e.schdOnEnd),document.removeEventListener("touchend",e.schdOnEnd),document.removeEventListener("touchcancel",e.schdOnEnd),e.state.draggedThumbIndex===-1&&e.state.draggedTrackPos[0]===-1&&e.state.draggedTrackPos[1]===-1)return null;e.setState({draggedThumbIndex:-1,draggedTrackPos:[-1,-1]},function(){e.fireOnFinalChange()})},e.fireOnFinalChange=function(){e.setState({isChanged:!1});var a=e.props,i=a.onFinalChange,h=a.values;i&&i(h)},e.updateMarkRefs=function(a){if(!a.renderMark){e.numOfMarks=void 0,e.markRefs=void 0;return}e.numOfMarks=(a.max-a.min)/e.props.step,e.markRefs=[];for(var i=0;i<e.numOfMarks+1;i++)e.markRefs[i]=S.createRef()},e.calculateMarkOffsets=function(){if(!(!e.props.renderMark||!e.trackRef||!e.numOfMarks||!e.markRefs||e.trackRef.current===null)){for(var a=window.getComputedStyle(e.trackRef.current),i=parseInt(a.width,10),h=parseInt(a.height,10),f=parseInt(a.paddingLeft,10),j=parseInt(a.paddingTop,10),F=[],s=0;s<e.numOfMarks+1;s++){var u=9999,w=9999;if(e.markRefs[s].current){var b=e.markRefs[s].current.getBoundingClientRect();u=b.height,w=b.width}e.props.direction===A.Direction.Left||e.props.direction===A.Direction.Right?F.push([Math.round(i/e.numOfMarks*s+f-w/2),-Math.round((u-h)/2)]):F.push([Math.round(h/e.numOfMarks*s+j-u/2),-Math.round((w-i)/2)])}e.setState({markOffsets:F})}},l.step===0)throw new Error('"step" property should be a positive number');return e.schdOnMouseMove=(0,p.schd)(e.onMouseMove),e.schdOnTouchMove=(0,p.schd)(e.onTouchMove),e.schdOnEnd=(0,p.schd)(e.onEnd),e.thumbRefs=l.values.map(function(){return S.createRef()}),e.updateMarkRefs(l),e}return m.prototype.componentDidMount=function(){var l=this,e=this.props,a=e.values,i=e.min,h=e.step;this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(this.onResize):{observe:function(){return window.addEventListener("resize",l.onResize)},unobserve:function(){return window.removeEventListener("resize",l.onResize)}},document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart,{passive:!1}),!this.props.allowOverlap&&(0,p.checkInitialOverlap)(this.props.values),this.props.values.forEach(function(f){return(0,p.checkBoundaries)(f,l.props.min,l.props.max)}),this.resizeObserver.observe(this.trackRef.current),(0,p.translateThumbs)(this.getThumbs(),this.getOffsets(),this.props.rtl),this.calculateMarkOffsets(),a.forEach(function(f){(0,p.isStepDivisible)(i,f,h)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")})},m.prototype.componentDidUpdate=function(l,e){var a=this.props,i=a.max,h=a.min,f=a.step,j=a.values,F=a.rtl;(l.max!==i||l.min!==h||l.step!==f)&&this.updateMarkRefs(this.props),(0,p.translateThumbs)(this.getThumbs(),this.getOffsets(),F),(l.max!==i||l.min!==h||l.step!==f||e.markOffsets.length!==this.state.markOffsets.length)&&(this.calculateMarkOffsets(),j.forEach(function(s){(0,p.isStepDivisible)(h,s,f)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")}))},m.prototype.componentWillUnmount=function(){var l={passive:!1};document.removeEventListener("mousedown",this.onMouseOrTouchStart,l),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchend",this.schdOnEnd),this.resizeObserver.unobserve(this.trackRef.current)},m.prototype.render=function(){var l=this,e=this.props,a=e.label,i=e.labelledBy,h=e.renderTrack,f=e.renderThumb,j=e.renderMark,F=j===void 0?function(){return null}:j,s=e.values,u=e.min,w=e.max,b=e.allowOverlap,c=e.disabled,g=this.state,C=g.draggedThumbIndex,n=g.thumbZIndexes,o=g.markOffsets;return h({props:{style:{transform:"scale(1)",cursor:C>-1?"grabbing":this.props.draggableTrack?(0,p.isVertical)(this.props.direction)?"ns-resize":"ew-resize":s.length===1&&!c?"pointer":"inherit"},onMouseDown:c?p.voidFn:this.onMouseDownTrack,onTouchStart:c?p.voidFn:this.onTouchStartTrack,ref:this.trackRef},isDragged:this.state.draggedThumbIndex>-1,disabled:c,children:I(I([],o.map(function(d,x,T){return F({props:{style:l.props.direction===A.Direction.Left||l.props.direction===A.Direction.Right?{position:"absolute",left:"".concat(d[0],"px"),marginTop:"".concat(d[1],"px")}:{position:"absolute",top:"".concat(d[0],"px"),marginLeft:"".concat(d[1],"px")},key:"mark".concat(x),ref:l.markRefs[x]},index:x})}),!0),s.map(function(d,x){var T=l.state.draggedThumbIndex===x;return f({index:x,value:d,isDragged:T,props:{style:{position:"absolute",zIndex:n[x],cursor:c?"inherit":T?"grabbing":"grab",userSelect:"none",touchAction:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},key:x,tabIndex:c?void 0:0,"aria-valuemax":b?w:s[x+1]||w,"aria-valuemin":b?u:s[x-1]||u,"aria-valuenow":d,draggable:!1,ref:l.thumbRefs[x],"aria-label":a,"aria-labelledby":i,role:"slider",onKeyDown:c?p.voidFn:l.onKeyDown,onKeyUp:c?p.voidFn:l.onKeyUp}})}),!0)})},m.defaultProps={label:"Accessibility label",labelledBy:null,step:1,direction:A.Direction.Right,rtl:!1,disabled:!1,allowOverlap:!1,draggableTrack:!1,min:0,max:100},m})(S.Component);return z.default=_,z}var pe;function He(){return pe||(pe=1,(function(t){var y=K&&K.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkValuesAgainstBoundaries=t.relativeValue=t.useThumbOverlap=t.Direction=t.getTrackBackground=t.Range=void 0;var M=y($e());t.Range=M.default;var v=we();Object.defineProperty(t,"getTrackBackground",{enumerable:!0,get:function(){return v.getTrackBackground}}),Object.defineProperty(t,"useThumbOverlap",{enumerable:!0,get:function(){return v.useThumbOverlap}}),Object.defineProperty(t,"relativeValue",{enumerable:!0,get:function(){return v.relativeValue}}),Object.defineProperty(t,"checkValuesAgainstBoundaries",{enumerable:!0,get:function(){return v.checkValuesAgainstBoundaries}});var I=ne();Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return I.Direction}})})(K)),K}var fe=He();function ve({groups:t,participantType:y,onUpdate:M,colorScheme:v}){const[I,S]=L.useState([]),[p,A]=L.useState([]),P=0,R=99,_=e=>{const a=new Date(e),i=String(a.getDate()).padStart(2,"0"),h=String(a.getMonth()+1).padStart(2,"0"),f=a.getFullYear();return`${i}-${h}-${f}`};L.useEffect(()=>{if(t.length===0)return;const e=[...t].sort((h,f)=>h.AgeFrom-f.AgeFrom),a=[e[0].AgeFrom,...e.map(h=>h.AgeTo)];S(a);const i=e.map(()=>v.color);i.push("#d1d5db"),A(["#d1d5db",...i])},[t,v]);const O=e=>{S(e)},m=e=>{const i=[...t].sort((h,f)=>h.AgeFrom-f.AgeFrom).map((h,f)=>{const j=e[f],F=e[f+1];return{...h,AgeFrom:j,AgeTo:F}});M(i)};if(t.length===0||I.length===0)return null;const l=[...t].sort((e,a)=>e.AgeFrom-a.AgeFrom);return r.jsxs("div",{className:"mb-6 p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(Pe,{className:"h-5 w-5 text-gray-600"}),r.jsxs("h3",{className:`text-sm font-semibold ${v.text}`,children:[y," Groups Range"]}),r.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Drag boundaries to adjust)"})]}),r.jsxs("div",{className:"px-4",children:[r.jsx(fe.Range,{step:1,min:P,max:R,values:I,onChange:O,onFinalChange:m,renderTrack:({props:e,children:a})=>r.jsx("div",{...e,style:{...e.style,height:"36px",display:"flex",width:"100%"},children:r.jsx("div",{ref:e.ref,style:{height:"6px",width:"100%",borderRadius:"3px",background:fe.getTrackBackground({values:I,colors:p,min:P,max:R}),alignSelf:"center"},children:a})}),renderThumb:({props:e,index:a,isDragged:i})=>{const h=I[a];let f="",j="";if(a===0){f=`Start of ${l[0]?.GroupName||""}`;const F=new Date(l[0]?.MaxAgeDate);j=`Born: ${_(l[0]?.MaxAgeDate)} (${F.getFullYear()})`}else if(a<=l.length){const F=a-1;f=`End of ${l[F]?.GroupName||""}`;const s=new Date(l[F]?.MinAgeDate);j=`Born: ${_(l[F]?.MinAgeDate)} (${s.getFullYear()})`}return L.createElement("div",{...e,key:e.key,className:"group",style:{...e.style,height:"28px",width:"28px",borderRadius:"50%",backgroundColor:i?"#3b82f6":v.thumbColor,display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",cursor:"grab"}},r.jsx("div",{className:"text-xs font-bold text-white",children:h}),r.jsxs("div",{className:"absolute -top-16 bg-gray-800 text-white text-xs rounded px-2 py-1 whitespace-nowrap pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[f,r.jsx("br",{}),j]}))}}),r.jsxs("div",{className:"flex justify-between mt-3 text-xs text-gray-500",children:[r.jsx("span",{children:"0"}),r.jsx("span",{children:"25"}),r.jsx("span",{children:"50"}),r.jsx("span",{children:"75"}),r.jsx("span",{children:"99"})]}),r.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:l.map((e,a)=>{const i=I[a],h=I[a+1],f=new Date(e.MinAgeDate),j=new Date(e.MaxAgeDate),F=f.getFullYear(),s=j.getFullYear();return r.jsxs("div",{className:`rounded-lg px-3 py-2 ${v.bg} ${v.badge} text-xs font-medium`,children:[r.jsx("div",{className:"font-semibold",children:e.GroupName}),r.jsxs("div",{className:"text-xs opacity-80",children:["Age ",i,"-",h," (",s,"-",F,")"]})]},e.EventGroupId)})})]})]})}function yt(){const{eventDetails:t}=Te(),[y,M]=L.useState(null),[v,I]=L.useState(!1),{rows:S,update:p,delete:A,status:P}=je("/AgewiseGroupsJson/Get",{filter:{EventCategory:t?.EventCategory},updateUrl:"/AgewiseGroupsJson/Save",deleteUrl:"/AgewiseGroupsJson/Remove",limit:100,sort:{sortOrder:"ASC",sortColumn:"Order"},select:"EventGroupId,GroupName,AgeFrom,AgeTo,AgeStartDate,AgeStartMonth,AgeStartYear,Status,JsonSettings,Order,MinAgeDate,MaxAgeDate"});console.log("rows",S);const R=L.useMemo(()=>S?S.map(s=>{let u={ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No"};try{s.JsonSettings&&(u=JSON.parse(s.JsonSettings))}catch(w){console.error("Failed to parse JsonSettings:",w)}return{...s,parsedSettings:u}}):[],[S]),_=L.useMemo(()=>R.filter(s=>s.parsedSettings.ParticipantType==="Individual"||s.parsedSettings.ParticipantType==="Any").sort((s,u)=>(s.Order||0)-(u.Order||0)),[R]),O=L.useMemo(()=>R.filter(s=>s.parsedSettings.ParticipantType==="Team"||s.parsedSettings.ParticipantType==="Any").sort((s,u)=>(s.Order||0)-(u.Order||0)),[R]),m=s=>{const u=b=>{const c=b.parsedSettings.ParticipantType,g=b.parsedSettings.IsCommon==="Yes";return c==="Individual"&&!g?1:c==="Individual"&&g?2:c==="Team"&&!g?3:c==="Team"&&g?4:5};return[...s].sort((b,c)=>{const g=u(b)-u(c);return g!==0?g:(b.AgeFrom||0)-(c.AgeFrom||0)}).map((b,c)=>({...b,correctOrder:c+1}))},l=async(s,u=!1)=>{if(!s||s.length===0)return;const b=m(s).filter(g=>g.Order!==g.correctOrder);if(b.length===0)return;console.log("Auto-fixing incorrect orders for",b.length,"groups:",b.map(g=>({name:g.GroupName,currentOrder:g.Order,newOrder:g.correctOrder})));const c=b.map(g=>p({EventGroupId:g.EventGroupId,Order:g.correctOrder},!0).catch(C=>(console.error(`Failed to auto-update order for group "${g.GroupName}":`,C),null)));try{const C=(await Promise.all(c)).filter(n=>n!==null).length;!u&&C>0&&console.log(`Auto-fixed order for ${C} group(s)`)}catch(g){console.error("Group order auto-fix errors:",g)}},e=async()=>{if(!R||R.length===0){$.error("No groups available to reorder");return}const s=m(R),u=[];if(s.forEach(b=>{b.Order!==b.correctOrder&&u.push({EventGroupId:b.EventGroupId,GroupName:b.GroupName,currentOrder:b.Order,newOrder:b.correctOrder})}),u.length===0){$.success("All groups are already in correct order");return}console.log("Groups needing order update:",u);const w=u.map(b=>p({EventGroupId:b.EventGroupId,Order:b.newOrder}).catch(c=>{throw console.error(`Failed to update order for group "${b.GroupName}":`,c),c}));try{await Promise.all(w),$.success(`Successfully updated order for ${u.length} group(s)`)}catch(b){$.error("Some group orders failed to update. Check console for details."),console.error("Group order update errors:",b)}},a=s=>{const u=[],w=c=>{const g=String(c.getDate()).padStart(2,"0"),C=String(c.getMonth()+1).padStart(2,"0"),n=c.getFullYear();return`${g}-${C}-${n}`},b=s.map(c=>{const g=new Date(c.AgeStartYear,c.AgeStartMonth-1,c.AgeStartDate),C=new Date(g);C.setFullYear(C.getFullYear()-c.AgeTo),C.setDate(C.getDate()+1);const n=new Date(g);return n.setFullYear(n.getFullYear()-c.AgeFrom+1),{...c,minBirthDate:C,maxBirthDate:n,minBirthDateStr:w(C),maxBirthDateStr:w(n)}});for(let c=0;c<b.length-1;c++){const g=b[c],C=b[c+1],n=new Date(C.maxBirthDate);n.setDate(n.getDate()+1);const o=new Date(g.minBirthDate);if(o.setDate(o.getDate()-1),n<=o){const d=new Date(g.AgeStartYear,g.AgeStartMonth-1,g.AgeStartDate),x=Math.floor((d-o)/(365.25*24*60*60*1e3)),T=Math.ceil((d-n)/(365.25*24*60*60*1e3));u.push({afterIndex:c,missingAges:x===T?`Age ${x}`:`Age ${x}-${T}`,dateFrom:w(n),dateTo:w(o)})}}return u},i=async s=>{try{const[u,w,b]=(s.BirthDateTo||"1-1-2020").split("-"),[c,g,C]=(s.BirthDateFrom||"31-12-2024").split("-"),n=new Date().getFullYear(),o=new Date(n,parseInt(g)-1,parseInt(c)),d=n-parseInt(C),x=n-parseInt(b),T=new Date(parseInt(b),parseInt(w)-1,parseInt(u)),D=new Date(parseInt(C),parseInt(g)-1,parseInt(c)),N=R.find(B=>{if(s.EventGroupId&&B.EventGroupId===s.EventGroupId||B.parsedSettings.ParticipantType!==s.ParticipantType||B.parsedSettings.IsCommon!==s.IsCommon)return!1;const q=new Date(B.AgeStartYear-B.AgeTo,B.AgeStartMonth-1,B.AgeStartDate),W=new Date(B.AgeStartYear-B.AgeFrom,B.AgeStartMonth-1,B.AgeStartDate);return T<=W&&D>=q});if(N){$.error(`Date range overlaps with existing group "${N.GroupName}". Please adjust the dates to avoid overlap within the same Participant Type and Common Group status.`);return}const k={EventGroupId:s.EventGroupId||0,EventCategory:t?.EventCategory,GroupName:s.GroupName,AgeFrom:d,AgeTo:x,AgeStartDate:o.getDate(),AgeStartMonth:o.getMonth()+1,AgeStartYear:o.getFullYear(),Status:1,Order:s.Order||(S?.length||0)+1,JsonSettings:JSON.stringify({ParticipantType:s.ParticipantType,IsCommon:s.IsCommon,NoAgeIdPrefix:s.NoAgeIdPrefix}),BirthDateFrom:s.BirthDateFrom,BirthDateTo:s.BirthDateTo},Y=await p(k,!1,!0),[E,J,U,V]=Y,G=Array.isArray(V)&&V.length>0?V[0]:null;if(G){console.log("Latest data after save:",G);const B=G.map(q=>{let W={ParticipantType:"Any",IsCommon:"No",NoAgeIdPrefix:"No"};try{q.JsonSettings&&(W=JSON.parse(q.JsonSettings))}catch(Z){console.error("Failed to parse JsonSettings:",Z)}return{...q,parsedSettings:W}});await l(B,!0)}$.success(y?"Group updated successfully":"Group added successfully"),M(null),I(!1)}catch(u){$.error("Failed to save group"),console.error(u)}},h=async s=>{if(window.confirm("Are you sure you want to delete this age group?"))try{const u=await A({EventGroupId:s}),[w,b,c]=u;setTimeout(async()=>{try{const g=R.filter(C=>C.EventGroupId!==s);g.length>0&&await l(g,!0)}catch(g){console.error("Failed to auto-fix orders after delete:",g)}},1e3),$.success("Group deleted successfully")}catch{$.error("Failed to delete group")}},f=s=>{let u="",w="";if(s.AgeFrom&&s.AgeTo&&s.AgeStartYear&&s.AgeStartMonth&&s.AgeStartDate)try{const c=new Date(s.AgeStartYear,s.AgeStartMonth-1,s.AgeStartDate),g=new Date(c);g.setFullYear(g.getFullYear()-s.AgeTo),g.setDate(g.getDate()+1);const C=o=>{const d=String(o.getDate()).padStart(2,"0"),x=String(o.getMonth()+1).padStart(2,"0"),T=o.getFullYear();return`${d}-${x}-${T}`};w=C(g);const n=new Date(c);n.setFullYear(n.getFullYear()-s.AgeFrom+1),u=C(n)}catch(c){console.error("Error calculating birth dates for editing:",c)}const b={...s,BirthDateFrom:s.BirthDateFrom||u,BirthDateTo:s.BirthDateTo||w};M(b),I(!0)},j=()=>{M(null),I(!1)},F=[{title:"New Page",path:te("/SetUp/ManageGroups")},{title:"Old Page",path:te("/SetUp/ManageGroupsOld")},{title:"Old Table View",path:te("/AgewiseGroups/Manage")}];return r.jsx(Me,{tabs:F,children:r.jsx(Ne,{children:r.jsxs("div",{className:"flex flex-col grow",children:[r.jsx(Oe,{heading:"Age Groups Setup",subHeading:"Manage participant age categories and groups",rightChildren:r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>I(!v),className:"inline-flex items-center gap-x-2 rounded-lg bg-gradient-to-r from-primary to-darkprimary px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200",children:[r.jsx(Ce,{className:"h-5 w-5"}),v?"Cancel":"Add New Group"]}),r.jsxs("button",{onClick:e,disabled:P==="loading",className:"inline-flex items-center gap-x-2 rounded-lg bg-emerald-600 px-5 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200 disabled:bg-surfaceVariant disabled:scale-100",children:[r.jsx(Ee,{className:"h-5 w-5"}),"Fix Order"]})]})}),v&&r.jsx(ze,{editingGroup:y,existingGroups:R,onSubmit:i,onCancel:j,open:v}),r.jsx("div",{className:"bg-surface border border-primary/20 rounded-xl p-5 mb-6 shadow-sm",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"bg-blue-100 rounded-lg p-2 flex-shrink-0",children:r.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-onSurface mb-1",children:"Quick Guide"}),r.jsx("p",{className:"text-sm text-onSurfaceVariant leading-relaxed mb-2",children:"Organize participants into age-based groups. Groups are automatically ordered by priority (Individual → Team → Any) and age range."}),r.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-onSurfaceVariant",children:[r.jsx("li",{children:"Cyan badges represent Individual participants, Emerald for Teams, Indigo for Any type"}),r.jsx("li",{children:"Red dashed gaps indicate missing age ranges between groups"}),r.jsx("li",{children:'Use "Fix Order" button to manually reorder groups when needed'})]})]})]})}),P==="loading"&&r.jsx("div",{className:"text-center py-8 text-onSurfaceVariant",children:"Loading groups..."}),P==="error"&&r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-red-500",children:"Error loading age groups. Please try refreshing the page."})}),(P==="success"||P==="finished")&&(!S||S.length===0)&&r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-onSurfaceVariant",children:'No age groups found. Click "Add New Group" to get started.'})}),(P==="success"||P==="finished")&&S&&S.length>0&&r.jsxs(r.Fragment,{children:[_.length>0&&r.jsx(ve,{groups:_,participantType:"Individual",onUpdate:s=>s.forEach(u=>p(u)),colorScheme:{border:"border-cyan-300",text:"text-cyan-700",bg:"bg-cyan-100",badge:"text-cyan-800",color:"#06b6d4",thumbColor:"#0891b2"}}),O.length>0&&r.jsx(ve,{groups:O,participantType:"Team",onUpdate:s=>s.forEach(u=>p(u)),colorScheme:{border:"border-emerald-300",text:"text-emerald-700",bg:"bg-emerald-100",badge:"text-emerald-800",color:"#10b981",thumbColor:"#059669"}}),r.jsx(We,{groups:R,onEdit:f,onDelete:h,detectGaps:a})]}),r.jsx("div",{className:"mt-8 pt-6 border-t border-border",children:r.jsxs("p",{className:"text-xs text-onSurfaceVariant",children:[r.jsx("strong",{className:"text-primary",children:"What's next?"})," ",r.jsx("a",{href:"/SetUp/ManageCompetitionItems",className:"underline hover:text-primary",children:"Add Competition Items"})," ","|"," ",r.jsx("a",{href:"/CompetitionStructure/Tab",className:"underline hover:text-primary",children:"Assign Competitions to Groups"})," ","|"," ",r.jsx("a",{href:"/Coordinator/ManageBulkParticipants",className:"underline hover:text-primary",children:"Add Participants"})]})})]})})})}export{yt as default};
