import{r as a,j as i,L as Q,_ as s}from"./mainweb-CU-zeN0-.js";import{a as W}from"./index-BtuGy7By.js";import I from"./textBox-48D8ZCSp.js";import{p as V,a as X}from"./httpService-BePN5U0C.js";import{c as Y}from"./utilities-CN4lTu6a.js";import"./validationMessage-D_C0RJFy.js";import"./EyeIcon-KP1cmLGn.js";import"./ChatBubbleBottomCenterTextIcon-BcHG5QYS.js";const Pe=({fieldName:w,label:R,placeholder:k,errors:p,register:O,formData:T,optional:D,maxLength:j,onChange:g,type:C,pattern:L,minLength:F,autocomplete:A,step:Z,disabled:ee,max:te,labelFont:se,noLabel:ae})=>{const[E,l]=a.useState(!1),[o,B]=a.useState(""),[u,G]=a.useState(!1),[d,v]=a.useState(!1),[le,x]=a.useState(!1),[h,n]=a.useState(!1),[re,N]=a.useState(!1),[ie,J]=a.useState(""),[f,c]=a.useState(!1),[b,m]=a.useState(!1),[oe,y]=a.useState(""),U="/PublicJson/GetUserCheck",$="/PublicJson/UsersActivation",_=X+"/PublicJson/GetOTPCheck",S=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),P=e=>e.length===6&&/^\d{6}$/.test(e);a.useEffect(()=>{const e=setTimeout(()=>{J(o)},500);return()=>{clearTimeout(e)}},[o]);let q=()=>{const e={Email:o};return l(!0),V(U,e).then(t=>(l(!1),t.data===!0?(c(!0),s.error("This email ID is already registered. Please enter a different email ID."),!1):(c(!1),!0))).catch(t=>{l(!1),console.error("Error checking user:",t),c(!1),s.error("Error checking user, please try again.")})};const z=e=>{const t=e.target.value;t!==o&&(n(!1),c(!1),B(t),x(!1),G(S(t)),v(!1),m(!1)),console.log("newEmail",t),g("email",e.target.value)},H=async()=>{let e=await q();if(e)if(S(o)&&e){n(!0),s.success("OTP button will activate in 30 seconds."),setTimeout(()=>{n(!1)},3e4);const t={Email:o};l(!0),V($,t).then(r=>{r.data.Results!=="Send mail success"?(c(!0),s.error(r.data.Results),n(!1)):(s.success("OTP sent successfully. Please check your email inbox. If you don't see the email, please check your spam folder."),console.log("OTP sent successfully:",r.data),v(!0),x(!0)),l(!1)}).catch(r=>{l(!1),console.error("Error sending OTP:",r),s.error("Failed to send OTP, please try again."),n(!1)})}else s.error("Please enter a valid email address.")},K=e=>{e&&(P(e)?(l(!0),W.post(_,{Email:o,OTP:e},{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{l(!1),t.data===!0?(m(!0),g("otp",e),s.success("OTP is valid.")):(g("otp",""),s.error("OTP is not valid."),y(""),m(!1))}).catch(t=>{l(!1),console.error("Error validating OTP:",t),s.error("Invalid OTP. Please try again."),m(!1)})):s.error("Please enter a valid 6-digit OTP."))},M=e=>{if(!P(e.target.value))return;const r=e.target.value;y(r),N(P(r)),K(r)};return console.log("isEmailValid",u),console.log("isEmailRegistered",f),console.log("isOTPSent",d),console.log("isButtonDisabled",h),i.jsxs(i.Fragment,{children:[E&&i.jsx(Q,{isLoading:E}),i.jsxs("div",{class:"flex flex-col",children:[i.jsx(I,{fieldName:w,label:R,placeholder:k,errors:p,register:O,formData:T,optional:D,maxLength:j,onChange:z,type:C,validate:e=>d?f?(s.error("This email ID is already registered. Please enter a different email ID or login with this email ID."),!1):u?!0:(s.error("Please enter a valid email address."),!1):(s.error("Please click on Get OTP via Email button to get OTP."),!1),pattern:L,minLength:F,autocomplete:A,readOnly:!1}),!b&&i.jsx("button",{disabled:!u||f||h,onClick:H,type:"button",className:Y(u&&!f&&!h?"w-full my-2 py-2 px-4 bg-green-600 text-white rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500":"w-full my-2 py-2 px-4 bg-gray-400 text-white rounded-md shadow-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500"),children:d?"Resend OTP via Email":"Get OTP via Email"}),d&&i.jsx("div",{className:"pt-4",children:i.jsx(I,{fieldName:"otp",label:"Enter the OTP",placeholder:"Enter OTP sent to your email",errors:p,register:O,formData:T,optional:!1,maxLength:6,validate:()=>b?!0:(s.error("Please enter a valid OTP."),!1),minLength:6,onChange:M,type:"text",pattern:/^\d{6}$/,autocomplete:"off"})})]})]})};export{Pe as default};
