import{p as xe,r as z,j as t,R as Ce,b as be,_ as A}from"./mainweb-DZ9ihk43.js";import{M as ye}from"./index.modern-Bho146_i.js";import{c as te}from"./utilities-CN4lTu6a.js";import{u as Ne}from"./index.esm-WAowWSBm.js";import{p as he}from"./httpService-Qkd6BQtv.js";import{B as Fe}from"./box--jFvvjrM.js";import{F as Ie}from"./PencilIcon-C-PBjtb3.js";import{F as we}from"./XMarkIcon-BOqc1NjK.js";import{F as ve}from"./CheckIcon-SXkE3hTW.js";import{F as ke}from"./PlusIcon-DOqkhzYs.js";import{u as Re}from"./useBackend-__X6qeZD.js";import"./index-t--hEgTQ.js";const Pe=Ce.lazy(()=>be(()=>import("./renderComponents-ChBgnzPE.js"),[]));function Ee({item:$,competitionStructureId:Z,eventDetails:N,participantsList:L,formData:E,participantId:D,candidateId:s}){const{register:F,control:K,errors:w,handleSubmit:ie,setValue:v,getValues:G}=Ne({defaultValues:{customCompetitionFields:[]}});console.log("CustomCompetitionFields",{item:$,eventDetails:N,register:F,errors:w,control:K,setValue:v,getValues:G,formData:E,participantId:D,candidateId:s});let M=L.find(i=>i.CandidateId==s&&i.Competition==Z);const f=xe($==null?void 0:$.JsonSettings),le=(f==null?void 0:f.AdditionalTextFieldsForPubRegForm)||[],J=(f==null?void 0:f.AdditionalTextFieldsMaxLength)||1/0,H=(f==null?void 0:f.AdditionalTextFieldsMinLength)||1;console.log("participantDetails",{participantDetails:M});let O=xe(M==null?void 0:M.JsonSettings),h=(O==null?void 0:O.customCompetitionFields)||[];const j=le.map(i=>{var r,p;return{key:i.FieldName.replace(/\s+/g,"_").toLowerCase(),label:i.FieldName,name:`customCompetitionFields[0].${i.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:((r=i.FieldType)==null?void 0:r.toLowerCase())||"text",isRequired:((p=i.IsRequired)==null?void 0:p.toLowerCase())==="yes",conditions:[],options:[],placeholder:"",defaultValue:""}}),[C,T]=z.useState([{id:Date.now(),values:{},fields:[...j],disabled:!1}]);z.useEffect(()=>{if(h.length>0){let i=[],r=h.map((p,b)=>{console.log("row",{row:p,index:b});let m={},k={};return j.forEach(a=>{m[`customCompetitionFields[${b}].${a.key}`]=p==null?void 0:p[a.key],k[a.key]=p==null?void 0:p[a.key]}),i.push(k),{id:Date.now()+b,values:m,fields:j.map(a=>({...a,name:`customCompetitionFields[${b}].${a.key}`})),disabled:!0}});v("customCompetitionFields",i),T(r)}},[]);const q=()=>{if(C.length>=J){A.error(`You can add a maximum of ${J} rows.`);return}T(i=>[...i,{id:Date.now(),values:{},fields:j.map(r=>({...r,name:`customCompetitionFields[${i.length}].${r.key}`})),disabled:!1}])},Q=async i=>{var U;let r=G();console.log("values",{values:r});let{candidate:p,customCompetitionFields:b}=r,m=C.findIndex(S=>S.id===i);const k=b[m];if(j.filter(S=>S.isRequired&&!k.values[S.name]).length>0){A.error("Please fill all required fields before adding a new row.");return}try{let S=(U=L.find(B=>B.CandidateId==s&&B.Competition==Z))==null?void 0:U.ParticipantId;if(!S){A.error("Participant ID not found.");return}let ee=await he("/CandidateJson/UpdateParticipantJson",{participantId:S,candidateId:E==null?void 0:E.candidate,JsonSettings:JSON.stringify(r)});console.log("API response:",ee),A.success("Data saved successfully!");let W=C[m];W.disabled=!0,j.forEach(B=>{W.values[`customCompetitionFields[${m}].${B.key}`]=k[B.key]}),T([...C])}catch(S){console.error("Error updating participant JSON:",S),A.error("Failed to save data.")}},u=i=>{T(r=>r.map(p=>p.id===i?{...p,disabled:!1}:p))},V=i=>{if(C.length<=H){A.error(`You must have at least ${H} rows.`);return}T(a=>a.filter(U=>U.id!==i));let r=G(),{candidate:p,customCompetitionFields:b}=r,m=C.findIndex(a=>a.id===i);b.splice(m,1),v("customCompetitionFields",b),console.log("customCompetitionFields",{customCompetitionFields:b}),console.log("values",{values:r});let k=M==null?void 0:M.ParticipantId;if(!k){A.error("Participant ID not found.");return}he("/CandidateJson/UpdateParticipantJson",{participantId:k,candidateId:E==null?void 0:E.candidate,JsonSettings:JSON.stringify(r)}).then(a=>{console.log("API response:",a),A.success("Data deleted successfully!")}).catch(a=>{console.error("Error updating participant JSON:",a),A.error("Failed to delete data.")})};let Y=j.map(i=>i.label).join(", "),n=Y.lastIndexOf(",");return n>-1&&(Y=Y.substring(0,n)+" and"+Y.substring(n)),console.log("fieldRows",{fieldRows:C}),console.log("getValues",{getValues:G()}),j.length>0&&M&&t.jsx(Fe,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:"Please fill some additional inputs here, fields are "+Y+" and minimum "+H+" and maximum "+J+" rows if items are required.",headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:"Additional Inputs",children:t.jsxs("div",{className:"flex flex-col flex-grow",children:[C.map(i=>t.jsxs("div",{className:"flex flex-row gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[t.jsx(Pe,{singleRow:!0,eventDetails:N,components:i.fields,errors:w,register:F,handleSelect:()=>{},control:K,setValue:v,getValues:G,formData:i.values,isSubmitted:i.disabled,onChangeValue:(r,p)=>{T(b=>b.map(m=>m.id===i.id?{...m,values:{...m.values,[r]:p}}:m))}},i.id),t.jsx("div",{className:"flex items-baseline gap-x-2 print:hidden",children:i.disabled?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>u(i.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:t.jsx(Ie,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+i.id),t.jsx("button",{type:"button",onClick:()=>V(i.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:t.jsx(we,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+i.id)]}):t.jsx("button",{type:"button",onClick:()=>Q(i.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:t.jsx(ve,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+i.id)})]},i.id)),C.length<J&&t.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:t.jsx("button",{type:"button",onClick:q,disabled:C.length>=J,className:`rounded-full p-1.5 text-white shadow-sm ${C.length>=J?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:t.jsx(ke,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const Ve=({fieldName:$,label:Z,errors:N,isGroupMandatory:L,participantType:E,setValue:D,formData:s,eventDetails:F,competitions:K,participantsList:w,onChange:ie,disabled:v,register:G,control:M})=>{var ee,W,B,se,ne,de,re,ae,ce,ue,pe,me;const{rows:f}=Re("/CandidateJson/GetByAge",{sort:{sortOrder:"DESC",sortColumn:"id"},filter:{ParticipantType:(s==null?void 0:s.participantType)=="Individual"?1:(s==null?void 0:s.participantType)=="Team"?2:0,DobString:s==null?void 0:s.userDobString},doCache:!0,select:"AgeFrom,AgeTo,EventGroupId,GroupName,Status"});console.log({competitions:K,ageWiseGroup:f});let le=N==null?void 0:N[$],[J,H]=z.useState(le);z.useEffect(()=>{H(N==null?void 0:N[$])},[N==null?void 0:N[$]]);let O=(w==null?void 0:w.map(e=>e.Competition))??[],[h,j]=z.useState(O);v&&(h=O);let C=O.join(",");z.useEffect(()=>{C&&O.length>0&&j(O)},[C]);let T=function(e){e.forEach(l=>{let d=`competitionCheckBox_${l.Competition}`,g=document.querySelector(`input[name='${d}']`);g&&(g.checked=!0,ie&&D(d,!0))})};z.useEffect(()=>{(w==null?void 0:w.length)>0&&T(w)},[w]);var q=f==null?void 0:f.filter(e=>{let l=e.JsonSettings;return!!(l&&(l=JSON.parse(l),(l==null?void 0:l.IsCommon)=="Yes"))});let Q=q==null?void 0:q.map(e=>e.EventGroupId),u=K??[];if(s!=null&&s.group||L)u=u.filter(e=>v&&!h.find(l=>l==e.CompetitionStructureId)?!1:!!(e.Group==(s==null?void 0:s.group)||Q!=null&&Q.find(l=>l==e.Group)));else{let e=[];u=u.filter(l=>!(e.find(d=>d.Title==l.Title)||(e.push(l),v&&!h.find(d=>d==l.CompetitionStructureId)))),u=e}s!=null&&s.gender&&(u=u.filter(e=>{if((s==null?void 0:s.gender)=="Male"){if(e.Gender==1||e.Gender==3)return!0}else if((s==null?void 0:s.gender)=="Female"){if(e.Gender==2||e.Gender==3)return!0}else return!0;return!1}));const V=[],Y=(e,l)=>{l.target.checked?h=[...h,e]:h=h.filter(g=>g!==e),j(h),ie(h)};let n=JSON.parse((F==null?void 0:F.JsonSettings)??"{}"),i=10;E=="Individual"?i=((ee=n==null?void 0:n.AdditionalSettings)==null?void 0:ee.MaximumParticipationPerCandidate)??10:i=((W=n==null?void 0:n.AdditionalSettings)==null?void 0:W.MaximumParticipationPerGroup)??10;let r=((B=n==null?void 0:n.AdditionalSettings)==null?void 0:B.FeesCurrency)??"USD",p=((se=n==null?void 0:n.AdditionalSettings)==null?void 0:se.EnablePublicAndPrivateRegistration)=="Yes",b=((ne=n==null?void 0:n.AdditionalSettings)==null?void 0:ne.UsePublicAndPrivateRegistrationByRegId)=="Yes",m=((de=n==null?void 0:n.AdditionalSettings)==null?void 0:de.CustomMaxParticipationPerCandidate)??[];if(console.log("customMaxSettings",m),u.length>0&&p&&!v)if(b){let e=n==null?void 0:n.AdditionalSettings;console.log({jsonSettings:n});let l=(ae=(re=n==null?void 0:n.components)==null?void 0:re.User)==null?void 0:ae.find(x=>x.type=="RegistrationIdBox");console.log({registrationBox:l});let d=e==null?void 0:e.EligibleRegistrationNumbers,g=d==null?void 0:d.find(x=>x.RegistrationNumber==(s==null?void 0:s.registrationId)),_=!1;if(l!=null&&l.conditions){let x=!0;for(let o=0;o<l.conditions.length;o++){let R=l.conditions[o],I=((ue=(ce=R.key)==null?void 0:ce.charAt(0))==null?void 0:ue.toLowerCase())+((pe=R.key)==null?void 0:pe.slice(1)),P=s[I];if((P==null?void 0:P.toString())!=((me=R.value)==null?void 0:me.toString())){x=!1;break}}x?_=!0:_=!1}else _=!0;g&&_||(u=u.filter(x=>{if(x.AllowPublicRegistration=="1")return!0}))}else u=u.filter(e=>{if(e.AllowPublicRegistration=="1")return!0});let k=h.filter(e=>u.find(l=>l.CompetitionStructureId==e)),a=(k==null?void 0:k.length)>=i;m.length>0&&E=="Individual"&&(a=!1);const U=[...new Set(u.map(e=>e.CompetitionCategoryName))],S=u.reduce((e,l)=>e.find(g=>g.CompetitionName===l.CompetitionName)?e:e.concat([l]),[]);return console.log("uniqueCategories",U),U.forEach(e=>{let l=S.filter(x=>x.CompetitionCategoryName==e),d={};if(d.CategoryName=e,d.CompetitionNames=[],l.forEach(x=>{let o=u.filter(I=>I.CompetitionCategoryName==e&&I.CompetitionName==x.CompetitionName),R={};R.CompetitionName=x.CompetitionName,R.competitions=o,d.CompetitionNames.push(R)}),m.length>0){let x=m.filter(y=>{var c;return(c=y.CompetitionCategoryId)==null?void 0:c.startsWith(e)});console.log("matchingCategories",x);let o=m.find(y=>y.CompetitionCategoryId==e);console.log("currentCategoryMax",o);let R=u.filter(y=>x.find(c=>c.CompetitionCategoryId==y.CompetitionCategoryName));console.log("items",R);var g=h.filter(y=>R.find(c=>c.CompetitionStructureId==y));console.log("filteredItemsInCategory",g);let I=g.length>=(o==null?void 0:o.MaxParticipation);if(console.log("isExceeded",I),I&&(d.isExceeded=I,d.MaxParticipation=(o==null?void 0:o.MaxParticipation)??1),e.split("-").length>1){let y=e.split(" - ")[0],c=m.find(X=>X.CompetitionCategoryId==y),ge=u.filter(X=>c.CompetitionCategoryId==X.CompetitionCategoryName);console.log("parentItems",ge);var _=h.filter(X=>ge.find(fe=>fe.CompetitionStructureId==X));console.log("filteredParentItemsInCategory",_);let oe=_.length+g.length>=(c==null?void 0:c.MaxParticipation);console.log("isParentExceeded",oe),oe&&(d.isExceeded=oe,d.MaxParticipation=(c==null?void 0:c.MaxParticipation)??1)}}V.push(d)}),console.log("competitionItems",K),t.jsxs("div",{className:"mt-4  print:mt-0",children:[!v&&t.jsx("label",{htmlFor:$,className:te("block text-sm font-medium leading-6 ",J?"text-danger":"text-gray-900"),children:Z||$}),t.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[V.length==0&&t.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}),a&&t.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:t.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",i," competition per ",E=="Individual"?"candidate":"team","."]})}),V==null?void 0:V.map((e,l)=>{var d;return t.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[t.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:t.jsxs("div",{className:"flex flex-wrap items-baseline",children:[t.jsx("h3",{className:"mt-1 text-2xl  print:text-lg font-semibold leading-6 text-blue-800",children:e.CategoryName}),t.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Programs"})]})}),t.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:(d=e.CompetitionNames)==null?void 0:d.map((g,_)=>{var x;return t.jsxs("div",{children:[t.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:t.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[t.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:g.CompetitionName}),t.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),t.jsx("div",{className:"mt-2 flex flex-wrap",children:(x=g.competitions)==null?void 0:x.map((o,R)=>{let I=h.find(c=>c==o.CompetitionStructureId)!=null,P=!!(v||!I&&a);e.isExceeded&&!I&&(P=!0);let y=q==null?void 0:q.find(c=>c.EventGroupId==o.Group);return console.log("item",o),console.log("item2",g),console.log("item3",e),t.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[t.jsx("div",{className:"flex gap-3",children:t.jsxs("label",{onClick:c=>{if((a||e.isExceeded)&&P){e.isExceeded?A.error("You can't select more than "+e.MaxParticipation+" competitions from "+e.CategoryName):A.error("You can select maximum "+i+" competitions only");return}},className:te(P?"":"ml-2","block text-sm text-gray-900"),children:[!P&&t.jsx("input",{type:"checkbox",id:`competitionCheckBox_${o.CompetitionStructureId}`,className:te(" h-5 w-5 optiontext-darkprimary ",J?"border-red-300  text-red-600 focus:ring-red-800":P?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:P,fieldName:`competitionCheckBox_${o.CompetitionStructureId}`,checked:I,onChange:c=>{Y(o.CompetitionStructureId,c)}},R),P&&!I&&t.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),t.jsxs("span",{className:"hidden print:flex",children:[(F==null?void 0:F.AllowDisplayCompetitionOrder)==1?o.CompetitionOrder+" - ":""," ",o.Title]}),t.jsxs("span",{className:te(v?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(J?"text-danger":"text-gray-900")),children:[((F==null?void 0:F.AllowDisplayCompetitionOrder)==1?o.CompetitionOrder+" - ":"")+(o.Title.replace(g.CompetitionName,"").replace(/ /gi,"").trim()!==""?o.Title.replace(g.CompetitionName,"").trim():g.CompetitionName.trim()),t.jsx("b",{className:"text-[10px] text-purple-800",children:y?" - "+(y==null?void 0:y.GroupName):""})]})]})}),t.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:(o==null?void 0:o.Remarks)&&t.jsx(ye,{children:o.Remarks})}),o.Fees>0&&t.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:t.jsxs("b",{children:["Fees:",t.jsxs("i",{className:"text-green-700 font-medium",children:[" ",o.Fees,r]})]})}),t.jsx(Ee,{eventDetails:F,item:o,competitionStructureId:o.CompetitionStructureId,candidateId:o.CandidateId,register:G,errors:N,control:M,participantsList:w,setValue:D,getValues:null,setFormData1:()=>{},formData:s})]},l+"_"+_+"_"+o.CompetitionStructureId)})})]},l+"_"+_)})})]},l)})]})]})};export{Ve as default};
