import{r as o,j as e,p as ee,L as B,R as _,b as J}from"./mainweb-DLytOzeA.js";import{B as te}from"./box-CSre7cpv.js";import{u as le}from"./useConfirmation-DntyYy5X.js";import{c as O}from"./utilities-CN4lTu6a.js";import{F as ae}from"./ShareIcon-9i1p9_iX.js";import{F as oe}from"./PlusIcon-sEOeD3Hh.js";import{u as V}from"./useBackend-DQtjNKWe.js";import"./dialog-ggJXrdBE.js";import"./keyboard-DtRAc72Y.js";import"./CheckIcon-irlFAkRU.js";import"./httpService-Dtbvl9Ps.js";import"./index-t--hEgTQ.js";function ne({title:n,titleId:a,...f},d){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":a},f),n?o.createElement("title",{id:a},n):null,o.createElement("path",{fillRule:"evenodd",d:"M12 2.25a.75.75 0 0 1 .75.75v11.69l3.22-3.22a.75.75 0 1 1 1.06 1.06l-4.5 4.5a.75.75 0 0 1-1.06 0l-4.5-4.5a.75.75 0 1 1 1.06-1.06l3.22 3.22V3a.75.75 0 0 1 .75-.75Zm-9 13.5a.75.75 0 0 1 .75.75v2.25a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5V16.5a.75.75 0 0 1 1.5 0v2.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V16.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))}const se=o.forwardRef(ne);function re({title:n,titleId:a,...f},d){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":a},f),n?o.createElement("title",{id:a},n):null,o.createElement("path",{fillRule:"evenodd",d:"M3.74 3.749a.75.75 0 0 1 .75.75V15h13.938l-2.47-2.47a.75.75 0 0 1 1.061-1.06l3.75 3.75a.75.75 0 0 1 0 1.06l-3.75 3.75a.75.75 0 0 1-1.06-1.06l2.47-2.47H3.738a.75.75 0 0 1-.75-.75V4.5a.75.75 0 0 1 .75-.751Z",clipRule:"evenodd"}))}const ie=o.forwardRef(re);function me({title:n,titleId:a,...f},d){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":a},f),n?o.createElement("title",{id:a},n):null,o.createElement("path",{fillRule:"evenodd",d:"M11.47 2.47a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06l-3.22-3.22V16.5a.75.75 0 0 1-1.5 0V4.81L8.03 8.03a.75.75 0 0 1-1.06-1.06l4.5-4.5ZM3 15.75a.75.75 0 0 1 .75.75v2.25a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5V16.5a.75.75 0 0 1 1.5 0v2.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V16.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))}const ce=o.forwardRef(me);function de({title:n,titleId:a,...f},d){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":a},f),n?o.createElement("title",{id:a},n):null,o.createElement("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"}))}const ue=o.forwardRef(de);function pe({title:n,titleId:a,...f},d){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":a},f),n?o.createElement("title",{id:a},n):null,o.createElement("path",{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"}))}const xe=o.forwardRef(pe),fe=_.lazy(()=>J(()=>import("./formEditor-aFH2hPeF.js"),[])),he=_.lazy(()=>J(()=>import("./pagination-zlfNJsP6.js"),[])),Z=({status:n,formTitle:a,defaultFormValues:f,formDescription:d,rows:r=[],formFields:j=[],pageDetails:i={},fields:h=[],topActions:E=[],actions:U=[],deleteProps:u,setOffsetAndLimit:T=()=>{},searchFields:p=[],update:N=()=>{alert("Not Implemented")},delete:S=()=>{alert("Not Implemented")},onImportEach:y=k=>{alert("Not Implemented")}})=>{console.log({rows:r});const[k,M]=le(),[s,g]=o.useState(()=>{const t={};return p==null||p.forEach(w=>{t[w.columnName]=""}),t}),[C,m]=o.useState(!1),[v,c]=o.useState(!1),[A,x]=o.useState(null),[b,P]=o.useState(!1),[we,q]=o.useState([]),[H,be]=o.useState([]),L=(t,w)=>{g(l=>({...l,[t]:w}))},D=()=>{console.log("Search Values:",s)},K=async t=>{u.fromKey&&u.postKey&&(t[u.postKey]=t[u.fromKey]),m(!0),await S(t),m(!1)},z=t=>{x(t),c(!0),m(!0)},G=async t=>{await N(t),m(!1),c(!1),x(null)},Y=()=>{m(!1),c(!1),x(null)},F=()=>{P(!0)},W=async t=>{if(t.length===0){alert("No rows to import");return}for(const w of t)await y(w);P(!1),q([])},Q=()=>e.jsx("div",{className:"min-h-5 w-full relative",children:e.jsx("div",{className:"relative right-0 md:-top-10",children:E.length>0&&e.jsx("div",{className:"flex justify-end items-end gap-x-2 gap-y-2",children:E.map((t,w)=>e.jsx("div",{className:"bg-white rounded-full shadow-sm p-2",children:e.jsxs("button",{className:O("font-medium text-sm py-2 px-2 rounded-3xl flex items-center justify-center shadow-sm",t.label?"px-3":"h-8 w-8",t.type==="new"?"bg-indigo-600 text-white":t.type==="export"?"bg-green-700 text-white":t.type==="import"?"bg-blue-700 text-white":t.type==="custom"?"bg-gray-700 text-white":""),onClick:()=>{t.type==="new"?c(!0):t.type==="export"?console.log("Export"):t.type==="import"?F():t.type==="custom"&&t.callback&&t.callback()},children:[t.type==="new"&&e.jsx(oe,{className:"h-5 w-5 text-white"}),t.type==="export"&&e.jsx(ce,{className:"h-5 w-5 text-white"}),t.type==="import"&&e.jsx(se,{className:"h-5 w-5 text-white"}),t.type==="custom"&&e.jsxs(e.Fragment,{children:[t.icon,e.jsx("span",{className:"ml-2",children:t.label})]})]})},w))})})});return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Delete Item",description:"Are you sure you want to delete this item?",confirmButtonLabel:"Delete",confirmButtonClick:async t=>K(t),className:"w-96 print:hidden"}),e.jsxs("div",{className:"",children:[(p==null?void 0:p.length)>0&&e.jsxs("div",{className:"mb-0 flex flex-row justify-end gap-x-2 gap-y-2",children:[p==null?void 0:p.map((t,w)=>e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"absolute -top-2 left-2 inline-block rounded-lg bg-white px-1 text-xs font-medium text-gray-900",children:["Search By ",t.label]}),t.type==="text"&&e.jsx("input",{type:"text",placeholder:"Enter "+(t.placeholder||t.label),value:s[t.columnName],onChange:l=>L(t.columnName,l.target.value),className:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900   placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 border-gray-300 focus:outline-gray-50 sm:text-sm/6"}),t.type==="select"&&e.jsx("select",{value:s[t.columnName],onChange:l=>L(t.columnName,l.target.value),className:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900  placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-darkprimary sm:text-sm/6",children:t.options.map((l,R)=>e.jsx("option",{value:l.value,children:l.label},R))})]},w)),e.jsx("button",{type:"button",onClick:D,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-darkprimary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-darkprimary",children:"Search"})]}),e.jsx("div",{className:"relative mt-12",children:e.jsxs("table",{className:"min-w-full md:divide-y md:divide-gray-300 flex flex-col md:table ",children:[(h==null?void 0:h.length)>0&&e.jsx("thead",{className:"flex flex-grow md:table-header-group ",children:e.jsxs("tr",{className:"md:bg-gray-200 flex md:table-row flex-grow justify-end",children:[h.map((t,w)=>e.jsx("th",{className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-3 hidden md:table-cell",children:t.label},w)),e.jsx("th",{children:e.jsx(Q,{})})]})}),(r==null?void 0:r.length)>0&&e.jsx("tbody",{className:"md:divide-y md:divide-gray-200 flex flex-grow md:table-row-group flex-col gap-y-3",children:r.map((t,w)=>{for(let l in t)if(l.indexOf("JsonSettings")>-1&&l.indexOf(".")==-1)try{let R=ee(t[l]);if(R)for(let $ in R)t[l+"Object."+$]=R[$],console.log({row:t})}catch(R){console.error("Error parsing JSON:",R)}return e.jsxs("tr",{className:"flex md:table-row flex-col py-4 md:py-0 px-4 md:px-0 shadow-md md:shadow-none",children:[h==null?void 0:h.map((l,R)=>e.jsxs("td",{className:"whitespace-nowrap md:px-3 py-2 md:py-4 text-sm text-gray-500 flex flex-row justify-between md:table-cell",children:[e.jsx("span",{className:"md:hidden font-semibold text-gray-900",children:l.label}),l.asOptionList?e.jsx("ul",{className:"list-disc mr-2 ml-3",children:Array.isArray(t[l.column])&&t[l.column].length>0?t[l.column].map(($,X)=>e.jsx("li",{className:"text-gray-700 font-normal text-xs",children:$.label},X)):e.jsx("span",{className:"text-gray-900 font-semibold",children:"-"})}):e.jsx("span",{className:"",children:t[l.column]})]},R)),U.length>0&&e.jsx("td",{className:"whitespace-nowrap text-sm font-medium mt-3 md:mt-0",children:e.jsx("div",{className:"flex justify-end gap-x-2 gap-y-2",children:U.map((l,R)=>e.jsxs("button",{title:l.label,className:O("h-8 w-8 font-semibold py-2 px-2 rounded-3xl flex items-center justify-center",l.type==="whatsapp"?"bg-green-700 text-white":l.type==="edit"?"bg-primary text-white":l.type==="delete"?"bg-red-800 text-white":""),onClick:()=>{l.type==="whatsapp"?l.callback&&l.callback(t):l.type==="edit"?z(t):l.type==="delete"&&M(t)},children:[l.type==="whatsapp"&&e.jsx(ae,{className:"h-5 w-5 text-white"}),l.type==="edit"&&e.jsx(ue,{className:"h-4 w-4 text-white"}),l.type==="delete"&&e.jsx(xe,{className:"h-5 w-5 text-white"})]},R))})})]},w)})}),(r==null?void 0:r.length)===0&&n!="finished"&&e.jsx("tbody",{className:"bg-white flex justify-center",children:e.jsx("tr",{className:"flex justify-center",children:e.jsx(B,{})})})]})}),i&&e.jsx(he,{rowsFrom:i==null?void 0:i.rowsFrom,rowsTo:i==null?void 0:i.rowsTo,totalRowCount:i==null?void 0:i.totalRowCount,setOffsetAndLimit:T}),v&&e.jsx(fe,{description:d,title:a,row:A||f,fields:j,onSave:G,onCancel:Y}),b&&e.jsx(ge,{show:b,onCancel:()=>P(!1),onSubmit:W,rows:H,fields:h,formFields:j})]})]})},ge=({show:n,onCancel:a,onSubmit:f,rows:d,fields:r,formFields:j})=>{const[i,h]=o.useState([]),E=o.useRef(null),U=()=>{h([]);const u=E.current;if(!u)return;const T=u.querySelector("table");if(!T)return;const p=T.querySelectorAll("tbody tr"),N=[];p.forEach((S,y)=>{const k=S.querySelectorAll("td");let M=S.innerHTML;console.log({innerHTML:M});let s=S.innerText;console.log({innerText:s});const g={};let C=!0;k.forEach((m,v)=>{var A;let c=j[v];if(c&&c.name){const x=(A=j[v])==null?void 0:A.name;if(console.log("Column Key:",x+" at Row: "+(y+1)+", Column: "+(v+1)+" - "+m.innerText.trim()),!x){console.error(`Row ${y+1}, Column ${v+1} has no key defined.`),C=!1;return}if(c.validate&&c.validate.required&&!m.innerText.trim()){console.error(`Row ${y+1}, Column ${v+1} is required with field ${x}.`),C=!1;return}if(c.validate&&c.validate.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.innerText.trim())){console.error(`Row ${y+1}, Column ${v+1} is not a valid email with field ${x}.`),C=!1;return}if(c.type==="select"&&c.options){const b=c.options.find(P=>P.text.trim().toLowerCase()===m.innerText.trim().toLowerCase()||P.text.replace(" "+c.name,"").trim().toLowerCase()===m.innerText.trim().toLowerCase());if(!b){console.error(`Row ${y+1}, Column ${v+1} has an invalid option value: ${m.innerText.trim()} with field ${x}.`),C=!1;return}C&&(g[x]=b?b.value:m.innerText.trim(),g[x+"Name"]=b?b.text:m.innerText.trim(),g[x+"Text"]=b?b.text:m.innerText.trim())}else c.type==="text"&&C&&(g[x]=m.innerText.trim())}}),C&&N.push(g)}),h(N),console.log("Imported Rows: "+N.length+" rows out of "+p.length,N)};return console.log("Excel Rows:",i),console.log("fields:",j),console.log("formFields:",j),n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Confirm Import"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Paste Excel Table Here:"}),e.jsx("div",{ref:E,className:"pasteexcel border rounded p-2 bg-gray-50 mb-2",contentEditable:!0,style:{outline:"none",maxHeight:"50vh",overflowY:"auto",minHeight:"80px"},suppressContentEditableWarning:!0}),e.jsx("button",{className:"px-3 py-1 bg-blue-500 text-white rounded",onClick:U,type:"button",children:"Import Excel to List"})]}),i.length>0&&e.jsx("div",{className:"max-h-96 overflow-auto mb-4",children:e.jsx(Z,{formTitle:"Import Preview",formDescription:"You can review the imported data before submitting.",rows:i.length>0?i:[],fields:r,formFields:j,actions:[]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-300 rounded",onClick:a,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>f(i.length>0?i:[]),children:"Submit Import"})]})]})}):null};let I={SuperAdmin:{RoleId:1,Role:"SuperAdmin"},Candidate:{RoleId:2,Role:"Candidate"},Organizer:{RoleId:3,Role:"Organizer"},Manager:{RoleId:4,Role:"Manager"},Coordinator:{RoleId:5,Role:"Coordinator",allowSections:!0},Judge:{RoleId:6,Role:"Judge"},Guest:{RoleId:7,Role:"Guest"},SubCoordinator:{RoleId:8,Role:"SubCoordinator",allowOrganizationLevels:!0},Projector:{RoleId:9,Role:"Projector"},SubAdmin:{RoleId:10,Role:"SubAdmin"},ContentAdmin:{RoleId:11,Role:"ContentAdmin"},User:{RoleId:12,Role:"User"},DrawMaster:{RoleId:13,Role:"DrawMaster"},ScoreMaster:{RoleId:14,Role:"ScoreMaster"},Guardian:{RoleId:15,Role:"Guardian"}};function ke({user:n,operation:a,eventCategory:f,eventId:d,eventLevel:r}){var M;const[j,i]=o.useState(!1),h=V("/UsersRolesPlusUsersJson/Get",{filter:{Event:d,Role:I[a].RoleId,CreatedBy:n.UId,Status:"1"},updateUrl:"/SetupJson/SaveUser",deleteUrl:"/SetupJson/RemoveCoordinator",limit:10,sort:{sortOrder:"DESC",sortColumn:"UserRoleId"},select:"Event,Role,SixDigitPassword,Status,User,UserEmail,UserEmailCode,UserName,UserNameCode,UserRoleId,JsonSettings"});let{rows:E,update:U}=h,u=[];if(a=="SubCoordinator"&&r){console.log({eventLevel:r}),console.log({operation:a});const{rows:s}=V("/OrganizationJson/Get",{select:"Id,Name,Status",filter:{CompetitionLevelLevelName:r},mandatoryParams:["CompetitionLevelLevelName"]});console.log({orgs:s}),u=s}const T=({UserName:s,UserEmail:g,SixDigitPassword:C})=>{let m=window.location.origin,v=btoa(s),c=btoa(g),A=btoa(d),x=encodeURIComponent(g);const b=`https://api.whatsapp.com/send?text=Hi%20${s},%0AYour%20login%20details%20are:%0A%0AUserName%3A%20${x}%0A🔑Password%3A%20${C}%0APlease%20follow%20the%20following%20link%20to%20login:%0A${m}%2FAccount%2FLogin%3FeventId%3D${A}%26name%3D${v}%26Email%3D${c}`;window.open(b,"_blank")};var p=[{type:"new",title:"New"},{type:"import",title:"Import"}];let N={Event:d,Role:I[a].RoleId,RoleRole:I[a].Role,Status:"1",CreatedBy:n.UId};(M=E==null?void 0:E.filter(s=>s.UserEmail==n.Email))!=null&&M.length||p.push({type:"custom",callback:()=>U({...N,UserName:n.Name,UserEmail:n.Email}),icon:e.jsx(ie,{className:"h-5 w-5"}),label:"Create Yourself as "+a,onClick:()=>handleAddUser({UserName:n.Name,UserEmail:n.Email})});let S=[{label:"Name",column:"UserName"},{label:"Email",column:"UserEmail"}];I[a].allowSections&&S.push({label:"Accessible Sections",column:"JsonSettingsObject.AccessibleSections",asOptionList:!0}),I[a].allowOrganizationLevels&&S.push({label:r,column:r+"Name"});let y=[{name:"UserName",label:"Name",type:"text",validate:{required:!0,minLength:3,maxLength:50}},{name:"UserEmail",label:"Email",type:"text",validate:{required:!0,email:!0}}];I[a].allowSections&&y.push({name:"JsonSettingsObject.AccessibleSections",label:"Accessible Sections",type:"select",multiple:!0,options:[{text:"All",value:"All"},{text:"Event SetUp",value:"EventSetup"},{text:"Candidate Edit & Approve",value:"CandidateEditApprove"},{text:"Advanced Event Configurations",value:"AdvancedEventSetup"},{text:"Bulk Participants Management",value:"BulkParticipants"},{text:"Users Roles Management",value:"UsersRoles"},{text:"Print and Download",value:"PrintAndDownload"},{text:"Score Management",value:"ScoreManagement"},{text:"Draw Management",value:"DrawManagement"},{text:"Time Management",value:"TimeManagement"},{text:"Result Printing",value:"ResultPrinting"},{text:"Result Individual Printing Only",value:"ResultIndividualPrinting"},{text:"Publish Results",value:"PublishResults"},{text:"Publish to Social Media",value:"PublishToSocialMedia"},{text:"Certificate Printing",value:"CertificatePrinting"},{text:"Unit Management",value:"UnitManagement"}],validate:{required:!0,email:!0}}),I[a].allowOrganizationLevels&&y.push({name:r,label:r,type:"select",multiple:!1,options:u!=null&&u.length?u==null?void 0:u.map(s=>({text:s.Name,value:s.Id})):[],validate:{required:!0}});const k=async s=>{let g={...N,...s,UserName:s.UserName||s.Name,UserEmail:s.UserEmail||s.Email};g.UserName&&g.UserEmail?await U(g):alert("User Name and Email are required to create a new user")};return e.jsx(te,{heading:"Manage User Roles - "+a,childrenClasses:"px-0 py-2",headingClasses:"px-3",outerClasses:"max-w-full mx-auto ml-5 bg-gray-50 print:hidden ",children:e.jsxs("div",{className:"",children:[j&&e.jsx(B,{}),e.jsx(Z,{...h,defaultFormValues:N,onImportEach:k,formTitle:"Manage User Roles - "+a,formDescription:"You can create new "+a+" by enter name and email",topActions:p,fields:S,searchFields:[{label:"Name",type:"text",column:"UserName"}],deleteProps:{fromKey:"UserRoleId",postKey:"UserUId"},formFields:y,actions:[{type:"edit",icon:"fa-edit"},{type:"whatsapp",icon:"fa-share",callback:s=>T(s)},{type:"delete",icon:"fa-trash"}]})]})})}export{ke as default};
