import{p as se,r as q,j as e,R as ae,b as le,_ as F}from"./mainweb-C-fYIVSe.js";import{M as de}from"./index.modern-LU3-dINH.js";import{c as ie}from"./utilities-CN4lTu6a.js";import{u as ce}from"./index.esm-DMRRpLCA.js";import{p as ne}from"./httpService-fNHmhpQ8.js";import{B as me}from"./box-8Vs7llda.js";import{F as pe}from"./PencilIcon-C19UkucN.js";import{F as ue}from"./XMarkIcon-CtbT471N.js";import{F as ge}from"./CheckIcon-s0s2yF0U.js";import{F as fe}from"./PlusIcon-DG9SKPDs.js";import{u as xe}from"./useBackend-JnmMr3HB.js";import"./index-t--hEgTQ.js";const he=ae.lazy(()=>le(()=>import("./renderComponents-Bq3GeYZK.js"),[]));function Ce({item:B,competitionStructureId:H,eventDetails:E,participantsList:z,formData:A,participantId:W,candidateId:u}){const{register:G,control:V,errors:k,handleSubmit:Q,setValue:I,getValues:M}=ce({defaultValues:{customCompetitionFields:[]}});console.log("CustomCompetitionFields",{item:B,eventDetails:E,register:G,errors:k,control:V,setValue:I,getValues:M,formData:A,participantId:W,candidateId:u});let Y=z.find(i=>i.CandidateId==u&&i.Competition==H);const J=se(B?.JsonSettings),X=J?.AdditionalTextFieldsForPubRegForm||[],S=J?.AdditionalTextFieldsMaxLength||1/0,L=J?.AdditionalTextFieldsMinLength||1;console.log("participantDetails",{participantDetails:Y});let m=se(Y?.JsonSettings)?.customCompetitionFields||[];const j=X.map(i=>({key:i.FieldName.replace(/\s+/g,"_").toLowerCase(),label:i.FieldName,name:`customCompetitionFields[0].${i.FieldName.replace(/\s+/g,"_").toLowerCase()}`,type:i.FieldType?.toLowerCase()||"text",isRequired:i.IsRequired?.toLowerCase()==="yes",conditions:[],options:[],placeholder:"",defaultValue:""})),[h,P]=q.useState([{id:Date.now(),values:{},fields:[...j],disabled:!1}]);q.useEffect(()=>{if(m.length>0){let i=[],c=m.map((v,C)=>{console.log("row",{row:v,index:C});let d={},w={};return j.forEach(a=>{d[`customCompetitionFields[${C}].${a.key}`]=v?.[a.key],w[a.key]=v?.[a.key]}),i.push(w),{id:Date.now()+C,values:d,fields:j.map(a=>({...a,name:`customCompetitionFields[${C}].${a.key}`})),disabled:!0}});I("customCompetitionFields",i),P(c)}},[]);const K=()=>{if(h.length>=S){F.error(`You can add a maximum of ${S} rows.`);return}P(i=>[...i,{id:Date.now(),values:{},fields:j.map(c=>({...c,name:`customCompetitionFields[${i.length}].${c.key}`})),disabled:!1}])},Z=async i=>{let c=M();console.log("values",{values:c});let{candidate:v,customCompetitionFields:C}=c,d=h.findIndex(b=>b.id===i);const w=C[d];if(j.filter(b=>b.isRequired&&!w.values[b.name]).length>0){F.error("Please fill all required fields before adding a new row.");return}try{let b=z.find(o=>o.CandidateId==u&&o.Competition==H)?.ParticipantId;if(!b){F.error("Participant ID not found.");return}let ee=await ne("/CandidateJson/UpdateParticipantJson",{participantId:b,candidateId:A?.candidate,JsonSettings:JSON.stringify(c)});console.log("API response:",ee),F.success("Data saved successfully!");let t=h[d];t.disabled=!0,j.forEach(o=>{t.values[`customCompetitionFields[${d}].${o.key}`]=w[o.key]}),P([...h])}catch(b){console.error("Error updating participant JSON:",b),F.error("Failed to save data.")}},l=i=>{P(c=>c.map(v=>v.id===i?{...v,disabled:!1}:v))},$=i=>{if(h.length<=L){F.error(`You must have at least ${L} rows.`);return}P(a=>a.filter(b=>b.id!==i));let c=M(),{candidate:v,customCompetitionFields:C}=c,d=h.findIndex(a=>a.id===i);C.splice(d,1),I("customCompetitionFields",C),console.log("customCompetitionFields",{customCompetitionFields:C}),console.log("values",{values:c});let w=Y?.ParticipantId;if(!w){F.error("Participant ID not found.");return}ne("/CandidateJson/UpdateParticipantJson",{participantId:w,candidateId:A?.candidate,JsonSettings:JSON.stringify(c)}).then(a=>{console.log("API response:",a),F.success("Data deleted successfully!")}).catch(a=>{console.error("Error updating participant JSON:",a),F.error("Failed to delete data.")})};let _=j.map(i=>i.label).join(", "),N=_.lastIndexOf(",");return N>-1&&(_=_.substring(0,N)+" and"+_.substring(N)),console.log("fieldRows",{fieldRows:h}),console.log("getValues",{getValues:M()}),j.length>0&&Y&&e.jsx(me,{outerClasses:"flex flex-row w-full lg:py-3 print:py-0",childrenClasses:"px-1 lg:px-4 py-1 w-full flex",description:"Please fill some additional inputs here, fields are "+_+" and minimum "+L+" and maximum "+S+" rows if items are required.",headingClasses:"border-b-[#485257] text-[#206689] items-center font-medium mb-0 pb-1 px-1 w-full uppercase border-b-2 text-base",heading:"Additional Inputs",children:e.jsxs("div",{className:"flex flex-col flex-grow",children:[h.map(i=>e.jsxs("div",{className:"flex flex-row gap-x-6 border-b border-gray-100 py-4  print:py-0",children:[e.jsx(he,{singleRow:!0,eventDetails:E,components:i.fields,errors:k,register:G,handleSelect:()=>{},control:V,setValue:I,getValues:M,formData:i.values,isSubmitted:i.disabled,onChangeValue:(c,v)=>{P(C=>C.map(d=>d.id===i.id?{...d,values:{...d.values,[c]:v}}:d))}},i.id),e.jsx("div",{className:"flex items-baseline gap-x-2 print:hidden",children:i.disabled?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>l(i.id),className:"rounded-full bg-yellow-600 p-1.5 text-white shadow-sm hover:bg-yellow-500",children:e.jsx(pe,{"aria-hidden":"true",className:"h-5 w-5"})},"Edit"+i.id),e.jsx("button",{type:"button",onClick:()=>$(i.id),className:"rounded-full bg-red-800 p-1.5 text-white shadow-sm hover:bg-red-500",children:e.jsx(ue,{"aria-hidden":"true",className:"h-5 w-5"})},"Delete"+i.id)]}):e.jsx("button",{type:"button",onClick:()=>Z(i.id),className:"rounded-full p-1.5 text-white shadow-sm bg-green-600 hover:bg-green-500",children:e.jsx(ge,{"aria-hidden":"true",className:"h-5 w-5"})},"Save"+i.id)})]},i.id)),h.length<S&&e.jsx("div",{className:"justify-end items-end flex mt-4 print:hidden",children:e.jsx("button",{type:"button",onClick:K,disabled:h.length>=S,className:`rounded-full p-1.5 text-white shadow-sm ${h.length>=S?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:e.jsx(fe,{"aria-hidden":"true",className:"h-5 w-5"})})})]})})}const Ee=({fieldName:B,label:H,errors:E,isGroupMandatory:z,participantType:A,setValue:W,formData:u,eventDetails:G,competitions:V,participantsList:k,onChange:Q,disabled:I,register:M,control:Y})=>{const{rows:J}=xe("/CandidateJson/GetByAge",{sort:{sortOrder:"DESC",sortColumn:"id"},filter:{ParticipantType:u?.participantType=="Individual"?1:u?.participantType=="Team"?2:0,DobString:u?.userDobString},doCache:!0,select:"AgeFrom,AgeTo,EventGroupId,GroupName,Status"});console.log({competitions:V,ageWiseGroup:J});let X=E?.[B],[S,L]=q.useState(X);q.useEffect(()=>{L(E?.[B])},[E?.[B]]);let D=k?.map(t=>t.Competition)??[],[m,j]=q.useState(D);I&&(m=D);let h=D.join(",");q.useEffect(()=>{h&&D.length>0&&j(D)},[h]);let P=function(t){t.forEach(o=>{let n=`competitionCheckBox_${o.Competition}`,r=document.querySelector(`input[name='${n}']`);r&&(r.checked=!0,Q&&W(n,!0))})};q.useEffect(()=>{k?.length>0&&P(k)},[k]);var K=J?.filter(t=>{let o=t.JsonSettings;return!!(o&&(o=JSON.parse(o),o?.IsCommon=="Yes"))});let Z=K?.map(t=>t.EventGroupId),l=V??[];if(u?.group||z)l=l.filter(t=>I&&!m.find(o=>o==t.CompetitionStructureId)?!1:!!(t.Group==u?.group||Z?.find(o=>o==t.Group)));else{let t=[];l=l.filter(o=>!(t.find(n=>n.Title==o.Title)||(t.push(o),I&&!m.find(n=>n==o.CompetitionStructureId)))),l=t}u?.gender&&(l=l.filter(t=>{if(u?.gender=="Male"){if(t.Gender==1||t.Gender==3)return!0}else if(u?.gender=="Female"){if(t.Gender==2||t.Gender==3)return!0}else return!0;return!1}));const $=[],_=(t,o)=>{o.target.checked?m=[...m,t]:m=m.filter(r=>r!==t),j(m),Q(m)};let N=JSON.parse(G?.JsonSettings??"{}"),i=10;A=="Individual"?i=N?.AdditionalSettings?.MaximumParticipationPerCandidate??10:i=N?.AdditionalSettings?.MaximumParticipationPerGroup??10;let c=N?.AdditionalSettings?.FeesCurrency??"USD",v=N?.AdditionalSettings?.EnablePublicAndPrivateRegistration=="Yes",C=N?.AdditionalSettings?.UsePublicAndPrivateRegistrationByRegId=="Yes",d=N?.AdditionalSettings?.CustomMaxParticipationPerCandidate??[];if(console.log("customMaxSettings",d),l.length>0&&v&&!I)if(C){let t=N?.AdditionalSettings;console.log({jsonSettings:N});let o=N?.components?.User?.find(y=>y.type=="RegistrationIdBox");console.log({registrationBox:o});let r=t?.EligibleRegistrationNumbers?.find(y=>y.RegistrationNumber==(u?.registrationId??"-")),g=!1;if(o?.conditions){let y=!0;for(let s=0;s<o.conditions.length;s++){let p=o.conditions[s],f=p.key?.charAt(0)?.toLowerCase()+p.key?.slice(1);if(u[f]?.toString()!=p.value?.toString()){y=!1;break}}y?g=!0:g=!1}else g=!0;r&&g||(l=l.filter(y=>{if(y.AllowPublicRegistration=="1")return!0}))}else l=l.filter(t=>{if(t.AllowPublicRegistration=="1")return!0});let a=m.filter(t=>l.find(o=>o.CompetitionStructureId==t))?.length>=i;d.length>0&&A=="Individual"&&(a=!1);const b=[...new Set(l.map(t=>t.CompetitionCategoryName))],ee=l.reduce((t,o)=>t.find(r=>r.CompetitionName===o.CompetitionName)?t:t.concat([o]),[]);return console.log("uniqueCategories",b),J?.forEach(t=>{b.forEach(o=>{let n=ee.filter(s=>s.CompetitionCategoryName==o&&s.Group==t.EventGroupId),r={};if(r.CategoryName=o,r.CompetitionNames=[],n.forEach(s=>{let p=l.filter(x=>x.CompetitionCategoryName==o&&x.CompetitionName==s.CompetitionName),f={};f.CompetitionName=s.CompetitionName,f.competitions=p,r.CompetitionNames.push(f)}),d.length>0){let s=d.filter(R=>R.CompetitionCategoryId?.startsWith(o));console.log("matchingCategories",s);let p=d.find(R=>R.CompetitionCategoryId==o);console.log("currentCategoryMax",p);let f=l.filter(R=>s.find(T=>T.CompetitionCategoryId==R.CompetitionCategoryName));console.log("items",f);var g=m.filter(R=>f.find(T=>T.CompetitionStructureId==R));console.log("filteredItemsInCategory",g);let x=g.length>=(p?.MaxParticipation??1);if(console.log("isExceeded",x),x&&(r.isExceeded=x,r.MaxParticipation=p?.MaxParticipation??1),o.split("-").length>1){let R=o.split(" - ")[0],T=d.find(U=>U.CompetitionCategoryId==R),oe=l.filter(U=>T.CompetitionCategoryId==U.CompetitionCategoryName);console.log("parentItems",oe);var y=m.filter(U=>oe.find(re=>re.CompetitionStructureId==U));console.log("filteredParentItemsInCategory",y);let te=y.length+g.length>=(T?.MaxParticipation??1);console.log("isParentExceeded",te),te&&(r.isExceeded=te,r.MaxParticipation=T?.MaxParticipation??1)}}if(n.length>0){let s=n[0]?.GroupName;if($.find(p=>p.GroupName==s))$.find(f=>f.GroupName==s).items.push(r);else{let p={GroupName:s,items:[r]};$.push(p)}}})}),console.log("competitionItems",V),e.jsx("div",{className:"mt-4  print:mt-0",children:e.jsxs("div",{className:"flex flex-col print:flex-row print:flex-wrap",children:[$.length==0&&e.jsx("div",{className:"text-gray-500 text-sm",children:"No competitions available for this group / matching criterias"}),a&&e.jsx("blockquote",{className:"border-l-4 border-orange-300 bg-orange-50 p-3 mt-2 print:hidden",children:e.jsxs("div",{className:"text-sm text-orange-600 font-normal",children:["You can select maximum ",i," competition per ",A=="Individual"?"candidate":"team","."]})}),$?.map((t,o)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-3 print:mb-0 rounded-md print:border-0 print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-3  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-2xl px-5 print:text-lg font-semibold leading-6 text-blue-900",children:t.GroupName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500"})]})}),t?.items?.map((n,r)=>e.jsxs("div",{className:"mb-3  print:mb-0 rounded-md border border-gray-200  print:border-0 px-5  print:px-0   print:py-0 py-2",children:[e.jsx("div",{className:"border-b border-gray-300 pb-2  print:pb-0 print:hidden",children:e.jsxs("div",{className:"flex flex-wrap items-baseline",children:[e.jsx("h3",{className:"mt-1 text-xl  print:text-lg font-semibold leading-6 text-cyan-600",children:n.CategoryName}),e.jsx("p",{className:"ml-1 truncate text-base text-gray-500",children:"Competitions"})]})}),e.jsx("div",{className:"flex flex-col md:grid md:grid-cols-2 md:gap-2  print:gap-0",children:n.CompetitionNames?.map((g,y)=>e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-100 pb-0 print:hidden",children:e.jsxs("div",{className:"flex items-baseline text-left justify-start",children:[e.jsx("h3",{className:"mt-1 text-lg  print:text-base font-semibold leading-6 text-green-800",children:g.CompetitionName}),e.jsx("p",{className:"ml-1 truncate text-sm text-gray-500"})]})}),e.jsx("div",{className:"mt-2 flex flex-wrap",children:g.competitions?.map((s,p)=>{let f=m.find(O=>O==s.CompetitionStructureId)!=null,x=!!(I||!f&&a);return n.isExceeded&&!f&&(x=!0),K?.find(O=>O.EventGroupId==s.Group),console.log("item",s),console.log("item2",g),console.log("item3",n),e.jsxs("div",{className:"w-min-[300] pr-4 mb-2",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("label",{onClick:O=>{if((a||n.isExceeded)&&x){n.isExceeded?F.error("You can't select more than "+n.MaxParticipation+" competitions from "+n.CategoryName):F.error("You can select maximum "+i+" competitions only");return}},className:ie(x?"":"ml-2","block text-sm text-gray-900"),children:[!x&&e.jsx("input",{type:"checkbox",id:`competitionCheckBox_${s.CompetitionStructureId}`,className:ie(" h-5 w-5 optiontext-darkprimary ",S?"border-red-300  text-red-600 focus:ring-red-800":x?"bg-gray-200 text-gray-500":"focus:ring-darkprimary text-primary border-gray-300"),disabled:x,fieldName:`competitionCheckBox_${s.CompetitionStructureId}`,checked:f,onChange:O=>{_(s.CompetitionStructureId,O)}},p),x&&!f&&e.jsx("span",{className:"h-5 w-5 inline-block align-middle optiontext-darkprimary bg-gray-300 text-gray-500"}),e.jsxs("span",{className:"hidden print:flex",children:[G?.AllowDisplayCompetitionOrder==1?s.CompetitionOrder+" - ":""," ",s.Title]}),e.jsx("span",{className:ie(I?"":"ml-2","text-xs  print:hidden font-medium leading-6 select-none "+(S?"text-danger":"text-gray-900")),children:(G?.AllowDisplayCompetitionOrder==1?s.CompetitionOrder+" - ":"")+(s.Title.replace(g.CompetitionName,"").replace(/ /gi,"").trim()!==""?s.Title.replace(g.CompetitionName,"").trim():g.CompetitionName.trim())})]})}),e.jsx("div",{className:"text-sm text-gray-500 whitespace-break-spaces print:hidden",children:s?.Remarks&&e.jsx(de,{children:s.Remarks})}),s.Fees>0&&e.jsx("p",{className:"fees text-md mt-2 text-gray-600 print:hidden",children:e.jsxs("b",{children:["Fees:",e.jsxs("i",{className:"text-green-700 font-medium",children:[" ",s.Fees,c]})]})}),e.jsx(Ce,{eventDetails:G,item:s,competitionStructureId:s.CompetitionStructureId,candidateId:s.CandidateId,register:M,errors:E,control:Y,participantsList:k,setValue:W,getValues:null,setFormData1:()=>{},formData:u})]},r+"_"+y+"_"+s.CompetitionStructureId)})})]},r+"_"+y))})]},r))]},o)}))]})})};export{Ee as default};
