import{r as h,j as e,i as Z,z as q,b as Se,u as se}from"./main-DzBv391f.js";import{L as be}from"./layoutOuter-BWOSiPQB.js";import{P as Ne}from"./pageHeader-DvhGT9y7.js";import{F as le}from"./ClipboardDocumentListIcon-D1LHrjQn.js";import{F as je}from"./CheckCircleIcon-BhK035Ye.js";import{F as ce}from"./UserIcon-Cw3Ba6zT.js";import{F as xe}from"./CheckCircleIcon-Bdu76bIJ.js";import{F as Ce}from"./StarIcon-DY_r_poI.js";import{F as ve}from"./TrashIcon-BZMsvNOS.js";import{F as we}from"./TrophyIcon-BIrx71A-.js";function ye({title:d,titleId:g,...i},n){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":g},i),d?h.createElement("title",{id:g},d):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const Ie=h.forwardRef(ye);function Je({title:d,titleId:g,...i},n){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":g},i),d?h.createElement("title",{id:g},d):null,h.createElement("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z",clipRule:"evenodd"}))}const $e=h.forwardRef(Je),Pe=({competitions:d,processedCompetitions:g,competitionsStatus:i,selectedCompetition:n,onCompetitionSelect:C,getCompetitionStatusPriority:l,selectedGroupFilter:w,setSelectedGroupFilter:V})=>{const[$,L]=h.useState([]);h.useEffect(()=>{let t=g;w!=="all"&&(t=t.filter(u=>u.competitionGroupName===w)),L(t)},[g,w]);const m=t=>{const u=t.competitionOrder+" -"||"",f=t.competitionGroupName||"",o=t.competitionItemTitle||"",k=t.competitionGenderTitle||"",D=t.competitionLanguageName||"",F=t.statusTitle||"",J=t.competitionGender===3,O=t.competitionLanguage===4;let v=[];return u&&v.push(u),f&&v.push(f),o&&v.push(o),!J&&!O?(k&&v.push(k),D&&v.push(D)):J&&!O?D&&v.push(D):!J&&O&&k&&v.push(k),F&&v.push(`- ${F}`),v.join(" ").trim()||`Competition ${t.competitionId}`},j=t=>{switch(t){case"Filling in Progress":return 1;case"Allowed to Fill":return 2;case"Filled":return 3;case"Published":return 4;case"No Judges Assigned":return 5;default:return 6}},P=t=>{const u=t.competitionGroupName||"";let f="";if(t.judges&&t.judges.length>0){const o=t.judges.filter(J=>J.scoreStatus===1||J.scoreStatus==="1").length,k=t.judges.filter(J=>J.scoreStatus===2||J.scoreStatus==="2").length,D=t.judges.filter(J=>!J.scoreStatus||J.scoreStatus===0||J.scoreStatus==="0"||J.scoreStatus===3||J.scoreStatus==="3").length,F=t.judges.length;D>0&&D!==F?f="Filling in Progress":D===F?f="Allowed to Fill":o+k===F?f="Filled":k===F&&(f="Published")}return t._groupPriority=j(f),u&&f?`${u} - ${f}`:u||f||"General"},p=t=>t.inProgressJudges>0?"bg-blue-50 border-blue-200 text-blue-700":t.finishedJudges===t.totalJudges&&t.competitionStatus!==4?"bg-green-50 border-green-200 text-green-700":t.competitionStatus===4?"bg-purple-50 border-purple-200 text-purple-700":"bg-surface border-border text-onSurfaceVariant";return i==="loading"?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Loading competitions..."})]})}):g.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"No Competitions Available"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"No competitions have been assigned yet."})]}):$.length===0?e.jsxs("div",{children:[e.jsx("h2",{className:"border-b-2 border-b-[#485257] text-[#206689] items-center mb-4 font-medium pb-1 px-1 w-full uppercase text-lg",children:"Competition & Judge Selection"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"No Competitions Found"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"No competitions match the selected group filter. Try adjusting your filter settings."})]})]}):e.jsxs("div",{className:"",children:[e.jsx("div",{className:"block lg:hidden ",children:e.jsx("div",{className:"mb-2",children:e.jsxs("select",{value:n,onChange:t=>C(t.target.value),className:"block w-full rounded-md border-0 py-2 pl-3 pr-10 text-onSurface ring-1 ring-inset ring-border focus:ring-2 focus:ring-primary focus:border-primary sm:text-sm sm:leading-6",children:[e.jsx("option",{value:"",children:w==="all"?"Choose Competition...":`Choose Competition from ${w}...`}),(()=>{const t=$.reduce((u,f)=>{const o=P(f);return u[o]||(u[o]=[]),u[o].push(f),u},{});return Object.entries(t).sort(([,u],[,f])=>{const o=u[0]?._groupPriority||999,k=f[0]?._groupPriority||999;return o-k}).map(([u,f])=>e.jsx("optgroup",{label:u,children:f.map(o=>e.jsxs("option",{value:o.competitionId,"data-competition-status":o.competitionStatus,"data-allotment-id":o.allotementId,children:[m(o)," (",o.totalJudges," judges)"]},o.competitionId))},u))})()]})})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"max-h-[calc(100vh-120px)] overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-surface hover:scrollbar-thumb-onSurfaceVariant",children:e.jsx("div",{className:"w-full pr-2",children:(()=>{const t=$.reduce((u,f)=>{const o=P(f);return u[o]||(u[o]=[]),u[o].push(f),u},{});return Object.entries(t).sort(([,u],[,f])=>{const o=u[0]?._groupPriority||999,k=f[0]?._groupPriority||999;return o-k}).map(([u,f])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-bold bg-surfaceCard text-onSurfaceVariant uppercase tracking-wide mb-2 px-2 sticky top-0  py-1 z-10",children:u}),e.jsx("div",{className:"space-y-2",children:f.map(o=>e.jsx("button",{onClick:()=>C(o.competitionId),className:`w-full text-left py-3 px-3 rounded-lg border transition-colors ${n===o.competitionId?"bg-surface text-primary border-primary":p(o)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:`font-medium mr-1 text-xs break-words ${n===o.competitionId?"text-primary":"text-onSurface"}`,title:m(o),children:m(o)})}),o.competitionCode&&e.jsx("div",{className:`mb-3 ${n===o.competitionId,"text-onSurface"}`,children:e.jsxs("p",{className:"text-xs break-words",title:`Code: ${o.competitionCode}`,children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",o.competitionCode]})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs space-y-1",children:[o.finishedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-green-800"}`,children:[e.jsx(je,{className:"h-5 w-5"}),e.jsx("span",{children:o.finishedJudges})]}),o.inProgressJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-blue-800"}`,children:[e.jsx($e,{className:"h-5 w-5"}),e.jsx("span",{children:o.inProgressJudges})]}),o.notStartedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-onSurfaceVariant"}`,children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:o.notStartedJudges})]})]})})]})},o.competitionId))})]},u))})()})})})]})},Te=({processedCompetitions:d,selectedCompetition:g,selectedJudges:i,onJudgeSelect:n})=>{const[C,l]=h.useState(!1),[w,V]=h.useState([]);h.useEffect(()=>{const t=()=>{l(window.innerWidth>1200)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),h.useEffect(()=>{i&&i.length>0&&V(i)},[i]);const $=t=>t.scoreStatus===1||t.scoreStatus==="1"?"bg-green-50 border-green-200 text-green-700":t.scoreStatus===2||t.scoreStatus==="2"?"bg-blue-50 border-blue-200 text-blue-700":"bg-surface border-border text-onSurfaceVariant",L=t=>t.scoreStatus===1||t.scoreStatus==="1"?"Filled":t.scoreStatus===2||t.scoreStatus==="2"?"Published":"Allowed To Fill",m=t=>{if(C){const u=w.includes(t)?w.filter(f=>f!==t):[...w,t];V(u),n(u)}else{const u=[t];V(u),n(u)}},j=t=>w.includes(t.toString());if(!g)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"Select a Competition"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"Choose a competition to see available judges."})]});const p=d.find(t=>t.competitionId==g)?.judges||[];return p.length===0&&g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-onSurface mb-2",children:"No Judges Available"}),e.jsx("p",{className:"text-sm text-onSurfaceVariant",children:"No judges found for this competition."})]}):e.jsx("div",{children:g&&e.jsx("div",{children:e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-row gap-2 flex-wrap",children:p.map(t=>e.jsxs("label",{className:`group relative flex rounded-lg border p-2 sm:p-3 min-w-24 sm:min-w-28 flex-1 sm:flex-none cursor-pointer transition-colors ${j(t.judgeId)?"border-primary bg-primary text-white shadow-sm":`${$(t)} hover:border-primary hover:shadow-sm bg-surfaceCard`}`,children:[e.jsx("input",{type:C?"checkbox":"radio",name:C?`judge-${t.judgeId}`:"judge",value:t.judgeId,checked:j(t.judgeId),onChange:()=>m(t.judgeId.toString()),className:"absolute inset-0 appearance-none focus:outline-none border-transparent outline-0 invisible"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:`block text-xs sm:text-sm font-semibold ${j(t.judgeId)?"text-white":"text-onSurface"}`,children:t.judgeName}),e.jsx("span",{className:`block text-[10px] mt-0.5 sm:mt-1 ${j(t.judgeId)?"text-blue-100":"text-onSurfaceVariant"}`,children:L(t)})]})}),e.jsx("div",{className:"absolute bottom-1 right-1 sm:bottom-2 sm:right-2",children:(t.scoreStatus===1||t.scoreStatus==="1"||t.scoreStatus===2||t.scoreStatus==="2")&&e.jsx(xe,{className:`h-3 w-3 sm:h-4 sm:w-4 ${j(t.judgeId)?"text-green-200":"text-green-500"}`})})]},t.judgeId))})})})})},Ve=({participants:d,participantsStatus:g,activeParticipantId:i,currentParticipantIndex:n,participantScores:C,onParticipantSelect:l,onNavigateParticipant:w,judgeId:V,showJudgeSpecificScores:$=!1})=>{const L=m=>{if($&&V){const j=`judge_${V}_${m}`;return C[j]||C[m]||"-"}return C[m]||"-"};return g==="loading"?e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-6",children:e.jsx("div",{className:"text-center text-onSurfaceVariant py-4",children:"Loading participants..."})}):!d||d.length===0?e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"text-center text-onSurfaceVariant py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("p",{children:"No participants found"})]})}):e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm",children:e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"space-y-1",children:d.map((m,j)=>e.jsx("button",{onClick:()=>l(m.ParticipantId,j),className:Z("w-full text-left p-3 rounded-md transition-colors",m.ParticipantId===i?"bg-primary text-white":"hover:bg-surface bg-surfaceCard border border-border"),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:Z("text-sm font-medium",m.ParticipantId===i?"text-white":"text-onSurface"),children:m.IdentityNumber?m.IdentityNumber:m.CandidateIdentityNumber||m.ParticipantNumber}),e.jsx("div",{className:Z("text-sm font-medium",m.ParticipantId===i?"text-green-200":"text-primary"),children:L(m.ParticipantId)})]})},m.ParticipantId))})})})})},ue=({value:d,onChange:g,maxStars:i=10,criteriaId:n,participantId:C,disabled:l=!1})=>{const[w,V]=h.useState(0),$=m=>{l||g(m,n,C)},L=m=>{l||V(m)};return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex items-center justify-center gap-1 mb-2 w-full",children:[...Array(i)].map((m,j)=>{const P=j+1,p=P<=(w||d||0);return e.jsx("button",{type:"button",disabled:l,className:Z("flex-1 flex items-center justify-center p-1 transition-colors duration-150 max-w-8 max-h-8 aspect-square",l?"cursor-not-allowed opacity-50":"cursor-pointer",p?"text-yellow-400":"text-onSurfaceVariant hover:text-yellow-200"),onMouseEnter:()=>L(P),onMouseLeave:()=>V(0),onClick:()=>$(P),children:p?e.jsx(Ce,{className:"w-full h-full min-w-4 min-h-4"}):e.jsx(Ie,{className:"w-full h-full min-w-4 min-h-4"})},j)})})})},me=({value:d,onChange:g,maxMarks:i=100,minMarks:n=0,criteriaId:C,participantId:l,disabled:w=!1,placeholder:V="Enter marks"})=>{const $=m=>{const j=m.target.value,P=parseFloat(j);!isNaN(P)&&P>=n&&P<=i?g(P,C,l):j===""&&g(0,C,l)},L=()=>{const m=parseFloat(d);isNaN(m)||m<n?g(n,C,l):m>i&&g(i,C,l)};return e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",min:n,max:i,step:"0.1",value:d||"",onChange:$,onBlur:L,disabled:w,placeholder:V,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border disabled:bg-surface disabled:cursor-not-allowed"})})})},fe=({value:d,onChange:g,maxCount:i=10,minCount:n=0,criteriaId:C,participantId:l,disabled:w=!1,label:V="Count"})=>{const $=()=>{if(w||(d||0)>=i)return;const j=(d||0)+1;g(j,C,l)},L=()=>{if(w||(d||0)<=n)return;const j=Math.max(n,(d||0)-1);g(j,C,l)},m=j=>{const P=parseInt(j.target.value);!isNaN(P)&&P>=n&&P<=i&&g(P,C,l)};return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:L,disabled:w||(d||0)<=n,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-surface hover:bg-border disabled:opacity-50 disabled:cursor-not-allowed text-onSurfaceVariant",children:e.jsx("span",{className:"text-lg font-medium",children:"âˆ’"})}),e.jsx("div",{className:"flex-1 max-w-20",children:e.jsx("input",{type:"number",step:"0.1",min:n,max:i,value:d||0,onChange:m,disabled:w,className:"text-center pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border disabled:bg-surface disabled:cursor-not-allowed"})}),e.jsx("button",{type:"button",onClick:$,disabled:w||(d||0)>=i,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-surface hover:bg-border disabled:opacity-50 disabled:cursor-not-allowed text-onSurfaceVariant",children:e.jsx("span",{className:"text-lg font-medium",children:"+"})})]})},ke=({activeParticipantId:d,participants:g,competitionDetails:i,criteriaScores:n,participantScores:C,participantNotes:l,onScoreChange:w,onNotesChange:V,onSaveScore:$,onDeleteScore:L,selectedCompetition:m,processedCompetitions:j,selectedJudges:P,currentJudgeId:p})=>{const[t,u]=h.useState(!1),[f,o]=h.useState({}),[k,D]=h.useState(""),[F,J]=h.useState(0),O=g?.find(a=>a.ParticipantId===d),v=j?.find(a=>a.competitionId==m),X=()=>{if(!p||!v||!v.judges)return"";const a=v.judges.find(N=>N.judgeId.toString()===p.toString());return a?a.judgeName:`Judge ${p}`},Q=(a,N=p)=>P.length>1?`${a}_judge_${N}`:a,W=()=>!i||i.length===0||i.every(N=>N.Value&&N.Value!=0&&N.Value==v.competitionMaximumScore)?!1:i.every(N=>N.Value&&N.Value!=0),R=(a=f)=>{if(!i||i.length===0)return F;let N=0;const y=W();return i.forEach(I=>{const A=I.DetailId||I.CompetitionDetailsId,E=a[A]||0;N+=E}),y?N:N/i.length},re=a=>{if(J(a),!i||i.length===0)return;const N={...f};if(W()){const I=i.reduce((A,E)=>A+(E.Value||0),0);i.forEach(A=>{const E=A.DetailId||A.CompetitionDetailsId,U=A.Value||0,K=I>0?a*U/I:0,te=A.Value||10;N[E]=Math.min(K,te)})}else i.forEach(I=>{const A=I.DetailId||I.CompetitionDetailsId,E=I.Value||10;N[A]=Math.min(a,E)});o(N)};if(h.useEffect(()=>{if(d&&p){const a={},N=Q(d),y=C[N]||0;if(J(y),i&&i.length>0&&(i.forEach(E=>{const U=E.DetailId||E.CompetitionDetailsId,K=Q(`${U}_${d}`);a[U]=n[K]||0}),!Object.values(a).some(E=>E>0)&&y>0&&R(a)!==y)){re(y);return}o(a);const I=Q(d);D(l[I]||"")}},[d,C,n,l,i,p]),!O)return e.jsx("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-4 text-center",children:e.jsx("p",{className:"text-onSurfaceVariant text-sm",children:"Select a participant to begin scoring"})});const ie=async()=>{u(!0);try{const a={...O,judgeId:p,totalScore:F,criteriaScores:f,notes:k};if(await $(d,null,F,p),i&&i.length>0)for(const N of i){const y=N.DetailId||N.CompetitionDetailsId,I=f[y]||0;w(I,y,d,p),await $(d,y,I,p)}V(d,k,p),q.success(`Score saved successfully for ${X()}!`)}catch(a){console.error("Error saving scores:",a),q.error("Failed to save score. Please try again.")}finally{u(!1)}},H=async()=>{if(window.confirm(`Are you sure you want to delete the score for this participant from ${X()}?`)){u(!0);try{if(await L(d,null,p),i&&i.length>0)for(const a of i){const N=a.DetailId||a.CompetitionDetailsId;await L(d,N,p)}J(0),o({}),D(""),q.success(`Score deleted successfully for ${X()}!`)}catch(a){console.error("Error deleting scores:",a),q.error("Failed to delete score. Please try again.")}finally{u(!1)}}},ne=()=>v?.competitionMaximumScore||10,z=()=>{switch(v?.scoreLabel){case 1:return"marks";case 2:return"count";case 3:case 4:return"star";default:return"marks"}},Y=()=>z(),ee=()=>{const a=ne(),N=Y(),y={value:F,onChange:I=>re(I),disabled:t,criteriaId:"total",participantId:d};return N==="count"?e.jsx(fe,{...y,maxCount:a,label:"Total Count"}):N==="marks"?e.jsx(me,{...y,maxMarks:a,placeholder:"Enter total score"}):e.jsx(ue,{...y,maxStars:Math.min(a,10),maxScore:a})},oe=(a,N)=>{const y=a.DetailId||a.CompetitionDetailsId,I=f[y]||0,A=a.Value||10,E=Y(),U=(K,te,s)=>{const c={...f,[te]:K};o(c);const x=R(c);J(x)};return E==="count"?e.jsx(fe,{value:I,onChange:U,maxCount:A,criteriaId:y,participantId:d,disabled:t}):E==="star"?e.jsx(ue,{value:I,onChange:U,maxStars:10,maxScore:A,criteriaId:y,participantId:d,disabled:t}):e.jsx(me,{value:I,onChange:U,maxMarks:A,criteriaId:y,participantId:d,disabled:t})},ae=i&&i.length>0;return e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-md font-medium text-onSurface",children:O.CandidateName}),e.jsxs("p",{className:"text-sm text-onSurfaceVariant mt-1",children:["ID: #",O.CandidateIdentityNumber||O.TeamIdentityNumber]})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Enter Score"}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-onSurface text-sm mb-1",children:"Total Score"}),e.jsx("p",{className:"text-xs text-onSurfaceVariant",children:ae?"Enter total score (will auto-distribute to criteria below)":"Enter the participant's total score"})]})}),e.jsx("div",{className:"mt-3",children:ee()}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[F.toFixed(1)," / ",ne()]})})]})]}),ae&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Detailed Criteria Scoring (Optional)"}),e.jsx("div",{className:"border rounded-lg p-4 bg-surface",children:e.jsx("div",{className:"space-y-4",children:i.map((a,N)=>{`${a.DetailId||a.CompetitionDetailsId}${d}`;const y=a.DetailId||a.CompetitionDetailsId,I=f[y]||0,E=Y()==="star";return e.jsx("div",{className:N>0?"border-t border-border pt-4":"",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-onSurface text-sm",children:a.CriteriaName||a.CompetitionDetailsTitle}),e.jsxs("p",{className:"text-xs text-onSurfaceVariant mt-1",children:["Max: ",a.Value||10," points"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:oe(a)}),E&&e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"text-sm font-semibold text-primary",children:[I.toFixed(1)," / ",a.Value||10]})})]})]})},a.DetailId||a.CompetitionDetailsId)})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-onSurface mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:k,onChange:a=>D(a.target.value),disabled:t,placeholder:"Add any additional comments or notes about this participant's performance...",rows:3,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-onSurface focus:border-darkprimary placeholder:text-onSurfaceVariant ring-border disabled:bg-surface"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("button",{onClick:H,disabled:t,className:"inline-flex items-center gap-x-2 rounded-md bg-surface px-4 py-2 text-sm font-semibold text-onSurfaceVariant shadow-sm hover:bg-border focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:[e.jsx(ve,{className:"-mr-0.5 h-5 w-5"}),"Delete Score"]}),e.jsx("button",{onClick:ie,disabled:t||F===0,className:Z("inline-flex items-center gap-x-2 rounded-md px-6 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",t||F===0?"bg-surface text-onSurfaceVariant cursor-not-allowed":"bg-primary text-white hover:bg-primaryHover"),children:t?"Saving...":"Save Score"})]})]})]})},Ue=({user:d})=>{const{user:g,token:i}=Se()||{},[n,C]=h.useState([]),[l,w]=h.useState(""),[V,$]=h.useState(null),[L,m]=h.useState(0),[j,P]=h.useState(!1),[p,t]=h.useState([]),[u,f]=h.useState("all"),[o,k]=h.useState({}),[D,F]=h.useState({}),[J,O]=h.useState({}),{rows:v,status:X,update:Q}=se("/JudgesAllotmentWithScoreLabelJson/Get",{select:"AllotementId,Competition,CompetitionParticipantType,CompetitionParticipantTypeTitle,CompetitionGroup,CompetitionGroupGroupName,CompetitionCompetitionItem,CompetitionItemTitle,CompetitionItemScoreLabel,ScoreLabelLabel,CompetitionLanguage,CompetitionLanguageLanguageName,CompetitionGender,CompetitionGenderGenderTitle,CompetitionCompetitionStatus,CompetitionCompetitionStatusCompetitionStatusTitle,CompetitionEventEventName,CompetitionOrder,CompetitionMaximumScore,CompetitionFees,CompetitionMaximumMinutes,CompetitionMaximumSeconds,CompetitionMinimumMinutes,CompetitionMinimumSeconds,CompetitionWarningMinute,CompetitionWarningSecond,ScoreStatus,ScoreStatusScoreResultStatus,Phase,PhaseTitle,Stage,StageTitle,Judge,Visibility,Status,EventEventName,Order,ModifiedDateString,CompetitionStatusTitle",filter:{NoGrouping:!0,CreatedBy:g?.UId,Status:"1",Event:g?.Event},sort:{sortColumn:"CompetitionOrder"},updateUrl:"/JudgesAllotmentJson/SaveJudgeStatus"}),{rows:W}=se("/UsersRolesJson/Get",{select:"UId,UserRoleId,UserName,Name,Role,Status",filter:{Role:"6",Status:"1"}}),{rows:R,status:re,setFilter:ie}=se("/CompetitionParticipantsScoreCardJson/Get",{select:"ParticipantId,CandidateIdentityNumber,CompetitionCompetitionItem,CompetitionGender,CompetitionGroup,CompetitionLanguage,CompetitionMaximumScore,CompetitionParticipantType,IdentityNumber,Notes,ParticipantIdScore,ParticipantIdScorecardId,ParticipantType,Status,TeamIdentityNumber,CandidateName,ParticipantNumber,ScorecardId",filter:{Status:"1"},noGet:!0,updateUrl:"/JudgeJson/SaveScore",deleteUrl:"/JudgeJson/DeleteScore"}),{rows:H,setFilter:ne}=se("/JudgesDetailedScoreCardJson/Get",{select:"JudgesDetailedScoreCardId,ParticipantId,CompetitionDetailsId,Score,Judge,Competition,ScoreCard",filter:{},noGet:!0,updateUrl:"/JudgesDetailedScoreCardJson/Save",deleteUrl:"/JudgesDetailedScoreCardJson/Remove"}),{rows:z,setFilter:Y}=se("/CompetitionDetailsJson/Get",{select:"CriteriaName,DetailId,Order,SecondValue,Status,Value,Competition,CompetitionDetailsTitle,MaxScore,MinScore,CompetitionItem,ParticipantType,Gender,Group,Language,CompetitionDetailsId",filter:{},noGet:!0,updateUrl:"/CompetitionDetailsJson/Save"}),ee=s=>s.inProgressJudges>0?1:s.finishedJudges===s.totalJudges&&s.competitionStatus!==4?2:s.notStartedJudges===s.totalJudges?4:s.competitionStatus===4?5:3;h.useEffect(()=>{if(g&&g.Role===6&&p.length>0){const c=p.flatMap(x=>x.judges).find(x=>x.judgeName===g.UserName||x.judgeUserName===g.UserName||x.judgeId===g.UId||x.judgeId===g.UserRoleId);c&&C([c.judgeId.toString()])}},[g,p]),h.useEffect(()=>{if(v&&v.length>0&&W&&W.length>0){const s=v.reduce((x,r)=>{const S=r.Competition;if(x[S]||(x[S]={competitionId:S,allotementId:r.AllotementId,competitionName:r.CompetitionEventEventName||`Competition ${S}`,competitionCode:r.CompetitionCode||"",statusTitle:r.CompetitionStatusTitle||r.CompetitionCompetitionStatusCompetitionStatusTitle||"Unknown Status",competitionStatus:r.CompetitionCompetitionStatus,competitionItemTitle:r.CompetitionItemTitle,competitionGender:r.CompetitionGender,competitionGenderTitle:r.CompetitionGenderGenderTitle,competitionGroupName:r.CompetitionGroupGroupName,competitionItemScoreLabel:r.CompetitionItemScoreLabel,competitionLanguage:r.CompetitionLanguage,competitionLanguageName:r.CompetitionLanguageLanguageName,competitionOrder:r.CompetitionOrder||r.Order,competitionParticipantTypeTitle:r.CompetitionParticipantTypeTitle,scoreLabel:r.CompetitionItemScoreLabel,scoreLabelLabel:r.ScoreLabelLabel,scoreStatus:r.ScoreStatus,scoreStatusTitle:r.ScoreStatusScoreResultStatus,competitionMaximumScore:r.CompetitionMaximumScore>0?r.CompetitionMaximumScore:10,competitionFees:r.CompetitionFees,phaseTitle:r.PhaseTitle,stageTitle:r.StageTitle,judges:[],totalJudges:0,finishedJudges:0,inProgressJudges:0,notStartedJudges:0}),!x[S].judges.find(b=>b.judgeId===r.Judge&&b.allotmentId===r.AllotementId)){const b=W.find(_=>_.UserRoleId===r.Judge),B=b?b.Name||b.UserName:`Judge ${r.Judge}`;x[S].judges.push({judgeId:r.Judge,judgeName:B,judgeUserName:b?.UserName||"",scoreStatus:r.ScoreStatus,allotmentId:r.AllotementId}),x[S].totalJudges++,r.ScoreStatus===1||r.ScoreStatus==="1"?x[S].finishedJudges++:r.ScoreStatus===2||r.ScoreStatus==="2"?x[S].inProgressJudges++:x[S].notStartedJudges++}return x},{}),c=Object.values(s).sort((x,r)=>{const S=ee(x)-ee(r);if(S!==0)return S;const T=x.competitionOrder||0,b=r.competitionOrder||0;return T-b});t(c)}},[v,W]);const oe=h.useMemo(()=>{const s=[...new Set(p.map(c=>c.competitionGroupName).filter(Boolean))];return[{value:"all",label:"All Groups",count:p.length},...s.map(c=>({value:c,label:c,count:p.filter(x=>x.competitionGroupName===c).length}))]},[p]);h.useEffect(()=>{n.length>0&&l&&ie({Judge:n[0],Competition:l,Status:"1"})},[n,l]),h.useEffect(()=>{n.length>0&&l&&ne({Judge:n[0],Competition:l})},[n,l]),h.useEffect(()=>{l&&Y({Competition:l})},[l]),h.useEffect(()=>{if(H&&H.length>0){const s={},c={},x={};H.forEach(r=>{r.CriteriaId&&(s[`${r.CriteriaId}_${r.ParticipantId}`]=r.Score),r.TotalScore&&(c[r.ParticipantId]=r.TotalScore),r.Notes&&(x[r.ParticipantId]=r.Notes)}),k(s),F(c),O(x)}},[H]),h.useEffect(()=>{R&&R.length>0&&!V&&($(R[0].ParticipantId),m(0))},[R,V]);const ae=s=>{w(s),$(null),m(0)},a=s=>{C(s),$(null),m(0)},N=(s,c)=>{$(s),m(c)},y=s=>{if(!R||R.length===0)return;let c;s==="next"?(c=L+1,c>=R.length&&(c=0)):(c=L-1,c<0&&(c=R.length-1)),m(c),$(R[c]?.ParticipantId)},I=(s,c,x,r=null)=>{const S=r||n[0],T=n.length>1?`judge_${S}_`:"";if(c===null)F(b=>({...b,[`${T}${x}`]:s}));else{const b=`${T}${c}_${x}`;k(B=>({...B,[b]:s})),E(x,S)}},A=(s,c,x=null)=>{const r=x||n[0],S=n.length>1?`judge_${r}_`:"";O(T=>({...T,[`${S}${s}`]:c}))},E=(s,c=null)=>{const x=c||n[0],r=n.length>1?`judge_${x}_`:"",T=Object.keys(o).filter(b=>b.endsWith(`_${s}`)&&(n.length===1||b.startsWith(`judge_${x}_`))).reduce((b,B)=>b+(o[B]||0),0);F(b=>({...b,[`${r}${s}`]:T}))},U=async(s,c=null,x=null,r=null)=>{const S=r||n[0],T=n.length>1?`judge_${S}_`:"";try{const b={};if(b.Scores=[],c){const G={Judge:S,Competition:l,ParticipantId:s,CriteriaId:c,Score:x||o[`${T}${c}_${s}`]||0,AllotementId:v?.find(M=>M.Competition===l)?.AllotementId};b.Scores.push(G)}else if(z&&z.length>0){z.forEach(M=>{const ge=`${T}${M.DetailId||M.CompetitionDetailsId}_${s}`,de=o[ge]||0;if(de>0){const he={Judge:S,Competition:l,ParticipantId:s,CriteriaId:M.DetailId||M.CompetitionDetailsId,Score:de,AllotementId:v?.find(pe=>pe.Competition===l)?.AllotementId};b.Scores.push(he)}});const G={Judge:S,Competition:l,ParticipantId:s,ScoreCardScore:D[`${T}${s}`]||0,IsTotalScore:!0,AllotementId:v?.find(M=>M.Competition===l)?.AllotementId};b.Scores.push(G)}else{const G={Judge:S,Competition:l,ParticipantId:s,ScoreCardScore:D[`${T}${s}`]||0,AllotementId:v?.find(M=>M.Competition===l)?.AllotementId};b.Scores.push(G)}b.notes=J[`${T}${s}`]||"",b.JudgeId=S;const _=await(await fetch("/JudgeJson/SaveScore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).json();if(_.Results>0&&_.Results!=="0")return _.Results;throw new Error(typeof _.Results=="string"?_.Results:"Failed to save score")}catch(b){throw console.error("Error saving score:",b),b}},K=async(s,c=null,x=null)=>{const r=x||n[0],S=n.length>1?`judge_${r}_`:"";try{const T={Judge:r,Competition:l,ParticipantId:s};return c?(T.CriteriaId=c,(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json()).success!==!1&&k(_=>{const G={..._};return delete G[`${S}${c}_${s}`],G})):(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json()).success!==!1&&(F(_=>{const G={..._};return delete G[`${S}${s}`],G}),k(_=>{const G={..._};return Object.keys(G).forEach(M=>{M.endsWith(`_${s}`)&&(n.length===1||M.startsWith(`judge_${r}_`))&&delete G[M]}),G}),O(_=>{const G={..._};return delete G[`${S}${s}`],G})),!0}catch(T){throw console.error("Error deleting score:",T),T}},te=async()=>{if(!(n.length===0||!l)){P(!0);try{const s={Competition:l,ScoreStatus:1,AllotementId:v?.find(c=>c.Competition===l)?.AllotementId};await Q(s),q.success("Competition marked as finished!")}catch(s){console.error("Error marking as finished:",s),q.error("Failed to mark competition as finished.")}finally{P(!1)}}};return e.jsx(be,{children:e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx(Ne,{heading:"Scoring Panel",subHeading:"Select a judge and competition to begin scoring participants",rightChildren:n.length>0&&l&&e.jsxs("button",{onClick:te,disabled:j,className:Z("inline-flex items-center gap-x-2 rounded-md px-4 py-2 text-sm font-semibold shadow-sm",j?"bg-surface text-onSurfaceVariant cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"),children:[e.jsx(xe,{className:"h-4 w-4"}),j?"Finishing...":"Mark as Finished"]})}),e.jsxs("div",{className:"px-2 lg:px-6 py-2",children:[p.length>0&&e.jsx("div",{className:"lg:mb-6",children:e.jsxs("div",{className:"bg-white rounded-t-lg lg:rounded-lg py-2 px-2 lg:px-6 ",children:[e.jsx("div",{className:"lg:hidden lg:mb-4 mt-1",children:e.jsx("select",{value:u,onChange:s=>f(s.target.value),className:"block w-full rounded-md border-border shadow-sm focus:border-darkprimary focus:ring-primary text-sm",children:oe.map(s=>e.jsxs("option",{value:s.value,children:[s.label," (",s.count,")"]},s.value))})}),e.jsx("nav",{className:"hidden lg:flex -mb-px space-x-4 overflow-x-auto",children:oe.map(s=>e.jsxs("button",{onClick:()=>f(s.value),className:`whitespace-nowrap py-2 px-6 border-b-2 font-medium text-sm transition-all duration-200 ${u===s.value?"border-primary text-primary bg-blue-50":"border-transparent text-onSurfaceVariant hover:text-onSurface hover:border-border"}`,children:[s.label," (",s.count,")"]},s.value))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-2",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsx("div",{className:"bg-white lg:border-t-2 lg:border-primary rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx(Pe,{competitions:v,processedCompetitions:p,competitionsStatus:X,selectedCompetition:l,onCompetitionSelect:ae,getCompetitionStatusPriority:ee,selectedGroupFilter:u,setSelectedGroupFilter:f})})})}),e.jsxs("div",{className:"lg:col-span-3 space-y-2",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx(Te,{processedCompetitions:p,selectedCompetition:l,selectedJudges:n,onJudgeSelect:a})})}),n.length>0&&l&&e.jsx("div",{className:"space-x-1 flex flex-row overflow-x-auto",children:n.map((s,c)=>{const r=p.find(S=>S.competitionId==l)?.judges?.find(S=>S.judgeId.toString()===s.toString());return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-primary",children:["Judge: ",r?.judgeName||`Judge ${s}`]}),e.jsxs("p",{className:"text-xs text-onSurfaceVariant mt-1",children:["Status: ",r?.scoreStatus===1||r?.scoreStatus==="1"?"Filled":r?.scoreStatus===2||r?.scoreStatus==="2"?"Published":"Allowed To Fill"]})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("div",{className:"w-28 flex-shrink-0",children:e.jsx(Ve,{participants:R,participantsStatus:re,activeParticipantId:V,currentParticipantIndex:L,participantScores:D,onParticipantSelect:N,onNavigateParticipant:y,judgeId:s,showJudgeSpecificScores:n.length>1})}),e.jsx("div",{className:"flex-1",children:e.jsx(ke,{activeParticipantId:V,participants:R,competitionDetails:z,criteriaScores:o,participantScores:D,participantNotes:J,onScoreChange:I,onNotesChange:A,onSaveScore:U,onDeleteScore:K,selectedCompetition:l,processedCompetitions:p,selectedJudges:[s],currentJudgeId:s})})]})]},s)})})]})]}),(n.length===0||!l)&&e.jsxs("div",{className:"bg-surfaceCard rounded-lg shadow-sm p-8 text-center",children:[e.jsx(we,{className:"h-12 w-12 text-onSurfaceVariant mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-onSurface mb-2",children:"Welcome to Judge Scoring Panel"}),e.jsx("p",{className:"text-onSurfaceVariant mb-4",children:"Please select a judge and competition to begin scoring participants."}),e.jsx("div",{className:"text-sm text-onSurfaceVariant",children:"Enhanced with modern UX patterns and interactive scoring features"})]})]})]})})};export{Ue as default};
