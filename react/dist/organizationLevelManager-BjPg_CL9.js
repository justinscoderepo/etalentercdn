import{r as d,k as S,j as a,d as U,h as M}from"./main-CNwsE70q.js";import{u as q}from"./index.esm-BL8OPNFa.js";import R from"./textBox-Ct1KoYV8.js";import{F}from"./BuildingOfficeIcon-BR0-hWkI.js";import{F as V}from"./XMarkIcon-B-6fa6OM.js";import{F as T}from"./PlusIcon-CDgLbrzv.js";import"./validationMessage-D_gLv93j.js";import"./EyeSlashIcon-BHiEAmaa.js";import"./EyeIcon-DzO4qsbT.js";import"./ChatBubbleBottomCenterTextIcon-v0M-VItJ.js";const B=({isOpen:s,onClose:r,level:t,parentOrganizationId:f,user:h,onOrganizationAdded:p})=>{const{register:O,control:w,handleSubmit:z,getValues:A,reset:y,formState:{errors:L,isSubmitting:g}}=q({defaultValues:{organizationName:"",shortName:""}}),c=A(),j=d.useCallback(async N=>{if(!N.organizationName?.trim()){S.error("Organization name is required");return}try{const b={Name:N.organizationName,ShortName:N.shortName||N.organizationName.substring(0,10).toUpperCase(),CompetitionLevel:t?.EventLevelId,ParentOrganization:f,OrganizationType:2,Status:1,CreatedBy:h?.UId,AllowOrganizationId:1};await p(b),S.success(`${t?.LevelName} "${N.organizationName}" added successfully`),y(),r()}catch(b){console.error("Failed to add organization:",b),S.error(`Failed to add ${t?.LevelName}. Please try again.`)}},[t,f,h,p,y,r]);return s?a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:a.jsxs("div",{className:"flex items-center justify-center min-h-screen px-2 pt-2 pb-8 text-center sm:block sm:p-0",children:[a.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:r}),a.jsxs("div",{className:"inline-block w-full max-w-md p-4 my-6 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{className:"h-5 w-5 text-primary"}),a.jsxs("h3",{className:"text-base font-medium text-gray-900",children:["Add New ",t?.LevelName]})]}),a.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(V,{className:"h-5 w-5"})})]}),a.jsxs("form",{onSubmit:z(j),className:"space-y-4",children:[a.jsx("div",{children:a.jsx(R,{fieldName:"organizationName",label:`${t?.LevelName} Name`,placeholder:`Enter ${t?.LevelName} name...`,control:w,register:O,formData:c,errors:L,optional:!1,disabled:g})}),a.jsx("div",{children:a.jsx(R,{fieldName:"shortName",label:"Short Name (Optional)",placeholder:"Enter short name...",control:w,register:O,formData:c,errors:L,optional:!0,disabled:g,maxLength:10})}),a.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx("button",{type:"button",onClick:r,disabled:g,className:"inline-flex items-center gap-x-2 rounded-md bg-gray-200 px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:g,className:"inline-flex items-center gap-x-2 rounded-md bg-primary px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-primaryHover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:g?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Adding..."]}):a.jsxs(a.Fragment,{children:[a.jsx(T,{className:"h-4 w-4"}),"Add ",t?.LevelName]})})]})]})]})]})}):null},Z=({user:s,eventLevels:r,topLevels:t,selectedOrganizations:f,onOrganizationChange:h,onFormDataChange:p,className:O=""})=>{const[w,z]=d.useState(!1),[A,y]=d.useState(null),[L,g]=d.useState(null),c=d.useCallback(e=>{if(!Array.isArray(f))return"";const i=f.find(o=>o[e]!==void 0);return i?i[e]:""},[f]),{rows:j,update:N}=U("/OrganizationJson/Get",{select:"Id,Name,OrganizationId,ShortName,CompetitionLevel,CompetitionLevelLevelName,Order,ParentOrganization,ParentOrganizationName",filter:{Status:1,OrganizationType:2},limit:1e3,offset:0,sort:{sortColumn:"Order",sortOrder:"asc"},updateUrl:"/OrganizationJson/Save"}),[b,k]=d.useState(!1);d.useEffect(()=>{if(b||!r||!s)return;if(r[0]&&c(r[0]?.LevelName)){k(!0);return}const e=[];r[0]&&e.push({[r[0].LevelName]:s.Organization}),s.Role===3&&t&&r.forEach(i=>{t[i.LevelName]&&e.push({[i.LevelName]:t[i.LevelName]})}),e.length>0&&(k(!0),setTimeout(()=>{h(e)},0))},[r,s,t,c,b]);const x=d.useMemo(()=>!r||r.length<=1?[]:r.slice(1),[r]),E=d.useCallback((e,i)=>{if(!j)return[];const o=i+1;let n=null;if(o===1)n=s?.Organization;else if(o>1){const l=r[o-1];n=c(l?.LevelName)}return j.filter(l=>!(l.CompetitionLevel!==e.EventLevelId||n&&l.ParentOrganization!=n))},[j,c,s,r]),P=d.useCallback((e,i,o)=>{let n=[...Array.isArray(f)?f:[]];n=n.filter(m=>!m[e]),i&&n.push({[e]:i});const l=o+1;for(let m=l+1;m<r.length;m++){const u=r[m];u&&(n=n.filter($=>!$[u.LevelName]))}h(n)},[f,r,h]),v=d.useCallback((e,i)=>{const o=i+1;let n=s?.Organization;if(o>1){const l=r[o-1];n=c(l?.LevelName)}y(e),g(n),z(!0)},[c,r,s]),C=d.useCallback(e=>s?.Role===3&&t&&t[level.LevelName],[s,t]),I=d.useMemo(()=>{const e={AllowToLoadSubOrg:"",OrderFrom:s?.OrganizationLevelOrder+1||1,OrganizationType:"2",ParentOrganization:s?.Organization,levels:{},Group:"",ParticipantType:"",AgeFrom:"",AgeTo:"",UsersRolesModel:{},TeamModel:{},teamrequiredelements:{},userrequiredelements:{}};return r?.[0]&&(e.levels[r[0].LevelName]=s?.Organization),x.forEach((i,o)=>{const n=o+1,l=C(i.LevelName),m=c(i.LevelName)||"";l?e.levels[i.LevelName]=t[i.LevelName]:e.levels[i.LevelName]=m,e.UsersRolesModel[i.LevelName]=l?t[i.LevelName]:m,e.TeamModel[i.LevelName]=l?t[i.LevelName]:m,n>0&&(e.teamrequiredelements[i.LevelName]=l?t[i.LevelName]:m,e.userrequiredelements[i.LevelName]=l?t[i.LevelName]:m)}),r?.forEach((i,o)=>{o===0?(e.UsersRolesModel[i.LevelName]=s?.Organization,e.TeamModel[i.LevelName]=s?.Organization):s?.Role===3&&t&&t[i.LevelName]&&(e.UsersRolesModel[i.LevelName]=t[i.LevelName],e.TeamModel[i.LevelName]=t[i.LevelName])}),e},[s,r,x,t,c,C]);return d.useEffect(()=>{p&&p(I)},[I,p]),!r||r.length<=1?null:a.jsxs("div",{className:M("w-full",O),children:[x.length>0&&a.jsx("div",{className:M("grid gap-3",x.length===1&&"grid-cols-1",x.length===2&&"grid-cols-1 md:grid-cols-2",x.length===3&&"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",x.length>=4&&"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"),children:x.map((e,i)=>{const o=i+1,n=C(e.LevelName),l=E(e,i),m=c(e.LevelName)||"";return n?null:a.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsxs("h4",{className:"text-xs font-medium text-primary flex items-center mr-2",children:[a.jsx(F,{className:"h-3 w-3 mr-1"}),e.LevelName]}),a.jsxs("button",{type:"button",onClick:()=>v(e,i),className:"inline-flex items-center gap-x-1 rounded-md bg-primary px-2 py-0.5 text-xs font-medium text-white shadow-sm hover:bg-primaryHover",children:[a.jsx(T,{className:"h-3 w-3"}),"Add"]})]}),a.jsx("div",{children:a.jsxs("select",{id:`levelid_${o}`,name:"ParentOrganization",className:"pl-2 block w-full rounded-md border-0 py-1 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm text-xs text-gray-900 focus:border-darkprimary ring-gray-300",value:m,onChange:u=>P(e.LevelName,u.target.value,i),children:[o===r.length-1?a.jsxs("option",{value:"all",children:["All ",e.LevelName?.toLowerCase()," Candidates"]}):a.jsxs(a.Fragment,{children:[a.jsxs("option",{value:"",children:["Please add ",e.LevelName?.toLowerCase()," name"]}),a.jsxs("option",{value:"all",children:["All ",e.LevelName?.toLowerCase()," Candidates"]})]}),l.map(u=>a.jsxs("option",{value:u.Id,children:[u.Order&&u.Order!==0?`${u.Order} - `:"",u.Name]},u.Id))]})})]},e.LevelName)})}),a.jsx(B,{isOpen:w,onClose:()=>{z(!1),y(null),g(null)},level:A,parentOrganizationId:L,user:s,onOrganizationAdded:async e=>{await N(e)}})]})};export{Z as default};
