import{r as g,j as e,f as q,g as Se}from"./main-T_zjahGS.js";import{u as se}from"./useBackend-BiEufqUg.js";import{c as z}from"./utilities-CN4lTu6a.js";import{F as le,a as ye}from"./StarIcon-D4sm9Ywu.js";import{F as Ne}from"./CheckCircleIcon-CJURfTdD.js";import{F as he}from"./CheckCircleIcon-Do9fQXHq.js";import{F as je}from"./TrashIcon-BqXm-g9R.js";import{F as ue}from"./TrophyIcon-C5FCTHOP.js";import"./httpService-DhFNxXIP.js";import"./index-t--hEgTQ.js";function ve({title:d,titleId:u,...i},n){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":u},i),d?g.createElement("title",{id:u},d):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const Ce=g.forwardRef(ve);function we({title:d,titleId:u,...i},n){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":u},i),d?g.createElement("title",{id:u},d):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const de=g.forwardRef(we);function Ie({title:d,titleId:u,...i},n){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":u},i),d?g.createElement("title",{id:u},d):null,g.createElement("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z",clipRule:"evenodd"}))}const Je=g.forwardRef(Ie),$e=({competitions:d,processedCompetitions:u,competitionsStatus:i,selectedCompetition:n,onCompetitionSelect:j,getCompetitionStatusPriority:l,selectedGroupFilter:C,setSelectedGroupFilter:F})=>{const[$,A]=g.useState([]);g.useEffect(()=>{let t=u;C!=="all"&&(t=t.filter(m=>m.competitionGroupName===C)),A(t)},[u,C]);const x=t=>{const m=t.competitionOrder+" -"||"",h=t.competitionGroupName||"",o=t.competitionItemTitle||"",k=t.competitionGenderTitle||"",G=t.competitionLanguageName||"",E=t.statusTitle||"",J=t.competitionGender===3,O=t.competitionLanguage===4;let v=[];return m&&v.push(m),h&&v.push(h),o&&v.push(o),!J&&!O?(k&&v.push(k),G&&v.push(G)):J&&!O?G&&v.push(G):!J&&O&&k&&v.push(k),E&&v.push(`- ${E}`),v.join(" ").trim()||`Competition ${t.competitionId}`},N=t=>{switch(t){case"Filling in Progress":return 1;case"Allowed to Fill":return 2;case"Filled":return 3;case"Published":return 4;case"No Judges Assigned":return 5;default:return 6}},T=t=>{const m=t.competitionGroupName||"";let h="";if(t.judges&&t.judges.length>0){const o=t.judges.filter(J=>J.scoreStatus===1||J.scoreStatus==="1").length,k=t.judges.filter(J=>J.scoreStatus===2||J.scoreStatus==="2").length,G=t.judges.filter(J=>!J.scoreStatus||J.scoreStatus===0||J.scoreStatus==="0"||J.scoreStatus===3||J.scoreStatus==="3").length,E=t.judges.length;console.log(o,k,G,E),G>0&&G!==E?h="Filling in Progress":G===E?h="Allowed to Fill":o+k===E?h="Filled":k===E&&(h="Published")}return t._groupPriority=N(h),m&&h?`${m} - ${h}`:m||h||"General"},p=t=>t.inProgressJudges>0?"bg-blue-50 border-blue-200 text-blue-700":t.finishedJudges===t.totalJudges&&t.competitionStatus!==4?"bg-green-50 border-green-200 text-green-700":t.competitionStatus===4?"bg-purple-50 border-purple-200 text-purple-700":"bg-gray-50 border-gray-200 text-gray-700";return i==="loading"?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading competitions..."})]})}):u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No Competitions Available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No competitions have been assigned yet."})]}):$.length===0?e.jsxs("div",{children:[e.jsx("h2",{className:"border-b-2 border-b-[#485257] text-[#206689] items-center mb-4 font-medium pb-1 px-1 w-full uppercase text-lg",children:"Competition & Judge Selection"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No Competitions Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No competitions match the selected group filter. Try adjusting your filter settings."})]})]}):e.jsxs("div",{className:"",children:[e.jsx("div",{className:"block lg:hidden ",children:e.jsx("div",{className:"mb-2",children:e.jsxs("select",{value:n,onChange:t=>j(t.target.value),className:"block w-full rounded-md border-0 py-2 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-primary focus:border-primary sm:text-sm sm:leading-6",children:[e.jsx("option",{value:"",children:C==="all"?"Choose Competition...":`Choose Competition from ${C}...`}),(()=>{const t=$.reduce((m,h)=>{const o=T(h);return m[o]||(m[o]=[]),m[o].push(h),m},{});return console.log(t),Object.entries(t).sort(([,m],[,h])=>{const o=m[0]?._groupPriority||999,k=h[0]?._groupPriority||999;return o-k}).map(([m,h])=>e.jsx("optgroup",{label:m,children:h.map(o=>e.jsxs("option",{value:o.competitionId,"data-competition-status":o.competitionStatus,"data-allotment-id":o.allotementId,children:[x(o)," (",o.totalJudges," judges)"]},o.competitionId))},m))})()]})})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"max-h-[calc(100vh-120px)] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:e.jsx("div",{className:"w-full pr-2",children:(()=>{const t=$.reduce((m,h)=>{const o=T(h);return m[o]||(m[o]=[]),m[o].push(h),m},{});return Object.entries(t).sort(([,m],[,h])=>{const o=m[0]?._groupPriority||999,k=h[0]?._groupPriority||999;return o-k}).map(([m,h])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-bold bg-white text-gray-600 uppercase tracking-wide mb-2 px-2 sticky top-0  py-1 z-10",children:m}),e.jsx("div",{className:"space-y-2",children:h.map(o=>e.jsx("button",{onClick:()=>j(o.competitionId),className:`w-full text-left py-3 px-3 rounded-lg border transition-colors ${n===o.competitionId?"bg-gray-200 text-primary border-primary":p(o)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:`font-medium mr-1 text-xs break-words ${n===o.competitionId?"text-primary":"text-gray-900"}`,title:x(o),children:x(o)})}),o.competitionCode&&e.jsx("div",{className:`mb-3 ${n===o.competitionId,"text-gray-800"}`,children:e.jsxs("p",{className:"text-xs break-words",title:`Code: ${o.competitionCode}`,children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",o.competitionCode]})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs space-y-1",children:[o.finishedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-green-800"}`,children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{children:o.finishedJudges})]}),o.inProgressJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-blue-800"}`,children:[e.jsx(Je,{className:"h-5 w-5"}),e.jsx("span",{children:o.inProgressJudges})]}),o.notStartedJudges>0&&e.jsxs("div",{className:`flex items-center space-x-1 ${n===o.competitionId,"text-gray-500"}`,children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:o.notStartedJudges})]})]})})]})},o.competitionId))})]},m))})()})})})]})},Te=({processedCompetitions:d,selectedCompetition:u,selectedJudges:i,onJudgeSelect:n})=>{const[j,l]=g.useState(!1),[C,F]=g.useState([]);g.useEffect(()=>{const t=()=>{l(window.innerWidth>1200)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),g.useEffect(()=>{i&&i.length>0&&F(i)},[i]),console.log({selectedCompetition:u,processedCompetitions:d,isWideScreen:j,localSelectedJudges:C,selectedJudges:i});const $=t=>t.scoreStatus===1||t.scoreStatus==="1"?"bg-green-50 border-green-200 text-green-700":t.scoreStatus===2||t.scoreStatus==="2"?"bg-blue-50 border-blue-200 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700",A=t=>t.scoreStatus===1||t.scoreStatus==="1"?"Filled":t.scoreStatus===2||t.scoreStatus==="2"?"Published":"Allowed To Fill",x=t=>{if(j){const m=C.includes(t)?C.filter(h=>h!==t):[...C,t];F(m),n(m)}else{const m=[t];F(m),n(m)}},N=t=>C.includes(t.toString());if(!u)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Select a Competition"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a competition to see available judges."})]});const p=d.find(t=>t.competitionId==u)?.judges||[];return p.length===0&&u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No Judges Available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No judges found for this competition."})]}):e.jsx("div",{children:u&&e.jsx("div",{children:e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-row gap-2 flex-wrap",children:p.map(t=>e.jsxs("label",{className:`group relative flex rounded-lg border p-2 sm:p-3 min-w-24 sm:min-w-28 flex-1 sm:flex-none cursor-pointer transition-colors ${N(t.judgeId)?"border-primary bg-primary text-white shadow-sm":`${$(t)} hover:border-primary hover:shadow-sm bg-white`}`,children:[e.jsx("input",{type:j?"checkbox":"radio",name:j?`judge-${t.judgeId}`:"judge",value:t.judgeId,checked:N(t.judgeId),onChange:()=>x(t.judgeId.toString()),className:"absolute inset-0 appearance-none focus:outline-none focus:ring-0 border-transparent outline-0 invisible"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:`block text-xs sm:text-sm font-semibold ${N(t.judgeId)?"text-white":"text-gray-900"}`,children:t.judgeName}),e.jsx("span",{className:`block text-[10px] mt-0.5 sm:mt-1 ${N(t.judgeId)?"text-blue-100":"text-gray-500"}`,children:A(t)})]})}),e.jsx("div",{className:"absolute bottom-1 right-1 sm:bottom-2 sm:right-2",children:(t.scoreStatus===1||t.scoreStatus==="1"||t.scoreStatus===2||t.scoreStatus==="2")&&e.jsx(he,{className:`h-3 w-3 sm:h-4 sm:w-4 ${N(t.judgeId)?"text-green-200":"text-green-500"}`})})]},t.judgeId))})})})})},Pe=({participants:d,participantsStatus:u,activeParticipantId:i,currentParticipantIndex:n,participantScores:j,onParticipantSelect:l,onNavigateParticipant:C,judgeId:F,showJudgeSpecificScores:$=!1})=>{const A=x=>{if($&&F){const N=`judge_${F}_${x}`;return j[N]||j[x]||"-"}return j[x]||"-"};return u==="loading"?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsx("div",{className:"text-center text-gray-500 py-4",children:"Loading participants..."})}):!d||d.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"No participants found"})]})}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"space-y-1",children:d.map((x,N)=>e.jsx("button",{onClick:()=>l(x.ParticipantId,N),className:z("w-full text-left p-3 rounded-md transition-colors",x.ParticipantId===i?"bg-primary text-white":"hover:bg-gray-50 bg-white border border-gray-200"),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:z("text-sm font-medium",x.ParticipantId===i?"text-white":"text-gray-900"),children:x.IdentityNumber?x.IdentityNumber:x.CandidateIdentityNumber||x.ParticipantNumber}),e.jsx("div",{className:z("text-sm font-medium",x.ParticipantId===i?"text-green-200":"text-primary"),children:A(x.ParticipantId)})]})},x.ParticipantId))})})})})},me=({value:d,onChange:u,maxStars:i=10,criteriaId:n,participantId:j,disabled:l=!1})=>{const[C,F]=g.useState(0),$=x=>{l||u(x,n,j)},A=x=>{l||F(x)};return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex items-center justify-center gap-1 mb-2 w-full",children:[...Array(i)].map((x,N)=>{const T=N+1,p=T<=(C||d||0);return e.jsx("button",{type:"button",disabled:l,className:z("flex-1 flex items-center justify-center p-1 transition-colors duration-150 max-w-8 max-h-8 aspect-square",l?"cursor-not-allowed opacity-50":"cursor-pointer",p?"text-yellow-400":"text-gray-300 hover:text-yellow-200"),onMouseEnter:()=>A(T),onMouseLeave:()=>F(0),onClick:()=>$(T),children:p?e.jsx(ye,{className:"w-full h-full min-w-4 min-h-4"}):e.jsx(Ce,{className:"w-full h-full min-w-4 min-h-4"})},N)})})})},ge=({value:d,onChange:u,maxMarks:i=100,minMarks:n=0,criteriaId:j,participantId:l,disabled:C=!1,placeholder:F="Enter marks"})=>{const $=x=>{const N=x.target.value,T=parseFloat(N);!isNaN(T)&&T>=n&&T<=i?u(T,j,l):N===""&&u(0,j,l)},A=()=>{const x=parseFloat(d);isNaN(x)||x<n?u(n,j,l):x>i&&u(i,j,l)};return e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",min:n,max:i,step:"0.1",value:d||"",onChange:$,onBlur:A,disabled:C,placeholder:F,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-gray-900 focus:border-darkprimary placeholder:text-gray-400 ring-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed"})})})},xe=({value:d,onChange:u,maxCount:i=10,minCount:n=0,criteriaId:j,participantId:l,disabled:C=!1,label:F="Count"})=>{const $=()=>{if(C||(d||0)>=i)return;const N=(d||0)+1;u(N,j,l)},A=()=>{if(C||(d||0)<=n)return;const N=Math.max(n,(d||0)-1);u(N,j,l)},x=N=>{const T=parseInt(N.target.value);!isNaN(T)&&T>=n&&T<=i&&u(T,j,l)};return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:A,disabled:C||(d||0)<=n,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-gray-600",children:e.jsx("span",{className:"text-lg font-medium",children:"−"})}),e.jsx("div",{className:"flex-1 max-w-20",children:e.jsx("input",{type:"number",step:"0.1",min:n,max:i,value:d||0,onChange:x,disabled:C,className:"text-center pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-gray-900 focus:border-darkprimary placeholder:text-gray-400 ring-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed"})}),e.jsx("button",{type:"button",onClick:$,disabled:C||(d||0)>=i,className:"inline-flex items-center justify-center w-8 h-8 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-gray-600",children:e.jsx("span",{className:"text-lg font-medium",children:"+"})})]})},ke=({activeParticipantId:d,participants:u,competitionDetails:i,criteriaScores:n,participantScores:j,participantNotes:l,onScoreChange:C,onNotesChange:F,onSaveScore:$,onDeleteScore:A,selectedCompetition:x,processedCompetitions:N,selectedJudges:T,currentJudgeId:p})=>{const[t,m]=g.useState(!1),[h,o]=g.useState({}),[k,G]=g.useState(""),[E,J]=g.useState(0),O=u?.find(a=>a.ParticipantId===d),v=N?.find(a=>a.competitionId==x),X=()=>{if(!p||!v||!v.judges)return"";const a=v.judges.find(y=>y.judgeId.toString()===p.toString());return a?a.judgeName:`Judge ${p}`},Q=(a,y=p)=>T.length>1?`${a}_judge_${y}`:a,W=()=>!i||i.length===0||i.every(y=>y.Value&&y.Value!=0&&y.Value==v.competitionMaximumScore)?!1:i.every(y=>y.Value&&y.Value!=0),D=(a=h)=>{if(!i||i.length===0)return E;let y=0;const w=W();return i.forEach(I=>{const R=I.DetailId||I.CompetitionDetailsId,L=a[R]||0;y+=L}),w?y:y/i.length},re=a=>{if(J(a),!i||i.length===0)return;const y={...h};if(W()){const I=i.reduce((R,L)=>R+(L.Value||0),0);i.forEach(R=>{const L=R.DetailId||R.CompetitionDetailsId,U=R.Value||0,K=I>0?a*U/I:0,te=R.Value||10;y[L]=Math.min(K,te)})}else i.forEach(I=>{const R=I.DetailId||I.CompetitionDetailsId,L=I.Value||10;y[R]=Math.min(a,L)});o(y)};if(g.useEffect(()=>{if(d&&p){const a={},y=Q(d),w=j[y]||0;if(J(w),i&&i.length>0&&(i.forEach(L=>{const U=L.DetailId||L.CompetitionDetailsId,K=Q(`${U}_${d}`);a[U]=n[K]||0}),!Object.values(a).some(L=>L>0)&&w>0&&D(a)!==w)){re(w);return}o(a);const I=Q(d);G(l[I]||"")}},[d,j,n,l,i,p]),!O)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 text-center",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Select a participant to begin scoring"})});const ae=async()=>{m(!0);try{const a={...O,judgeId:p,totalScore:E,criteriaScores:h,notes:k};if(await $(d,null,E,p),i&&i.length>0)for(const y of i){const w=y.DetailId||y.CompetitionDetailsId,I=h[w]||0;C(I,w,d,p),await $(d,w,I,p)}F(d,k,p),q.success(`Score saved successfully for ${X()}!`)}catch(a){console.error("Error saving scores:",a),q.error("Failed to save score. Please try again.")}finally{m(!1)}},Z=async()=>{if(window.confirm(`Are you sure you want to delete the score for this participant from ${X()}?`)){m(!0);try{if(await A(d,null,p),i&&i.length>0)for(const a of i){const y=a.DetailId||a.CompetitionDetailsId;await A(d,y,p)}J(0),o({}),G(""),q.success(`Score deleted successfully for ${X()}!`)}catch(a){console.error("Error deleting scores:",a),q.error("Failed to delete score. Please try again.")}finally{m(!1)}}},ne=()=>v?.competitionMaximumScore||10,H=()=>{switch(v?.scoreLabel){case 1:return"marks";case 2:return"count";case 3:case 4:return"star";default:return"marks"}},Y=()=>H(),ee=()=>{const a=ne(),y=Y(),w={value:E,onChange:I=>re(I),disabled:t,criteriaId:"total",participantId:d};return y==="count"?e.jsx(xe,{...w,maxCount:a,label:"Total Count"}):y==="marks"?e.jsx(ge,{...w,maxMarks:a,placeholder:"Enter total score"}):e.jsx(me,{...w,maxStars:Math.min(a,10),maxScore:a})},ie=(a,y)=>{const w=a.DetailId||a.CompetitionDetailsId,I=h[w]||0,R=a.Value||10,L=Y(),U=(K,te,s)=>{const c={...h,[te]:K};o(c);const f=D(c);J(f)};return L==="count"?e.jsx(xe,{value:I,onChange:U,maxCount:R,criteriaId:w,participantId:d,disabled:t}):L==="star"?e.jsx(me,{value:I,onChange:U,maxStars:10,maxScore:R,criteriaId:w,participantId:d,disabled:t}):e.jsx(ge,{value:I,onChange:U,maxMarks:R,criteriaId:w,participantId:d,disabled:t})},oe=i&&i.length>0;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900",children:O.CandidateName}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ID: #",O.CandidateIdentityNumber||O.TeamIdentityNumber]})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Enter Score"}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:"Total Score"}),e.jsx("p",{className:"text-xs text-gray-500",children:oe?"Enter total score (will auto-distribute to criteria below)":"Enter the participant's total score"})]})}),e.jsx("div",{className:"mt-3",children:ee()}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[E.toFixed(1)," / ",ne()]})})]})]}),oe&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"border-b-[#4852573e] text-[#206689] mb-4 items-center font-medium pb-1 px-1 w-full uppercase border-b text-sm",children:"Detailed Criteria Scoring (Optional)"}),e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsx("div",{className:"space-y-4",children:i.map((a,y)=>{`${a.DetailId||a.CompetitionDetailsId}${d}`;const w=a.DetailId||a.CompetitionDetailsId,I=h[w]||0,L=Y()==="star";return e.jsx("div",{className:y>0?"border-t border-gray-200 pt-4":"",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:a.CriteriaName||a.CompetitionDetailsTitle}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",a.Value||10," points"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:ie(a)}),L&&e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"text-sm font-semibold text-primary",children:[I.toFixed(1)," / ",a.Value||10]})})]})]})},a.DetailId||a.CompetitionDetailsId)})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold leading-6 text-gray-900 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:k,onChange:a=>G(a.target.value),disabled:t,placeholder:"Add any additional comments or notes about this participant's performance...",rows:3,className:"pl-3 block w-full rounded-md border-0 py-1.5 ring-1 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 text-gray-900 focus:border-darkprimary placeholder:text-gray-400 ring-gray-300 disabled:bg-gray-100"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("button",{onClick:Z,disabled:t,className:"inline-flex items-center gap-x-2 rounded-md bg-gray-200 px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50",children:[e.jsx(je,{className:"-mr-0.5 h-5 w-5"}),"Delete Score"]}),e.jsx("button",{onClick:ae,disabled:t||E===0,className:z("inline-flex items-center gap-x-2 rounded-md px-6 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",t||E===0?"bg-gray-200 text-gray-700 cursor-not-allowed":"bg-primary text-white hover:bg-primaryHover"),children:t?"Saving...":"Save Score"})]})]})]})},Oe=({user:d})=>{const{user:u,token:i}=Se()||{};console.log("JudgesScoreCard - Current user role:",u?.Role),console.log("JudgesScoreCard - Current token:",i);const[n,j]=g.useState([]),[l,C]=g.useState(""),[F,$]=g.useState(null),[A,x]=g.useState(0),[N,T]=g.useState(!1),[p,t]=g.useState([]),[m,h]=g.useState("all"),[o,k]=g.useState({}),[G,E]=g.useState({}),[J,O]=g.useState({}),{rows:v,status:X,update:Q}=se("/JudgesAllotmentWithScoreLabelJson/Get",{select:"AllotementId,Competition,CompetitionParticipantType,CompetitionParticipantTypeTitle,CompetitionGroup,CompetitionGroupGroupName,CompetitionCompetitionItem,CompetitionItemTitle,CompetitionItemScoreLabel,ScoreLabelLabel,CompetitionLanguage,CompetitionLanguageLanguageName,CompetitionGender,CompetitionGenderGenderTitle,CompetitionCompetitionStatus,CompetitionCompetitionStatusCompetitionStatusTitle,CompetitionEventEventName,CompetitionOrder,CompetitionMaximumScore,CompetitionFees,CompetitionMaximumMinutes,CompetitionMaximumSeconds,CompetitionMinimumMinutes,CompetitionMinimumSeconds,CompetitionWarningMinute,CompetitionWarningSecond,ScoreStatus,ScoreStatusScoreResultStatus,Phase,PhaseTitle,Stage,StageTitle,Judge,Visibility,Status,EventEventName,Order,ModifiedDateString,CompetitionStatusTitle",filter:{NoGrouping:!0,CreatedBy:u?.UId,Status:"1",Event:u?.Event},sort:{sortColumn:"CompetitionOrder"},updateUrl:"/JudgesAllotmentJson/SaveJudgeStatus"}),{rows:W}=se("/UsersRolesJson/Get",{select:"UId,UserRoleId,UserName,Name,Role,Status",filter:{Role:"6",Status:"1"}}),{rows:D,status:re,setFilter:ae}=se("/CompetitionParticipantsScoreCardJson/Get",{select:"ParticipantId,CandidateIdentityNumber,CompetitionCompetitionItem,CompetitionGender,CompetitionGroup,CompetitionLanguage,CompetitionMaximumScore,CompetitionParticipantType,IdentityNumber,Notes,ParticipantIdScore,ParticipantIdScorecardId,ParticipantType,Status,TeamIdentityNumber,CandidateName,ParticipantNumber,ScorecardId",filter:{Status:"1"},noGet:!0,updateUrl:"/JudgeJson/SaveScore",deleteUrl:"/JudgeJson/DeleteScore"}),{rows:Z,setFilter:ne}=se("/JudgesDetailedScoreCardJson/Get",{select:"JudgesDetailedScoreCardId,ParticipantId,CompetitionDetailsId,Score,Judge,Competition,ScoreCard",filter:{},noGet:!0,updateUrl:"/JudgesDetailedScoreCardJson/Save",deleteUrl:"/JudgesDetailedScoreCardJson/Remove"}),{rows:H,setFilter:Y}=se("/CompetitionDetailsJson/Get",{select:"CriteriaName,DetailId,Order,SecondValue,Status,Value,Competition,CompetitionDetailsTitle,MaxScore,MinScore,CompetitionItem,ParticipantType,Gender,Group,Language,CompetitionDetailsId",filter:{},noGet:!0,updateUrl:"/CompetitionDetailsJson/Save"}),ee=s=>s.inProgressJudges>0?1:s.finishedJudges===s.totalJudges&&s.competitionStatus!==4?2:s.notStartedJudges===s.totalJudges?4:s.competitionStatus===4?5:3;g.useEffect(()=>{if(u&&u.Role===6&&p.length>0){const c=p.flatMap(f=>f.judges).find(f=>f.judgeName===u.UserName||f.judgeUserName===u.UserName||f.judgeId===u.UId||f.judgeId===u.UserRoleId);c&&j([c.judgeId.toString()])}},[u,p]),g.useEffect(()=>{if(v&&v.length>0&&W&&W.length>0){const s=v.reduce((f,r)=>{const b=r.Competition;if(f[b]||(f[b]={competitionId:b,allotementId:r.AllotementId,competitionName:r.CompetitionEventEventName||`Competition ${b}`,competitionCode:r.CompetitionCode||"",statusTitle:r.CompetitionStatusTitle||r.CompetitionCompetitionStatusCompetitionStatusTitle||"Unknown Status",competitionStatus:r.CompetitionCompetitionStatus,competitionItemTitle:r.CompetitionItemTitle,competitionGender:r.CompetitionGender,competitionGenderTitle:r.CompetitionGenderGenderTitle,competitionGroupName:r.CompetitionGroupGroupName,competitionItemScoreLabel:r.CompetitionItemScoreLabel,competitionLanguage:r.CompetitionLanguage,competitionLanguageName:r.CompetitionLanguageLanguageName,competitionOrder:r.CompetitionOrder||r.Order,competitionParticipantTypeTitle:r.CompetitionParticipantTypeTitle,scoreLabel:r.CompetitionItemScoreLabel,scoreLabelLabel:r.ScoreLabelLabel,scoreStatus:r.ScoreStatus,scoreStatusTitle:r.ScoreStatusScoreResultStatus,competitionMaximumScore:r.CompetitionMaximumScore>0?r.CompetitionMaximumScore:10,competitionFees:r.CompetitionFees,phaseTitle:r.PhaseTitle,stageTitle:r.StageTitle,judges:[],totalJudges:0,finishedJudges:0,inProgressJudges:0,notStartedJudges:0}),!f[b].judges.find(S=>S.judgeId===r.Judge&&S.allotmentId===r.AllotementId)){const S=W.find(_=>_.UserRoleId===r.Judge),B=S?S.Name||S.UserName:`Judge ${r.Judge}`;f[b].judges.push({judgeId:r.Judge,judgeName:B,judgeUserName:S?.UserName||"",scoreStatus:r.ScoreStatus,allotmentId:r.AllotementId}),f[b].totalJudges++,r.ScoreStatus===1||r.ScoreStatus==="1"?f[b].finishedJudges++:r.ScoreStatus===2||r.ScoreStatus==="2"?f[b].inProgressJudges++:f[b].notStartedJudges++}return f},{}),c=Object.values(s).sort((f,r)=>{const b=ee(f)-ee(r);if(b!==0)return b;const P=f.competitionOrder||0,S=r.competitionOrder||0;return P-S});t(c)}},[v,W]);const ie=g.useMemo(()=>{const s=[...new Set(p.map(c=>c.competitionGroupName).filter(Boolean))];return[{value:"all",label:"All Groups",count:p.length},...s.map(c=>({value:c,label:c,count:p.filter(f=>f.competitionGroupName===c).length}))]},[p]);g.useEffect(()=>{n.length>0&&l&&ae({Judge:n[0],Competition:l,Status:"1"})},[n,l]),g.useEffect(()=>{n.length>0&&l&&ne({Judge:n[0],Competition:l})},[n,l]),g.useEffect(()=>{l&&Y({Competition:l})},[l]),g.useEffect(()=>{if(Z&&Z.length>0){const s={},c={},f={};Z.forEach(r=>{r.CriteriaId&&(s[`${r.CriteriaId}_${r.ParticipantId}`]=r.Score),r.TotalScore&&(c[r.ParticipantId]=r.TotalScore),r.Notes&&(f[r.ParticipantId]=r.Notes)}),k(s),E(c),O(f)}},[Z]),g.useEffect(()=>{D&&D.length>0&&!F&&($(D[0].ParticipantId),x(0))},[D,F]);const oe=s=>{C(s),$(null),x(0)},a=s=>{j(s),$(null),x(0)},y=(s,c)=>{$(s),x(c)},w=s=>{if(!D||D.length===0)return;let c;s==="next"?(c=A+1,c>=D.length&&(c=0)):(c=A-1,c<0&&(c=D.length-1)),x(c),$(D[c]?.ParticipantId)},I=(s,c,f,r=null)=>{const b=r||n[0],P=n.length>1?`judge_${b}_`:"";if(c===null)E(S=>({...S,[`${P}${f}`]:s}));else{const S=`${P}${c}_${f}`;k(B=>({...B,[S]:s})),L(f,b)}},R=(s,c,f=null)=>{const r=f||n[0],b=n.length>1?`judge_${r}_`:"";O(P=>({...P,[`${b}${s}`]:c}))},L=(s,c=null)=>{const f=c||n[0],r=n.length>1?`judge_${f}_`:"",P=Object.keys(o).filter(S=>S.endsWith(`_${s}`)&&(n.length===1||S.startsWith(`judge_${f}_`))).reduce((S,B)=>S+(o[B]||0),0);E(S=>({...S,[`${r}${s}`]:P}))},U=async(s,c=null,f=null,r=null)=>{const b=r||n[0],P=n.length>1?`judge_${b}_`:"";try{const S={};if(S.Scores=[],c){const V={Judge:b,Competition:l,ParticipantId:s,CriteriaId:c,Score:f||o[`${P}${c}_${s}`]||0,AllotementId:v?.find(M=>M.Competition===l)?.AllotementId};S.Scores.push(V)}else if(H&&H.length>0){H.forEach(M=>{const fe=`${P}${M.DetailId||M.CompetitionDetailsId}_${s}`,ce=o[fe]||0;if(ce>0){const pe={Judge:b,Competition:l,ParticipantId:s,CriteriaId:M.DetailId||M.CompetitionDetailsId,Score:ce,AllotementId:v?.find(be=>be.Competition===l)?.AllotementId};S.Scores.push(pe)}});const V={Judge:b,Competition:l,ParticipantId:s,ScoreCardScore:G[`${P}${s}`]||0,IsTotalScore:!0,AllotementId:v?.find(M=>M.Competition===l)?.AllotementId};S.Scores.push(V)}else{const V={Judge:b,Competition:l,ParticipantId:s,ScoreCardScore:G[`${P}${s}`]||0,AllotementId:v?.find(M=>M.Competition===l)?.AllotementId};S.Scores.push(V)}S.notes=J[`${P}${s}`]||"",S.JudgeId=b;const _=await(await fetch("/JudgeJson/SaveScore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)})).json();if(_.Results>0&&_.Results!=="0")return _.Results;throw new Error(typeof _.Results=="string"?_.Results:"Failed to save score")}catch(S){throw console.error("Error saving score:",S),S}},K=async(s,c=null,f=null)=>{const r=f||n[0],b=n.length>1?`judge_${r}_`:"";try{const P={Judge:r,Competition:l,ParticipantId:s};return c?(P.CriteriaId=c,(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json()).success!==!1&&k(_=>{const V={..._};return delete V[`${b}${c}_${s}`],V})):(await(await fetch("/JudgesScoreCardJson/Remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json()).success!==!1&&(E(_=>{const V={..._};return delete V[`${b}${s}`],V}),k(_=>{const V={..._};return Object.keys(V).forEach(M=>{M.endsWith(`_${s}`)&&(n.length===1||M.startsWith(`judge_${r}_`))&&delete V[M]}),V}),O(_=>{const V={..._};return delete V[`${b}${s}`],V})),!0}catch(P){throw console.error("Error deleting score:",P),P}},te=async()=>{if(!(n.length===0||!l)){T(!0);try{const s={Competition:l,ScoreStatus:1,AllotementId:v?.find(c=>c.Competition===l)?.AllotementId};await Q(s),q.success("Competition marked as finished!")}catch(s){console.error("Error marking as finished:",s),q.error("Failed to mark competition as finished.")}finally{T(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-6 w-6 text-primary mr-3"}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Scoring Panel - Warning - Not finished"})})]}),n.length>0&&l&&e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:te,disabled:N,className:z("inline-flex items-center gap-x-2 rounded-md px-4 py-2 text-sm font-semibold shadow-sm",N?"bg-gray-200 text-gray-700 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"),children:[e.jsx(he,{className:"h-4 w-4"}),N?"Finishing...":"Mark as Finished"]})})]})})}),e.jsxs("div",{className:"px-2 lg:px-6 py-2",children:[p.length>0&&e.jsx("div",{className:"lg:mb-6",children:e.jsxs("div",{className:"bg-white rounded-t-lg lg:rounded-lg py-2 px-2 lg:px-6 ",children:[e.jsx("div",{className:"lg:hidden lg:mb-4 mt-1",children:e.jsx("select",{value:m,onChange:s=>h(s.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-darkprimary focus:ring-primary text-sm",children:ie.map(s=>e.jsxs("option",{value:s.value,children:[s.label," (",s.count,")"]},s.value))})}),e.jsx("nav",{className:"hidden lg:flex -mb-px space-x-4 overflow-x-auto",children:ie.map(s=>e.jsxs("button",{onClick:()=>h(s.value),className:`whitespace-nowrap py-2 px-6 border-b-2 font-medium text-sm transition-all duration-200 ${m===s.value?"border-primary text-primary bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.label," (",s.count,")"]},s.value))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-2",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsx("div",{className:"bg-white lg:border-t-2 lg:border-primary rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx($e,{competitions:v,processedCompetitions:p,competitionsStatus:X,selectedCompetition:l,onCompetitionSelect:oe,getCompetitionStatusPriority:ee,selectedGroupFilter:m,setSelectedGroupFilter:h})})})}),e.jsxs("div",{className:"lg:col-span-3 space-y-2",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"p-2",children:e.jsx(Te,{processedCompetitions:p,selectedCompetition:l,selectedJudges:n,onJudgeSelect:a})})}),n.length>0&&l&&e.jsx("div",{className:"space-y-4",children:n.map((s,c)=>{const r=p.find(b=>b.competitionId==l)?.judges?.find(b=>b.judgeId.toString()===s.toString());return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-primary",children:["Judge: ",r?.judgeName||`Judge ${s}`]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Status: ",r?.scoreStatus===1||r?.scoreStatus==="1"?"Filled":r?.scoreStatus===2||r?.scoreStatus==="2"?"Published":"Allowed To Fill"]})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("div",{className:"w-28 flex-shrink-0",children:e.jsx(Pe,{participants:D,participantsStatus:re,activeParticipantId:F,currentParticipantIndex:A,participantScores:G,onParticipantSelect:y,onNavigateParticipant:w,judgeId:s,showJudgeSpecificScores:n.length>1})}),e.jsx("div",{className:"flex-1",children:e.jsx(ke,{activeParticipantId:F,participants:D,competitionDetails:H,criteriaScores:o,participantScores:G,participantNotes:J,onScoreChange:I,onNotesChange:R,onSaveScore:U,onDeleteScore:K,selectedCompetition:l,processedCompetitions:p,selectedJudges:[s],currentJudgeId:s})})]})]},s)})})]})]}),(n.length===0||!l)&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Welcome to Judge Scoring Panel v2"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Please select a judge and competition to begin scoring participants."}),e.jsx("div",{className:"text-sm text-gray-400",children:"Enhanced with modern UX patterns and interactive scoring features"})]})]})]})};export{Oe as default};
